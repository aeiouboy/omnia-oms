{
  "id": "2617715",
  "permalink": "payment-schedulers",
  "title": "Payment Schedulers & Batch Processing",
  "type": "topic",
  "level": 5,
  "path": "Manhattan Active® Omni/Order Management/Process & Configuration Guides/Order Selling/Payment/Payment Schedulers & Batch Processing",
  "raw_item": {
    "id": "2617715",
    "text": "Payment Schedulers & Batch Processing",
    "title": "Payment Schedulers & Batch Processing",
    "permalink": "payment-schedulers",
    "leaf": false,
    "droppable": true,
    "expanded": true,
    "closed": true,
    "visible": true,
    "editable": true,
    "type": "topic",
    "topicType": "0",
    "status": "1",
    "iconCls": "icon-topic",
    "cls": "",
    "folder_id": "129592",
    "parent": "f;129592",
    "created_date": "1597861327",
    "modified_date": "1684389314",
    "instructor_id": null,
    "loaded": true,
    "haschildren": false,
    "callout": "0",
    "order": "12"
  },
  "success": true,
  "content": "\r\n\r\n\r\n<div class=\"hiq-page-wrap\">\r\n<div class=\"hiq-t-wrap\">\r\n\t\t\r\n  \t  <div class=\"hiq-t \">\r\n\t\t\t\t<ul class=\"breadcrumbs\"><li><a class=\"breadcrumb-links\" hqid=\"1788908\"  href=\"/home\">Home</a></li> <li><span>&rsaquo;&rsaquo;</span><a hqid=\"3500940\" href=\"/omni\" class=\"breadcrumb-links\">Manhattan Active® Omni</a></li><li><span>&rsaquo;&rsaquo;</span><a hqid=\"2158393\" href=\"/order-management\" class=\"breadcrumb-links\">Order Management</a></li><li><span>&rsaquo;&rsaquo;</span><a hqid=\"2158394\" href=\"/process-configuration-guides\" class=\"breadcrumb-links\">Process & Configuration Guides</a></li><li><span>&rsaquo;&rsaquo;</span><a hqid=\"2163646\" href=\"/order-selling-2\" class=\"breadcrumb-links\">Order Selling</a></li><li><span>&rsaquo;&rsaquo;</span><a hqid=\"2163647\" href=\"/payment-2\" class=\"breadcrumb-links\">Payment</a></li><li> <span>››</span>Payment Schedulers & Batch Processing</li></ul>  \t\r\n\t\t<h2>Payment Schedulers &amp; Batch Processing</h2>\r\n\r\n<p></p>\r\n\r\n<a href=\"/payment-gateway-integration\" hqid=\"2617714\">Previous</a>&nbsp;I&nbsp;<a href=\"/payment-fraud\" hqid=\"2617716\">Next</a>\r\n<p>&nbsp;</p>\r\n\r\n<p>This section explains the various ways in which payment can be processed, whether in real-time or via scheduled jobs. It also explains how to implement batch payment processing&nbsp;for third parties which require batch files.</p>\r\n\r\n<div class=\"info\"><ul><li><a href=\"/payment-schedulers$real-time-payments\">Real Time Payments</a></li><li><a href=\"/payment-schedulers$scheduled-nbsp-payment-processing\">Scheduled&nbsp;Payment Processing</a><ul><li><a href=\"/payment-schedulers$configuring-payment-schedulers\">Configuring Payment Schedulers</a></li><li><a href=\"/payment-schedulers$scheduling-payment-transactions\">Scheduling Payment Transactions</a></li></ul></li><li><a href=\"/payment-schedulers$batch-payment-processing\">Batch Payment Processing</a></li><li><a href=\"/payment-schedulers$contact-center-payments\">Contact Center Payments</a></li><li><a href=\"/payment-schedulers$implementation-flavors\">Implementation Flavors</a></li><li><a href=\"/payment-schedulers$related-articles\">Related Articles</a></li></ul></div>\r\n\r\n<h3><a name=\"real-time-payments\" id=\"real-time-payments\"></a>Real Time Payments</h3>\r\n\r\n<p>Payments can be executed in real time, as payment transactions are created, or periodically by using scheduled jobs. Real time payments can optionally be limited to only orders which are fulfilled completely, meaning that all items have been shipped or picked up. The purpose of this setting is to settle immediately for orders which are completely shipped, but to delay settlement for orders which are only partially shipped until&nbsp;the next scheduled job. Delaying settlement for partial shipments increases the likelihood that the remaining shipments occur before the next scheduled payment job, in which case only one settlement occurs, and no advance authorization is required.</p>\r\n\r\n<p>For example, if a customer purchases a $40 item and a $60 item and both items ship in a single package, then settlement occurs immediately for the full $100. If the $40&nbsp;item ships at 11:00 AM&nbsp;and the $60 item ships at 5:00 PM and immediate settlement occurs, then at 11:00 a $40 settlement occurs against the original authorization and an advance authorization is executed for $60. At 5:00, a $60 settlement occurs against the new authorization, and the customer sees two charges on their account. However, if immediate settlement occurs only for complete shipments, then an open settlement is created at 11:00 AM for $60, and at 5:00 the open settlement amount is increased to $100 before the settlement is executed. With real time settlement enabled only for complete shipments, the customer sees only one charge on their account and no advance authorization is required for some partial shipment scenarios.</p>\r\n\r\n<p>The Process Payments Immediately attribute controls whether&nbsp;completely fulfilled orders are settled immediately. Then an order is completely fulfilled when all the quantity detail records for sale lines reach the configured invoicing status within the same transaction. Select a setting by&nbsp;navigating to the Payment section of the <a hqid=\"1827458\" href=\"/payment-configuration-2$PaymentSchedulingConfiguration_UI\">Order Configuration UI</a>.</p>\r\n\r\n<ul>\r\n\t<li>If this is enabled, then when an order is fulfilled completely and an invoice is created, the Order<em>&nbsp;</em>component&nbsp;sends a payment request to the Payment<em>&nbsp;</em>component with execution mode &quot;CalculateAndExecute&quot;. The Payment<em>&nbsp;</em>component&nbsp;creates open transactions and executes them immediately. For example, if an order has two lines, each with one unit, and both lines are shipped in a single package, then one invoice is created, and settlement&nbsp;occurs&nbsp;immediately for the invoice.&nbsp;If an order has two lines, each with one unit, and each line is shipped in its own package as part of the same shipment, then two invoices are created, and settlement occurs immediately for both invoices.</li>\r\n\t<li>If Process Payments Immediately is disabled, then no immediate settlement occurs, regardless of the completeness of a fulfillment. When any fulfillment occurs and&nbsp;an invoice is created, the Order<em>&nbsp;</em>component&nbsp;sends a payment request to the Payment<em>&nbsp;</em>component&nbsp;with execution mode &quot;CalculateOnly&quot;. The Payment<em>&nbsp;c</em>omponent&nbsp;creates open transactions but does not execute them. This setting is designed for scenarios where settlement is executed on a schedule; a scheduled settlement job must be configured to execute payments. For example, if an order has two lines, each with one unit, and both lines are shipped in a single package, then one invoice is created, and an open settlement is created but not executed. Later, a scheduled job picks up the open settlement and executes it.</li>\r\n</ul>\r\n\r\n<h3><a name=\"scheduled-nbsp-payment-processing\" id=\"scheduled-nbsp-payment-processing\"></a>Scheduled&nbsp;Payment Processing</h3>\r\n\r\n<p>Scheduled payment jobs can be set up on a configurable frequency. For example, a scheduler&nbsp;can execute payments every 4 hours or at the close of business each day. Schedulers can be scheduled by&nbsp;transaction type, to separate settlement jobs from authorization jobs.&nbsp;</p>\r\n\r\n<p>Payment schedulers pick&nbsp;open payment transactions with a&nbsp;transaction scheduled timestamp which is null or in the past. To execute&nbsp;payment transactions purely based on scheduler frequency, the transaction scheduled timestamp can be left null. To schedule payment transactions in the future and effectively skip&nbsp;a scheduled run, payment transactions are stamped with a scheduled timestamp equal to the current time plus a configured number of hours. For example, a seller wants to schedule e-commerce settlements 2 days after the open transaction is created, in case of partial shipments. This seller sets the number of hours to be 48 hours. When an open settlement&nbsp;transaction is created on January 1 at 3:00 PM, its scheduled timestamp is set to January 3 at 3:00 PM. This transaction is executed when a scheduler runs after January 3 at 3:00 PM.</p>\r\n\r\n<h4><a name=\"configuring-payment-schedulers\" id=\"configuring-payment-schedulers\"></a>Configuring Payment Schedulers</h4>\r\n\r\n<p>Scheduled payment jobs can be set up on a configurable frequency. For example,&nbsp;a scheduler&nbsp;can execute payments every 4 hours or&nbsp;at the close of business each day. Schedulers can be scheduled by&nbsp;transaction type, to separate settlement jobs from authorization jobs.&nbsp;Jobs can be scheduled by transaction type, to separate settlement jobs from authorization jobs. To configure a payment scheduler, import a scheduler JSON. The following schedulers are provided in the seed data, and their frequencies can be modified by copying the scheduler and importing it with a new cron expression.</p>\r\n\r\n<h5>Payment Processing Scheduler</h5>\r\n\r\n<p>This scheduler processes open payment transactions.&nbsp;Details of job parameters are below.</p>\r\n\r\n<ul>\r\n\t<li><strong>JobTypeId</strong>:&nbsp;processPaymentTransactionJob</li>\r\n\t<li><strong>PaymentTransactionType</strong>: Used to define the type(s) of transactions which should be picked up. For example, if configured to &quot;Authorization Reversal,Settlement&quot;, then the scheduler picks up open authorization reversal and settlement transactions. Should be comma separated with no spaces.</li>\r\n\t<li>Note: Additional query parameters cannot be added to this scheduler; only transaction type can be used.</li>\r\n\t<li>This scheduler can be used to pick up open advance authorizations, by adding transaction type = Authorization to the below query.</li>\r\n</ul>\r\n\r\n<p>For example:</p>\r\n\r\n<div class=\"computer_code\">{<br />\r\n&nbsp; &nbsp; &quot;Messages&quot;: null,<br />\r\n&nbsp; &nbsp; &quot;IsDisabled&quot;: false,<br />\r\n&nbsp; &nbsp; &quot;IsAdHoc&quot;: false,<br />\r\n&nbsp; &nbsp; &quot;Process&quot;: null,<br />\r\n&nbsp; &nbsp; &quot;StartDelay&quot;: null,<br />\r\n&nbsp; &nbsp; &quot;TriggerKey&quot;: &quot;ProcessPaymentTransactionJobTrigger-1&quot;,<br />\r\n&nbsp; &nbsp; &quot;TimeZone&quot;: &quot;GMT&quot;,<br />\r\n&nbsp; &nbsp; &quot;JobTypeId&quot;: &quot;processPaymentTransactionJob&quot;,<br />\r\n&nbsp; &nbsp; &quot;IsSyncExecution&quot; = true,<br />\r\n&nbsp; &nbsp; &quot;CronExpression&quot;: &quot;0 00 10 * * ? *&quot;,<br />\r\n&nbsp; &nbsp; &quot;JobParameters&quot;: [{<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; &quot;InputValue&quot;: &quot;Settlement,Refund&quot;,<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; &quot;Process&quot;: null,<br />\r\n&nbsp; &nbsp; &nbsp; &nbsp; &quot;InputKey&quot;: &quot;PaymentTransactionType&quot;<br />\r\n&nbsp; &nbsp; }],<br />\r\n&nbsp; &nbsp; &quot;JobScheduleId&quot;: &quot;processPaymentTransactionJob-1&quot;,<br />\r\n&nbsp; &nbsp; &quot;RepeatInterval&quot;: null<br />\r\n}</div>\r\n\r\n<p>&nbsp;</p>\r\n\r\n<h5>Re-Authorization Scheduler</h5>\r\n\r\n<pre>\r\n&nbsp;</pre>\r\n\r\n<p>This scheduler&nbsp;picks up authorization transactions which have an expiry date in the past and creates new, open authorizations.&nbsp;Details of job parameters are below.</p>\r\n\r\n<ul>\r\n\t<li><strong>JobTypeId</strong>:&nbsp;reAuthorizationJob</li>\r\n\t<li><strong>QueryString</strong>: Used to define a query which picks up payment transactions. Available fields are from payment transaction.</li>\r\n</ul>\r\n\r\n<div class=\"computer_code\"><code class=\"json\">{<br />\r\n&nbsp;&nbsp;&nbsp; &quot;JobScheduleId&quot;: &quot;reAuthorizationJob-1&quot;,<br />\r\n&nbsp;&nbsp;&nbsp; &quot;JobTypeId&quot;: &quot;reAuthorizationJob&quot;,<br />\r\n&nbsp;&nbsp;&nbsp; &quot;CronExpression&quot;: &quot;0 0 22 1/1 * ? &quot;,<br />\r\n&nbsp;&nbsp;&nbsp; &quot;TimeZone&quot;: &quot;GMT&quot;,<br />\r\n&nbsp;&nbsp;&nbsp; &quot;TriggerKey&quot;: &quot;ReAuthorizationJobTrigger-1&quot;,<br />\r\n&nbsp;&nbsp;&nbsp; &quot;JobParameters&quot;: [{<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;InputKey&quot;: &quot;QueryString&quot;,<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;InputValue&quot;: &quot;select pt.parentPaymentMethod.parentPaymentHeader.pk, pt.pk from PaymentTransactionEntity pt where pt.transactionType.paymentTransactionTypeId = &#39;Authorization&#39; and pt.status.paymentTransactionStatusId = &#39;Closed&#39; and pt.isActive = true and pt.transactionExpiryDate &lt; CURRENT_TIMESTAMP and pt.processedAmount &gt; 0 and (pt.followOnProcessedAmount is null or pt.processedAmount &gt; pt.followOnProcessedAmount)&quot;<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; },<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;InputKey&quot;: &quot;ChunkSize&quot;,<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &quot;InputValue&quot;: &quot;2&quot;<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br />\r\n&nbsp;&nbsp;&nbsp; ]<br />\r\n}</code></div>\r\n\r\n<h5>Stuck Payment Transaction Scheduler</h5>\r\n\r\n<p>This scheduler&nbsp;gets the status of progress in payment transactions and either retries the transaction&nbsp;if it doesn&#39;t exist in the gateway, or updates the transaction status&nbsp;if it has been processed in the gateway.</p>\r\n\r\n<h5>E-Check Status Update Scheduler</h5>\r\n\r\n<p>This scheduler gets the status and updates in progress e-check transactions. This scheduler picks up e-check settlements and refunds which have transaction status In Progress, and calls the gateway to get the status of the transaction. It takes an input key-value pair to define the number of days after which a transaction status is checked. Details of job parameters are below.</p>\r\n\r\n<ul>\r\n\t<li><strong>JobTypeId</strong>:&nbsp;updateECheckStatusJob</li>\r\n\t<li><strong>NumberOfDaysOldReport</strong>: Used for defining the number of days in which an e-check transaction has been in transaction status In Progress. For example, if configured to 3, then the scheduler picks up e-check transactions which have been in transaction status In Progress for at least 3 days.</li>\r\n\t<li><strong>GatewayId</strong>: Used to define the gateway of the payment transactions which should be picked up. For example, if configured to Cybersource, then the scheduler picks up transactions which have a gateway of Cybersource defined.</li>\r\n\t<li><strong>AccountId</strong>: Used to define the account which should be used for processing payments. Not required. Not read if the simulator is used as the gateway.</li>\r\n</ul>\r\n\r\n<h5>E-Check Force Update Scheduler</h5>\r\n\r\n<p>This scheduler marks&nbsp;in-progress e-check payment transactions as success after X days. It picks&nbsp;up e-check settlements and refunds which have transaction status In Progress, and updates the transaction status to Success. Details of job parameters are below.</p>\r\n\r\n<ul>\r\n\t<li><strong>JobTypeId</strong>:&nbsp;forceUpdatePaymentTransactionJob</li>\r\n\t<li><strong>QueryString</strong>: Used to define a query which picks up payment transactions. Available fields are from payment transaction.</li>\r\n\t<li><strong>NoOfUnits</strong>: Used for defining the length of time in which an e-check transaction has been in transaction status In Progress. For example, if configured to 3 and timeUnit is configured as &#39;day&#39;, then the scheduler picks up e-check transactions which have been in transaction status In Progress for at least 3 days.</li>\r\n\t<li><strong>TimeUnit</strong>: Used for defining the unit in which the NoOfUnits is measured.</li>\r\n</ul>\r\n\r\n<p>For example:</p>\r\n\r\n<div class=\"computer_code\">{<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&quot;JobScheduleId&quot;: &quot;forceUpdatePaymentTransactionJob-1&quot;,<br />\r\n&nbsp; &nbsp; &quot;JobTypeId&quot;: &quot;forceUpdatePaymentTransactionJob&quot;,<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&quot;CronExpression&quot;: &quot;0 0 23 1/1 * ? *&quot;,<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&quot;TimeZone&quot;: &quot;GMT&quot;,<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&quot;TriggerKey&quot;: &quot;ForceUpdatePaymentTransactionJobTrigger1&quot;,<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&quot;JobParameters&quot;: [{<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;InputKey&quot;: &quot;QueryString&quot;,<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;InputValue&quot;: &quot;select pt.orderId, pt.paymentGroupId, pt.pk from PaymentTransactionEntity pt where pt.status.paymentTransactionStatusId = &#39;InProgress&#39; and pt.isActive = 1 and pt.transactionDate != null and pt.transactionDate &lt; SQL(&#39;(? - interval :noOfUnits :timeUnit)&#39;, CURRENT_TIMESTAMP)&quot;<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;InputKey&quot;: &quot;timeUnit&quot;,<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;InputValue&quot;: &quot;day&quot;<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;InputKey&quot;: &quot;noOfUnits&quot;,<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;InputValue&quot;: &quot;7&quot;<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;},<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;InputKey&quot;: &quot;ChunkSize&quot;,<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&quot;InputValue&quot;: &quot;2&quot;<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />\r\n&nbsp;&nbsp;&nbsp;&nbsp;]<br />\r\n}</div>\r\n\r\n<h4><a name=\"scheduling-payment-transactions\" id=\"scheduling-payment-transactions\"></a>Scheduling Payment Transactions</h4>\r\n\r\n<p>When payments are not processed in real time, then the Transaction Schedule Hours attribute is used to schedule the execution of individual payment transactions.&nbsp;When a payment transaction is created, the&nbsp;scheduled timestamp is set to the current system date plus this many hours. This attribute is used for payment transactions executed via scheduled job.&nbsp;Payment schedulers pick&nbsp;open payment transactions with a&nbsp;transaction scheduled timestamp which is null or in the past.&nbsp;Select a setting by&nbsp;navigating to the <a hqid=\"1827458\" href=\"/payment-configuration-2$payment_parameter_UI\">Payment Parameters UI</a>.</p>\r\n\r\n<ul>\r\n\t<li>If only real time payment execution is used, this attribute should be null.</li>\r\n\t<li>To execute&nbsp;payment transactions purely based on scheduler frequency, this attribute should be null.&nbsp;</li>\r\n\t<li>To schedule payment transactions in the future and effectively&nbsp;skip&nbsp;a scheduled run, payment transactions are stamped with a scheduled timestamp equal to the current time plus a configured number of hours.&nbsp;For example, a seller wants to schedule e-commerce settlements 2 days after the open transaction is created, in case of partial shipments. This seller sets the number of hours to be 48 hours. When an open settlement&nbsp;transaction is created on January 1 at 3:00 PM, its scheduled timestamp is set to January 3 at 3:00 PM. This transaction is executed when a scheduler runs after January 3 at 3:00 PM.</li>\r\n</ul>\r\n\r\n<h3><a name=\"batch-payment-processing\" id=\"batch-payment-processing\"></a>Batch Payment Processing</h3>\r\n\r\n<p>Many third-party payment gateways require batch files to be created for payments. All&nbsp;requests sent from the Payment component to the Payment Gateway component are jsons which include a single payment gateway request. To create a batch file in the format required by the third-party payment gateway, a custom component with a translation and batch file creation&nbsp;logic needs to be created. For example, a custom component can be written to batch and send files every 1 hour or at 11:00 PM each night.</p>\r\n\r\n<p>To accomplish this:</p>\r\n\r\n<ul>\r\n\t<li>The callGateway user exit is implemented to invoke custom logic for processing batch payments.</li>\r\n\t<li>Throughout the day, the execute payment service sends open settlements and&nbsp;refunds to the callGateway user exit.</li>\r\n\t<li>The callGateway user exit sends the open transactions to the custom component.</li>\r\n\t<li>This custom component receives single payment gateway requests and stores them.</li>\r\n\t<li>Based on the required frequency/schedule (for example,&nbsp;nightly at 11:00 PM), a scheduled job (example, cron job) is run in the custom component to pick up all the open transactions from the custom component and batch them into a single file.</li>\r\n\t<li>The custom component sends the file to the third-party payment gateway.</li>\r\n\t<li>The third-party payment gateway responds with a batch file,&nbsp;the custom component translates the file into payment format, and the custom component posts the batch response to the bulk update payment transaction API.</li>\r\n</ul>\r\n\r\n<p>Note: This design assumes that open payment transactions are sent to the custom component using only immediate execution, which accounts for settlements created for&nbsp;complete shipments and all refunds. This design does not include open settlements created as a result of partial shipments. If it&#39;s required to execute those settlements each night, then the following can be implemented in addition to the above:</p>\r\n\r\n<ul>\r\n\t<li>Configure the out of the box process payments scheduler to run at a frequency/time which will get all open transactions to the custom component in time for the nightly batch job (for example,&nbsp;once every hour, or nightly at 10:00 PM - be sure to test this based on your volumes).</li>\r\n</ul>\r\n\r\n<p>This insures that all open settlements and refunds are sent to the custom component before the nightly batch file.</p>\r\n\r\n<h3><a name=\"contact-center-payments\" id=\"contact-center-payments\"></a>Contact Center Payments</h3>\r\n\r\n<p>When making order updates, Contact Service Representatives(CSRs) must click the &#39;Confirm Changes&#39; button for payment to be processed. For instance, if quantity is increased and more payment is captured, then an open authorization is created. The authorization is not processed unless the CSR clicks &#39;Confirm Changes&#39;. If an appeasement is added and an auth reversal (or refund) transaction is created, then the auth reversal (or refund) is not processed until the CSR clicks &#39;Confirm Changes&#39;. This should be enforced via SOP. For scenarios where CSRs forget to click &#39;Confirm Changes&#39;, then configure a scheduled agent which will process open transactions.</p>\r\n\r\n<h3><a name=\"implementation-flavors\" id=\"implementation-flavors\"></a>Implementation Flavors</h3>\r\n\r\n<p>To exclude payment transactions from getting picked by a payment scheduler depending on the value populated in the&nbsp;extended attributes on the payment method, include the phrase pt.parentPaymentMethod.<strong data-renderer-mark=\"true\">extend::&lt;extendedAttribute&gt;</strong></p>\r\n\r\n<h3><a name=\"related-articles\" id=\"related-articles\"></a>Related Articles</h3>\r\n\r\n<div class=\"info\"><ul class=\"related-articles\"><li><a href=\"/other-transaction-types\" hqid=\"2617712\">Other Transaction Types</a></li><li><a href=\"/payment-fraud\" hqid=\"2617716\">Fraud</a></li><li><a href=\"/how-payment-processing-works\" hqid=\"2617708\">How Payment Processing Works</a></li><li><a href=\"/paymentfailures\" hqid=\"2660553\">Payment Failures</a></li><li><a href=\"/payment-rest-apis-and-user-exits\" hqid=\"2617717\">Rest APIs and User Exits</a></li><li><a href=\"/payment-health-dashboard\" hqid=\"3127204\">Payment Health Dashboard</a></li><li><a href=\"/payment-types\" hqid=\"2617707\">Payment Types</a></li><li><a href=\"/invoicing-sales-posting\" hqid=\"2617713\">Invoicing and Sales Posting</a></li><li><a href=\"/payment-gateway-integration\" hqid=\"2617714\">Payment Gateway Integration</a></li><li><a href=\"/settlement\" hqid=\"2617710\">Settlement</a></li><li><a href=\"/capturing-payment\" hqid=\"2617706\">Capturing Payment</a></li><li><a href=\"/authorization\" hqid=\"2617709\">Authorization</a></li><li><a href=\"/paymentoverview\" hqid=\"2688302\">Payment Overview</a></li><li><a href=\"/refunds\" hqid=\"2617711\">Refunds</a></li><li><a href=\"/payment-troubleshooting\" hqid=\"2617718\">Testing & Troubleshooting Payment</a></li><li><a href=\"/einvoice\" hqid=\"3061519\">eInvoice </a></li></ul></div>\r\n\r\n\t  </div>\r\n </div>\r\n <div id=\"ui-page-fb-wrap\"></div>\r\n <div class=\"hiq-footer-wrap\">\r\n    \r\n                \r\n  </div>\r\n\r\n\r\n</div>\r\n\r\n\r\n\r\n\r\n\r\n",
  "content_length": 23800,
  "scraped_at": "2025-08-09T21:58:55.884308",
  "content_clean": "Home ››Manhattan Active® Omni››Order Management››Process & Configuration Guides››Order Selling››Payment ››Payment Schedulers & Batch Processing Payment Schedulers & Batch Processing Previous I Next This section explains the various ways in which payment can be processed, whether in real-time or via scheduled jobs. It also explains how to implement batch payment processing for third parties which require batch files. Real Time PaymentsScheduled Payment ProcessingConfiguring Payment SchedulersScheduling Payment TransactionsBatch Payment ProcessingContact Center PaymentsImplementation FlavorsRelated Articles Real Time Payments Payments can be executed in real time, as payment transactions are created, or periodically by using scheduled jobs. Real time payments can optionally be limited to only orders which are fulfilled completely, meaning that all items have been shipped or picked up. The purpose of this setting is to settle immediately for orders which are completely shipped, but to delay settlement for orders which are only partially shipped until the next scheduled job. Delaying settlement for partial shipments increases the likelihood that the remaining shipments occur before the next scheduled payment job, in which case only one settlement occurs, and no advance authorization is required. For example, if a customer purchases a $40 item and a $60 item and both items ship in a single package, then settlement occurs immediately for the full $100. If the $40 item ships at 11:00 AM and the $60 item ships at 5:00 PM and immediate settlement occurs, then at 11:00 a $40 settlement occurs against the original authorization and an advance authorization is executed for $60. At 5:00, a $60 settlement occurs against the new authorization, and the customer sees two charges on their account. However, if immediate settlement occurs only for complete shipments, then an open settlement is created at 11:00 AM for $60, and at 5:00 the open settlement amount is increased to $100 before the settlement is executed. With real time settlement enabled only for complete shipments, the customer sees only one charge on their account and no advance authorization is required for some partial shipment scenarios. The Process Payments Immediately attribute controls whether completely fulfilled orders are settled immediately. Then an order is completely fulfilled when all the quantity detail records for sale lines reach the configured invoicing status within the same transaction. Select a setting by navigating to the Payment section of the Order Configuration UI. If this is enabled, then when an order is fulfilled completely and an invoice is created, the Order component sends a payment request to the Payment component with execution mode \"CalculateAndExecute\". The Payment component creates open transactions and executes them immediately. For example, if an order has two lines, each with one unit, and both lines are shipped in a single package, then one invoice is created, and settlement occurs immediately for the invoice. If an order has two lines, each with one unit, and each line is shipped in its own package as part of the same shipment, then two invoices are created, and settlement occurs immediately for both invoices. If Process Payments Immediately is disabled, then no immediate settlement occurs, regardless of the completeness of a fulfillment. When any fulfillment occurs and an invoice is created, the Order component sends a payment request to the Payment component with execution mode \"CalculateOnly\". The Payment component creates open transactions but does not execute them. This setting is designed for scenarios where settlement is executed on a schedule; a scheduled settlement job must be configured to execute payments. For example, if an order has two lines, each with one unit, and both lines are shipped in a single package, then one invoice is created, and an open settlement is created but not executed. Later, a scheduled job picks up the open settlement and executes it. Scheduled Payment Processing Scheduled payment jobs can be set up on a configurable frequency. For example, a scheduler can execute payments every 4 hours or at the close of business each day. Schedulers can be scheduled by transaction type, to separate settlement jobs from authorization jobs. Payment schedulers pick open payment transactions with a transaction scheduled timestamp which is null or in the past. To execute payment transactions purely based on scheduler frequency, the transaction scheduled timestamp can be left null. To schedule payment transactions in the future and effectively skip a scheduled run, payment transactions are stamped with a scheduled timestamp equal to the current time plus a configured number of hours. For example, a seller wants to schedule e-commerce settlements 2 days after the open transaction is created, in case of partial shipments. This seller sets the number of hours to be 48 hours. When an open settlement transaction is created on January 1 at 3:00 PM, its scheduled timestamp is set to January 3 at 3:00 PM. This transaction is executed when a scheduler runs after January 3 at 3:00 PM. Configuring Payment Schedulers Scheduled payment jobs can be set up on a configurable frequency. For example, a scheduler can execute payments every 4 hours or at the close of business each day. Schedulers can be scheduled by transaction type, to separate settlement jobs from authorization jobs. Jobs can be scheduled by transaction type, to separate settlement jobs from authorization jobs. To configure a payment scheduler, import a scheduler JSON. The following schedulers are provided in the seed data, and their frequencies can be modified by copying the scheduler and importing it with a new cron expression. Payment Processing Scheduler This scheduler processes open payment transactions. Details of job parameters are below. JobTypeId: processPaymentTransactionJob PaymentTransactionType: Used to define the type(s) of transactions which should be picked up. For example, if configured to \"Authorization Reversal,Settlement\", then the scheduler picks up open authorization reversal and settlement transactions. Should be comma separated with no spaces. Note: Additional query parameters cannot be added to this scheduler; only transaction type can be used. This scheduler can be used to pick up open advance authorizations, by adding transaction type = Authorization to the below query. For example: { \"Messages\": null, \"IsDisabled\": false, \"IsAdHoc\": false, \"Process\": null, \"StartDelay\": null, \"TriggerKey\": \"ProcessPaymentTransactionJobTrigger-1\", \"TimeZone\": \"GMT\", \"JobTypeId\": \"processPaymentTransactionJob\", \"IsSyncExecution\" = true, \"CronExpression\": \"0 00 10 * * ? *\", \"JobParameters\": [{ \"InputValue\": \"Settlement,Refund\", \"Process\": null, \"InputKey\": \"PaymentTransactionType\" }], \"JobScheduleId\": \"processPaymentTransactionJob-1\", \"RepeatInterval\": null } Re-Authorization Scheduler This scheduler picks up authorization transactions which have an expiry date in the past and creates new, open authorizations. Details of job parameters are below. JobTypeId: reAuthorizationJob QueryString: Used to define a query which picks up payment transactions. Available fields are from payment transaction. { \"JobScheduleId\": \"reAuthorizationJob-1\", \"JobTypeId\": \"reAuthorizationJob\", \"CronExpression\": \"0 0 22 1/1 * ? \", \"TimeZone\": \"GMT\", \"TriggerKey\": \"ReAuthorizationJobTrigger-1\", \"JobParameters\": [{ \"InputKey\": \"QueryString\", \"InputValue\": \"select pt.parentPaymentMethod.parentPaymentHeader.pk, pt.pk from PaymentTransactionEntity pt where pt.transactionType.paymentTransactionTypeId = 'Authorization' and pt.status.paymentTransactionStatusId = 'Closed' and pt.isActive = true and pt.transactionExpiryDate < CURRENT_TIMESTAMP and pt.processedAmount > 0 and (pt.followOnProcessedAmount is null or pt.processedAmount > pt.followOnProcessedAmount)\" }, { \"InputKey\": \"ChunkSize\", \"InputValue\": \"2\" } ] } Stuck Payment Transaction Scheduler This scheduler gets the status of progress in payment transactions and either retries the transaction if it doesn't exist in the gateway, or updates the transaction status if it has been processed in the gateway. E-Check Status Update Scheduler This scheduler gets the status and updates in progress e-check transactions. This scheduler picks up e-check settlements and refunds which have transaction status In Progress, and calls the gateway to get the status of the transaction. It takes an input key-value pair to define the number of days after which a transaction status is checked. Details of job parameters are below. JobTypeId: updateECheckStatusJob NumberOfDaysOldReport: Used for defining the number of days in which an e-check transaction has been in transaction status In Progress. For example, if configured to 3, then the scheduler picks up e-check transactions which have been in transaction status In Progress for at least 3 days. GatewayId: Used to define the gateway of the payment transactions which should be picked up. For example, if configured to Cybersource, then the scheduler picks up transactions which have a gateway of Cybersource defined. AccountId: Used to define the account which should be used for processing payments. Not required. Not read if the simulator is used as the gateway. E-Check Force Update Scheduler This scheduler marks in-progress e-check payment transactions as success after X days. It picks up e-check settlements and refunds which have transaction status In Progress, and updates the transaction status to Success. Details of job parameters are below. JobTypeId: forceUpdatePaymentTransactionJob QueryString: Used to define a query which picks up payment transactions. Available fields are from payment transaction. NoOfUnits: Used for defining the length of time in which an e-check transaction has been in transaction status In Progress. For example, if configured to 3 and timeUnit is configured as 'day', then the scheduler picks up e-check transactions which have been in transaction status In Progress for at least 3 days. TimeUnit: Used for defining the unit in which the NoOfUnits is measured. For example: { \"JobScheduleId\": \"forceUpdatePaymentTransactionJob-1\", \"JobTypeId\": \"forceUpdatePaymentTransactionJob\", \"CronExpression\": \"0 0 23 1/1 * ? *\", \"TimeZone\": \"GMT\", \"TriggerKey\": \"ForceUpdatePaymentTransactionJobTrigger1\", \"JobParameters\": [{ \"InputKey\": \"QueryString\", \"InputValue\": \"select pt.orderId, pt.paymentGroupId, pt.pk from PaymentTransactionEntity pt where pt.status.paymentTransactionStatusId = 'InProgress' and pt.isActive = 1 and pt.transactionDate != null and pt.transactionDate < SQL('(? - interval :noOfUnits :timeUnit)', CURRENT_TIMESTAMP)\" }, { \"InputKey\": \"timeUnit\", \"InputValue\": \"day\" }, { \"InputKey\": \"noOfUnits\", \"InputValue\": \"7\" }, { \"InputKey\": \"ChunkSize\", \"InputValue\": \"2\" } ] } Scheduling Payment Transactions When payments are not processed in real time, then the Transaction Schedule Hours attribute is used to schedule the execution of individual payment transactions. When a payment transaction is created, the scheduled timestamp is set to the current system date plus this many hours. This attribute is used for payment transactions executed via scheduled job. Payment schedulers pick open payment transactions with a transaction scheduled timestamp which is null or in the past. Select a setting by navigating to the Payment Parameters UI. If only real time payment execution is used, this attribute should be null. To execute payment transactions purely based on scheduler frequency, this attribute should be null. To schedule payment transactions in the future and effectively skip a scheduled run, payment transactions are stamped with a scheduled timestamp equal to the current time plus a configured number of hours. For example, a seller wants to schedule e-commerce settlements 2 days after the open transaction is created, in case of partial shipments. This seller sets the number of hours to be 48 hours. When an open settlement transaction is created on January 1 at 3:00 PM, its scheduled timestamp is set to January 3 at 3:00 PM. This transaction is executed when a scheduler runs after January 3 at 3:00 PM. Batch Payment Processing Many third-party payment gateways require batch files to be created for payments. All requests sent from the Payment component to the Payment Gateway component are jsons which include a single payment gateway request. To create a batch file in the format required by the third-party payment gateway, a custom component with a translation and batch file creation logic needs to be created. For example, a custom component can be written to batch and send files every 1 hour or at 11:00 PM each night. To accomplish this: The callGateway user exit is implemented to invoke custom logic for processing batch payments. Throughout the day, the execute payment service sends open settlements and refunds to the callGateway user exit. The callGateway user exit sends the open transactions to the custom component. This custom component receives single payment gateway requests and stores them. Based on the required frequency/schedule (for example, nightly at 11:00 PM), a scheduled job (example, cron job) is run in the custom component to pick up all the open transactions from the custom component and batch them into a single file. The custom component sends the file to the third-party payment gateway. The third-party payment gateway responds with a batch file, the custom component translates the file into payment format, and the custom component posts the batch response to the bulk update payment transaction API. Note: This design assumes that open payment transactions are sent to the custom component using only immediate execution, which accounts for settlements created for complete shipments and all refunds. This design does not include open settlements created as a result of partial shipments. If it's required to execute those settlements each night, then the following can be implemented in addition to the above: Configure the out of the box process payments scheduler to run at a frequency/time which will get all open transactions to the custom component in time for the nightly batch job (for example, once every hour, or nightly at 10:00 PM - be sure to test this based on your volumes). This insures that all open settlements and refunds are sent to the custom component before the nightly batch file. Contact Center Payments When making order updates, Contact Service Representatives(CSRs) must click the 'Confirm Changes' button for payment to be processed. For instance, if quantity is increased and more payment is captured, then an open authorization is created. The authorization is not processed unless the CSR clicks 'Confirm Changes'. If an appeasement is added and an auth reversal (or refund) transaction is created, then the auth reversal (or refund) is not processed until the CSR clicks 'Confirm Changes'. This should be enforced via SOP. For scenarios where CSRs forget to click 'Confirm Changes', then configure a scheduled agent which will process open transactions. Implementation Flavors To exclude payment transactions from getting picked by a payment scheduler depending on the value populated in the extended attributes on the payment method, include the phrase pt.parentPaymentMethod.extend::<extendedAttribute> Related Articles Other Transaction TypesFraudHow Payment Processing WorksPayment FailuresRest APIs and User ExitsPayment Health DashboardPayment TypesInvoicing and Sales PostingPayment Gateway IntegrationSettlementCapturing PaymentAuthorizationPayment OverviewRefundsTesting & Troubleshooting PaymenteInvoice"
}