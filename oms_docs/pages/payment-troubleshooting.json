{
  "id": "2617718",
  "permalink": "payment-troubleshooting",
  "title": "Testing & Troubleshooting Payment",
  "type": "topic",
  "level": 5,
  "path": "Manhattan Active® Omni/Order Management/Process & Configuration Guides/Order Selling/Payment/Testing & Troubleshooting Payment",
  "raw_item": {
    "id": "2617718",
    "text": "Testing & Troubleshooting Payment",
    "title": "Testing & Troubleshooting Payment",
    "permalink": "payment-troubleshooting",
    "leaf": false,
    "droppable": true,
    "expanded": true,
    "closed": true,
    "visible": true,
    "editable": true,
    "type": "topic",
    "topicType": "0",
    "status": "1",
    "iconCls": "icon-topic",
    "cls": "",
    "folder_id": "129592",
    "parent": "f;129592",
    "created_date": "1597861411",
    "modified_date": "1728451946",
    "instructor_id": null,
    "loaded": true,
    "haschildren": false,
    "callout": "0",
    "order": "18"
  },
  "success": true,
  "content": "\r\n\r\n\r\n<div class=\"hiq-page-wrap\">\r\n<div class=\"hiq-t-wrap\">\r\n\t\t\r\n  \t  <div class=\"hiq-t \">\r\n\t\t\t\t<ul class=\"breadcrumbs\"><li><a class=\"breadcrumb-links\" hqid=\"1788908\"  href=\"/home\">Home</a></li> <li><span>&rsaquo;&rsaquo;</span><a hqid=\"3500940\" href=\"/omni\" class=\"breadcrumb-links\">Manhattan Active® Omni</a></li><li><span>&rsaquo;&rsaquo;</span><a hqid=\"2158393\" href=\"/order-management\" class=\"breadcrumb-links\">Order Management</a></li><li><span>&rsaquo;&rsaquo;</span><a hqid=\"2158394\" href=\"/process-configuration-guides\" class=\"breadcrumb-links\">Process & Configuration Guides</a></li><li><span>&rsaquo;&rsaquo;</span><a hqid=\"2163646\" href=\"/order-selling-2\" class=\"breadcrumb-links\">Order Selling</a></li><li><span>&rsaquo;&rsaquo;</span><a hqid=\"2163647\" href=\"/payment-2\" class=\"breadcrumb-links\">Payment</a></li><li> <span>››</span>Testing & Troubleshooting Payment</li></ul>  \t\r\n\t\t<h2>Testing, Validating&nbsp;& Troubleshooting Payment</h2>\r\n\r\n<p></p>\r\n\r\n<a href=\"/payment-health-dashboard\" hqid=\"3127204\">Previous</a>&nbsp;I&nbsp;\r\n<p>&nbsp;</p>\r\n\r\n<div class=\"info\"><ul><li><a href=\"/payment-troubleshooting$testing-with-the-payment-nbsp-simulator\">Testing with the Payment&nbsp;Simulator</a><ul><li><a href=\"/payment-troubleshooting$simulator-configuration\">Simulator Configuration</a></li><li><a href=\"/payment-troubleshooting$how-to-test-using-the-simulator\">How to Test Using the Simulator</a></li><li><a href=\"/payment-troubleshooting$simulating-e-check-payments\">Simulating E-Check Payments</a></li><li><a href=\"/payment-troubleshooting$simulating-nbsp-batch-payments\">Simulating&nbsp;Batch Payments</a></li></ul></li><li><a href=\"/payment-troubleshooting$basic-payment-validations\">Basic Payment Validations</a></li><li><a href=\"/payment-troubleshooting$troubleshooting\">Troubleshooting</a><ul><li><a href=\"/payment-troubleshooting$why-is-my-invoice-open\">Why is my invoice open?</a></li><li><a href=\"/payment-troubleshooting$how-can-i-update-a-payment-transaction\">How can I update a payment transaction?</a></li><li><a href=\"/payment-troubleshooting$why-is-my-order-refunding-to-gift-card\">Why is my order refunding to gift card?</a></li><li><a href=\"/payment-troubleshooting$payment-data-is-incorrect-nbsp-in-publish-order-json\">Payment Data is Incorrect&nbsp;in Publish Order JSON</a></li><li><a href=\"/payment-troubleshooting$transactions-stuck-in-in-progress-status\">Transactions Stuck in In-Progress Status</a></li><li><a href=\"/payment-troubleshooting$order-not-moving-to-paid-status\">Order not Moving to Paid Status</a></li><li><a href=\"/payment-troubleshooting$republishing-sales-postings-for-invoices\">Republishing Sales Postings for Invoices</a></li><li><a href=\"/payment-troubleshooting$transaction-is-stuck-in-unavailable-status\">Transaction is Stuck in Unavailable Status</a></li><li><a href=\"/payment-troubleshooting$why-did-my-payment-transaction-fail\">Why did my payment transaction fail?</a></li><li><a href=\"/payment-troubleshooting$gift-card-refunds-showing-up-on-nbsp-payment-method\">Gift card refunds showing up on&nbsp;payment method</a></li><li><a href=\"/payment-troubleshooting$how-to-re-process-nbsp-a-refund-failure\">How to Re-Process&nbsp;a Refund Failure</a></li><li><a href=\"/payment-troubleshooting$why-is-payment-data-not-included-in-the-order-confirmation-outbound-message\">Why is payment data not included in the order confirmation outbound message?</a></li><li><a href=\"/payment-troubleshooting$authorization-record-not-created-for-new-payment-was-added-after-deleting-the-old-payment-method-due-to-settlement-failure\">Authorization record not created for new payment was added after deleting the old payment method due to settlement failure.</a></li><li><a href=\"/payment-troubleshooting$authorization-got-reversed-inadvertently-how-to-clean-up-the-data-and-proceed-with-settlement-for-fulfilled-orders\">Authorization got reversed inadvertently - how to clean up the data and proceed with settlement for fulfilled orders?</a></li><li><a href=\"/payment-troubleshooting$user-exit-nbsp-not-getting-invoked-while-trying-to-add-additional-request-fields\">User exit&nbsp;not getting invoked while trying to add additional request fields</a></li><li><a href=\"/payment-troubleshooting$even-though-the-amount-is-fully-paid-the-remaining-to-pay-remains-non-zero-on-the-contact-center-screen\">Even though the amount is fully paid, the remaining to pay remains non zero on the Contact Center screen?</a></li><li><a href=\"/payment-troubleshooting$why-is-my-canceled-invoice-information-not-posted-to-vertex\">Why is my canceled invoice information not posted to vertex</a></li><li><a href=\"/payment-troubleshooting$why-is-followonid-not-populated-in-paymentheader-during-standalone-settlement\">Why is FollowOnID not populated in PaymentHeader during standalone settlement</a></li><li><a href=\"/payment-troubleshooting$authorization-reversal-is-stuck-in-open\">Authorization reversal is stuck in open</a></li><li><a href=\"/payment-troubleshooting$a-second-auth-transaction-is-created-in-active-omni-with-the-same-transactionrequestid-as-the-original-auth-doubling-the-authorized-amount-for-the-order\">A second auth transaction is created in Active Omni with the same TransactionRequestId as the original auth, doubling the authorized amount for the order</a></li><li><a href=\"/payment-troubleshooting$authorization-is-not-getting-reversed\">Authorization is not getting reversed</a></li></ul></li><li><a href=\"/payment-troubleshooting$related-articles\">Related Articles</a></li></ul></div>\r\n\r\n<h3><a name=\"testing-with-the-payment-nbsp-simulator\" id=\"testing-with-the-payment-nbsp-simulator\"></a>Testing with the Payment&nbsp;Simulator</h3>\r\n\r\n<p>The payment simulator mimics behavior of a third-party payment gateway such as CyberSource or PAYware Connect. The simulator is used to test payment flows including authorization, settlement, and refund, in scenarios where the system is not yet integrated with a third-party payment gateway. To test with the simulator, select it as the gateway in the payment rule configuration.</p>\r\n\r\n<p>The simulator receives a payment gateway request and generates a payment gateway response based on the configured rules.&nbsp;To select a rule, the simulator filters by transaction type and first tries to match for account number. If no record is found with a matching account number, then the simulator looks for a rule where the requested amount falls within the minimum/maximum range. The simulator returns a response with the configured external response code and processed amount which is calculated as requested amount times processed amount percentage. For example, if the payment simulator rules are configured as follows</p>\r\n\r\n<table border=\"1\" resolved=\"\">\r\n\t<colgroup>\r\n\t\t<col />\r\n\t\t<col />\r\n\t\t<col />\r\n\t\t<col />\r\n\t\t<col />\r\n\t\t<col />\r\n\t\t<col />\r\n\t</colgroup>\r\n\t<thead>\r\n\t\t<tr>\r\n\t\t\t<th>\r\n\t\t\t<p>Rule ID</p>\r\n\t\t\t</th>\r\n\t\t\t<th>\r\n\t\t\t<p>Account Number</p>\r\n\t\t\t</th>\r\n\t\t\t<th>\r\n\t\t\t<p>Minimum Requested Amount</p>\r\n\t\t\t</th>\r\n\t\t\t<th>\r\n\t\t\t<p>Maximum Requested Amount</p>\r\n\t\t\t</th>\r\n\t\t\t<th>\r\n\t\t\t<p>External Response Code</p>\r\n\t\t\t</th>\r\n\t\t\t<th>\r\n\t\t\t<p>Processed Amount Percentage</p>\r\n\t\t\t</th>\r\n\t\t\t<th>\r\n\t\t\t<p>Transaction Type</p>\r\n\t\t\t</th>\r\n\t\t</tr>\r\n\t</thead>\r\n\t<tbody>\r\n\t\t<tr>\r\n\t\t\t<td>1</td>\r\n\t\t\t<td>4242424242424240</td>\r\n\t\t\t<td>null</td>\r\n\t\t\t<td>null</td>\r\n\t\t\t<td>100 (Success)</td>\r\n\t\t\t<td>100</td>\r\n\t\t\t<td>null</td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td>2</td>\r\n\t\t\t<td>5105105105105100</td>\r\n\t\t\t<td>null</td>\r\n\t\t\t<td>null</td>\r\n\t\t\t<td>101 (Failure)</td>\r\n\t\t\t<td>0</td>\r\n\t\t\t<td>null</td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td>3</td>\r\n\t\t\t<td>3566002020360505</td>\r\n\t\t\t<td>null</td>\r\n\t\t\t<td>null</td>\r\n\t\t\t<td>150 (Unavailable)</td>\r\n\t\t\t<td>0</td>\r\n\t\t\t<td>null</td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td>4</td>\r\n\t\t\t<td>4000056655665550</td>\r\n\t\t\t<td>null</td>\r\n\t\t\t<td>null</td>\r\n\t\t\t<td>400 (Fraud)</td>\r\n\t\t\t<td>100</td>\r\n\t\t\t<td>null</td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td>5</td>\r\n\t\t\t<td>null</td>\r\n\t\t\t<td>1000</td>\r\n\t\t\t<td>2000</td>\r\n\t\t\t<td>101 (Failure)</td>\r\n\t\t\t<td>0</td>\r\n\t\t\t<td>null</td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td>6</td>\r\n\t\t\t<td>null</td>\r\n\t\t\t<td>50</td>\r\n\t\t\t<td>60</td>\r\n\t\t\t<td>101 (Failure)</td>\r\n\t\t\t<td>0</td>\r\n\t\t\t<td>null</td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td>7</td>\r\n\t\t\t<td>null</td>\r\n\t\t\t<td>200</td>\r\n\t\t\t<td>250</td>\r\n\t\t\t<td>100 (Success)</td>\r\n\t\t\t<td>25</td>\r\n\t\t\t<td>null</td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td>8</td>\r\n\t\t\t<td>null</td>\r\n\t\t\t<td>250</td>\r\n\t\t\t<td>300</td>\r\n\t\t\t<td>400 (Fraud)</td>\r\n\t\t\t<td>25</td>\r\n\t\t\t<td>null</td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td colspan=\"1\">9</td>\r\n\t\t\t<td colspan=\"1\">4242424242424240</td>\r\n\t\t\t<td colspan=\"1\">500</td>\r\n\t\t\t<td colspan=\"1\">750</td>\r\n\t\t\t<td colspan=\"1\">400 (Fraud)</td>\r\n\t\t\t<td colspan=\"1\">100</td>\r\n\t\t\t<td colspan=\"1\">null</td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td colspan=\"1\">10</td>\r\n\t\t\t<td colspan=\"1\">4242424242424240</td>\r\n\t\t\t<td colspan=\"1\">750</td>\r\n\t\t\t<td colspan=\"1\">1000</td>\r\n\t\t\t<td colspan=\"1\">150 (Unavailable)</td>\r\n\t\t\t<td colspan=\"1\">0</td>\r\n\t\t\t<td colspan=\"1\">null</td>\r\n\t\t</tr>\r\n\t</tbody>\r\n</table>\r\n\r\n<p>For example, when a payment gateway request is received by the simulator with the below request data, then the response data is sent as indicated below.</p>\r\n\r\n<table border=\"1\" resolved=\"\">\r\n\t<colgroup>\r\n\t\t<col />\r\n\t\t<col />\r\n\t\t<col />\r\n\t</colgroup>\r\n\t<thead>\r\n\t\t<tr>\r\n\t\t\t<th>\r\n\t\t\t<p>Request</p>\r\n\t\t\t</th>\r\n\t\t\t<th colspan=\"1\">\r\n\t\t\t<p>Selected Rule ID</p>\r\n\t\t\t</th>\r\n\t\t\t<th>\r\n\t\t\t<p>Response</p>\r\n\t\t\t</th>\r\n\t\t</tr>\r\n\t</thead>\r\n\t<tbody>\r\n\t\t<tr>\r\n\t\t\t<td>\r\n\t\t\t<ul>\r\n\t\t\t\t<li>Transaction type = Settlement</li>\r\n\t\t\t\t<li>Requested amount = $200</li>\r\n\t\t\t\t<li>Account number =&nbsp;4242424242424240</li>\r\n\t\t\t</ul>\r\n\t\t\t</td>\r\n\t\t\t<td colspan=\"1\">1</td>\r\n\t\t\t<td>\r\n\t\t\t<ul>\r\n\t\t\t\t<li>External response code = 100 (Success)</li>\r\n\t\t\t\t<li>Processed amount = $200</li>\r\n\t\t\t</ul>\r\n\t\t\t</td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td>\r\n\t\t\t<ul>\r\n\t\t\t\t<li>Transaction type = Settlement</li>\r\n\t\t\t\t<li>Requested amount = $200</li>\r\n\t\t\t\t<li>Account number =&nbsp;4000000000000000</li>\r\n\t\t\t</ul>\r\n\t\t\t</td>\r\n\t\t\t<td colspan=\"1\">7</td>\r\n\t\t\t<td>\r\n\t\t\t<ul>\r\n\t\t\t\t<li>External response code = 100 (Success)</li>\r\n\t\t\t\t<li>Processed amount = $50</li>\r\n\t\t\t</ul>\r\n\t\t\t</td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td colspan=\"1\">\r\n\t\t\t<ul>\r\n\t\t\t\t<li>Transaction type = Settlement</li>\r\n\t\t\t\t<li>Requested amount = $600</li>\r\n\t\t\t\t<li>Account number =&nbsp;4242424242424240</li>\r\n\t\t\t</ul>\r\n\t\t\t</td>\r\n\t\t\t<td colspan=\"1\">9</td>\r\n\t\t\t<td colspan=\"1\">\r\n\t\t\t<ul>\r\n\t\t\t\t<li>External response code = 400 (Fraud)</li>\r\n\t\t\t\t<li>Processed amount = $600</li>\r\n\t\t\t</ul>\r\n\t\t\t</td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td>\r\n\t\t\t<ul>\r\n\t\t\t\t<li>Transaction type = Settlement</li>\r\n\t\t\t\t<li>Requested amount = $200</li>\r\n\t\t\t\t<li>Account number =&nbsp;5105105105105100</li>\r\n\t\t\t</ul>\r\n\t\t\t</td>\r\n\t\t\t<td colspan=\"1\">2</td>\r\n\t\t\t<td>\r\n\t\t\t<ul>\r\n\t\t\t\t<li>External response code = 101 (Failure)</li>\r\n\t\t\t\t<li>Processed amount = $0</li>\r\n\t\t\t</ul>\r\n\t\t\t</td>\r\n\t\t</tr>\r\n\t\t<tr>\r\n\t\t\t<td>\r\n\t\t\t<ul>\r\n\t\t\t\t<li>Transaction type = Settlement</li>\r\n\t\t\t\t<li>Requested amount = $35</li>\r\n\t\t\t\t<li>Account number =&nbsp;9999999999999999</li>\r\n\t\t\t</ul>\r\n\t\t\t</td>\r\n\t\t\t<td colspan=\"1\">No matching rule found</td>\r\n\t\t\t<td>\r\n\t\t\t<ul>\r\n\t\t\t\t<li>Response status = Success</li>\r\n\t\t\t\t<li>Processed amount = Requested amount</li>\r\n\t\t\t</ul>\r\n\t\t\t</td>\r\n\t\t</tr>\r\n\t</tbody>\r\n</table>\r\n\r\n<h4><a name=\"simulator-configuration\" id=\"simulator-configuration\"></a>Simulator Configuration</h4>\r\n\r\n<p>To configure simulator rules,&nbsp;navigate to the Payment Simulator Rule UI:</p>\r\n\r\n<ol>\r\n\t<li>To modify an existing rule,&nbsp;edit an existing record.</li>\r\n\t<li>To add a new rule, add a new record and select a response code from the following: Success, Failure, Fraud and&nbsp;Unavailable.</li>\r\n\t<li>If response code Success or Fraud is selected, then enter a processed amount percentage. This indicates what percentage of the requested amount will be successfully processed. For example, to return a processed amount equal to the full requested amount, then configure processed amount percentage = 100. To return processed amount of $25 for a requested amount of $100, then configure processed amount percentage = 25. Processed amount percentage is not required for Failure or Unavailable responses, since the Payment<em>&nbsp;</em>component assumes the processed amount to be zero.</li>\r\n\t<li>Optionally add account number, transaction type, minimum requested amount, and maximum requested amount to further filter responses using these attributes.</li>\r\n</ol>\r\n\r\n<h4><a name=\"how-to-test-using-the-simulator\" id=\"how-to-test-using-the-simulator\"></a>How to Test Using the Simulator</h4>\r\n\r\n<p>To test a synchronous payment such as a credit card, gift card, or debit card, perform the following&nbsp;steps:</p>\r\n\r\n<ol>\r\n\t<li>Create an order and ship items such that a shipment invoice is created</li>\r\n\t<li>Create or update a payment simulator rule entry for this transactionType, accountNumber (optional), and requestedAmount range (optional)\r\n\t<ol>\r\n\t\t<li>Set the&nbsp;externalResponseCode&nbsp;based on the outcome you wish to achieve&nbsp;(Success, Failure, and so on)</li>\r\n\t\t<li>Ensure a mapping exists in the gateway response mapping table for this&nbsp;externalResponseCode&nbsp;value</li>\r\n\t</ol>\r\n\t</li>\r\n\t<li>Create a payment header with a payment method which gets executed synchronously (credit card, gift card, debit card, PayPal, and so on) with a transactionType, accountNumber, and amount which corresponds to the rule created in the previous step</li>\r\n\t<li>Run the calculate and execute services</li>\r\n\t<li>The transaction should be updated to Closed status, with the&nbsp;responseStatus configured in the simulator rule/gateway mapping</li>\r\n</ol>\r\n\r\n<h4><a name=\"simulating-e-check-payments\" id=\"simulating-e-check-payments\"></a>Simulating E-Check Payments</h4>\r\n\r\n<p>The payment simulator can also be used to test asynchronous payment processing such as e-checks. For e-check authorization&nbsp;and authorization reversal transactions, the payment simulator rules are used to return a responseStatus as described above. For e-check settlement and refund transactions, however, the simulator always returns transactionStatus&nbsp;=&nbsp;In Progress, instead of returning transactionStatus = Closed as would be done for all other transactions. This logic is hard coded and does not require configuration.</p>\r\n\r\n<p>To retrieve the status of an In Progress transaction, a&nbsp;separate configuration entity called the payment report simulator rule is required. While the payment simulator rule entity is used for simulating a responseStatus for Open transactions, the payment simulator report rule is used for simulating a responseStatus for In Progress transactions.</p>\r\n\r\n<p>To simulate an e-check settlement or refund response, follow the steps below:</p>\r\n\r\n<ol>\r\n\t<li>Create an order and ship items such that a shipment invoice is created</li>\r\n\t<li>Create a payment header with an e-check payment method\r\n\t<ol>\r\n\t\t<li>The e-check settlement is created. Once the execute service runs, the transaction is updated to TransactionStatus = In Progress, based on the hard coded logic in the payment simulator rules.&nbsp;</li>\r\n\t</ol>\r\n\t</li>\r\n\t<li>Create or update a payment report simulator rule entry for this orderId and requestId\r\n\t<ol>\r\n\t\t<li>Get the requestId from the settlement paymentTransaction.requestId</li>\r\n\t\t<li>Set the externalResponseId&nbsp;based on the outcome you wish to achieve (Success, Failure, and so on)</li>\r\n\t\t<li>Ensure a mapping exists in the gateway response mapping table for this externalResponseCode&nbsp;value</li>\r\n\t</ol>\r\n\t</li>\r\n\t<li>Create a scheduler entry for e-check settlement and execute it immediately</li>\r\n\t<li>The In Progress transaction should be updated to Closed, with the&nbsp;responseStatus configured in the simulator rule/gateway mapping</li>\r\n</ol>\r\n\r\n<h4><a name=\"simulating-nbsp-batch-payments\" id=\"simulating-nbsp-batch-payments\"></a>Simulating&nbsp;Batch Payments</h4>\r\n\r\n<p>To test batch payments or other asynchronous payment flows other than e-check, which use&nbsp;transactionStatus = In Progress to indicate that the transaction is being processed by the third-party payment gateway, a payment simulator rule is required. The payment simulator has hard coded logic to return transactionStatus = In Progress for e-check settlements and refunds, but for other payment types such as credit cards which use a batch process, an explicit rule must be configured. Configuring a payment simulator rule entry with a null&nbsp;externalResponseCode returns a response with transactionStatus = In Progress.</p>\r\n\r\n<p>To test a batch payment, follow these steps:</p>\r\n\r\n<ol>\r\n\t<li>Create an order and ship items such that a shipment invoice is created</li>\r\n\t<li>Create or update a payment simulator rule entry for this transactionType, accountNumber (optional), and requestedAmount range (optional)\r\n\t<ol>\r\n\t\t<li>Leave the&nbsp;externalResponseCode&nbsp;null</li>\r\n\t</ol>\r\n\t</li>\r\n\t<li>Create a payment header with a payment method with a transactionType, accountNumber, and amount which corresponds to the rule created in the previous step</li>\r\n\t<li>Run the calculate and execute services</li>\r\n\t<li>The transaction should be updated to In Progress status</li>\r\n\t<li>Create or update a payment report simulator rule entry for this orderId and requestId\r\n\t<ol>\r\n\t\t<li>Get the requestId from the settlement paymentTransaction.requestId</li>\r\n\t\t<li>Set the externalResponseId&nbsp;based on the outcome you wish to achieve (Success, Failure, and so on)</li>\r\n\t\t<li>Ensure a mapping exists in the gateway response mapping table for this externalResponseCode&nbsp;value</li>\r\n\t</ol>\r\n\t</li>\r\n\t<li>Create a scheduler entry for getting the status of In Progress transactions and execute it immediately</li>\r\n\t<li>The In Progress transaction should be updated to Closed, with the&nbsp;responseStatus configured in the simulator rule/gateway mapping</li>\r\n</ol>\r\n\r\n<div class=\"tip\"><strong>Note</strong>: If no matching payment simulator rule entry is found for a transaction, then the simulator responds with responseStatus = Success and transactionStatus = Closed.</div>\r\n\r\n<h3><a name=\"basic-payment-validations\" id=\"basic-payment-validations\"></a>Basic Payment Validations</h3>\r\n\r\n<p>Some of the validations while evaluating payment related issues are listed below:</p>\r\n\r\n<ul>\r\n\t<li>Required fields - Check for the RequestId on the payment transactions, it should not be blank.&nbsp;For example,&nbsp;If the RequestId is blank on the authorization record, then the settlement is done as a standalone settlement, the follow on processed amount will be null on the auth record.</li>\r\n\t<li>Important fields - RequestId, FollowonId, Expiry date, IsActive flag, IsValidForRefund, IsCopied, RequestAmount, ProcessedAmount</li>\r\n\t<li>For follownon based refunds - validate that the requestId on the auth record is not null and this Id is the followonId of the settlement record. Similarly, the requestId of the settlement records = the followonId on the Refund record.</li>\r\n\t<li>The followonProcessedAmount on the Authorization record = Sum of settled amount for that payment method. The followonProcessedAmount on the Settlement record = Sum of refund amount for that payment method.&nbsp;</li>\r\n\t<li>Check amount fields - RequestedAmount, ProcessedAmount, FollowOnProcessedAmount</li>\r\n\t<li>Check status fields - Response status should be Success, Transaction Status should be Closed</li>\r\n\t<li>The requestId on the Authorization/Settlement/Refund/Return Credit should be unique, there should not be any duplicates.</li>\r\n\t<li>For Unavailable / Failure transactions,&nbsp;the ProcessedAmount should be 0</li>\r\n\t<li>Base Gateway Vs Custom Gateway - From the payment header find the GatewayId, from the gateway UI find isBase=true/false</li>\r\n</ul>\r\n\r\n<div class=\"tip\"><strong>Note</strong>: Use the user exit CallGateway for custom gateway calls</div>\r\n\r\n<h3><a name=\"troubleshooting\" id=\"troubleshooting\"></a>Troubleshooting</h3>\r\n\r\n<h4><a name=\"why-is-my-invoice-open\" id=\"why-is-my-invoice-open\"></a>Why is my invoice open?</h4>\r\n\r\n<ul>\r\n\t<li>Check the invoice processed amount. If it&#39;s not equal to the invoice total, then check if your settlement or refund transactions are open or failed.</li>\r\n\t<li>Call the following API for the order to ensure payment and order are in sync:&nbsp;PUT<strong> /order/api/order/order/orderId/{orderId}/invoiceProcessedAmount</strong></li>\r\n\t<li>If the invoice processed amount is equal to the invoice amount and order and payment are in sync, then close the invoice&nbsp;by using the below API:\r\n\t<ul>\r\n\t\t<li>PUT : /order/api/order/order/orderId/{orderId}/syncPayment&nbsp;(Note: This only reconciles open invoices. Closed invoices will not be updated.)</li>\r\n\t</ul>\r\n\t</li>\r\n\t<li>If it&#39;s an adjustment invoice and you&#39;re using RefundBeforeAuthReversal = False, then this scenario could occur:\r\n\t<ul>\r\n\t\t<li>Create two-line order. Pay with one payment method.</li>\r\n\t\t<li>Ship line 1. Execute Settlement. Shipment invoice ties to Settlement.</li>\r\n\t\t<li>Apply appeasement to line 1</li>\r\n\t\t<li>An adjustment invoice is created in Open status but does not tie to any payment transaction. Auth Reversal created and executed. An invoice must have processedAmount = invoice total to be closed, so this invoice will remain open until the remaining items ship or get canceled.&nbsp;</li>\r\n\t\t<li>Possible outcomes<br />\r\n\t\ta. What happens to the adjustment invoice if we ship line 2? The AI will be closed and linked to the shipment invoice settlement transaction<br />\r\n\t\tb. What happens to the adjustment invoice if we short (cancel) line 2?&nbsp; The AI will be closed and linked to the refund transaction&nbsp;<br />\r\n\t\tc. What happens to the adjustment invoice if we short (reallocate) line 2? The AI will remain open until one of the above occurs.</li>\r\n\t</ul>\r\n\t</li>\r\n</ul>\r\n\r\n<h4><a name=\"how-can-i-update-a-payment-transaction\" id=\"how-can-i-update-a-payment-transaction\"></a>How can I update a payment transaction?</h4>\r\n\r\n<p>Edit the payment transaction&nbsp;on the &quot;Manage Payment Transactions&quot; UI which can be accessed by menu option &quot;Payment Transactions&quot;. Once the details are displayed on the right hand side panel, click on &#39;Edit&#39; button and set the proper value for transaction decision, processed amount, and so on,&nbsp;and click on &#39;Process Transaction Button&#39;.</p>\r\n\r\n<div class=\"warning\">If you are updating a transaction manually, a best practice is to always compare it to a successful equivalent transaction. The most common source of mistake is to not update the processed amount when updating the transaction to Success status.&nbsp;<br />\r\nThis type of problem can be avoided if the updated payment transaction was compared to another successful transaction.&nbsp;</div>\r\n\r\n<h4><a name=\"why-is-my-order-refunding-to-gift-card\" id=\"why-is-my-order-refunding-to-gift-card\"></a>Why is my order refunding to gift card?</h4>\r\n\r\n<ul>\r\n\t<li>Is your order line a gift? If so, the gift refund payment method defaults to gift card.</li>\r\n\t<li>Is your refund aged? If the current date minus settlement transaction date is less than the refund age configured in the payment parameters, then the aged refund payment type (gift card) is used.</li>\r\n\t<li>Is order refundRecipient set to GiftRecipient? If so, then the refund will be issued via gift card.</li>\r\n\t<li>Check the payment capture config for your original payment type - gift card may be configured. For example, if your original order was paid in cash, and now you&#39;re returning via call center, then the refund payment method with the highest ranked sequence for assisted selling channel is selected (gift card).</li>\r\n</ul>\r\n\r\n<h4><a name=\"payment-data-is-incorrect-nbsp-in-publish-order-json\" id=\"payment-data-is-incorrect-nbsp-in-publish-order-json\"></a>Payment Data is Incorrect&nbsp;in Publish Order JSON</h4>\r\n\r\n<p>Updates between the order and payment components are asynchronous, so many order outbound messages will have outdated payment information. For example, if a $100 order is fully authorized and a $30 appeasement is applied in the call center UI, then when the user confirms the updates, the order is updated and an outbound order is published. An auth reversal for $30 is processed and the payment method amount is now reduced to $70, but the outbound order message is published independently of these payment updates and may not include the latest data. If such data is required, then customization is required.</p>\r\n\r\n<p>A possible approach for such customization is to have the custom code do a synchronous payment request call (in calculate and execute mode) then call the Publish order API to generate the message. &nbsp;</p>\r\n\r\n<p>If payment is imported with an order json, there is a way to include the in-flight payment data on outbound order messages. For instance, if you import an order with a $40 Visa credit card and want to include the details of that payment in the publish order message, even if the payment component has not finished saving/processing the payment at the time of publishing.</p>\r\n\r\n<p><strong>Configuration</strong>:&nbsp;order.storeInflightPaymentData=True</p>\r\n\r\n<ul>\r\n\t<li><strong>Where?</strong> In the order component KV store</li>\r\n\t<li><strong>How does it work?</strong> If set to True, then any payment data included with an inbound order message will be included with the outbound publish order messages, if payment is not yet saved. If payment is already saved in the payment component (and payment is included in the order template), then the payment component data will be included in the outbound.&nbsp;</li>\r\n</ul>\r\n\r\n<h4><a name=\"transactions-stuck-in-in-progress-status\" id=\"transactions-stuck-in-in-progress-status\"></a>Transactions Stuck in In-Progress Status</h4>\r\n\r\n<p data-renderer-start-pos=\"105\">Some possible reasons include:</p>\r\n\r\n<ul data-indent-level=\"1\">\r\n\t<li data-renderer-start-pos=\"206\">Third party response mapping is missing</li>\r\n\t<li data-renderer-start-pos=\"206\">Custom code not handling some scenarios like in progress transactions or exceptions - see the Payment Failures guide for details</li>\r\n</ul>\r\n\r\n<p data-renderer-start-pos=\"385\">If the issue is reproducible, enable&nbsp;the logs during transaction processing. Depending on the root cause you can determine a solution:</p>\r\n\r\n<ul>\r\n\t<li data-renderer-start-pos=\"385\">If you need to trigger transaction processing, post a payment request (api/payment/paymentRequest). Check Swagger for more details.</li>\r\n\t<li data-renderer-start-pos=\"385\">Edit the payment transaction&nbsp;on the &quot;Manage Payment Transactions&quot; UI which can be accessed by menu option &quot;Payment Transactions&quot;. Once the details are displayed on the right hand side panel, click on &#39;Edit&#39; button and set the proper value for transaction decision, processed amount, and so on,&nbsp;and click on &#39;Process Transaction Button&#39;.</li>\r\n</ul>\r\n\r\n<h4><a name=\"order-not-moving-to-paid-status\" id=\"order-not-moving-to-paid-status\"></a>Order not Moving to Paid Status</h4>\r\n\r\n<p data-renderer-start-pos=\"53\">There could be a few causes for an order not moving to Paid status:</p>\r\n\r\n<ul>\r\n\t<li data-renderer-start-pos=\"107\">Payment transactions are not closed. Refer to the above section on In-Progress transactions if this is the case.</li>\r\n\t<li data-renderer-start-pos=\"156\">Payment transactions are closed but the&nbsp;invoice is still open or payment status is not updated. Refer to the above section on open invoices.</li>\r\n\t<li data-renderer-start-pos=\"260\">Payment component has correct payment status but it is not reflecting correctly in order.&nbsp;If payment component has correct payment status but the order does not, then see below.</li>\r\n</ul>\r\n\r\n<p>There may be an&nbsp;issue with queues/consumers. Ask services to&nbsp;check if &#39;queue.UpdatePaymentStatusEvent&#39; has&nbsp;stuck messages and consumers that are up. Once the issue is identified,&nbsp;correct the status of payment status with below URL (no payload required):&nbsp;PUT /order/api/order/order/orderId/{orderId}/paymentStatus</p>\r\n\r\n<h4 data-renderer-start-pos=\"1078\"><a name=\"republishing-sales-postings-for-invoices\" id=\"republishing-sales-postings-for-invoices\"></a>Republishing Sales Postings for Invoices</h4>\r\n\r\n<p data-renderer-start-pos=\"1\">To re-publish a sales posting for an order, update the required invoice&nbsp;PublishStatus to &quot;Ready For Publishing&quot; using the below order save API.</p>\r\n\r\n<p data-renderer-start-pos=\"1\">POST : /order/api/order/order/save</p>\r\n\r\n<pre>\r\n<code class=\"json\">{\r\n    &quot;Invoice&quot;: [\r\n        {\r\n            &quot;InvoiceId&quot;: &quot;{{InvoiceId1}}&quot;,\r\n            &quot;PublishStatus&quot;: {\r\n                &quot;PublishStatusId&quot;: &quot;Ready For Publishing&quot;\r\n            }\r\n        },\r\n        {\r\n            &quot;InvoiceId&quot;: &quot;{{InvoiceId2}}&quot;,\r\n            &quot;PublishStatus&quot;: {\r\n                &quot;PublishStatusId&quot;: &quot;Ready For Publishing&quot;\r\n            }\r\n        }      \r\n    ],        \r\n    &quot;OrderId&quot;: &quot;{{OrderId}}&quot;\r\n}</code></pre>\r\n\r\n<p>If OrderConfig.ImmediatePublishSalesPosting is&nbsp;enabled, the sales posting will be published immediately after the order is updated per the above API. Otherwise, use the below API to&nbsp;publish the sales posting immediately.</p>\r\n\r\n<p>GET /order/api/order/order/publishSalesPosting/orderId/orderId</p>\r\n\r\n<p data-renderer-start-pos=\"942\">Verify by checking the PublishStatusId of the invoices is&nbsp;updated to &quot;Published.&quot;</p>\r\n\r\n<h4 data-renderer-start-pos=\"942\"><a name=\"transaction-is-stuck-in-unavailable-status\" id=\"transaction-is-stuck-in-unavailable-status\"></a>Transaction is Stuck in Unavailable Status</h4>\r\n\r\n<h5 data-renderer-start-pos=\"942\">Issue: A settlement or refund transaction is stuck in unavailable status, and&nbsp;no new open transactions are created due to the parent transaction remaining attempts being negative.</h5>\r\n\r\n<p data-renderer-start-pos=\"942\">To troubleshoot, for Settlement and Refund transactions find their parent transaction using the FollowOnId field. Check if the parent transaction&rsquo;s RemainingAttempts is zero or a&nbsp;negative value. Get this from the GET PaymentHeader&nbsp;API.&nbsp; Find the RemainingAttempts defined in PaymentTypeConfig for the card type combination. The default value is 10. Update the RemainingAttempts in the parent transaction to the above value and save the payment header using the below API: POST&nbsp;/payment/api/payment/paymentHeader/save</p>\r\n\r\n<p data-renderer-start-pos=\"675\">Process the payment again by sending a payment request: POST /payment/api/payment/paymentRequest/save</p>\r\n\r\n<h4 data-renderer-start-pos=\"798\"><a name=\"why-did-my-payment-transaction-fail\" id=\"why-did-my-payment-transaction-fail\"></a>Why did my payment transaction fail?</h4>\r\n\r\n<p data-renderer-start-pos=\"264\">Check if the payment gateway used is base or custom. To find this, Get the payment header and find the Gateway Id. Use the Payment Gateway UI to determine if the gateway has IsBase set to true, or if it&#39;s custom.</p>\r\n\r\n<p data-renderer-start-pos=\"342\">If using a base gateway, get the ExternalResponseId from the payment transaction, get the response description from the Gateway Response Mapping UI. Search for the response ID and read the description to understand the reason for the failure.&nbsp;</p>\r\n\r\n<p data-renderer-start-pos=\"759\">If using a custom gateway, get the ExternalResponseId from the payment transaction</p>\r\n\r\n<h4 data-renderer-start-pos=\"798\"><a name=\"gift-card-refunds-showing-up-on-nbsp-payment-method\" id=\"gift-card-refunds-showing-up-on-nbsp-payment-method\"></a>Gift card refunds showing up on&nbsp;payment method</h4>\r\n\r\n<p data-renderer-start-pos=\"264\">If using gift cards as a refund service, the payment method will always include a gift card line. In order to avoid this, create a custom solution using the CallGateway user exit.</p>\r\n\r\n<h4><a name=\"how-to-re-process-nbsp-a-refund-failure\" id=\"how-to-re-process-nbsp-a-refund-failure\"></a>How to Re-Process&nbsp;a Refund Failure</h4>\r\n\r\n<p data-renderer-start-pos=\"1\">When refund transaction fails and it needs to be reprocessed, follow these steps:</p>\r\n\r\n<ol>\r\n\t<li data-renderer-start-pos=\"92\">Get the payment header</li>\r\n\t<li data-renderer-start-pos=\"118\">Find the parent settlement transaction of the failed refund</li>\r\n\t<li data-renderer-start-pos=\"181\">Set &quot;IsValidForRefund&quot; to true</li>\r\n\t<li data-renderer-start-pos=\"215\">Update the Payment Header</li>\r\n\t<li data-renderer-start-pos=\"244\">Trigger Payment Request with CalcualteOnly to check if an Open Refund is created with proper amount and followOnId</li>\r\n\t<li data-renderer-start-pos=\"359\">Trigger Payment Request with CalcualteAndExecute to execute refund</li>\r\n</ol>\r\n\r\n<h4><a name=\"why-is-payment-data-not-included-in-the-order-confirmation-outbound-message\" id=\"why-is-payment-data-not-included-in-the-order-confirmation-outbound-message\"></a>Why is payment data not included in the order confirmation outbound message?</h4>\r\n\r\n<p>When an order gets confirmed, payment data is sent to the payment component asynchronously, so payment information may not be available when the order is confirmed. To include payment data in the order confirmation email/outbound message, follow these steps:</p>\r\n\r\n<ul>\r\n\t<li>Introduce a new extended attribute in order (e.g. IsPaymentInfoAvailable) and default&nbsp;to null</li>\r\n\t<li>When the payment header is saved in order, the &quot;Payment:PaymentHeader:Event:PostCreate&rdquo; event is triggered. When this event is fired, implement custom code to update IsPaymentInfoAvailable to true.</li>\r\n\t<li>In the Order Configuration: Mod Types, trigger the Publish Order outbound message for this attribute (IsPaymentInfoAvailable) instead of the IsConfirmed attribute.</li>\r\n</ul>\r\n\r\n<h4><a name=\"authorization-record-not-created-for-new-payment-was-added-after-deleting-the-old-payment-method-due-to-settlement-failure\" id=\"authorization-record-not-created-for-new-payment-was-added-after-deleting-the-old-payment-method-due-to-settlement-failure\"></a>Authorization record not created for new payment was added after deleting the old payment method due to settlement failure.</h4>\r\n\r\n<p>Base does not create an authorization transaction for a new payment method added to replace the payment method used previously in the order due to settlement failure and a settlement transaction is created directly without the authorization transaction being created and executed.</p>\r\n\r\n<p>If an authorization transaction is required to be created, the below mentioned options are available as a custom solution.</p>\r\n\r\n<ul>\r\n\t<li>\r\n\t<p data-renderer-start-pos=\"47\">Add a new payment tender with the closed authorization record and then trigger a settlement transaction in execute mode.</p>\r\n\t</li>\r\n\t<li>\r\n\t<p data-renderer-start-pos=\"148\">Send a settlement request to the gateway for the new payment method, and have custom logic to modify the payment gateway code to&nbsp;call authorization if the follow-on token id is not present on the settlement transaction.</p>\r\n\t</li>\r\n</ul>\r\n\r\n<h4><a name=\"authorization-got-reversed-inadvertently-how-to-clean-up-the-data-and-proceed-with-settlement-for-fulfilled-orders\" id=\"authorization-got-reversed-inadvertently-how-to-clean-up-the-data-and-proceed-with-settlement-for-fulfilled-orders\"></a>Authorization got reversed inadvertently - how to clean up the data and proceed with settlement for fulfilled orders?</h4>\r\n\r\n<ul>\r\n\t<li data-renderer-start-pos=\"46\">Perform the below-mentioned steps in&nbsp;Payment Transactions UI:\r\n\t<ul>\r\n\t\t<li data-renderer-start-pos=\"46\">Mark the authorization reversal as a failure.&nbsp;</li>\r\n\t\t<li data-renderer-start-pos=\"109\">Validate if the followOnProcessedAmount goes back to the original amount on the auth. It should happen automatically after marking the auth reversal transaction as failure. If that does not happen, update the followOnProcessedAmount to the amount on the authorization transaction.</li>\r\n\t</ul>\r\n\t</li>\r\n\t<li data-renderer-start-pos=\"324\">Update the PaymentMethod.Amount to the Authorization Amount using API</li>\r\n\t<li data-renderer-start-pos=\"403\">To continue with settlement transactions for fulfilled orders, perform the below-mentioned steps:&nbsp;\r\n\t<ul>\r\n\t\t<li data-renderer-start-pos=\"444\">Trigger calculateOnly payment request to make sure the remaining settlement is created correctly.</li>\r\n\t\t<li data-renderer-start-pos=\"575\">Trigger ExecuteOnly payment request to attempt settlement for the remaining amount.</li>\r\n\t</ul>\r\n\t</li>\r\n</ul>\r\n\r\n<div class=\"warning\">The steps mentioned above may not work for PayPal. Try these steps for one of the orders and if it works, proceed with other orders, else reconciliation has to be handled outside MAO.</div>\r\n\r\n<h4><a name=\"user-exit-nbsp-not-getting-invoked-while-trying-to-add-additional-request-fields\" id=\"user-exit-nbsp-not-getting-invoked-while-trying-to-add-additional-request-fields\"></a>User exit&nbsp;not getting invoked while trying to add additional request fields</h4>\r\n\r\n<p>The User Exit Paymentgateway:CyberSource:UserExit:EditCyberSourceRequest is not getting invoked while trying to add additional request fields. Will this User Exit be called before or after the CallGateway Use Exit is called?</p>\r\n\r\n<p>This user exit will be called just before cybersource call.</p>\r\n\r\n<h4><a name=\"even-though-the-amount-is-fully-paid-the-remaining-to-pay-remains-non-zero-on-the-contact-center-screen\" id=\"even-though-the-amount-is-fully-paid-the-remaining-to-pay-remains-non-zero-on-the-contact-center-screen\"></a>Even though the amount is fully paid, the remaining to pay remains non zero on the Contact Center screen?</h4>\r\n\r\n<p data-renderer-start-pos=\"208\">This happens&nbsp;when&nbsp;you have manually modified payment related information for the order.&nbsp;To fix this problem, perform the following checks</p>\r\n\r\n<ul data-indent-level=\"1\">\r\n\t<li>\r\n\t<p data-renderer-start-pos=\"351\">Check sum total of PaymentMethod.Amount - sum total of PaymentMethod.CurrentRefundAmount</p>\r\n\t</li>\r\n\t<li>\r\n\t<p data-renderer-start-pos=\"443\">The above calculated value is shown in UI as Remaining to Pay / Balance Due. If the calculated value matches to what is shown in UI, then you might have to fix the Amount field in PaymentMethod. To do that, continue with the steps below.</p>\r\n\t</li>\r\n\t<li>\r\n\t<p data-renderer-start-pos=\"678\">Check sum total of Settled amount from settlement transaction and sum total of Authorized amount if the payment is not yet settled. This should be equal to the sum total of PaymentMethod.Amount. If not, then update the Amount field for appropriate PaymentMethod so that they become equal.</p>\r\n\t</li>\r\n</ul>\r\n\r\n<h4><a name=\"why-is-my-canceled-invoice-information-not-posted-to-vertex\" id=\"why-is-my-canceled-invoice-information-not-posted-to-vertex\"></a>Why is my canceled invoice information not posted to vertex</h4>\r\n\r\n<p>Currently, we do not support &ldquo;Distribute tax call&rdquo; for cancelled invoices and is not turned on by default. The attribute to turn on is &ldquo;RemitTaxForCanceledInvoice&rdquo; in order parameters.</p>\r\n\r\n<p>This will call vertex distribute tax api to negate the taxes. Other tax integrations must implement Order:Order:UserExit:CallDistributeTaxService.</p>\r\n\r\n<h4><a name=\"why-is-followonid-not-populated-in-paymentheader-during-standalone-settlement\" id=\"why-is-followonid-not-populated-in-paymentheader-during-standalone-settlement\"></a>Why is FollowOnID not populated in PaymentHeader during standalone settlement</h4>\r\n\r\n<p>While creating a stand alone settlement, when an authorization call is made to a third party internally or authorization&nbsp;is created on the fly in the gateway, requestId is considered as FollowOnId and sent in settlement request.&nbsp;This FollowOnId is populated in the callGateway response for settlement transactions, but is not reflected on the GetPayment header for the same settlement transaction.<br />\r\n<br />\r\nOnly certain fields are updated as part of CallGateway response. To record the FollowOnID that is generated in PaymentHeader, use the new entry in PaymentTransAttribute.</p>\r\n\r\n<h4><a name=\"authorization-reversal-is-stuck-in-open\" id=\"authorization-reversal-is-stuck-in-open\"></a>Authorization reversal is stuck in open</h4>\r\n\r\n<p>Ensure that no duplicate payment rule exists for the payment methods like visa, credit card, and so on.&nbsp;</p>\r\n\r\n<div class=\"info\"><strong>Note</strong>: Reverse Authorization will remain open until all the lines in the order are shorted or shipped.</div>\r\n\r\n<h4><a name=\"a-second-auth-transaction-is-created-in-active-omni-with-the-same-transactionrequestid-as-the-original-auth-doubling-the-authorized-amount-for-the-order\" id=\"a-second-auth-transaction-is-created-in-active-omni-with-the-same-transactionrequestid-as-the-original-auth-doubling-the-authorized-amount-for-the-order\"></a>A second auth transaction is created in Active Omni with the same TransactionRequestId as the original auth, doubling the authorized amount for the order</h4>\r\n\r\n<p>If paymentRequestId on both the auth records are same, once the auth reversal is created, the system will update the followonprocessed amount on both the auth records. So, provide a valid value for PaymentTransactionId and ensure that the value is not null. If the PaymentTransactionId is null and if the order/payment is called twice for save, the PaymentTransaction will get saved twice.</p>\r\n\r\n<h4><a name=\"authorization-is-not-getting-reversed\" id=\"authorization-is-not-getting-reversed\"></a>Authorization is not getting reversed</h4>\r\n\r\n<ol>\r\n\t<li>Attempt to trigger payment again, it is possible that the auth is ready to reverse, but a payment request failed or wasn&#39;t sent. Save a payment request for the order in &quot;CalculateAndExecute&quot; mode.</li>\r\n\t<li>Verify the order total is updated correctly and there are no remaining balances present including the order/line taxes and order/line charges.</li>\r\n</ol>\r\n\r\n<h3><a name=\"related-articles\" id=\"related-articles\"></a>Related Articles</h3>\r\n\r\n<div class=\"info\"><ul class=\"related-articles\"><li><a href=\"/other-transaction-types\" hqid=\"2617712\">Other Transaction Types</a></li><li><a href=\"/paymentfailures\" hqid=\"2660553\">Payment Failures</a></li><li><a href=\"/paymentoverview\" hqid=\"2688302\">Payment Overview</a></li><li><a href=\"/payment-schedulers\" hqid=\"2617715\">Payment Schedulers & Batch Processing</a></li><li><a href=\"/capturing-payment\" hqid=\"2617706\">Capturing Payment</a></li><li><a href=\"/payment-fraud\" hqid=\"2617716\">Fraud</a></li><li><a href=\"/refunds\" hqid=\"2617711\">Refunds</a></li><li><a href=\"/how-payment-processing-works\" hqid=\"2617708\">How Payment Processing Works</a></li><li><a href=\"/payment-types\" hqid=\"2617707\">Payment Types</a></li><li><a href=\"/einvoice\" hqid=\"3061519\">eInvoice </a></li><li><a href=\"/payment-gateway-integration\" hqid=\"2617714\">Payment Gateway Integration</a></li><li><a href=\"/payment-rest-apis-and-user-exits\" hqid=\"2617717\">Rest APIs and User Exits</a></li><li><a href=\"/authorization\" hqid=\"2617709\">Authorization</a></li><li><a href=\"/payment-health-dashboard\" hqid=\"3127204\">Payment Health Dashboard</a></li><li><a href=\"/invoicing-sales-posting\" hqid=\"2617713\">Invoicing and Sales Posting</a></li><li><a href=\"/settlement\" hqid=\"2617710\">Settlement</a></li></ul></div>\r\n\r\n\t  </div>\r\n </div>\r\n <div id=\"ui-page-fb-wrap\"></div>\r\n <div class=\"hiq-footer-wrap\">\r\n    \r\n                \r\n  </div>\r\n\r\n\r\n</div>\r\n\r\n\r\n\r\n\r\n\r\n",
  "content_length": 43654,
  "scraped_at": "2025-08-09T21:59:04.349914",
  "content_clean": "Home ››Manhattan Active® Omni››Order Management››Process & Configuration Guides››Order Selling››Payment ››Testing & Troubleshooting Payment Testing, Validating & Troubleshooting Payment Previous I Testing with the Payment SimulatorSimulator ConfigurationHow to Test Using the SimulatorSimulating E-Check PaymentsSimulating Batch PaymentsBasic Payment ValidationsTroubleshootingWhy is my invoice open?How can I update a payment transaction?Why is my order refunding to gift card?Payment Data is Incorrect in Publish Order JSONTransactions Stuck in In-Progress StatusOrder not Moving to Paid StatusRepublishing Sales Postings for InvoicesTransaction is Stuck in Unavailable StatusWhy did my payment transaction fail?Gift card refunds showing up on payment methodHow to Re-Process a Refund FailureWhy is payment data not included in the order confirmation outbound message?Authorization record not created for new payment was added after deleting the old payment method due to settlement failure.Authorization got reversed inadvertently - how to clean up the data and proceed with settlement for fulfilled orders?User exit not getting invoked while trying to add additional request fieldsEven though the amount is fully paid, the remaining to pay remains non zero on the Contact Center screen?Why is my canceled invoice information not posted to vertexWhy is FollowOnID not populated in PaymentHeader during standalone settlementAuthorization reversal is stuck in openA second auth transaction is created in Active Omni with the same TransactionRequestId as the original auth, doubling the authorized amount for the orderAuthorization is not getting reversedRelated Articles Testing with the Payment Simulator The payment simulator mimics behavior of a third-party payment gateway such as CyberSource or PAYware Connect. The simulator is used to test payment flows including authorization, settlement, and refund, in scenarios where the system is not yet integrated with a third-party payment gateway. To test with the simulator, select it as the gateway in the payment rule configuration. The simulator receives a payment gateway request and generates a payment gateway response based on the configured rules. To select a rule, the simulator filters by transaction type and first tries to match for account number. If no record is found with a matching account number, then the simulator looks for a rule where the requested amount falls within the minimum/maximum range. The simulator returns a response with the configured external response code and processed amount which is calculated as requested amount times processed amount percentage. For example, if the payment simulator rules are configured as follows Rule ID Account Number Minimum Requested Amount Maximum Requested Amount External Response Code Processed Amount Percentage Transaction Type 1 4242424242424240 null null 100 (Success) 100 null 2 5105105105105100 null null 101 (Failure) 0 null 3 3566002020360505 null null 150 (Unavailable) 0 null 4 4000056655665550 null null 400 (Fraud) 100 null 5 null 1000 2000 101 (Failure) 0 null 6 null 50 60 101 (Failure) 0 null 7 null 200 250 100 (Success) 25 null 8 null 250 300 400 (Fraud) 25 null 9 4242424242424240 500 750 400 (Fraud) 100 null 10 4242424242424240 750 1000 150 (Unavailable) 0 null For example, when a payment gateway request is received by the simulator with the below request data, then the response data is sent as indicated below. Request Selected Rule ID Response Transaction type = Settlement Requested amount = $200 Account number = 4242424242424240 1 External response code = 100 (Success) Processed amount = $200 Transaction type = Settlement Requested amount = $200 Account number = 4000000000000000 7 External response code = 100 (Success) Processed amount = $50 Transaction type = Settlement Requested amount = $600 Account number = 4242424242424240 9 External response code = 400 (Fraud) Processed amount = $600 Transaction type = Settlement Requested amount = $200 Account number = 5105105105105100 2 External response code = 101 (Failure) Processed amount = $0 Transaction type = Settlement Requested amount = $35 Account number = 9999999999999999 No matching rule found Response status = Success Processed amount = Requested amount Simulator Configuration To configure simulator rules, navigate to the Payment Simulator Rule UI: To modify an existing rule, edit an existing record. To add a new rule, add a new record and select a response code from the following: Success, Failure, Fraud and Unavailable. If response code Success or Fraud is selected, then enter a processed amount percentage. This indicates what percentage of the requested amount will be successfully processed. For example, to return a processed amount equal to the full requested amount, then configure processed amount percentage = 100. To return processed amount of $25 for a requested amount of $100, then configure processed amount percentage = 25. Processed amount percentage is not required for Failure or Unavailable responses, since the Payment component assumes the processed amount to be zero. Optionally add account number, transaction type, minimum requested amount, and maximum requested amount to further filter responses using these attributes. How to Test Using the Simulator To test a synchronous payment such as a credit card, gift card, or debit card, perform the following steps: Create an order and ship items such that a shipment invoice is created Create or update a payment simulator rule entry for this transactionType, accountNumber (optional), and requestedAmount range (optional) Set the externalResponseCode based on the outcome you wish to achieve (Success, Failure, and so on) Ensure a mapping exists in the gateway response mapping table for this externalResponseCode value Create a payment header with a payment method which gets executed synchronously (credit card, gift card, debit card, PayPal, and so on) with a transactionType, accountNumber, and amount which corresponds to the rule created in the previous step Run the calculate and execute services The transaction should be updated to Closed status, with the responseStatus configured in the simulator rule/gateway mapping Simulating E-Check Payments The payment simulator can also be used to test asynchronous payment processing such as e-checks. For e-check authorization and authorization reversal transactions, the payment simulator rules are used to return a responseStatus as described above. For e-check settlement and refund transactions, however, the simulator always returns transactionStatus = In Progress, instead of returning transactionStatus = Closed as would be done for all other transactions. This logic is hard coded and does not require configuration. To retrieve the status of an In Progress transaction, a separate configuration entity called the payment report simulator rule is required. While the payment simulator rule entity is used for simulating a responseStatus for Open transactions, the payment simulator report rule is used for simulating a responseStatus for In Progress transactions. To simulate an e-check settlement or refund response, follow the steps below: Create an order and ship items such that a shipment invoice is created Create a payment header with an e-check payment method The e-check settlement is created. Once the execute service runs, the transaction is updated to TransactionStatus = In Progress, based on the hard coded logic in the payment simulator rules. Create or update a payment report simulator rule entry for this orderId and requestId Get the requestId from the settlement paymentTransaction.requestId Set the externalResponseId based on the outcome you wish to achieve (Success, Failure, and so on) Ensure a mapping exists in the gateway response mapping table for this externalResponseCode value Create a scheduler entry for e-check settlement and execute it immediately The In Progress transaction should be updated to Closed, with the responseStatus configured in the simulator rule/gateway mapping Simulating Batch Payments To test batch payments or other asynchronous payment flows other than e-check, which use transactionStatus = In Progress to indicate that the transaction is being processed by the third-party payment gateway, a payment simulator rule is required. The payment simulator has hard coded logic to return transactionStatus = In Progress for e-check settlements and refunds, but for other payment types such as credit cards which use a batch process, an explicit rule must be configured. Configuring a payment simulator rule entry with a null externalResponseCode returns a response with transactionStatus = In Progress. To test a batch payment, follow these steps: Create an order and ship items such that a shipment invoice is created Create or update a payment simulator rule entry for this transactionType, accountNumber (optional), and requestedAmount range (optional) Leave the externalResponseCode null Create a payment header with a payment method with a transactionType, accountNumber, and amount which corresponds to the rule created in the previous step Run the calculate and execute services The transaction should be updated to In Progress status Create or update a payment report simulator rule entry for this orderId and requestId Get the requestId from the settlement paymentTransaction.requestId Set the externalResponseId based on the outcome you wish to achieve (Success, Failure, and so on) Ensure a mapping exists in the gateway response mapping table for this externalResponseCode value Create a scheduler entry for getting the status of In Progress transactions and execute it immediately The In Progress transaction should be updated to Closed, with the responseStatus configured in the simulator rule/gateway mapping Note: If no matching payment simulator rule entry is found for a transaction, then the simulator responds with responseStatus = Success and transactionStatus = Closed. Basic Payment Validations Some of the validations while evaluating payment related issues are listed below: Required fields - Check for the RequestId on the payment transactions, it should not be blank. For example, If the RequestId is blank on the authorization record, then the settlement is done as a standalone settlement, the follow on processed amount will be null on the auth record. Important fields - RequestId, FollowonId, Expiry date, IsActive flag, IsValidForRefund, IsCopied, RequestAmount, ProcessedAmount For follownon based refunds - validate that the requestId on the auth record is not null and this Id is the followonId of the settlement record. Similarly, the requestId of the settlement records = the followonId on the Refund record. The followonProcessedAmount on the Authorization record = Sum of settled amount for that payment method. The followonProcessedAmount on the Settlement record = Sum of refund amount for that payment method. Check amount fields - RequestedAmount, ProcessedAmount, FollowOnProcessedAmount Check status fields - Response status should be Success, Transaction Status should be Closed The requestId on the Authorization/Settlement/Refund/Return Credit should be unique, there should not be any duplicates. For Unavailable / Failure transactions, the ProcessedAmount should be 0 Base Gateway Vs Custom Gateway - From the payment header find the GatewayId, from the gateway UI find isBase=true/false Note: Use the user exit CallGateway for custom gateway calls Troubleshooting Why is my invoice open? Check the invoice processed amount. If it's not equal to the invoice total, then check if your settlement or refund transactions are open or failed. Call the following API for the order to ensure payment and order are in sync: PUT /order/api/order/order/orderId/{orderId}/invoiceProcessedAmount If the invoice processed amount is equal to the invoice amount and order and payment are in sync, then close the invoice by using the below API: PUT : /order/api/order/order/orderId/{orderId}/syncPayment (Note: This only reconciles open invoices. Closed invoices will not be updated.) If it's an adjustment invoice and you're using RefundBeforeAuthReversal = False, then this scenario could occur: Create two-line order. Pay with one payment method. Ship line 1. Execute Settlement. Shipment invoice ties to Settlement. Apply appeasement to line 1 An adjustment invoice is created in Open status but does not tie to any payment transaction. Auth Reversal created and executed. An invoice must have processedAmount = invoice total to be closed, so this invoice will remain open until the remaining items ship or get canceled. Possible outcomes a. What happens to the adjustment invoice if we ship line 2? The AI will be closed and linked to the shipment invoice settlement transaction b. What happens to the adjustment invoice if we short (cancel) line 2?  The AI will be closed and linked to the refund transaction c. What happens to the adjustment invoice if we short (reallocate) line 2? The AI will remain open until one of the above occurs. How can I update a payment transaction? Edit the payment transaction on the \"Manage Payment Transactions\" UI which can be accessed by menu option \"Payment Transactions\". Once the details are displayed on the right hand side panel, click on 'Edit' button and set the proper value for transaction decision, processed amount, and so on, and click on 'Process Transaction Button'. If you are updating a transaction manually, a best practice is to always compare it to a successful equivalent transaction. The most common source of mistake is to not update the processed amount when updating the transaction to Success status. This type of problem can be avoided if the updated payment transaction was compared to another successful transaction. Why is my order refunding to gift card? Is your order line a gift? If so, the gift refund payment method defaults to gift card. Is your refund aged? If the current date minus settlement transaction date is less than the refund age configured in the payment parameters, then the aged refund payment type (gift card) is used. Is order refundRecipient set to GiftRecipient? If so, then the refund will be issued via gift card. Check the payment capture config for your original payment type - gift card may be configured. For example, if your original order was paid in cash, and now you're returning via call center, then the refund payment method with the highest ranked sequence for assisted selling channel is selected (gift card). Payment Data is Incorrect in Publish Order JSON Updates between the order and payment components are asynchronous, so many order outbound messages will have outdated payment information. For example, if a $100 order is fully authorized and a $30 appeasement is applied in the call center UI, then when the user confirms the updates, the order is updated and an outbound order is published. An auth reversal for $30 is processed and the payment method amount is now reduced to $70, but the outbound order message is published independently of these payment updates and may not include the latest data. If such data is required, then customization is required. A possible approach for such customization is to have the custom code do a synchronous payment request call (in calculate and execute mode) then call the Publish order API to generate the message. If payment is imported with an order json, there is a way to include the in-flight payment data on outbound order messages. For instance, if you import an order with a $40 Visa credit card and want to include the details of that payment in the publish order message, even if the payment component has not finished saving/processing the payment at the time of publishing. Configuration: order.storeInflightPaymentData=True Where? In the order component KV store How does it work? If set to True, then any payment data included with an inbound order message will be included with the outbound publish order messages, if payment is not yet saved. If payment is already saved in the payment component (and payment is included in the order template), then the payment component data will be included in the outbound. Transactions Stuck in In-Progress Status Some possible reasons include: Third party response mapping is missing Custom code not handling some scenarios like in progress transactions or exceptions - see the Payment Failures guide for details If the issue is reproducible, enable the logs during transaction processing. Depending on the root cause you can determine a solution: If you need to trigger transaction processing, post a payment request (api/payment/paymentRequest). Check Swagger for more details. Edit the payment transaction on the \"Manage Payment Transactions\" UI which can be accessed by menu option \"Payment Transactions\". Once the details are displayed on the right hand side panel, click on 'Edit' button and set the proper value for transaction decision, processed amount, and so on, and click on 'Process Transaction Button'. Order not Moving to Paid Status There could be a few causes for an order not moving to Paid status: Payment transactions are not closed. Refer to the above section on In-Progress transactions if this is the case. Payment transactions are closed but the invoice is still open or payment status is not updated. Refer to the above section on open invoices. Payment component has correct payment status but it is not reflecting correctly in order. If payment component has correct payment status but the order does not, then see below. There may be an issue with queues/consumers. Ask services to check if 'queue.UpdatePaymentStatusEvent' has stuck messages and consumers that are up. Once the issue is identified, correct the status of payment status with below URL (no payload required): PUT /order/api/order/order/orderId/{orderId}/paymentStatus Republishing Sales Postings for Invoices To re-publish a sales posting for an order, update the required invoice PublishStatus to \"Ready For Publishing\" using the below order save API. POST : /order/api/order/order/save { \"Invoice\": [ { \"InvoiceId\": \"{{InvoiceId1}}\", \"PublishStatus\": { \"PublishStatusId\": \"Ready For Publishing\" } }, { \"InvoiceId\": \"{{InvoiceId2}}\", \"PublishStatus\": { \"PublishStatusId\": \"Ready For Publishing\" } } ], \"OrderId\": \"{{OrderId}}\" } If OrderConfig.ImmediatePublishSalesPosting is enabled, the sales posting will be published immediately after the order is updated per the above API. Otherwise, use the below API to publish the sales posting immediately. GET /order/api/order/order/publishSalesPosting/orderId/orderId Verify by checking the PublishStatusId of the invoices is updated to \"Published.\" Transaction is Stuck in Unavailable Status Issue: A settlement or refund transaction is stuck in unavailable status, and no new open transactions are created due to the parent transaction remaining attempts being negative. To troubleshoot, for Settlement and Refund transactions find their parent transaction using the FollowOnId field. Check if the parent transaction’s RemainingAttempts is zero or a negative value. Get this from the GET PaymentHeader API.  Find the RemainingAttempts defined in PaymentTypeConfig for the card type combination. The default value is 10. Update the RemainingAttempts in the parent transaction to the above value and save the payment header using the below API: POST /payment/api/payment/paymentHeader/save Process the payment again by sending a payment request: POST /payment/api/payment/paymentRequest/save Why did my payment transaction fail? Check if the payment gateway used is base or custom. To find this, Get the payment header and find the Gateway Id. Use the Payment Gateway UI to determine if the gateway has IsBase set to true, or if it's custom. If using a base gateway, get the ExternalResponseId from the payment transaction, get the response description from the Gateway Response Mapping UI. Search for the response ID and read the description to understand the reason for the failure. If using a custom gateway, get the ExternalResponseId from the payment transaction Gift card refunds showing up on payment method If using gift cards as a refund service, the payment method will always include a gift card line. In order to avoid this, create a custom solution using the CallGateway user exit. How to Re-Process a Refund Failure When refund transaction fails and it needs to be reprocessed, follow these steps: Get the payment header Find the parent settlement transaction of the failed refund Set \"IsValidForRefund\" to true Update the Payment Header Trigger Payment Request with CalcualteOnly to check if an Open Refund is created with proper amount and followOnId Trigger Payment Request with CalcualteAndExecute to execute refund Why is payment data not included in the order confirmation outbound message? When an order gets confirmed, payment data is sent to the payment component asynchronously, so payment information may not be available when the order is confirmed. To include payment data in the order confirmation email/outbound message, follow these steps: Introduce a new extended attribute in order (e.g. IsPaymentInfoAvailable) and default to null When the payment header is saved in order, the \"Payment:PaymentHeader:Event:PostCreate” event is triggered. When this event is fired, implement custom code to update IsPaymentInfoAvailable to true. In the Order Configuration: Mod Types, trigger the Publish Order outbound message for this attribute (IsPaymentInfoAvailable) instead of the IsConfirmed attribute. Authorization record not created for new payment was added after deleting the old payment method due to settlement failure. Base does not create an authorization transaction for a new payment method added to replace the payment method used previously in the order due to settlement failure and a settlement transaction is created directly without the authorization transaction being created and executed. If an authorization transaction is required to be created, the below mentioned options are available as a custom solution. Add a new payment tender with the closed authorization record and then trigger a settlement transaction in execute mode. Send a settlement request to the gateway for the new payment method, and have custom logic to modify the payment gateway code to call authorization if the follow-on token id is not present on the settlement transaction. Authorization got reversed inadvertently - how to clean up the data and proceed with settlement for fulfilled orders? Perform the below-mentioned steps in Payment Transactions UI: Mark the authorization reversal as a failure. Validate if the followOnProcessedAmount goes back to the original amount on the auth. It should happen automatically after marking the auth reversal transaction as failure. If that does not happen, update the followOnProcessedAmount to the amount on the authorization transaction. Update the PaymentMethod.Amount to the Authorization Amount using API To continue with settlement transactions for fulfilled orders, perform the below-mentioned steps: Trigger calculateOnly payment request to make sure the remaining settlement is created correctly. Trigger ExecuteOnly payment request to attempt settlement for the remaining amount. The steps mentioned above may not work for PayPal. Try these steps for one of the orders and if it works, proceed with other orders, else reconciliation has to be handled outside MAO. User exit not getting invoked while trying to add additional request fields The User Exit Paymentgateway:CyberSource:UserExit:EditCyberSourceRequest is not getting invoked while trying to add additional request fields. Will this User Exit be called before or after the CallGateway Use Exit is called? This user exit will be called just before cybersource call. Even though the amount is fully paid, the remaining to pay remains non zero on the Contact Center screen? This happens when you have manually modified payment related information for the order. To fix this problem, perform the following checks Check sum total of PaymentMethod.Amount - sum total of PaymentMethod.CurrentRefundAmount The above calculated value is shown in UI as Remaining to Pay / Balance Due. If the calculated value matches to what is shown in UI, then you might have to fix the Amount field in PaymentMethod. To do that, continue with the steps below. Check sum total of Settled amount from settlement transaction and sum total of Authorized amount if the payment is not yet settled. This should be equal to the sum total of PaymentMethod.Amount. If not, then update the Amount field for appropriate PaymentMethod so that they become equal. Why is my canceled invoice information not posted to vertex Currently, we do not support “Distribute tax call” for cancelled invoices and is not turned on by default. The attribute to turn on is “RemitTaxForCanceledInvoice” in order parameters. This will call vertex distribute tax api to negate the taxes. Other tax integrations must implement Order:Order:UserExit:CallDistributeTaxService. Why is FollowOnID not populated in PaymentHeader during standalone settlement While creating a stand alone settlement, when an authorization call is made to a third party internally or authorization is created on the fly in the gateway, requestId is considered as FollowOnId and sent in settlement request. This FollowOnId is populated in the callGateway response for settlement transactions, but is not reflected on the GetPayment header for the same settlement transaction. Only certain fields are updated as part of CallGateway response. To record the FollowOnID that is generated in PaymentHeader, use the new entry in PaymentTransAttribute. Authorization reversal is stuck in open Ensure that no duplicate payment rule exists for the payment methods like visa, credit card, and so on. Note: Reverse Authorization will remain open until all the lines in the order are shorted or shipped. A second auth transaction is created in Active Omni with the same TransactionRequestId as the original auth, doubling the authorized amount for the order If paymentRequestId on both the auth records are same, once the auth reversal is created, the system will update the followonprocessed amount on both the auth records. So, provide a valid value for PaymentTransactionId and ensure that the value is not null. If the PaymentTransactionId is null and if the order/payment is called twice for save, the PaymentTransaction will get saved twice. Authorization is not getting reversed Attempt to trigger payment again, it is possible that the auth is ready to reverse, but a payment request failed or wasn't sent. Save a payment request for the order in \"CalculateAndExecute\" mode. Verify the order total is updated correctly and there are no remaining balances present including the order/line taxes and order/line charges. Related Articles Other Transaction TypesPayment FailuresPayment OverviewPayment Schedulers & Batch ProcessingCapturing PaymentFraudRefundsHow Payment Processing WorksPayment TypeseInvoice Payment Gateway IntegrationRest APIs and User ExitsAuthorizationPayment Health DashboardInvoicing and Sales PostingSettlement"
}