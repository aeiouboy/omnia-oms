# Order Cancellation

**Permalink:** order-cancellation
**Path:** Manhattan Active® Omni/Order Management/Process & Configuration Guides/Order Orchestration/Order Cancellation
**Content Length:** 33,741 characters
**Scraped:** 2025-08-09T21:56:37.692446

---

Home ››Manhattan Active® Omni››Order Management››Process & Configuration Guides››Order Orchestration ››Order Cancellation Order Cancellation Previous I Next Order CancellationOverviewHow Order Cancellation WorksTypes of CancellationWays to Cancel an OrderCancel Using Orders UICancel Using Customer Service UICancel via API UpdatesCancel Using MilestonesHow to configure Order Milestone for cancelling Non-Confirmed/Non-Allocated/Non-Released Orders using Order Configuration UIHow to Cancel Back Ordered UnitsHow to Cancel Back Ordered Units with a Scheduled JobRetaining Selling Attributes on Canceled Order/LinesImplementation FlavorsOn Short Reason Codes - Backorder instead of CancelCanceling STS OrdersTroubleshootingOrders are not getting canceled post released statusManhattan Active® Omni does not keep the charges once the order is canceledThe order was canceled successfully in the fulfillment system but not reflected as canceled in OMUnable to cancel an order line from exchange order. Getting error "Return charges cannot be saved against sale order lines. Return charges can be saved against a return order line, while non-return charges can be saved against sale lines"BOPIS order was shorted by the store, but it is still not canceledBackordered units are not getting canceled although "Cancel Backordered Units" is enabled in Order ConfigurationWhen the order cancellation scheduler invokes the CancelUnReleasedQtyHandler, it does not trigger a payment transaction and generates a refund transaction for unreleased quantities that were canceledWhy isn't cancelledOrderSubtotal and cancelledOrderLineSubtotal populated when partial quantity cancellation occurs? Authorization Reversal or Refund is not generated during a partial scheduled cancellationRelated Articles Overview Order cancellation is the act of making an order void. It can happen either due to a customer no longer wanting an originally ordered product or due to a system-generated action. When orders are canceled, the system updates the quantity, item subtotal, item line subtotal, order subtotal, and order total to zero. All discounts, charges and taxes are deleted, resulting in zero. An order, by default, cannot be canceled once its maximum fulfillment status reaches released (3000) status. However, one can enable post release cancellation feature to cancel orders even after they are released. Refer here for more details on post release cancellation. How Order Cancellation Works When an order line is canceled, then the reservation for that line should be canceled and the order line is moved to "Canceled" (9000) status. The isCancelled property is updated to true once the order line gets canceled. The orderline quantity is updated to zero. Each cancellation is mapped to a cancel reason code. The cancel reason codes currently configured in base are: Cancel Reason Codes Store Close Fulfillment System Shorted Order Resumed Cancel Line Confirmation Due Cancel of Unallocated Unit Miscellaneous reason Out of the box seed data should have CreatedBy populated as ‘seeddata-importer'. For example:  To get the base reason codes, follow the steps below: Login as system user Use the API {{url}}/order/api/order/reason/search { "Query": "CreatedBy = 'seeddata-importer' and ReasonTypeId = 'Cancel'" } HttpMethod = POST In the response, "CreatedBy": "seeddata-importer" will have the reason codes defined from base. Note: The API might return 403, make sure the user has the required permission to access the URL Retailers can specify at the cancel/short reason code level if the cancellation is initiated by the system or the customer. Depending on who initiated the cancellation, different mod types will be triggered. This allows retailers to re-evaluate promotion and charges if a customer partially cancels an order but not if part of an order is shorted by the fulfillment system. Types of Cancellation Cancellations can be initiated either by the system or by the customer. Each cancel reason code can be mapped to any of the below cancellation types. This can be configured in the Order Reasons. Cancellation types are captured using the cancellationInitiatedBy property. Type of Cancellation Description Customer Initiated Cancels When the customer initiates the cancellation action. For example, a customer cancels an order from his order account page. System Initiated Cancels When the system initiates the action. For example, cancel the back-order line by job scheduler. Not Applicable When the initiating party is not specified or when the entity does not support differentiating between System initiated or Customer initiated. Ways to Cancel an Order Base provides the capability to cancel order and order line using different ways. Cancel Using Orders UI One can choose to cancel multiple orders at a time selecting the orders one wishes to cancel. Reason code and its description should be provided. Similar action can be performed at line level as well to cancel specific order lines.  Refer UI help to understand how cancelation can be done for order or order line from the Orders UI. Cancel Using Customer Service UI Orders or order lines can be canceled through the Customer Service UI. Refer UI help to understand how cancelation can be done for order or order line from the customer service UI. Cancel via API Updates The following APIs can be used for order and order line cancellation. API Description POST /api/order/order/cancel To cancel multiple orders POST /api/order/order/orderId/{orderId}/cancel To cancel a single order by order ID POST /api/order/order/orderId/{orderId}/orderLine/cancel To cancel a single or multiple order lines by order ID POST /api/order/order/orderLine/cancel To cancel multiple order lines across multiple orders Cancel Using Milestones Automatic cancelation of orders can be configured using milestones. A rule can be added with the event as "Cancel Order" (within a milestone - Confirmed, Allocated, Released, Fulfilled) in the Order Configuration UI. If a milestone is not met within the given time period, the event is fired, and the order is canceled. How to configure Order Milestone for cancelling Non-Confirmed/Non-Allocated/Non-Released Orders using Order Configuration UI Search for 'Order Type' in the application menu. In the Order Types UI, identify the order type for which you want to configure a remorse period. Find the Order Config for that order type. Search for 'Order Configuration' in the application menu. Open the Order Config from the previous step. Open the Order Monitoring tab and go to the Confirmed milestone. Add expected time rule for Confirmed milestone. Specify the duration in hours (for example, 0.5 hours is 30 minutes). Select the dependent milestone as Created (or another value from the list based on requirements). Skip the Restrict by Date check box, and then click OK. In the same Confirmed milestone section, add a monitoring rule. Add rule name, and specify the duration in hours. Select event "Cancel Order" from the drop-down. Note: Configure expected time rule for Allocated and Released milestone respectively for cancelling Non-Allocated or Non-Released order / order-line using OnAllocationDue and OnReleaseDue monitoring rules. How to Cancel Back Ordered Units Backordered units immediately after allocation or batch allocation or reallocation will be cancelled by reducing the ordered quantity (ordered quantity = ordered quantity – backordered quantity). If the ordered quantity becomes zero (0), the order line will be cancelled. This configuration works only for Doc Type "RetailOrder". Navigate to Order Configuration UI for a given order type > General Tab > Allocation > Cancel Backordered Units How to Cancel Back Ordered Units with a Scheduled Job The OnAllocationDue milestone can be used to cancel units which have been back ordered by allocation (which were never released). For orders which have been allocated and released and then are shorted, the OnAllocationDue milestone has already been met. Once a milestone has been met, it is never reevaluated. If you load the order and look at the milestone, it will have an allocation milestone which will have a date - that is how you know it's already met. You cannot use milestones to cancel these units - instead you can use an agent which loads all orders with min status = back ordered and send it to the cancel service. Note: If VAS charges are applied on the line which is back ordered, then Mod Type for VAS Charges should be more than Released. Here is a sample agent: {"name": "BackOrderSchedulerQuery12","cronSchedule": "0 0 * 1/1 * ? *", "query": "MinFulfillmentStatusId =\"1500\" AND CreatedTimestamp <= currentTime(-1h)","handlerName": "CancelUnReleasedQtyHandler","entity": "orderLine","queryType": "Rest","MessageTypeMode": "DEDICATED_MESSAGE_TYPE" }} This CancelUnReleasedQtyHandler service cancels all back ordered and allocated quantities. This service cannot be modified, it will apply the reason code "CancelLine" on the cancel order line. Changing the query to include maxFulfillmentStatus = 1500 would not prevent the allocated quantities from getting canceled, since the query on the agent only filters for orders to enter the service. Once the orders enter the CancelUnReleasedQtyHandler service, any quantity less than released will be canceled. If you have allocated quantities which you do not want to be canceled, you will need to do a modification. To achieve this behavior, you will need a custom component which can calculate how much quantity to cancel, then send a cancellation request to the below API with the quantity to be canceled. The system will cancel back ordered units before allocating the units. If your requirement is real time cancellation, then every time a back order entity is created, listen to the event and send a cancellation request with the quantity to be canceled. If your requirement is scheduled cancellation, then configure an agent which selects the eligible orders and invokes a custom service, then have the custom service calculate the eligible quantity to cancel, and have the custom service call the below API to cancel the units. One limited workaround is to change the modification rules to restrict Allocated status from the "Decrease Quantity" mod type. This way, units which are already allocated will not be canceled by the scheduler. However, this will also prevent cancellation of allocated lines from other sources such as through the call center UI or order updates. The creation of a handler to cancel only backordered quantities and not allocated quantities is currently not supported. Canceling aged back ordered orders for specific order types If we have the query as "MinFulfillmentStatusId='1000' and Order.OrderType.OrderTypeId='Ecom Order' and CreatedTimestamp<=currentTime(-24h)", and in the agent the attribute is "queryType": "Rest", then the query works both with time and order type. Note: The above query format has been changed to include single quotes around the values instead of the escaped double quotes which were used earlier(\"). Retaining Selling Attributes on Canceled Order/Lines The system will retain charge and tax details for canceled orders and order lines. Upon cancelation of an order or order line, the charge and tax details will be copied to the specified entities on the order as a record and will also be published. This process occurs only when the status of the order or order line status is updated to 'Canceled' (9000). The following entities will be used to store charge/tax details in order: CancelledOrderChargeDetail CancelledOrderTaxDetail CancelledOrderLineChargeDetail CancelledOrderLineTaxDetail Note: Cancelled taxes and charges are tracked on the event of complete line or order cancellation, respectively. If an order line quantity is decreased, but not fully canceled, the line level totals reduced prior to the line cancellation are not tracked, as all of the units on the corresponding line have not been cancelled. Similarly, if an order containing multiple lines has one line canceled, the order level totals reduced as a result of the line cancellation are not tracked, as all of the units on the order have not been canceled. Implementation Flavors On Short Reason Codes - Backorder instead of Cancel Some retailers have a requirement after a short from downstream fulfillment systems to hold the order in order management so that a user can manually review the order, select a fulfillment facility and manually allocate the order line again. This is needed so  that the order line does not cancel immediately. To achieve this, the following condition may be added to the extension handler: OrderLineShortExtensionHandler{{url}}/order/api/ServiceDefinition/extensionHandler/save { "ExtensionHandlerId": "OrderLineShortExtensionHandler", "ProfileId": "base", "ExtensionhandlerRoute": [ { "ExtensionhandlerRouteId": "OrderLineShortExtensionHandlerRouteId", "Source": "ON_EVENT", "Destination": "cancelOrderLineShortEvent", "IsSync": "true" } ], "RegisteredExtensionPoints": [ { "ExtensionPointId": "Order:OrderLine:Event:OnShort", "EntryCondition": "CancelReason.ReasonId != ‘3000.000'" } ] } This will allow orders which are shorted with reason code = 1000.000 to go to "Cancelled" status and orders shorted with reason code = 2000.000 to go to "Backordered" status (as it is passed in the entry condition). Short with reason code 1000.000 - "Reallocate on Short = False" - Result: Cancelled Short with reason code 2000.000 - "Reallocate on Short = False" - Result: Backordered Note: OrderLineShortExtensionHandler is invoked only for reason codes where re-allocate on short = false, it will not get invoked for reasons with re-allocate on short = true. Canceling Return Orders Currently, no base job is available to cancel return orders automatically. It is however possible to create a return order cancellation scheduler with custom effort. Both the job and the query will need to be created and tailored to the project needs. One business scenario being, cancel all pending return order that have been pending for more than X days. Modification rules on order configuration for return lines will also need to be reviewed with the enhanced cancellation capabilities. Canceling STS Orders STS Orders which have merge legs fulfilled, but delivery legs not created due to payment in awaiting status cannot be canceled. Because the delivery legs are in open status, releases do not get created. Such STS orders can be canceled with the below suggested way : Step1 : At Order Line: Reduce the quantity from 1 to 0 in QuantityDetail for statusId:3000 and Add QuantityDetail with status 1500 and quantity as 1. Step2: Update Order with IsCancelled at Order level. Note: This might leave the reservation and the allocationDetail in order as is. Troubleshooting Orders are not getting canceled post released status Check if the post release cancellation feature is enabled. Work around : For the quantity detail "StatusId": "3000", change the qty to 0 and add new quantity details for "StatusId": "1500" or "1000" with qty 1. Then use the UI to cancel the eligible line quantity. Manhattan Active® Omni does not keep the charges once the order is canceled When the line or the order is canceled, then all the charges and discounts are deleted. The order was canceled successfully in the fulfillment system but not reflected as canceled in OM Check for any failed messages Check the fulfillment queue to see if any messages are stuck Check if the cancel reason code in the fulfillment system is the same as the corresponding reason code in OM Work around is to short the order through order event json (Short) Unable to cancel an order line from exchange order. Getting error "Return charges cannot be saved against sale order lines. Return charges can be saved against a return order line, while non-return charges can be saved against sale lines" Cancel the charges because you cannot have a charge on a return order. BOPIS order was shorted by the store, but it is still not canceled Check if the short reason code used has the flag ‘ReAllocate on Short’ as true. Flip it to false for the BOPIS order to get canceled. Backordered units are not getting canceled although "Cancel Backordered Units" is enabled in Order Configuration The above config will handle only RetailOrders where DocTypeId = RetailOrder When the order cancellation scheduler invokes the CancelUnReleasedQtyHandler, it does not trigger a payment transaction and generates a refund transaction for unreleased quantities that were canceled This is as designed and due to partial cancellation by scheduler. The required refund transaction will be created once the order is fulfilled. It works fine if unreleased quantities are manually canceled from orders UI. Why isn't cancelledOrderSubtotal and cancelledOrderLineSubtotal populated when partial quantity cancellation occurs? These fields are only populated on complete line or order cancellation. For instance, if you order 3 units and cancel 1, these fields will remain null. If you cancel all 3 units, then these fields will be populated with the respective values. The intention of these fields is for customer emails, if a retailer wants to print the value of a line or order which has been cancelled. Authorization Reversal or Refund is not generated during a partial scheduled cancellation When a partial cancellation of an order takes place, either unit level or line level, the order total is typically reduced and the customer is considered to be owed money back in the form of an authorization reversal or a refund, depending on the status of the order, configured behavior of the payment method, etc. This payment process is driven by a payment request generated when the order total is reduced. If this partial cancellation is done using a scheduled job or other backend cancellation API, the payment request is generated in "SaveOnly" mode, meaning no payment transaction processing is done at that time. This varies from cancellations initiated from customer service UI's and self-service UI, Customer service UIs: Customer service UIs have logic to explicitly send a payment request in "CalculateAndExecute" mode, as these cancellations are typically assumed to be customer initiated, and require immediate processing of the refund or authorization reversal. Self-service UI: When a partial cancellation is initiated from the self-service UI, a payment request is generated in 'CalculateAndExecute' mode, triggering immediate processing of the refund or authorization reversal. If the schedule-based cancellation payment behavior needs to mirror the UI cancellation payment behavior, an additional custom service can be added to the cancellation agent to send a payment request in "CalculateAndExecute" mode to the save payment request queue after the ordered unit(s) or line(s) are canceled. Related Articles Order ArchivingMod TypesOrder Orchestration ProcessHoldsCart and Preview ModeShipping RestrictionOrder Orchestration ConfigurationCreating and Updating OrderOrder TaggingDelivery TrackingPublishing Order Order Audit