# Refunds

**Permalink:** refunds
**Path:** Manhattan Active® Omni/Order Management/Process & Configuration Guides/Order Selling/Payment/Refunds
**Content Length:** 78,220 characters
**Scraped:** 2025-08-09T21:58:45.098114

---

Home ››Manhattan Active® Omni››Order Management››Process & Configuration Guides››Order Selling››Payment ››Refunds Refunds Previous I Next Refund transactions move funds from the payee's account into the payer's account. For example, when a customer returns an item to a retailer, a refund transaction transfers money from the retailer to the customer. This section explains follow-on refunds, standalone refunds, refund policies, return credit, and issuing new gift cards. Follow-On Vs. Standalone RefundsFollow-On RefundsStandalone RefundsConfiguring Follow-On Vs. Standalone BehaviorConsolidate Refund TransactionsRefund Behavior For EdgeRefund SequenceRefund ExpiryRefund RetryRefund by Link ReminderConfigurationsRefund or Reverse AuthorizationReturn & Refund PoliciesAged Refund PolicyStandalone Return PolicyGift Returns PolicyReturn CreditRefund to New Gift CardConfiguring Gift Card RefundsRefund FailureRefunds against In Progress TransactionsReturn & Refund APIsExpected Refund APIRefund APIImplementation FlavorHow to create a virtual gift card line externally without a valid item price configured for the eGC SKUHow to configure the payment component to settle a refund for split payment tender (Credit card + Gift card) at the distribution center instead of carrier scanHow to refund to a new gift card after exhausting all refund retry attemptsTroubleshootingVirtual gift cards are not created after the base config "ConsolidateRefundTransactions" is enabled in payment parametersHow to know what payment method is going to be used for refund?If the parent order is overpaid, the refund during return is being processed to a credit card, even though the original payment was made using a non-credit card prepaid method.Related Articles Follow-On Vs. Standalone Refunds Follow-On Refunds Refunds can be performed as standalone or follow-on transactions. If a refund is performed against a settlement, then it is referred to as a follow-on refund. For a follow-on refund to be processed, the unique keys from the initial settlement must be included in the settlement transaction, so that the gateway can reference the settlement. Follow-on refunds are performed against the settlement if the refund is created within X days of the settlement date, where X is the settlement expiry days configured in the payment configuration. For example, if a customer returns an item 48 days after initial purchase, and the payment configuration indicates that settlement expires after 60 days, then a follow-on refund is performed. Standalone Refunds If a refund is performed without a settlement, then it is a standalone refund. Standalone refunds are performed in multiple scenarios, including when a refund is processed after the settlement has expired or when a new payment type is used for refund (for example, store credit or a new gift card). If the refund is performed more than X days after the settlement date, where X is the settlement expiry days, then a standalone refund is performed. Standalone refunds are not initiated against an existing settlement and include the complete payment method information in the refund request. For example, if a customer returns an item 72 days after initial purchase, and the payment configuration indicates that settlement expires after 60 days, then a standalone refund is performed. Standalone refunds can also be issued when a new payment method is used to refund a customer. For example, a customer purchased a $50 order and paid using credit card, but when she returns the item at POS, she is refunded $50 via store credit. In this scenario, POS can save a new store credit payment method with a $50 refund payment transaction. Standalone refunds can be identified by the isStandaloneRefund attribute in the payment transaction attributes child table. Configuring Follow-On Vs. Standalone Behavior When the Refund API is used to process refunds, the payment component reads the refund behavior for each payment type to determine what action to take. The configuration indicates whether a follow-on refund is created against the original payment method, or a new payment method is issued. For example, refund behavior is defined as 'Follow-on refund' for credit card. When the Refund API initiates a refund against a credit card payment method, then the credit card payment method and settlement transaction are copied from the parent order to the return order, and a follow-on refund is immediately executed. When a refund is issued in POS to a payment type that supports follow-on refunds, then there is no manual step involved in the UI; the payment component directly calls the payment gateway to process the refund. Refund behavior should be configured as 'New payment method' for any payment types which require manual intervention or do not support follow-on refunds. For example, cash and paper checks do not support follow-on refunds, and payment processors typically do not support follow on refunds for debit payments. For these payment types, a new payment method such as gift card or store credit must be used for refunds. For example, when a refund is issued in POS to a payment type that requires a new refund payment method, then there is an additional manual step such as handling the cash drawer or updating the till. A refund behavior should be configured for each payment type. Refund Behaviour configurations are applicable only for return credit and not for any other refund scenarios like applying appeasement, cancellation or any changes to the original order resulting in a refund. Consolidate Refund Transactions The refund behavior for a particular payment type can be configured as "New payment method" in the event of a standalone refund or when refunding against a parent order. Because of this, the possibility exists that multiple refund transactions can be created on the same refund payment method when the original order was paid for by multiple payment tenders. Consider a parent order paid for by two payment methods, and as a result will have two settlement transactions. When the new refund payment method is generated before being sent to the gateway, these settlements are referenced to determine the amount to be refunded. Because multiple parent transactions are referenced, multiple refund transactions can be created. The business flag "Consolidate Refund Transactions" is configurable in the Payment Parameters UI. If enabled, any refunds created under the behavior of "New payment method" will consolidate all refunds into a single transaction on the new refund payment method, irrespective of how many settlements are present on the parent order. This is applicable only for "New payment method" refund behavior and not for follow-on refund behavior. Refund Behavior For Edge Indicates the refund behavior for a payment completed in edge mode in POS. For example, payment methods such as credit card would be refunded using new payment method as system cannot execute follow on refund as the unique transaction Id from the gateway is not available on parent order payment method which has capturedInEdgeMode set to true. Options under this are same as the Refund Behavior options. Refund Sequence If multiple payment methods exist and a refund is required, then a payment method is selected using the following logic: Select payment methods which have a negative Amount, since these payment methods are intended only for refunds. After all payment methods with negative Amount values have been refunded, then select payment methods with positive Amounts. Sort payment methods using refund sequence ascending. Consider payment methods which have Refund Behavior = Follow-on refund (or null), since these payment methods can be automatically processed by the Payment component and do not require external user interaction. After these payment methods have been refunded, then select payment methods with Refund Behavior = New payment method. If multiple settlements exist within a payment method, then settlement expiry date is used to select a transaction. The system uses the settlement expiry date to sort the settlement transactions to be used to refund against. For example, if an order has two payment methods, each with two settlements: Payment method 1: refundSequence = 2 Payment method 2: refundSequence = 1 Settlement 1, transaction expiry date January 1, 2018 Settlement 3, transaction expiry date January 1, 2018 Settlement 2, transaction expiry date January 15, 2018 Settlement 4, transaction expiry date January 15, 2018 When a refund is initiated on January 14, 2018, then a follow-on refund is performed against settlement #4. If there is a remaining amount to refund, then a standalone refund is performed against payment method #3. If there is a remaining amount to refund, then a follow-on refund is performed against settlement #2. If there is a remaining amount to refund, then a standalone refund is performed against payment method #1. Refund sequence is also honored for authorization reversals, if multiple payment methods exist. Refund Expiry Transaction expiry date for refund transactions is currently not used. Refund Retry Payment auto-retry and refund by link recovery features can be enabled to help reduce the need to manually capture the new payment method from end customers in case of refund failure. For example, the user returns an item and the refund is initiated to the existing payment method present on the parent order (For example, credit card). The payment attempts to refund, and the payment fails due to the payment gateway unavailability or card is expired. Manhattan Active® Omni Order Management retries payment (refund) as many times (remainingAttempts) as specified in the configuration. If a retry for a refund is unsuccessful within the configured number of attempts, then a refundbylink email/text outbound message is sent to get a new payment method from the customer to process the refund. Process flow: Note: If a retry refund on the customer order is unsuccessful, a new payment method will be collected from the end customer through a refund link. Subsequent refunds on the customer order will be processed against the newly collected payment method. If a retry refund on the return order is unsuccessful, the copied settlement transaction will be marked as 'ValidForRefund=false,' and a new payment method will be collected from the end customer through a refund link. The refund will then be processed against the newly collected payment method. If another return is created against the same customer order, the system will not retry for a refund or not refund through a gift card. Instead, a refund link will be generated to collect a new payment method, and the refund will be processed to the customer. If 'Number of Attempts' is configured as 0, the system will not retry the refund by creating a new refund transaction, and 'Refund by Link' will not be enabled in the Call Center UI. To enable 'Refund by Link' in the Call Center UI when the original refund transaction fails, the 'Number of Attempts' should be configured as 1, and the number of retries should be customized by setting 'RemainingAttempts' to 0 in the original refund transaction. This overrides the base 'Number of Attempts' configuration, ensuring that the refund is not retried, and 'Refund by Link' is generated. When a refund retry transaction is created, the 'ReasonId' attribute is updated with the value 'AutoRetry' to differentiate between regular refund and retry refund transactions, which can be used in scheduler queries to filter, schedule, and process the transactions separately. The 'ReasonId' attribute gets updated to 'RetryRefundSucceeded' when the retry refund transaction is successful and to 'RetryRefundFailed' when the retry refund transaction is unsuccessful. Refund by Link Reminder In the event that the system has not received a payment method from the customer within the configured number of hours, the system sends the customer a recovery reminder email or text. For example: The reminder threshold (PayByLink Reminder Threshold) is configured as 2 hours. If the RefundByLink was sent to the customer at 1:00 p.m. and the customer delays adding payment, the RefundByLink reminder notification via email/text will be sent to the customer by 3:00 p.m. Configurations Refer to Enabling Auto-Retries and Refund Failure RefundbyLink configurations for Refund Retry, RefundByLink and RefundByLink reminder email/text. Refer here to configure the reminder threshold value in hours Refund or Reverse Authorization The 'Refund or Reverse Authorization' attribute indicates whether to refund funds which are already settled or reverse remaining authorized amounts, when the amount due decreases for an order. This attribute is used by the calculate payment service in the event that the funds collected exceed the amount due. More specifically, if, in the payment summary, (credit amount + authorized amount + requested auth amount + requested settle amount - requested refund amount) - (debit amount + book amount) is greater than zero, the payment component needs to reduce the amount currently held on the customer's payment method. Configure this setting on the Payment Parameters UI. If set to true, then when both the credit amount and authorized amount are greater than zero and the book or debit amount decreases, then the credit amount is refunded before reducing the authorized amount. For example, a $100 order is placed and a $100 credit card authorization is processed. $40 worth of items ship and a $40 settlement is processed. If the customer returns the $40 worth of goods before the remaining $60 worth of items ship, then the $40 is refunded to the customer. If set to false, then when both the credit amount and authorized amount are greater than zero and the book or debit amount decreases, then the authorizations are reversed before refunding any existing credit amount. For example, a $100 order is placed and a $100 credit card authorization is processed. $40 worth of items ship and a $40 settlement is processed. If the customer returns the $40 worth of goods before the remaining $60 worth of items ship, then the $40 is reversed from the remaining authorized amount. The result is a $40 settlement and a $20 authorization for the $60 worth of items which have yet to ship. Return & Refund Policies The payment parameters configuration contains a few attributes which enable retailers to configure refund policies for aged returns, gift returns, and standalone returns. These configurations are used in the Expected Refund API, which is used by order capture systems to determine how a customer's refund can be processed for a given order. To configure this setting, navigate to the Payment Parameters UI. Aged Refund Policy The system calculates 'Refund Age' of a settlement transaction in order to determine whether a refund is aged, and if so, it uses the 'aged refund payment type' configured. For example, some retailers want to refund to gift card for any refund after 120 days. To calculate refund age using the payment transaction transactionDate, which is calculated by the third party payment gateway, set useTranDateForRefundAge = true. To calculate refund age using the payment transaction createdTimestamp, set useTranDateForRefundAge = false. However, this presents a problem for return orders, wherein the original settlement is copied, but the entity created date "resets" the refund age clock. We recommend setting this parameter to true. For refunds which are processed more than X days after the original settlement occurred, where X is configured as the Refund Age attribute, the Expected Refund API recommends that the refund be issued via the payment type configured as the Aged Return Payment Type. For example, if a retailer wants to refund to gift card for all refunds which are processed 120 days after the original settlement, then Refund Age should be set to 120, and the Aged Return Payment Type should be set to Gift Card. Standalone Return Policy For refunds processed against standalone returns, for which no parent order is retrieved, the Expected Refund API recommends that the refund be issued via the payment type configured as the Standalone Return Payment Type. For instance, if a customer returns an item at the POS and no parent order is found, the retailer may define that the customer is refunded via new gift card. For a stand alone refund to a payment method which requires a $0 authorization for a refund transaction to be successful, for example, a creditcard base does not support creation of the  $0 authorization out of the box. For such requirements, please check with the third party payment processor if they support creation of the $0 authorization internally as part of the tokani-zation call. Gift Returns Policy For refunds processed against gift returns, a refund payment method can be configured. For example, always refund gift returns using a new gift card. The Expected Refund API recommends that the refund be issued via the payment type configured as the Gift Recipient Payment Type. Gift returns are identified by an order with Refund Recipient = Gift Recipient. Return Credit A return credit transaction is used to transfer funds from a parent order to a return order. A return credit transaction is created as a follow-on transaction against a settlement, when a portion of that settlement is copied to the return order to be used as return credit. A return credit transaction is never sent to a third-party payment gateway and only signifies the movement of funds between orders. For example, if a parent order has a $100 settlement transaction, and a $40 return is completed against this parent order, then a $40 settlement is copied from the parent order to the return order, and a $40 return credit transaction is created against the parent settlement to denote the transfer of funds. This ensures that a CSR cannot apply a $100 appeasement on the parent order. Refund to New Gift Card Refunds are issued to new gift cards in multiple scenario: If the original payment method was a gift card: After customers make purchases using a gift card, they generally discard the gift card. Therefore, when a refund is processed for the customer, the funds should not be put back on the original gift card. Retailers issue a new gift card instead of refunding the original gift card. If the original payment method is eligible for refund and the first refund fails: New gift cards are generated as a refund. For example, if a customer purchases an item using a credit card, traveler's check, or any other payment method, then the customer returns the item by shipping it to the return center. If the first refund transaction to the original payment method fails, the return order will generate a gift card as a refund. If the original payment method is not eligible for refund : If the original payment method follow on refund fails or if the original payment settlement transaction is expired and payment gateway does not support follow on refund, a new gift card will be issued based on the eligible payment refund type configuration. If a customer purchases and saves the sale item in store using cash, traveler's check, or paper check, and then the customer returns the item by shipping it to the return center, then a new gift card is generally issued as a refund. To refund via new gift card for these scenarios, each payment type has eligible refund payment types configured. If the eligible refund payment type is 'Gift Card', then a gift card is issued. In customer present scenarios, the payment transaction processing mode is set to 'External Processing', which tells the payment component not to create a gift card order line, since the gift card will be handed to the customer in store. If the original order is a gift: New gift cards are also issued as a refund tender when a gift recipients return items. For example, if a customer purchases an item as a gift and pays using credit card, then if the gift recipient returns the item, the refund should be issued to the gift recipient via a new gift card, instead of putting the funds back on the customer's credit card. To refund via new gift card for these scenarios, the order RefundRecipient attribute must be set to Gift Recipient. Two options can be used to populate this field: A returns UI can capture a user-input which specifies whether to refund to the Customer via original payment method, or to the Gift Recipient via new gift card If no UI can capture this input, then the order component auto-calculates refund recipient as Gift Recipient if all return lines are gifts, or Customer if not all return lines are gifts. In Customer service scenario (or "customer not present"), the payment transaction processing mode is set to 'Normal Processing'. This tells the Payment component to create a corresponding order line for the gift card item, which is used to ship or email the gift card to the customer. This gift card order line is fulfilled like a typical item, and the corresponding refund payment transaction is updated upon fulfillment. The gift card item can be issued digitally, with delivery method 'Email', or physically, with delivery method 'ShipToAddress', based on whether the item is configured as digital goods in the Item component. When a refund is configured to happen to a new Gift card line, Order will create a new GiftCard line with the ItemId being picked from OrderParameters → giftCardRefundItemId. During creation of the line, it calls Item component to fetch Item information. Since Item is profile based master entity, make sure Item exist in the profile. If it does not exist, then the Item component will throw 404 Not Found, and Gift card line creation will fail. Note: If the behavior to always refund to a new gift card is not desired in all cases - for example, some customers want a refund to their original payment method even if the item was marked as a gift - then implement a user exit as required. For instance, if the requirement is to refund to the original payment method for returns, implement a user exit for mod type – quantity increase for status 18000, and use custom logic to set the refund recipient to customer or gift recipient. This takes care of CSR returns, self-service returns, and automated returns received at the DC. Note: When a gift card item is being used for a refund and its 'IsGiftCard' attribute is set to false, the refund line will not be released, and the following error will be thrown in the logs.  Error: The Gift card item being used for refund is not configured as a gift card. Note: Shipment Invoice for an electronic gift card is not connected to payment transactions or return invoices by any visible field. To reduce the number of gift card generated per order, the gift card will only be added after a short/cancel when the order is fully shorted (and canceled) or if the remaining quantities have been shipped. This allows the system to issue only one gift card even if multiple items are shorted/canceled at different times. Note: If a retailer does not want to create a gift card order line, but instead wants to integrate with a third party gift card system to issue the refund immediately. Implement the UE 'Payment:Payment:UserExit:CreateGiftCardLine'. In this case, no gift card  line will be created, but a refund transaction will be created by base. Later, the transaction should be marked as success from Manage Payment Transaction UI or send an update to the payment transaction as closed/success. Configuring Gift Card Refunds To refund via new gift card, it's mandatory to configure a gift card item. When a refund is generated via a new gift card order line, the item id is set to the item configured as the Gift Card Refund Item, so this attribute in the Order Parameters should be configured to include the correct gift card item. The gift card refund can be fulfilled digitally in the case of e-gift card. When the item configured has digitalGoods = true in the Item component selling attributes, then the order line is created with the delivery method 'Email' and no ship to address is saved on the line. The email address on the order header can be used for fulfilling the e-gift card. If a line-level email address is required, then an extended field can be added for this purpose. When the item configured has digitalGoods = false, then the item is fulfilled via physical shipment just like any other item. The order line is created with the delivery method 'ShipToAddress' and a shipping address is copied from one of the order lines associated with the invoice. If no shipping address is available (for example, original lines were pick up in store), then the line is put on hold. A Gift Card Shipping Method is configured to define the shipping method which should be used for gift card order lines. Configure the Gift Card Refund Item and Gift Card Shipping Method on the Order Parameters UI. Gift Card Split Limit Indicates the maximum amount which will be issued to a new gift card, when a customer is not present. If the amount to be issued exceeds this limit, then multiple gift cards are issued. This attribute is not read for customer present situations such as POS. For example, if a $1000 refund is required and this split limit is set to $400, then 3 gift card payment methods and 3 corresponding order lines are created to issue the refund: one gift card for $400, another for $400, and a third for $200. Enable the Gift Card Split Limit functionality in the Payment Parameters UI using the 'Gift Card Split Limit' attribute. Refund Failure While it is rare, refund failure can occur in the event that funds cannot be put back into a customer's account. If a customer is present, then the store associate or customer care representative can refund using an alternative tender. If a customer is not present, then the customer care representative works the order and determines the required action. When a refund transaction is updated with response status failure, the following updates are made: Refund payment transaction processed amount is updated to zero. The payment summary requested refund amount is reduced based on the failed amount. The parent settlement transaction follow-on processed amount is reduced by the failed refund amount. The parent settlement transaction isValidForRefund flag is set to false, to ensure that this settlement cannot be picked for refund in the future. Refund failures must be reported on and resolved outside of Active® Omni. There is currently no way to resolve a refund failure within the system. Refunds against In Progress Transactions Refunds cannot be created against In Progress transactions; A refund can be generated only after the In Progress transaction has been marked as a success. For example, a $100 order with a $100 In Progress settlement has a $20 appeasement applied. No refund is created, since the settlement is In Progress. If the settlement comes back as a success, then a $20 refund is created the next time the payment scheduler runs. If the settlement comes back as a failure, then the customer must provide a new payment method to settle the $80 order total. Return & Refund APIs When an item is returned, there are business rules to determine how the customer can be refunded. For example, for aging returns older than 120 days, a retailer may only offer gift cards. For orders paid in cash which are returned via contact center, a retailer may refund to gift card. For an order paid in credit card and returned in store, a retailer may refund to the original credit card but also offer additional options for a manager to override and refund to gift card, store credit, or other payment methods. Business rules can be configured: By capture channel; for example: if a customer is present, then cash is an eligible refund payment method, but if a customer is not present, then cash is not eligible. By original payment type; for example: if an order was paid in gift card, then it should be refunded in gift card. If an order was paid in check and a customer is present, then it should be refunded in cash. Based on refund amount; for example: if an order was paid in $500 cash, then up to $200 can be refunded in cash, and the remaining $300 will be refunded via gift card. The refund APIs take an input return order id, read these refund business rules, and output a list of recommended and possible refund payment methods. Two APIs are used in this flow: Expected Refund API: Used to determine the expected refund payment methods/amounts for a given return order, if the default refund rules are followed. This API can be used during returns creation to display to the user/customer what their expected refund amount and payment methods would be before confirming the return order. Refund API: Used to initiate the refund processing. This API is currently used by the Point of Sale (POS) to tell the system how the customer/user wants to refund and to initiate refund processing. The Expected Refund API is used during returns creation in Contact Center, Point of Sale, and Digital Self-Service to determine how to refund the customer. However, this configuration/logic has not been adopted for non-returns flows which involve a refund, such as cancellation of pre-paid orders. For refunds which do not involve returns, refunds typically go to the original payment method. Note: If an order is created with cash tender and moved to the fulfilled status, and a return is initiated through an external system and the amount is refunded against prepaid tender (merchandise card). In this case, the return order import payload should include both the parent order and the new refund payment methods along with payment transaction details for the refund to be successful. Expected Refund API The Expected Refund API can be used to determine what the expected refund is for a given return order, if the default refund rules are followed. This API can be called with two modes: Automatic or Override. Automatic Mode: The system uses the highest ranked payment methods and rules configured in the payment capture config tables to determine how to refund. There is no manual intervention for this mode. This mode is used by the payment component to refund in customer not present scenarios (for example, return to DC). For regular returns against a parent line, the proposed refund payment type is the default refund payment type from the customer present column of the payment capture config refund payment type table. For example, an order paid in check will be refunded in cash. For aged refunds, output an expected refund payment type based on paymentParameters.AgedRefundPaymentType For standalone returns, output an expected refund payment type based on paymentParameters.StandaloneReturnPaymentType For gift returns, output an expected refund payment type based on paymentParameters.GiftRecipientRefundType Override Mode: The system provides a list of all possible refund payment types, and a user can choose how to refund. This mode is used by POS to allow a user to select from a list of possible refund payment methods, instead of letting the system decide. To illustrate how these APIs are used, here is the flow of a return at the POS. When the payment UI is loaded for a return of a $100 order paid in cash, it displays suggested refund payment types ($100 cash) per the original payment types by calling the Expected Refund API with mode = Automatic. The UI also gives an option for the user to Override and select their own payment method. If the user selects ‘Override’, then a list of possible refund payment types and amounts are returned based on the payment capture config refund payment type values for customer present mode. In this example, the UI would then show additional options of $100 cash, $100 gift card, and $100 store credit. The below diagram illustrates the logic within the API: Examples of Expected Refund API Expected Refund API ExamplesExamples with Refund Option = Automatic and Original Order Paid in a Single Payment Method In the below examples, an original order for $70 was paid with the Original Payment Data in the column below. The order was returned in full for -$70, and the refund option selected results in payment data in the End State Payment Data column below. Scenario Original Payment Data Response from Refund API with Refund Option = Automatic End State Payment Data, After POS Updates 1 Refund back to original payment method, follow-on refund completed by payment *Behavior is the same for any refund payment method where refund behavior is configured as 'Follow-on refund', e.g. PayPal, E-check Order #1: $70 Payment Method #1: Visa Credit Card Settlement Transaction: $70, Closed Order #2: -$70 Payment Method #2: Visa Credit Card Settlement Transaction (copied): $70, Closed Refund Transaction: $70, Closed Parent Payment Method = Payment Method #1, $70 (No updates by POS) Order #1: $70 Payment Method #1: Visa Settlement Transaction: $70, Closed Return Credit Transaction: $70, Closed Order #2: -$70 Payment Method #2: Visa Settlement Transaction (copied): $70, Closed Refund Transaction: $70, Closed Parent Payment Method = Payment Method #1, $70 2 Refund back to original payment method, standalone refund required in POS *Behavior is the same for any refund payment method where refund behavior is configured as 'New payment method', e.g. Debit, Gift Card Order #1: $70 Payment Method #1: Cash Settlement Transaction: $70, Closed Order #2: -$70 Payment Method #2: Cash Refund Transaction: -$70, Open Parent Payment Method = Payment Method #1, $70 Order #1: $70 Payment Method #1: Cash Settlement Transaction: $70, Closed Return Credit Transaction: $70, Closed Order #2: -$70 Payment Method #2: Cash Refund Transaction: -$70, Closed Parent Payment Method = Payment Method #1, $70 3 Refund to new payment method *Behavior is the same for any refund payment method where the refund payment method differs from the original payment method, e.g. Traveler's Check, Store Credit Order #1: $70 Payment Method #1: Check Settlement Transaction: $70, Closed Order #2: -$70 Payment Method #2: Cash Refund Transaction: -$70, Open Parent Payment Method = Payment Method #1, $70 Order #1: $70 Payment Method #1: Check Settlement Transaction: $70, Closed Return Credit Transaction: $70, Closed Order #2: -$70 Payment Method #2: Cash Refund Transaction: -$70, Closed Parent Payment Method = Payment Method #1, $70 Examples with Refund Option = Automatic and Original Order Paid in a Multiple Payment Methods In the below examples with multiple payment methods, an original order for $100 was paid with the Original Payment Data in the column below. The order was returned for -$70, and the refund option selected results in payment data in the End State Payment Data column below. Refund Option Original Payment Data Response from Refund API with Refund Option = Automatic End State Payment Data, After POS Updates 1 Refund back to multiple original payment methods Assume refund sequence chooses Visa before Mastercard Order #1: $100 Payment Method #1: Visa Settlement Transaction: $40, Closed Payment Method #2: MasterCard Settlement Transaction: $60, Closed Order #2: -$70 Payment Method #3: Visa Settlement Transaction (copied): $40, Closed Refund Transaction: $40, Closed Parent Payment Method = Payment Method #1, $40 Payment Method #4: MasterCard Settlement Transaction (copied): $30, Closed Refund Transaction: $30, Closed Parent Payment Method = Payment Method #2, $30 (No updates by POS) Order #1: $100 Payment Method #1: Visa Settlement Transaction: $40, Closed Return Credit Transaction: $40, Closed Payment Method #2: MasterCard Settlement Transaction: $60, Closed Return Credit Transaction: $30, Closed Order #2: -$70 Payment Method #3: Visa Settlement Transaction (copied): $40, Closed Refund Transaction: $40, Closed Parent Payment Method = Payment Method #1, $40 Payment Method #4: MasterCard Settlement Transaction (copied): $30, Closed Refund Transaction: $30, Closed Parent Payment Method = Payment Method #2, $30 2 Refund back to original payment methods Assume refund sequence chooses Visa before Check Order #1: $70 Payment Method #1: Check Settlement Transaction: $30 Payment Method #2: Visa Settlement Transaction: $40 Order #2: -$70 Payment Method #3: Visa Settlement Transaction (copied): $40, Closed Refund Transaction: $40, Closed Parent Payment Method = Payment Method #1, $40 Payment Method #4: Cash Refund Transaction: $30, Open Parent Payment Method = Payment Method #2, $30 Order #1: $100 Payment Method #1: Visa Settlement Transaction: $40, Closed Return Credit Transaction: $40, Closed Payment Method #2: Check Settlement Transaction: $60, Closed Return Credit Transaction: $30, Closed Order #2: -$70 Payment Method #3: Visa Settlement Transaction (copied): $40, Closed Refund Transaction: $40, Closed Parent Payment Method = Payment Method #1, $40 Payment Method #4: Cash Refund Transaction: $30, Closed Parent Payment Method = Payment Method #2, $30 Note: Refunds for non-return transactions, such as price overrides, appeasements, or order cancellations, are not issued to the new payment method, except when the payment method is a gift card, as determined by the payment type configuration. By default, the new payment method is set to "Gift Card." Refund API The Refund API is a way of telling the system to execute a refund transaction, using the same business logic mentioned above. If the Refund API is called with refund option 'Automatic', then the above logic is followed, and the system selects a refund payment method(s). If 'Override' option is used, then the request should include refund payment transactions. The below diagram illustrates the logic within the Refund API: API Method & Endpoint Method :POST Endpoint URL: url/payment/api/payment/paymentHeader/orderId/{ReturnOrderID}/processRefund?refundOption={Refund Option} &InteractionMode={Interaction Mode} Note: RefundOption and InteractionMode should be part of the end-point URL Refund API Examples Refund API (Automatic) ExamplesExamples with Refund Option = Automatic Example 1: A customer returns items totaling $100 from an orderA which was paid in two payment methods PaymentMethodA, Visa Credit Card, $40, RefundSequence = 1  (assume the refund payment type for credit card is credit card for interactionMode = CustomerPresent) PaymentMethodB, Check, $100, RefundSequence = 2 (assume the refund payment type for check is cash for interactionMode = CustomerPresent) If the Refund API is called with Refund Option = Automatic and Interaction Mode = CustomerPresent, the following is the output: PaymentMethod: PaymentType: Credit Card CardType: Visa Amount: -$40 PaymentTransactions: Refund, $40, Closed ParentPaymentMethodId: PaymentMethodA, $40 PaymentMethod: PaymentType: Cash Amount: -$60 PaymentTransactions: Refund, $60, Open ParentPaymentMethodId: PaymentMethodB, $60 Two return credit transactions are created; one for $40 against PaymentMethodA, and one for $60 against PaymentMethodB. An external system such as POS is expected to send an update to the open cash refund, after they have physically issued cash. Refund API (Override) ExamplesExamples with Refund Option = Override Example 1: Refund to new payment method, where payment transactions have already been executed - Manhattan Active POS Flow Original Order: PaymentMethodA, Visa Credit Card, $120 Return Order: -$100 total If the the retailer wants to refund $100 to a new Gift Card, and the POS system has already issued a new gift card, then the Refund API is called with: Refund Option = Override ExecutionMode = SaveOnly PaymentMethods: PaymentMethodB: PaymentType: Gift Card AccountNumber: 1234 Amount: -$100 PaymentTransactions: Refund, $100, Closed The payment method and refund transaction are saved in the return order payment header. The output of this API is an updated return order payment header: Return Order Payment Header: PaymentMethodB: PaymentType: Gift Card AccountNumber: 1234 Amount: -$100 PaymentTransactions: Refund, $100, Closed PaymentMethodA: IsCopied = true Amount: $100 PaymentTransactions: Settlement: $100 IsCopied = true Parent Order Payment Header: PaymentMethodA: ReturnCredit: $100 Example 2: Refund to new payment method, where no payment transactions are input Original Order: PaymentMethodA, Visa Credit Card, $120 Return Order: -$100 total If the the retailer wants to refund $100 to a new Gift Card, then the Refund API is called with: Refund Option = Override ExecutionMode = Calculate, or CalculateAndExecute PaymentMethods: PaymentMethodB: Payment Method Id PaymentType: Gift Card Amount: -$100 The output of this API is an updated return order payment header with an open refund payment transaction: Return Order Payment Header: PaymentMethodB: PaymentType: Gift Card Amount: -$100 PaymentTransactions: Refund, $100, Open No return credit transactions are created against PaymentMethodA. POS is responsible for issuing a new gift card and closing the refund payment transaction. After POS closes the refund, POS sends a payment header update: Return Order Payment Header: PaymentMethodB: PaymentType: Gift Card Amount: -$100 PaymentTransactions: Refund, $100, Closed Example 3: Refund to original payment methods with user-defined amounts, follow-on refunds Original Order: PaymentMethodA, Visa Credit Card, $120, RefundSequence = 1 PaymentMethodB, MasterCard Credit Card, $100, RefundSequence = 2 Return Order: -$100 total If the automatic refund flow was used, the customer would receive a $100 refund against the Visa. However, if the customer wants to refund $50 against Visa and $50 against MasterCard, then the Refund API is called with: Refund Option = Override ExecutionMode = Calculate, or CalculateAndExecute PaymentMethods: PaymentMethodC: PaymentType: Credit Card CardType: Visa Amount: -$50 ReturnCredit: ParentOrderId: OrderA ParentPaymentMethodId: PaymentMethodA Amount: $50 PaymentMethodD: PaymentType: Credit Card CardType: MasterCard Amount: -$50 ReturnCredit: ParentOrderId: OrderA ParentPaymentMethodId: PaymentMethodB Amount: $50 Then, the Payment component creates and executes refund payment transactions on the return order payment header. Two return credit transactions are created; one for $50 against PaymentMethodA, and one for $50 against PaymentMethodB. The output of this API is the updated return order payment header: Return Order Payment Header: PaymentMethodC: PaymentType: Credit Card CardType: Visa Amount: -$50 PaymentTransactions: Settlement (copied), $50, Closed Refund, $50, Closed ReturnCredit: ParentOrderId: OrderA ParentPaymentMethodId: PaymentMethodA Amount: $50 PaymentMethodD: PaymentType: Credit Card CardType: MasterCard Amount: -$50 PaymentTransactions: Settlement (copied), $50, Closed Refund, $50, Closed ReturnCredit: ParentOrderId: OrderA ParentPaymentMethodId: PaymentMethodB Amount: $50 If we did a GET call to see the parent order payment header, we would see: Parent Order Payment Header: PaymentMethodA: PaymentType: Credit Card CardType: Visa Amount: $120 PaymentTransactions: Settlement, $120, Closed Return Credit, $50, Closed, Return Invoice ID PaymentMethodB: PaymentType: Credit Card CardType: MasterCard Amount: $100 PaymentTransactions: Settlement, $100, Closed Return Credit, $50, Closed, Return Invoice ID Example 4: Refund to original payment methods with user-defined amounts, new payment method refunds Original Order: PaymentMethodA, Visa Credit Card, $120 Return Order: -$100 total If the customer wants to refund $50 in cash but still update the return credit on the parent order, then the Refund API is called with: Refund Option = Override ExecutionMode = Calculate, or CalculateAndExecute PaymentMethods: PaymentMethodB: PaymentType: Cash CardType: Visa Amount: -$100 ReturnCredit: ParentOrderId: OrderA ParentPaymentMethodId: PaymentMethodA Amount: $100 Then, the Payment component creates an open refund payment transaction on the return order payment header and a return credit transaction against the parent settlement. The output of this API is the updated return order payment header: Return Order Payment Header: PaymentMethodB: PaymentType: Cash CardType: Visa Amount: -$100 PaymentTransactions: Refund, $100, Open ReturnCredit: ParentOrderId: OrderA ParentPaymentMethodId: PaymentMethodA Amount: $100 POS is responsible for issuing cash and closing the refund payment transaction. After POS closes the refund, POS sends a payment header update: Return Order Payment Header: PaymentMethodB: PaymentType: Cash Amount: -$100 PaymentTransactions: Refund, $100, Closed If we did a GET call to see the parent order payment header, we would see: Parent Order Payment Header: PaymentMethodA: PaymentType: Credit Card CardType: Visa Amount: $120 PaymentTransactions: Settlement, $120, Closed Return Credit, $100, Closed, Return Invoice ID Example 5: Refund to new payment method; decrement return credit on parent Original OrderA: PaymentMethodA, Visa Credit Card, $120 Original OrderB: PaymentMethodB, Gift Card, $100 Return Order: -$40 against OrderA, -$60 against OrderB If the the retailer wants to refund $100 to a new Gift Card and to specify the amounts to be decremented on the return credit for each parent method, then the Refund API is called with: Refund Option = Override PaymentMethods: PaymentMethodC PaymentType: Gift Card Amount: -$100 PaymentTransactions: Refund, $100, Closed ReturnCredit: ParentOrderId: OrderA ParentPaymentMethodId: PaymentMethodA Amount: $40 ReturnCredit: ParentOrderId: OrderA ParentPaymentMethodId: PaymentMethodB Amount: $60 Then, the Payment component creates an open refund transaction for the gift card payment method and updates the two parent orders by creating return credit payment transactions on each one. The output of this API is the updated return order payment header: Return Order Payment Header: PaymentType: Gift Card Amount: -$100 PaymentTransactions: Refund, $100, Closed ReturnCredit: ParentOrderId: OrderA ParentPaymentMethodId: PaymentMethodA Amount: $40 ReturnCredit: ParentOrderId: OrderA ParentPaymentMethodId: PaymentMethodB Amount: $60 If we did GET calls to see the parent order payment headers, we would see: Parent OrderA Payment Header: PaymentMethodA: PaymentType: Credit Card CardType: Visa Amount: $120 PaymentTransactions: Settlement, $120, Closed Return Credit, $40, Closed, Return Invoice ID Parent OrderB Payment Header: PaymentMethodB: PaymentType: Gift Card Amount: $100 PaymentTransactions: Settlement, $100, Closed Return Credit, $60, Closed, Return Invoice ID Implementation Flavor How to create a virtual gift card line externally without a valid item price configured for the eGC SKU Create the gift card line with the unit price populated, the line tagged as "IsPriceOverridden" flag set as "true", and the "GiftCardValue" populated as the unit price of the SKU. How to configure the payment component to settle a refund for split payment tender (Credit card + Gift card) at the distribution center instead of carrier scan There are two options to implement: Configure gift card for refund on carrier scan along with credit card so that both credit card and gift card will get refunded on carrier scan Or Implement user exit: Order:Order:UserExit:isInvoiceOnCarrierScan to prevent generation of return invoice on carrier scanned for credit card, so that both credit card and gift card will get refunded at the distribution center on carrier scan. How to refund to a new gift card after exhausting all refund retry attempts Use Payment:Payment:UserExit:PaymentFailureEvent user exit to refund to a new gift card after exhausting all refund retry attempts. Ensure that refund by link is not enabled for Retry Refund Failure mod type. Troubleshooting Virtual gift cards are not created after the base config "ConsolidateRefundTransactions" is enabled in payment parameters Ensure that the BaseUOM in the Item component exists for locale-specific data. While creating a gift card line in order, the BaseUOM from item master should be set on the item master or in the gift card order line explicitly. If Order.OrderLocale is not set, then use item → baseUOM. If Order.OrderLocale is populated, then baseUOM is used from respective locale specific data from Item master. How to know what payment method is going to be used for refund? Use the expected refund API. If the parent order is overpaid, the refund during return is being processed to a credit card, even though the original payment was made using a non-credit card prepaid method. When a Follow-on Refund fails after all retry attempts, the base system marks the 'IsValidForRefund' flag on the settlement transaction as false. If this flag is false, during return creation, the return credit retrieves the eligible refund payment methods from the payment parameters, treating the return refund as a standalone transaction. Note: The same will apply to refunds created during appeasement or cancellation flows. Related Articles AuthorizationPayment TypesCapturing PaymentPayment Health DashboardOther Transaction TypesPayment Schedulers & Batch ProcessingHow Payment Processing WorksTesting & Troubleshooting PaymentRest APIs and User ExitsSettlementPayment Gateway IntegrationPayment FailuresFraudPayment OverviewInvoicing and Sales PostingeInvoice