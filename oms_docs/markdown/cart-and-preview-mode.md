# Cart and Preview Mode

**Permalink:** cart-and-preview-mode
**Path:** Manhattan Active® Omni/Order Management/Process & Configuration Guides/Order Orchestration/Cart and Preview Mode
**Content Length:** 47,915 characters
**Scraped:** 2025-08-09T21:56:36.152353

---

Home ››Manhattan Active® Omni››Order Management››Process & Configuration Guides››Order Orchestration ››Cart and Preview Mode Cart and Preview Mode Next OverviewConfigurationProfile ConfigurationInitializing the CartKeeping Cart and Order in SyncExtended Attributes in the CartUser Exits in the CartConsul Server ConfigurationMessage Type ConfigurationCart APIsCart Initialization Status Check APICancel Line APIGet Current Cart Version APIConfirm Order Changes APIManaging Discarded CartsImplementation FlavorsFeature ScopeRelated Articles Overview The cart enables customers and customer service agents to preview order changes before saving them to the order. For example, a customer can select an item to cancel, preview the new order total, and then confirm the changes, as opposed to directly canceling the items without the ability to preview the impact it would have on the order. Without the cart to manage this preview step, changes are saved directly on the order, which results in unnecessary payment processing if users then reverted the change. Currently, the cart supports preview mode for the following use cases: Order line cancellation Previewing order modifications not included in this list is not supported. Configuration Profile Configuration The cart component profile configuration requires all three profiles purposes listed below to belong to the same profile. If that is not the case in your environment, change the profile configuration before you enable the feature. If you change the profile configuration after you've enabled preview mode, you will have to disable and enable the feature again. Profile Purpose Entities ord::orderConfig orderConfig, orderParameters, holdType, holdStatus, holdResolveReason ord::orderCoreConfig reason, chargeSubType, noteType, appeasement, sellingChannel, orderType crt::processDefinition statusDefinition crt::batch and crt::messaging profile purposes have to be a the same org level than the corresponding ord::batch and ord::messaging profile prurpose If you cannot find the cart profile purposes in your provisioning profile, click the "Sync" button in the UI to sync the provisioning profile with the new profile purpose created. Once the profile are configured, run the below APIs to check if you have the required data in your profile: GET: {{url}}/cart/api/cart/inBoundMessageType?size=100 => you should have at least 16 message types GET: {{url}}/cart/api/cart/outBoundMessageType?size=100 => you should have at least 9 message types GET: {{url}}/cart/api/cart/extPointToMessageType?size=100 => you should have at least 5 extension points to message types If you have no data in the response of these API, that means that the profile copy did not happen correctly. See here to see what to do if the profile copy failedRun the below API with three different payloads as mentioned. This process will copy seed data from the retail profile to mentioned ToProfileId for a given profile purpose. POST: {{url}}/com-manh-cp-cart/api/fwcore/profiles/copy with bodies { "FromProfileId": "retail", "ToProfileId": {profileId to which crt::batch is pointing}, "ProfilePurpose": "crt::batch" } { "FromProfileId": "retail", "ToProfileId": {profileId to which crt::processDefinition is pointing}, "ProfilePurpose": "crt::processDefinition" } { "FromProfileId": "retail", "ToProfileId": {profileId to which crt::messaging is pointing}, "ProfilePurpose": "crt::messaging" } Once this is done, run these APIs again to check if the message types got created. GET: {{url}}/cart/api/cart/inBoundMessageType?size=100 GET: {{url}}/cart/api/cart/outBoundMessageType?size=100 GET: {{url}}/cart/api/cart/extPointToMessageType?size=100 Initializing the Cart For the cart to provide the same information as the order component would, it requires a copy of the order configuration and must remain in sync at all times. A process called "initializing" the cart is used to ensure that the cart and order components are in sync, so that users only need to manage the configuration in the order component. To initialize the cart: Navigate to the Order Parameters UI Update Enable Preview Mode to true Wait for about 20 minutes for the initialization to complete Check the status of the process by calling the API GET /cart/api/cart/preview/config/sync/status This API returns the below attributes: Extended Attribute Sync Status (Values are Started, Failure, or Success) Config Entity Sync Status (Values are Started, Failure, or Success) Sync Status (Will be true if the other two attributes are in Success status) Once the Sync Status is true, begin using preview mode Note: Features like post-release cancelation and Ship It Instead flow should work irrespective of Enable Preview Mode configuration. This configuration is necessary only for payment promotions. Why 20 min?Before being able to copy the extended attributes, the cart component has to fully copy the configuration and perform a rolling restart. The extended attribute sync will be delayed by as many minutes as configured in the property “cart.syncStatus.delayedMessageMinutes”. the default value for this property is 20 min. This is a one time activation per organization. The system automatically does the following during the initialization process: Creates messaging configuration to automatically propagate configuration updates from the order component to the cart Entities that are synchronized between order and cart are: reason, chargeSubType, noteType, appeasement, sellingChannel, statusDefinition, nextUpConfiguration, orderConfig, orderType, orderParameters, modType, holdType, holdStatus, holdResolveReason, taxCodeOverride. There are two ways to manually re-trigger the synchronization of the configuration: Disable and re-enable the parameter in the order parameter Or call directly the below sync API to trigger the configuration sync: POST /cart/api/cart/preview/config/sync (body is empty). Note that if the order parameter activation did not succeed, there is a low chance the direct API will succeed. Check all your message type and profile configuration before trying with the order parameter again. Direct API should be used only when directly instructed. If a sync is re-triggered while another sync is in progress, the API returns an error telling that the sync process is ongoing. Cart Initialization Process Keeping Cart and Order in Sync Once the cart component is initialized, order broadcasts every configuration change using a queue: ConfigEntityChangeMSGType. The cart component consumes these updates to remain in sync with order. Updating the cart configuration directly is not supported; the configuration API does not have resources, ensuring that configuration is always updated through the order component. Extended Attributes in the Cart The cart only uses database-based extended attributes. File-based extended attributes are expected to be updated to database-based extended attributes before cart initialization. Extended attributes are copied during cart initialization. Past the initial configuration, there is no feature to date to broadcast extended attributes updates. Projects must maintain them both in the order and cart components. User Exits in the Cart User exits in the cart are the same as in the order component order selling flows. However, the user exit configuration must be duplicated in the cart component. There are no capabilities to automatically duplicate user exits configuration in order and cart. List of User Exits available in cart component Order:Order:UserExit:PreCalculatePrice Order:Order:UserExit:CalculatePrice Order:Order:UserExit:PostCalculatePrice Order:Order:UserExit:PreCalculateSNH Order:Order:UserExit:CalculateSNH Order:Order:UserExit:PostCalculateSNH Order:Order:UserExit:PreCalculateTax Order:Order:UserExit:CalculateTax Order:Order:UserExit:TranslateTaxRequest Order:Order:UserExit:TranslateTaxResponse Order:Order:UserExit:PostCalculateTax When a cart is confirmed and the changes are persisted on the order, the cart component uses the response template CartOrderConfirmChangesTemplate. If any field of the cart is updated by a User exit, this response template will have to be updated to include these fields. Consul Server Configuration During code drops, the system ensures that the order consul server is in sync with the cart consul server for feature flags, labels and component properties. Any configurations in the consul server need to be made in both the order and cart components. Work with services to ensure these configurations are in sync. Mark the fields in order entity as labels for cart also: {{url}}/cart/api/fwcore/attributeLabelsConfig/save { "EntitysName": "Order", "FieldNames": "Extended.Refrence" } Message Type Configuration The below message types are required for the initialization process and configuration propagation. These message types are part of the seed data included out of the box, so you do not need to create these message types. However, the list is included for troubleshooting. Inbound Message Types for the Cart (seed data) Message type Json ConfigEntityChangeMSGType { "MessageType": "ConfigEntityChangeMSGType", "NoOfConsumer": 10, "MinNoOfConsumer": 1, "Idempotent": true, "ExternalIntegrationRequired": false, "MaxDesiredInstances": 6, "ScaleUpTimeWindow": 10, "ScaleDownTimeWindow": 20, "Description": "Inbound message type of syncing the config entities from order", "ServiceId": "ConfigEntityChangeService" } UpdateExtendedAttributesSyncStatus { "MessageType": "UpdateExtendedAttributesSyncStatus", "NoOfConsumer": 10, "MinNoOfConsumer": 1, "Idempotent": true, "ExternalIntegrationRequired": false, "MaxDesiredInstances": 6, "ScaleUpTimeWindow": 10, "ScaleDownTimeWindow": 20, "Description": "Inbound message type to update status of extended attributes sync process", "ServiceId": "UpdateExtendedAttributesSyncStatus", "InBoundQueues": { "QueueName": "queue.updateExtendedAttributesSyncStatus" } } SyncConfigEntities { "MessageType": "SyncConfigEntities", "NoOfConsumer": 10, "MinNoOfConsumer": 1, "Idempotent": true, "ExternalIntegrationRequired": false, "MaxDesiredInstances": 6, "ScaleUpTimeWindow": 10, "ScaleDownTimeWindow": 20, "Description": "Inbound message type to sync systemAugmentable entities during config sync process", "ServiceId": "SyncConfigEntities", "InBoundQueues": { "QueueName": "queue.syncConfigEntities" } } SyncExtendedAttributes "MessageType": "SyncExtendedAttributes", "NoOfConsumer": 10, "MinNoOfConsumer": 1, "Idempotent": true, "ExternalIntegrationRequired": false, "MaxDesiredInstances": 6, "ScaleUpTimeWindow": 10, "ScaleDownTimeWindow": 20, "Description": "Inbound message type to sync Extended Attributes during sync process", "ServiceId": "SyncExtendedAttributes", "InBoundQueues": { "QueueName": "queue.syncExtendedAttributes" } } UpdateSyncProcessStatus { "MessageType": "UpdateSyncProcessStatus", "NoOfConsumer": 10, "MinNoOfConsumer": 1, "Idempotent": true, "ExternalIntegrationRequired": false, "MaxDesiredInstances": 6, "ScaleUpTimeWindow": 10, "ScaleDownTimeWindow": 20, "Description": "Inbound message type to update config entities sync status during config sync process", "ServiceId": "UpdateSyncProcessStatus", "InBoundQueues": { "QueueName": "queue.updateSyncProcessStatus" } } TriggerSyncCart { "MessageType": "TriggerSyncCart", "NoOfConsumer": 10, "MinNoOfConsumer": 1, "Idempotent": true, "ExternalIntegrationRequired": false, "MaxDesiredInstances": 6, "ScaleUpTimeWindow": 10, "ScaleDownTimeWindow": 20, "Description": "Inbound message type to start sync process", "ServiceId": "TriggerSyncCart", "InBoundQueues": { "QueueName": "queue.triggerSyncCart" } } JobScheduleMsg { "MessageType": "JobScheduleMsg", "NoOfConsumer": 10, "MinNoOfConsumer": 1, "Idempotent": true, "ExternalIntegrationRequired": false, "MaxDesiredInstances": 6, "ScaleUpTimeWindow": 10, "ScaleDownTimeWindow": 20, "Description": "", "ServiceId": "JobScheduleListener", "InBoundQueues": { "QueueName": "JobScheduleQueue.COMPONENT-CART-BATCH" } } jobStatusMonitorJob { "MessageType": "jobStatusMonitorJob", "NoOfConsumer": 10, "MinNoOfConsumer": 1, "Idempotent": true, "ExternalIntegrationRequired": false, "MaxDesiredInstances": 6, "ScaleUpTimeWindow": 10, "ScaleDownTimeWindow": 20, "Description": "", "ServiceId": "JobStatusMonitor", "InBoundQueues": { "QueueName": "JobStatusMonitorQueue.COMPONENT-CART-BATCH" } } awpf-payload { "MessageType": "awpf-payload", "NoOfConsumer": 10, "MinNoOfConsumer": 1, "Idempotent": true, "ExternalIntegrationRequired": false, "MaxDesiredInstances": 6, "ScaleUpTimeWindow": 10, "ScaleDownTimeWindow": 20, "Description": "", "ServiceId": "PayloadMsgProcessor", "InBoundQueues": { "QueueName": "awpf-payload-queue-crt" } } awpf-processedmsg { "MessageType": "awpf-processedmsg", "NoOfConsumer": 10, "MinNoOfConsumer": 1, "Idempotent": true, "ExternalIntegrationRequired": false, "MaxDesiredInstances": 6, "ScaleUpTimeWindow": 10, "ScaleDownTimeWindow": 20, "Description": "", "ServiceId": "ProcessedMessageListener", "InBoundQueues": { "QueueName": "awpf-processedmsg-queue-crt" } } JobScheduleManagerMsg { "MessageType": "JobScheduleManagerMsg", "NoOfConsumer": 10, "MinNoOfConsumer": 1, "Idempotent": true, "ExternalIntegrationRequired": false, "MaxDesiredInstances": 6, "ScaleUpTimeWindow": 10, "ScaleDownTimeWindow": 20, "Description": "", "ServiceId": "JobScheduleManager", "InBoundQueues": { "QueueName": "JobScheduleManagerQueue.COMPONENT-CART-BATCH" } } DiscardCart { "MessageType": "DiscardCart", "NoOfConsumer": 10, "MinNoOfConsumer": 1, "Idempotent": true, "ExternalIntegrationRequired": false, "MaxDesiredInstances": 6, "ScaleUpTimeWindow": 10, "ScaleDownTimeWindow": 20, "Description": "Inbound message type to discard cart", "ServiceId": "DiscardCart", "InBoundQueues": { "QueueName": "queue.discardCart" } } awpf-delayed-payload-schedule { "MessageType": "awpf-delayed-payload-schedule", "MinNoOfConsumer": 1, "NoOfConsumer": 1, "ServiceId": "DelayedPayloadPublisherService", "InBoundQueues": { "QueueName": "awpf-delayed-payload-schedule-{:unique.app.code}" } } awpf-delayed-payload { "MessageType": "awpf-delayed-payload", "ServiceId": "PayloadMsgProcessor", "MinNoOfConsumer": 1, "NoOfConsumer": 10, "InBoundQueues": { "QueueName": "awpf-delayed-payload-{:unique.app.code}" } } awpf-track-payload { "MessageType": "awpf-track-payload", "ServiceId": "PayloadMsgProcessor", "MinNoOfConsumer": 1, "NoOfConsumer": 10, "InBoundQueues": { "QueueName": "awpf-track-payload-{:unique.app.code}" } } awpf-consolidate-payload { "MessageType": "awpf-consolidate-payload", "ServiceId": "ConsolidatePayload", "MinNoOfConsumer": 1, "NoOfConsumer": 10, "InBoundQueues": { "QueueName": "awpf-consolidate-payload-{:unique.app.code}" } } Outbound Message Types for the Cart (seed data) Message Type Json UpdateExtendedAttributesSyncStatus { "MessageType": "UpdateExtendedAttributesSyncStatus", "Transactional": true, "PersistMessageToMsgStore": false, "OutBoundDeliveryConfig": { "DeliveryDelay": "20 minute", "OutBoundDeliveryConfigId": "updateExtendedAttributesSyncStatusConfig" }, "OutBoundQueues": { "QueueName": "queue.updateExtendedAttributesSyncStatus" } } SyncConfigEntities { "MessageType": "SyncConfigEntities", "Transactional": true, "PersistMessageToMsgStore": false, "OutBoundQueues": { "QueueName": "queue.syncConfigEntities" } } SyncExtendedAttributes { "MessageType": "SyncExtendedAttributes", "Transactional": true, "PersistMessageToMsgStore": false, "OutBoundQueues": { "QueueName": "queue.syncExtendedAttributes" } } UpdateSyncProcessStatus { "MessageType": "UpdateSyncProcessStatus", "Transactional": true, "PersistMessageToMsgStore": false, "OutBoundQueues": { "QueueName": "queue.updateSyncProcessStatus" } } JobScheduleMsg { "MessageType": "JobScheduleMsg", "Transactional": false, "PersistMessageToMsgStore": false, "MessageCategory": "systembatch", "OutBoundQueues": [ { "QueueName": "JobScheduleQueue.COMPONENT-CART-BATCH" } ] } jobStatusMonitorJob "MessageType": "jobStatusMonitorJob", "Transactional": false, "PersistMessageToMsgStore": false, "MessageCategory": "systembatch", "OutBoundQueues": [ { "QueueName": "JobStatusMonitorQueue.COMPONENT-CART-BATCH" } ] } awpf-payload { "MessageType": "awpf-payload", "Transactional": false, "PersistMessageToMsgStore": false, "MessageCategory": "awpf", "DeliveryDelay": "200", "OutBoundQueues": [ { "QueueName": "awpf-payload-queue-crt" } ] } awpf-processedmsg "MessageType": "awpf-processedmsg", "Transactional": false, "PersistMessageToMsgStore": false, "MessageCategory": "awpf", "DeliveryDelay": "0", "OutBoundQueues": [ { "QueueName": "awpf-processedmsg-queue-crt" } ] } DiscardCart { "MessageType": "DiscardCart", "Transactional": true, "PersistMessageToMsgStore": false, "OutBoundQueues": { "QueueName": "queue.discardCart" } } Order Outbound Message type - seed data for cartOutbound message type (in order component) { "MessageType": "ConfigEntityChangeMSGType", "Transactional": true, "PersistMessageToMsgStore": false } Extension points to message types for the Cart (seed data)Here is a list of the seed data for extension points to message types POST{{url}}/cart/api/ServiceDefinition/extPointToMessageType/import { "data": [ { "ExtensionPointId": "Cart:Cart:Event:UpdateExtendedAttributesSyncStatus", "MessageType": "UpdateExtendedAttributesSyncStatus" }, { "ExtensionPointId": "Cart:Cart:Event:SyncConfigEntities", "MessageType": "SyncConfigEntities" }, { "ExtensionPointId": "Cart:Cart:Event:SyncExtendedAttributes", "MessageType": "SyncExtendedAttributes" }, { "ExtensionPointId": "Cart:Cart:Event:UpdateSyncProcessStatus", "MessageType": "UpdateSyncProcessStatus" }, { "ExtensionPointId": "Cart:Cart:Event:DiscardCart", "MessageType": "DiscardCart" } ] } Cart APIs The list of APIs currently supported in the cart component can be found in this section. See the below diagram for an illustration of which APIs to call to build a cancellation feature with preview. How to use cart APIs for cancellation preview Cart Initialization Status Check API After initializing the cart via the Order Parameters UI, check the status of the cart component with the below API: GET : /cart/api/cart/preview/config/sync/status How is the sync status used by the other cart APIs?By default, all the APIs sent to cart will always check for the value of the "SyncStatus" boolean flag. If this flag is set to false meaning that comething went wrong during the sync process, the functioanl APIs detailed in the rest of this section will fail. There is one way to bypass this verification. It is possible to change a KV store property "cart.enableSyncStatusValidation" (true by default) to false. In this case, the cart component configuration does not need to be in sync to allow funcitoanl APIs to hit the cart. Unless sepecifically instructed, it is not advised to change this value as it can have consequences in the accuracy of the cart component computation. Cancel Line API Canceling a line in the cart component provides the user with a preview of the new, estimated order totals and canceled order totals. The changes made in cart do not have any impact on the order or payment until the user confirms the changes. Currently, preview mode for order line cancellation is supported for end customers in Digital Self-Service. Refer to this guide for more information on cancellation preview in Digital Self-Service: Order Cancellation. Calling the below API will: Create a cart based on the current status of the order. This cart will not contain the lines that were previously canceled (or the lines that are “requested for cancelation” in the order component). Cancel the line in cart Recompute the order totals, taxes, charges, and other charges with this line canceled Return what the order would look like once the line gets canceled in the response On post-release cancelation: The cart always allows you to preview the new order total by canceling a line, even if it is already released. If in cart, you try to cancel a line that cannot be canceled, the persist cart API will fail. See Late Order Cancellation for more information. Cancel line in cart APIPOST {{url}}/commerceservice-facade/api/cart/order/edit/cancel?orderId=<orderID> Body: { "CancelReason": { "ReasonId": "<add here a reason for cancelation>" }, "OrderId": null, <this can stay null in the body as the API will only consider the order id in the URL> "OrderLine": [ { "OrderLineId": "<order line id to cancel>" } ], "CancelComments": "<cancel comments if required>" } This API will not allow you to modify an existing cart. It will delete all the cart currently active for this order and create a new one. if you want to cancel multiple lines on the same order, do that in the same API call. In the response of this API, you will note that the value of the “orderId” field is not the same one as the order ID you were expected. This is normal. In any cart related API, the field “OrderID” actually contains the cart ID (UUID autogenerated). You will need that cart ID to persist the changes to the order component. The cart ID is different than the order ID as an order can have multiple carts active at the same time but a user can only persist one cart. There is an entity in the cart component that lists all the cart active for an order at any given time: GET: {{url}}/cart/api/cart/cartDetail?query="OrderId='<your order ID>'" Get Current Cart Version API To get to the version of the order that exist in cart you need to know the cart ID for your specific order. This can be found in the response of the API that created the cart or using GET: {{url}}/cart/api/cart/cartDetail?query="OrderId='<your order ID>'" Confirm Order Changes API Once all the modifications have been done in the cart and the user is happy with the result, it is required to persist the changes in the order component. To do this, call the persist cart API with your cart ID: POST {{url}}/commerceservice-facade/api/cart/order/edit/confirmChanges?cartId=<your cart ID> (empty body) This API updates the order with the changes made in the cart. Once the order is updated, the cart is deleted and the payment processes (like refund or adjustment invoices) are triggered. The Persist Change API could fail if the order is no longer eligible for such updates. For example, if the order was updated since the cart processes started (if a line was released for example), it could make it ineligible for update. There is no version comparison between the cart and the order. The system will get to the current version of the order and will use an order save call to save the current version of the cart. Managing Discarded Carts Carts are intended to be short-lived. The longer a cart stays active, the higher the probability of discrepancy with the order is. If it is not explicitly deleted by the calling system, it will be deleted automatically by an internal cart process. Whenever a cart is created, a delayed message will be posted in a queue. That message will be set up to be processed 60 minutes after it was posted. 60 min is the default value but can be changed in the KV store of the cart component in the property "cart.discard.delayedMessageMinute". Implementation Flavors N/A Feature Scope The following is not supported in the cart: Preview of order modifications other than full line cancellations (for example, preview quantity changes, adding items, change shipping address, and so on) Related Articles Shipping RestrictionHoldsOrder Orchestration ConfigurationOrder TaggingOrder Orchestration ProcessOrder CancellationOrder Audit Mod TypesPublishing Order Order ArchivingDelivery TrackingCreating and Updating Order