# Settlement

**Permalink:** settlement
**Content Length:** 22,750 characters
**Scraped:** 2025-08-09T22:34:25.664887

---

Home &rsaquo;&rsaquo;Manhattan Active® Omni&rsaquo;&rsaquo;Order Management&rsaquo;&rsaquo;Process & Configuration Guides&rsaquo;&rsaquo;Order Selling&rsaquo;&rsaquo;Payment ››Settlement Settlement Previous&nbsp;I&nbsp;Next &nbsp; Settlement transactions move&nbsp;funds from the payer's account into the payee's account. For example, when a customer purchases an item from a retailer, a settlement transaction transfers money from the customer to the retailer. This section explains settlements, settlement failures, and settlement expiry. Follow-On vs. Standalone SettlementsSettlement FailureCharge SequenceSettlement ExpiryTesting Settlement&nbsp;ExpirySettlement transactions for Advance Authorization:Settlement RetryPayment Recovery&nbsp;ReminderAutomatic Write-Off on Payment FailureSuspend Payment Method on Partial Settlement FailureImplementation FlavorHow to suppress final capture flag for Paypal OrdersHow to use write-off balance due on the order in the following scenarios:Payment recovery feature is not configuredPayment method is not configured to retry failures"Settlement Retries Failed" mod type is not configured to send a payment recovery emailRelated Articles Follow-On vs. Standalone Settlements Settlements can be performed as standalone or follow-on transactions. If a settlement is performed against an existing authorization, then it is referred to as a follow-on settlement. For a follow-on settlement to be processed, the unique keys from the initial authorization must be included in the settlement transaction, so that the gateway can decrement the funds being held in the authorization. If a settlement is performed without an authorization, then it is a standalone settlement. Standalone settlements are performed in multiple scenarios, including when payment types do not support authorization (for example,&nbsp;cash payments) or when an in store purchase is made for which immediate settlement is required.&nbsp; In the scenario a&nbsp;charge back invoice is generated for a return order, a standalone settlement is performed for the payment method whose payment type is configured for generating a charge back settlement transaction. In case there are multiple payment methods existing for the configured payment type, the charge sequence is considered. Such payment transactions will be having&nbsp;isChargeback = true.&nbsp; A stand alone payment settlement with&nbsp;isChargeback = true will be copied to the parent order to move the funds back and will not be considered as funds available on the customer order. If a settlement is performed on an expired authorization (isActive flag=false and "TransactionExpiryDate" is in the past), then it will be considered as a standalone settlement.&nbsp; If&nbsp;the 2019&nbsp;Visa Mandate configuration is enabled in the Payment Parameters&nbsp;and Advance Auth Required is disabled for Visa cards, then all Visa settlement transactions processed by CyberSource will have a sequence number populated for each follow-on settlement. For instance, if a $100 authorization has three settlements processed due to split shipments, then the sequence number is populated with 1 for the first settlement transaction, 2 for the second transaction, and 99 for the final settlement transaction against this auth. The sequence number&nbsp;is not populated if&nbsp;Advance Auth Required is enabled for Visa cards. The system compares the&nbsp;Payment Method amount to&nbsp;the sum of all settlement transactions to determine if the current transaction is for last shipment or not for populating the Settlement Sequence number. If&nbsp;the Payment Method amount is equal to the sum of all settlement transactions, then the system assumes it is the last shipment and the settlement sequence number is populated as 99.&nbsp; If the payment Method amount is less than the sum of all settlement transactions,&nbsp;it is an intermediate shipment and the settlement sequence number is populated by incrementing the maximum settlement sequence number existing for the settlement transactions of the payment method by 1. Note: Partial settlement transactions will be created in an "Open" status, as only the "Calculate Execution Mode" will be executed as part of partial scenarios. These transactions can be processed through a custom or by increasing the frequency of the job scheduler. In the case&nbsp;of standalone settlements, FollowOnId (PaymentMethod.PaymentTransaction.FollowOnId) should be set to null." Settlement Failure Settlement failure can occur for many reasons such as insufficient funds or a stolen card. If a customer is present, then the store associate or customer care representative can ask for an alternative&nbsp;form of payment. If a customer is not present,&nbsp;then the customer care representative&nbsp;captures new payment information from the customer. When a settlement transaction is updated with response status failure, the following updates are made: Settlement payment transaction processed amount is updated to zero Payment method amount is reduced by the failed settlement amount Payment summary requested settlement amount is reduced based on the failed amount Order payment status is updated to Awaiting Payment Info The Customer Service UI does not provide a way to write-off invoices, open invoices, or close invoices. Upon settlement failure, a sales posting message is published so that the retailer can perform these functions outside of Active® Omni. When invoices are closed externally, the Close Invoice API can be&nbsp;used to mark the invoice as closed. Charge Sequence If multiple payment methods exist and a split shipment occurs,&nbsp;then charge sequence is used to select a payment method. For example, if two Visa credit cards exist on an order, and the payment configuration charge sequence for Visa is 2, then the payment method with the minimum&nbsp;charge sequence is charged first. Payments are processed using the&nbsp;charge sequence in ascending order. If there is a tie, then the charge sequence populated on the payment method is used to break the tie. The payment transaction charge sequence is populated on transaction import. Configure the charge sequence for each payment type in the Payment Configuration UI. Settlement Expiry The Settlement Expiration Days attribute indicates the number of days after which a settlement transaction should be considered expired. When a settlement is expired, follow-on refunds can no longer be created against it. For example, if a customer purchases an item in store on day 1, a settlement is processed. If the customer returns the item on day 120, then a payment gateway might no longer support&nbsp;follow-on refunds against the initial settlement, so the payment&nbsp;component creates a standalone refund instead. The transaction expiry date on a settlement transaction is read by the calculate service to determine whether a follow-on refund or standalone refund needs to be created. To configure this&nbsp;setting,&nbsp;navigate to the Payment Configuration UI. If settlement expiry days is null, then the transaction expiry date is not updated on settlement payment transactions. This attribute should be set to null if settlements do not expire. If settlement expiry days is not null, then the transaction expiry date is populated on successful, closed settlement payment transactions with the following logic: If the payment transaction expiry date is null, then set transaction expiry date equal to the current date plus the number of settlement expiry days configured. For example, the settlement expiry days attribute is set to 60 days for Visa credit cards. When on January 1, 2017 at 3:00 the payment gateway returns a successful Visa credit card settlement transaction with a null transaction expiry date, then the transaction expiry date is updated to March 2, 2017 at 3:00. If transaction expiry date is not null, then the transaction expiry date is honored. For example, a completed order is imported with a successful settlement and a transaction expiry date of January 10, 2017 at 4:30. When this settlement is saved, the settlement expiry days configuration is not used and the imported value is honored. If a payment does not support refund, then the settlement expiration attribute is not used. If the existing payment method is completely utilized (all funds have been refunded), a standalone refund transaction will not get created for same payment method. In such scenarios, a new payment method should be provided to process a standalone refund. Testing Settlement&nbsp;Expiry To test settlement expiry: In the Payment Type Config UI, configure the Settlement Expiration Days To test the behavior when a settlement&nbsp;is expired, set the Settlement Expiration Days&nbsp;to -1, so that newly-created settlements will be considered expired (Note: The system considers 0 as null, so do not use 0 for this configuration for testing purposes) Create and ship an order, so that a settlement is processed successfully Return the order or add an appeasement, which should trigger a standalone refund to be created (as opposed to a follow-on refund, where the follow-on ids would be populated) Settlement transactions for Advance Authorization: Base&nbsp;does not support performing settlement&nbsp;transaction for a advance authorization immediately as soon as it is created. However, some third party service provider&nbsp;offer a combo call which performs authorization as well as settlement together in a single call which will require&nbsp;mapping changes in the interface. Settlement Retry The payment auto-retry and pay by link recovery features can be enabled to reduce the need for manual payment recovery from payment failures. For example, user orders an item and pays&nbsp;with a credit card. The payment is authorized, and the order is shipped. However, when the payment attempts to settle, the payment fails due to the card being cancelled for some reason (maybe the card was stolen).&nbsp;Manhattan Active® Omni Order Management retries payment as many times (remainingAttempts) as specified in the configuration. If this fails, then a paybylink email/text outbound message is sent to get a new payment method from the customer. When an open settlement retry transaction is created, the 'ReasonId' attribute is updated with the value 'AutoRetry' to differentiate between regular settlement and retry settlement transactions, which can be used in scheduler queries to filter, schedule, and&nbsp;process the transactions separately. The 'ReasonId' attribute gets updated to 'RetrySettlementSucceeded' when the retry settlement transaction is successful and to 'RetrySettlementFailed' when the retry settlement transaction is unsuccessful. Refer to&nbsp;Enabling Auto-Retries for configuration details.&nbsp; Payment Recovery&nbsp;Reminder In the event that the system has not received a payment method from the customer within the configured number of hours, the system sends the customer a recovery reminder email or text. For example: The reminder threshold (PayByLink Reminder Threshold) is configured as 2 hours. If the PayByLink recovery was sent to the customer at 1:00 p.m. and the customer delays adding payment, the recovery reminder notification via email/text will be sent to the customer by 3:00 p.m. Refer to&nbsp;Settlement Failure PaybyLink configurations for enabling payment recovery email and texts, and&nbsp;Pay by Link and&nbsp;Refund by Link&nbsp;Reminder Threshold Configuration&nbsp;for enabling payment recovery reminder emails. Automatic Write-Off on Payment Failure When this configuration is set, the open balance due on the order will be auto-written off after a configured&nbsp;number of days from the time payment recovery email was sent to the customer if the balance due has still not been collected. In order for this behavior to take effect, the payment method used with the order needs to be configured to retry failures, and the "Settlement Retries Failed" mod type needs to be configured to send a payment recovery email. Refer to Enabling&nbsp;Auto Write-off for configuration details. Suspend Payment Method on Partial Settlement Failure When this configuration is set, the payment method will be suspended in case of a partial settlement failure, reversing the remaining authorized amount for a particular payment method. This assumes that if an initial attempt to settle an authorized amount is unsuccessful, subsequent attempts to settle against the same authorization will also be unsuccessful. If the payment method is suspended after&nbsp;the initial failure, any pay by link or payment recovery email sent to the customer to add additional payment is based off of the full remaining balance of the order, and not just the failed amount that&nbsp;attempted to settle. This is not required for use during the payment recovery email process, but can be used to prevent multiple payment recovery attempts to the customer for the same order. Refer to Enabling&nbsp;Suspend Payment Method on Partial Settlement Failure&nbsp;for configuration details. Implementation Flavor How to suppress final capture flag for Paypal Orders Change the “Value” flag to false under PaymentTransAttribute for IsCompleteFollowOnRequest using the user exit Payment:PaymentGateway:UserExit:CallGateway before calling the Base PayPal API. Refer to this sample How to use write-off balance due on the order in the following scenarios: Payment recovery feature is not configured Payment method is not configured to retry failures "Settlement Retries Failed" mod type is not configured to send a payment recovery email A custom agent can be used to identify such orders that require auto-write off using custom logic and the order.orderAdditional.autoWriteOffDate attribute can be populated with a date on which the system will automatically write off any balance due on such orders. Related Articles Payment TypesPayment Gateway IntegrationFraudAuthorizationHow Payment Processing WorksTesting & Troubleshooting PaymentPayment Schedulers & Batch ProcessingOther Transaction TypesPayment OverviewRest APIs and User ExitsPayment FailuresPayment Health DashboardeInvoice RefundsCapturing PaymentInvoicing and Sales Posting