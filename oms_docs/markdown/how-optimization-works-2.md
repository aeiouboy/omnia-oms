# How Optimization Works

**Permalink:** how-optimization-works-2
**Path:** Manhattan Active® Omni/Order Management/Process & Configuration Guides/Order Promising/How Optimization Works
**Content Length:** 165,860 characters
**Scraped:** 2025-08-09T21:56:01.317787

---

Home ››Manhattan Active® Omni››Order Management››Process & Configuration Guides››Order Promising ››How Optimization Works How Optimization Works Previous I Next OverviewOptimization PrincipleCalculating Total Cost of FulfillmentHard CostsShipping CostHandling CostInventory AssortmentSoft CostsFulfillment Capacity UtilizationInventory LevelItem VelocityRejection RateLocation Proximity Selling Price DifferentialOptimization - Cost EvaluationFactor GroupsMultiple Optimization LevelsEvaluate Soft CostMerge Shipment - OptimizationConfigurationConfiguring OptimizationConfiguring Merge Route for a LocationConfiguring Shipping RatesImplementation FlavorsHow to prioritize the Locations where prices have been Markdown for an Item?Do we perform address validation in Manhattan Active® Omni during Location Proximity ?Related Articles Overview The goal of optimization is to reduce the overall cost of fulfillment. If an order can be allocated from multiple locations, the optimization engine determines that location with the lowest overall cost of fulfillment based on configurable cost factors. Multiple factors are available for a retailer to consider while determining the best location. These factors are either complimentary or competitive in nature. The engine calculates the monetary impact of each of these factors and determines the location with overall lowest cost. An optimization level represents a group of selected factors that are used for allocation optimization. A retailer can configure one or more levels which are evaluated sequentially. For example, the factors that are most important to the retailer can be configured in the first optimization level, and other relevant but less important factors can be considered in later levels and used as tie breakers, when needed. Depending on the factors configured by the retailer, the total fulfillment cost is calculated as: Total Fulfillment Cost = Hard Costs + Soft Costs + Selling Price Differential (based on the factors configured in the optimization config) Optimization Principle If L1, L2, ... Ln are the potential locations considered for order promising and the cost of fulfillment for each of the location are F1,F2, ... Fn respectively, then the optimization function can be expressed as The optimization engine chooses the location with the overall least cost of fulfillment. It is quite possible that the order may get allocated from multiple locations. In this case, each location that is considered for allocation contributes to the cost of fulfillment. If LC1, LC2, ... LCn are the potential location ‘combination’ considered for promising, and the cost of fulfillment for each of the combination is FC1, FC2, ... FCn, then the optimization function can be expressed as, Calculating Total Cost of Fulfillment The Total Cost of fulfillment is the overall cost which the retailer must bear to fulfill the order. The factors that contribute to the cost are the hard cost factors or the soft cost/preferences factors or the Selling Price Differential. Total Hard Cost: The hard costs are quantifiable costs and can easily be summed up. Total Hard cost = Shipping cost + Handling cost Total Soft Cost: The soft costs are non-quantifiable. To compute the total soft cost, each preference factor is given a score in the range of [0,2]. Using the total soft cost, the overall score of all the preferences are computed as their weighted mean. Locations with the lower preference score are preferred over locations with higher preference score. If the preference is favorable, then the preference score of a location tends towards 0. If a preference factor is not favorable, then the preference score of the location tends towards 2. Because the range of each preference cost is [0,2] , the total preference score also falls in the same range. If all the preference considered for a location are favorable, then the total preference score tends towards 0. If all the preference considered are not favorable, then the total preference score tends towards 2. Total Preference score is calculated as Selling Price Differential: The selling price differential is the price margin the retailer may gain while selling the item from a store over the DC. Selling price differential = Store price - ECom price Total Cost of Fulfillment: The total cost of fulfillment is an indicative figure and not necessarily reflects the actual cost the retailer bears to fulfill the order. To mathematically compute an optimized solution, it becomes imperative to convert all the factors to a common unit of measurement, ‘Dollar’ (or equivalent). The scores are intentionally kept in the range of [0,2], so that the maximum cost impact of the preferences can be assumed to not surpass the total hard costs. Say for example, if the hard cost is 10$. Then the total cost of fulfillment lies in a range of [$0, $20] because the preference score lies in a range of [0,2]. Hence, the maximum dollar impact which the preferences cost can create in this scenario is +10$, which is same as the hard cost and the range of impact lies in [-$10, $10]. Thus, preferences have the potential to bring down the overall cost of fulfillment to zero. The formula to compute the total cost of fulfillment is Total cost of Fulfillment = (Total Hard cost * Total Preference score) + Selling price differential From this, the location combinations with the least total cost of Fulfillment is considered for Promising. Refer to the below section for more details Promising - Find Eligible locations (Examples)Example 1: Basic scenario (1 order line, 1 quantity) This is a basic scenario to demonstrate that allocation happens from the cheapest location. It involves an order with just one order line and 1 requested quantity. Setup: Order O with 1 order line OL1 with 1 quantity requested for ItemA Locations L1, L2, L3, L4 and L5 The following shows the grid map of whether the item is available or not at the given location. Green indicates availability. L1 L2 L3 L4 L5 ItemA Steps: Find the locations which can fulfill the order: L1, L4 and L5 Find the cost of fulfillment for each of the location: F1, F4 and F5 Reserve inventory against the cheapest location: Location where cost = Min (F1, F4, F5) Example 2: Basic scenario (3 order lines, 1 quantity each line) This is a basic scenario to demonstrate that allocation happens from a location which can fulfill all the lines. If there are more than one such location, then the algorithm tries to find the cheapest location among this list and allocates the order from there. Setup: Order O with 3 order lines OL1, OL2, OL3 with 1 quantity requested per order line for ItemA, ItemB, and ItemC respectively Locations L1, L2, L3, L4 and L5 The following shows the grid map of whether the item is available or not at the given location. Green indicates availability L1 L2 L3 L4 L5 ItemA ItemB ItemC Steps: The algorithm assumes that the location which can fulfill the maximum number of lines is among the potential locations from where the allocation can happen. Find locations which can fulfill maximum order lines: L1 and L4 Find the cost of fulfillment for each of the location:  F1 and F4 Reserve inventory against the cheapest location:  Location where cost = Min (F1, F4) Example 3: Basic Scenario (3 order line, 1 quantity each line, no locations can fulfill all order lines) This is a scenario to demonstrate that allocation happens from a location which can fulfill maximum number of lines. In this scenario, none of the locations can fulfill all the order lines. So the algorithm tries to find the location from which the maximum lines can be filled. The algorithm is repeated to find the locations which can fulfill the remaining lines. Setup: Order O with 3 order lines OL1, OL2, OL3 with 1 quantity requested per order line for ItemA, ItemB, and ItemC respectively Locations L1, L2, L3, L4 and L5 The following shows the grid map of whether the item is available or not at the given location. Green indicates availability L1 L2 L3 L4 L5 ItemA ItemB ItemC Steps: The algorithm assumes that the location which can fulfill the maximum number of lines is among the potential locations from where the allocation can happen. None of the location can fulfill all the three lines. Find locations which can fulfill maximum order lines:   L1, L4 and L5 Find the cost of fulfillment for each of the location:   F11, F14, and F15** Find location with the cheapest cost of fulfillment:  Location where cost = Min(F11, F14, F15) Let’s assume that Location L5 was the cheapest location. Hence ItemA and ItemC are reserved against Location L5. The item which is pending and yet to be allocated is ItemB. The following shows the grid map of item availability for ItemB. L1 L2 L3 L4 L5 ItemA Allocated ItemB ItemC Allocated The algorithm steps are repeated for ItemB Find locations which can fulfill maximum order lines:  L1, L2 and L4 Find the cost of fulfillment for each of the location: F21, F22 and F24 Find location with the cheapest cost of fulfillment: Location where cost = Min (F21, F22, F24) Let’s assume that Location L2 was the cheapest location among the three considered. Hence ItemB is reserved against Location L2. The cost of fulfillment of Location L1 in the first iteration F11 is different from second iteration F21, as the items that are getting fulfilled in the two iterations are different. In the first iteration ItemA and ItemB together were considered, but in second iteration, only itemB was considered for fulfillment. Refer to How Optimization works for more details on the Fulfillment cost evaluation Refer How to set up Optimization for more details. Hard Costs Hard costs have a direct, measurable cost associated with them. These factors contribute directly to the overall cost of fulfillment. Refer How to set up Optimization for more details. The following cost factors are available for the allocation optimization decision: Shipping Cost The cost to ship the item from the source location to the destination. It is typically the most dominant cost factor and is one of the most important factors to be optimized. This depends on the following factors (Refer How to set up Shipping cost for more details) Origin location: The location from where the item(s) can potentially be shipped. Destination: The destination address to which the item(s) will be shipped. This is provided in the Promising request. Parcel weight: This represents the weight of the package(s) shipping from the location. Parcel weight is either defaulted as 1 lb for every line shipped or calculated as per actual item weight. System will always assume that single parcel is shipped from the location. By default, the weight of each line in the parcel is considered as 1 lb. Most often, Shipping rates are proportional to distance between source & destination. Hence, default value serves the purpose of relative comparison between locations in most of the cases. For example, if 2 units of Item A (Weight 2 lb) and 3 units of Item B (Weight 1 lb) are shipped from a location, then ideally, the total weight of the parcel should be considered as 7 lb. But to simplify the cost calculation process, the weight of the parcel is just assumed as 2 lb (1 for each line). But, in certain regions, rate is not exactly proportional to distance for bulky items. Most of the carrier in these regions charges their customers based on true weight of the parcel, hence retailer prefers to have shipping cost comparison based on actual item weight. Refer to the below section on how Parcel weight is computed. Parcel Weight CalculationIf "Consider Actual Weight" is set as true in promising configuration parameters, shipping cost of locations for a zone will be based on order/order lines total weight calculated as per unit weight configured in "Volumetric Weight" in the Item Master. API - {{url}}/item/api/item/item/save { "Description": "Callahan Short", "VolumetricWeight": "5", "ItemId": "Callahan Short", } Volumetric Weight can also be sent on order line during order creation. For standalone promising request of type "Optimization"/"Query", value needs to be sent in "weight" attribute in promising request detail by the user. If "Consider Actual Weight"= true then weight = [Sum Across Lines ( Volumetric Weight X Quantity )] If Volumetric Weight is null, value will be assumed as 1 lb per unit If Volumetric Weight  is 0, value will be assumed as 0 per unit If "Consider Actual Weight"= false then weight = 1 lb irrespective of Volumetric Weight field value. Note: Assumption is that Shipping Rate data and Order line volumetric weight are defined in same UOM. System will not have any conversion logic or explicit validations of UOM during weight calculation for fetching Shipping Cost. System will not have any rounding logic. Precision of 16,4 will be honored for weight with truncate approach for digits after it. Example # 1: When multiple locations can fulfill an order completely and "Consider Actual Weight" is enabled Shipping Cost: Zone 1: DC1 is eligible,  Zone 2: DC2 is eligible Zone From Weight To Weight Shipping Cost Zone 1 0 20 30 $ Zone 1 20 200 40 $ Zone 2 0 20 20 $ Zone 2 20 200 60 $ Supply: Location Item Quantity DC1 Item A 20 DC2 Item A 30 Allocation: Ordered Quantity Shipping Cost Comparison Allocation Item A = 20 qty Volumetric Weight = 3 lbs Zone 1: DC1 for 20 X 3 = 60 lbs parcel weight is 40 $ Zone 2: DC2 for 20 X 3 = 60 lbs parcel weight is 60 $ DC1 = 20 qty Example # 2: When locations can fulfill few lines completely but not complete order and "Consider Actual Weight" is enabled Shipping Cost: Zone 1: DC1 is eligible, Zone 2: DC2 is eligible Zone From Weight To Weight Shipping Cost Zone 1 0 20 30 $ Zone 1 20 200 40 $ Zone 2 0 20 20 $ Zone 2 20 200 60 $ Supply: Location Item Quantity DC1 Item A 10 DC1 Item B 10 DC2 Item B 10 DC2 Item C 10 Allocation: Ordered Quantity Shipping Cost Comparison Allocation Item A = 1, Volumetric Weight = 5 lbs Item B = 1, Volumetric Weight = 10 lbs Item C = 1, Volumetric Weight = 15 lbs Zone 1: DC1 for Item A & Item B = 1 X 5 + 1 X 10 = 15 lbs parcel weight is 30 $ Zone 2: DC2 for Item B & Item C = 1 X 10 + 1 X 15 = 25 lbs parcel weight is 60 $ Hence, DC1 will be selected for Item A & Item B Zone 2: DC2 for Item C = 1 X 15 = 15 lbs parcel weight is 20 $ Hence, DC2 will be selected for Item C DC1: Item A = 1 qty Item B = 1 qty DC2: Item C = 1 qty Carrier: Shipping is done using carriers such as UPS, Fedex, and so on. This is provided in the Promising request. Service level: The service level used to ship the parcel. For example, ground, 1-day service, or 2-day service. This is provided in the Promising request. Finding the shipping cost: A call to the parcel component (API - GET {{url}}/parcel/api/parcel/shippingCostList) is made from within the optimization algorithm to find the shipping cost of all the potential locations from the top group. The following set of information is expected from the parcel component to find the shipping cost. Origin Details: Location details (Country, Postal code, Location ID ) considered for allocation Destination Details: Destination address where the item needs to be shipped (City, State, Country, Postal code) Carrier/Service level: The carrier and service level used for shipment from the origin location Weight: The weight of the items considered for shipment. Compute Shipping Cost - Sample request{{url}}/parcel/api/parcel/shippingCostList { "ShippingCostRequestList": [ { "CarrierId": "UPS", "ServiceLevelId": "UPS_GROUND", "Weight": 1, "Origin": [ { "LocationId": "ecomorg:AtlantaDC", "CountryCode": "US", "CarrierCode": "UPS", "ServiceLevelCode": "UPS_GROUND", "ZipCode": "94130" } ], "Destination": { "ZipCode": "75200", "CountryCode": "US" } } ] } Note: If an Org Location is not defined for a location, the shipping cost is defaulted to 10000.00 to give the location less preference. If a Shipping lane/zone doesn't exist, then Shipping cost is considered as $0. Refer to the below section to understand how Shipping cost is computed with some examples. Compute Shipping Cost - ExamplesRegion: Consider the below Region set up Region Type (Zip code for US). Zip code can be 9 digit, 5 digit or 3 digit zip code. Region Type "Location" for Canada Region Type "Country" for France. Region Schema Name Region Name Region Type Country code Zip start Zip end City State Location France Schema France Country FR Canada Schema Toronto Store Location Store 1 Canada Schema Ottawa Store Location Store 2 US Schema 300 Zip code US 30000 30099 US Schema 301 Zip code US 30100 30199 US Schema 30339 Zip code US 30339 30339 US Schema 30144A Zip code US 30144 30144 US Schema 30144B Zip code US 301440000 301449999 Region is selected based on the more granular data available. Following is the order of the preference - Location, Zip Code (9 digit, 5 digit and 3 digit), City, State and finally Country. Carrier Zone: Consider the following zone/lane setup. Create lane and zones for every required "Origin Region" and "Dest. Region" combinations (for all applicable Carrier, Service levels) Lane ID Zone ID Carrier Service Level Origin Region Destination Region Comments FR-FR FR-FR UPS Ground FR FR France TR-OT TR-OT UPS Ground Toronto Store Ottawa Store Canada Stores OT-TR OT-TR UPS Ground Ottawa Store Toronto Store Canada Stores 300-301 300-301 UPS Ground 300 301 301-300 301-300 UPS Ground 301 300 300-30339 300-30339 UPS Ground 300 30339 30339-300 30339-300 UPS Ground 30339 300 30339-30144A 30339-30144A UPS Ground 30339 30144A 30339-30144B 30339-30144B UPS Ground 30339 30144B 300-30144A 300-30144A UPS Ground 300 30144A Carrier Zone selection: For the below Origin and Destination details in the Order/promising request, below lanes/zones will be considered Origin Details Dest. Details Zone/Lane considered Comments 30339 30144 30339-30144A There is a matching Region (30144A) for Destination zip code "30144" 30339 334015513 30339-30144B For Destination zip code "334015513" - Since there is region with 9 digit zip code, system considers Region 30144B. 30339 300569999 30339-300 For Destination zip code "300569999" - Since there is no region with 9 digit or 5 digit zip code, system considers the next granular Region which is Region 300. 30100 300569999 301-300 For Origin zip code "30100" - Since there is no region with 5 digit zip code, system considers the next granular Region which is Region 301. For Destination zip code "300569999" - Since there is no region with 9 digit or 5 digit zip code, system considers the next granular Region which is Region 300. 30100 30339 No Lane exists Though Regions exist for the Origin zip code and Destination zip code but no lane/zone exists for this Origin and Destination region. 300569999 334015513 300-30144A For Origin zip code "300569999" - Since there is no region with 9 or 5 digit zip code, system considers the next granular Region which is Region 300. For Destination zip code "334015513" - Since there is no region with 9 digit zip code, system considers the next granular Region which is Region 30144A (5 digit zip code). France Paris Zip - 75000 France Marseille Zip - 13000 FR-FR For Origin and Dest. - Since there is no region with zip code and city, system considers the next granular Region which is Region "FR". Lane FR-FR exists, so it is used. Ship from: Store 1 Canada Toronto Ship to: Store 2 Canada Ottawa TR-OT Once a zone is selected, Shipping rate should exist for the selected zone. If not, the Shipping rate response will be empty. Zone Shipping Rate: Consider the below shipping rate Zone ID Carrier Service Level From Weight To Weight UOM Currency Rate FR-FR UPS Ground 0.01 10 lb EUR 10 FR-FR UPS Next Day 0.01 10 lb EUR 20 TR-OT UPS Ground 0.01 10 lb CAD 5 OT-TR UPS Ground 0.01 10 lb USD 5 300-301 UPS Ground 0.01 10 lb USD 3 301-300 UPS Ground 0.01 10 lb USD 3 300-30339 UPS Ground 0.01 10 lb USD 4 300-30339 UPS Ground 10.01 20 lb USD 8 30339-300 UPS Ground 0.01 10 lb USD 4 30339-300 UPS Ground 10.01 20 lb USD 8 30339-30144A UPS Ground 0.01 10 lb USD 6 30339-30144B UPS Ground 0.01 10 lb USD 6 It is recommended to clear the Parcel cache once the Region, Zone, Zone shipping rates are configured in the Parcel DELETE : - {{url}}/parcel/api/framework/cache/clearCache/zoneCache Example 1 - Origin Details: 30339 Destination Details: 300569999 Carrier, Service level: UPS - Ground Weight: 1 lb Zone Selected: 30339-300 Shipping Rate computed: $4 Example 2 - Origin Details: 30339 Destination Details: 300569999 Carrier, Service level: UPS - Ground Weight: 12 lb Zone Selected: 30339-300 Shipping Rate computed: $8 Example 3 - Origin Details: Zip code-75000, Country - France (FR) Destination Details: Zip code-13000, Country - France (FR) Carrier, Service level: UPS - Next day Weight: 4 lb Zone Selected: FR-FR Shipping Rate computed: EUR 20 Example 4 - No Zone/Lane available Origin Details: 300569999 Destination Details: 334015513 Carrier, Service level: UPS - Ground Weight: 4 lb Zone Selected: 300-30144A Shipping Rate computed: Empty as there is no shipping rate configured Example 5 - No Shipping Rate configured for the Zone Origin Details: 30100 Destination Details: 30339 Carrier, Service level: UPS - Ground Weight: 4 lb Zone Selected: No Lane/zone exists Shipping Rate computed: Empty as there is no lane/zone configured Handling Cost The cost of handling the item in the location where fulfillment occurs. The handling cost (or labor cost) is the average cost which a retailer must pay to handle an order (pick, pack, and so on) in a location. Typically, this cost factor provides an advantage to DCs since the labor cost in DCs is less expensive than stores. The handling cost is configured as an average cost per order for the location. Finding the Handling cost: Promising makes a call to the Inventory component to find the labor cost of all the potential locations from the top group. The handling cost is configured in the Labor Cost and Labor Cost UOM fields on the Inventory Location UI. Note: In an ideal world, the labor cost of handling orders with different number of lines are different. The labor cost data setup is the average cost per order and is not dependent on the number of order lines which are considered for allocation against the location. The configured handling cost represents an average cost per order and is not dependent on the number of order lines or quantity. If configured as one of the factors to use in optimization, handling cost must be configured for each location in the system. Inventory Assortment The Optimization factor "Inventory Assortment" is a hard cost validation to differentiate locations with existing supply records. This optimization factor, when selected, will ensure that locations that maintain a supply record for at least one item on the return order are prioritized over locations that do not maintain supply. For example: Value = $10000 if there is no supply record for any items in the orders. This ensures that all locations without supply records are considered last. Value = $0 if there is a supply record for any items in the order. This ensures that all locations with a supply record are considered in priority. Inventory assortment cost is used in the main below use cases: For order promising, in case force allocation is configured in the prioritization tier, this optimization factor ensures the system prioritizes locations that assort the item during foce allocation. For return optimization, it ensures that the location selected for returning the order assort the item. Soft Costs Soft costs (or preferences) do not have a direct impact on the cost of fulfillment but can be modeled to apply an indirect cost. These preferences do not have direct impact on the cost of fulfillment, but there is a soft cost (indirect cost) associated with each of them. For example, retailers may prefer to choose locations with lower capacity utilization in order to balance overall fulfillment workload. In this case, a retailer can associate a cost (or penalty) to locations as utilization increases. A score is assigned for each soft cost factor used. Refer How to set up Optimization for more details. Soft costs must be related to a hard cost (shipping cost, handling cost) in order to define their influence on the optimization decision. In case, hard cost is not available in the same or preceding optimization level then a default cost is used for evaluating the soft cost. Default cost can be configured in the Fulfillment Optimization configuration. Refer to Evaluate soft cost for more details. The following preferences can be considered in the allocation optimization decision: Fulfillment Capacity Utilization A retailer may have a preference of selecting a location with a lower capacity utilization when fulfilling an order to balance the workload among locations. This can be achieved by modeling a cost for locations with high utilization. Refer to How Capacity works for additional information related to location capacity. Capacity preference tries to balance the workload by allocating the next order to a low utilized location (location with a low backlog). For a location, if the capacity utilization is 0%, then it is a favorable condition. For a location running at 100% capacity utilization, it is not a favorable condition. If ANF is configured to perform optimization based on capacity, only then ANF will try to give preference to stores where max backlog is not reached. Finding the capacity utilization: The capacity utilization values are stored in inventory for each location (Location Capacity Utilization). Location utilization capacity is updated as part of Order Allocation, De-allocation, Ship and Short. Promising component makes a call to the inventory component (API - GET {{url}}/inventory/api/inventory/capacity/locationCapacityUtilization/locationId/<LocationID>) to get the max backlog and the current backlog and computes the capacity utilization percentages for each location. Refer to Evaluate soft cost section for details on how cost is computed. Inventory Level If a location has a high stock level for a particular item, there is a higher likelihood that the item may become distressed and marked down. Retailers may prefer to allocate such inventories first. The inventory level (or days of supply) represents the number of days of inventory present in the store. The inventory level is the same as the forecast for the current on hand available inventory. A retailer may prefer to allocate an item from a store with a high inventory level to possibly help prevent a future price markdown for the item at that location. Location(s) with higher Inventory Level will be given preference. Note: The inventory level represents the expected item life in the location and not the actual available quantity. The following are the factors which play a role in determining the Inventory level. Days of supply multiplier: The days of supply multiplier defines the number of days a single unit of inventory takes to be sold in the store. The multiplier is defined for every item-location combination. It is recommended that the days of supply multiplier are refreshed frequently (i.e., daily) based on selling data. It’s a factor by which the available quantity should be multiplied to get the days of supply for a store. In order for promising to make reliable optimization decisions, the days of supply multiplier information must be specified for all the items at all locations where the item is present, and the feed should be updated frequently. This is configured in the Item Location Configuration UI or imported directly using the Item Location API (Attribute name - DaysOfSupplyMultiplier; API - {{url}}/inventory/api/inventory/itemLocationConfig). Note: If the Days of Supply multiplier is not populated or there is no entry for the Item Location config, then the Days of supply multiplier is assumed to be zero. There is no configuration to default the Days of supply multiplier to other than zero if not set on the Item-Location configuration. Available Quantity: Total On Hand Quantity - Total On Hand Allocated Quantity (across all on hand supply type). Available quantity is considered as zero if there is no On Hand quantity available or no Supply record found for the Item-Location combination. Days of supply: The number of days the total inventory in the store is expected to last. Days of supply are the same as the forecast for the current on hand available. The days of supply for an item are calculated by multiplying the available quantity by the days of supply multiplier for that item/location: Days of Supply = Available Quantity * Days of Supply Multiplier Calculating the Days of supply statistics (mean, standard deviation): When the days of supply are calculated for all the locations for the item, the mean and the standard deviation are calculated for the data set.  Using the days of supply and available inventory, the mean and standard deviation of the data is calculated daily (by Scheduler job -  DaysOfSupplyStatisticsSchedulerJob) for all the items at all the locations. This job picks up all unique items from supply and calculates the days of supply statistics. Note that Item, Location which doesn't have Days of supply multiplier populated, No Item-Location config entry, No On Hand supply still participates in the statistics computation. There are two options to provide the means and the standard deviation for the above calculation. When the days of supply are calculated for all the locations for the item, the mean and the standard deviation are calculated for the data set by a jobSchedule ‘DaysOfSupplyStatisticsSchedulerJob’ which does this computation. The Days Of Supply Statistics Scheduler Job needs to run daily to update the day of supply statistics for all items in all locations. As it is a heavy process, it is recommended that this job is scheduled after the supply sync process is finished. It should only run once a day. When the days of supply are calculated for all the locations for the item, the mean and the standard deviation are bridged from external system by a REST API - "daysOfSupplyStatistics" Sample Scheduler set up - DaysOfSupplyStatisticsSchedulerJob Recommendation: Can be run once a day post Item price updates { "JobScheduleId": "DaysOfSupplyStatisticsSchedulerJob", "JobTypeId": "DaysOfSupplyStatisticsSchedulerJob", "CronExpression": "0 0 0 1/1 * ? *", "StartDelay": 1000, "RepeatInterval": 20000, "TriggerKey": "DaysOfSupplyStatisticsSchedulerJobTrigger", "IsDisabled": true } In order for promising to make reliable optimization decisions, the days of supply multiplier information must be specified for all the items at all locations where the item is present, and the feed should be updated frequently. Calculating the Deviation: Promising makes a call to the Inventory component to get the days of supply statistics (mean standard deviation) for the Item (which is computed across all locations). These details are computed upfront using the data of supply statistics job scheduler. API - GET {{url}}/inventory/api/inventory/daysOfSupplyStatistics/itemId/{{ItemId}}) is used to fetch the mean and the standard deviation for the Item, which is then used to calculate the deviation and inventory level score. Note that the mean and standard deviation are calculated for all Item(s) across all Location(s). But during promising, only a subset of locations may participate in the optimization process. Deviation is calculated as (Days of Supply - Mean)/Standard Deviation If the deviation value is high, then the preference is favorable for the location (if using the default graph in Fulfillment Optimization UI). This means that the stock level for the location is on a higher side and should be considered first for allocation. If the deviation is lower (if using the default graph in Fulfillment Optimization UI), then the preference is not in favor for the location. If "Extend Inventory Level" is set to true, then a range of -10 to 10 standard deviations can have different scores while configuring the graph in Fulfillment Optimization UI for Inventory Level. Refer to Evaluate soft cost section for details on how cost is computed. Item Velocity Item Velocity is a store-level metric used to enhance replenishment accuracy by adjusting the Days of Supply (DOS) based on recent sales performance. This feature applies only to stores (not distribution centers) and evaluates how quickly an item is selling over a fixed 7-day window. The goal is to dynamically scale replenishment quantities in line with item movement, improving inventory turns and reducing stockouts or overstocks. The system assigns greater importance to more recent sales through fixed weightages, resulting in a weighted sales score that is mapped to a multiplier. This multiplier is then used to calculate adjusted Days of Supply for procurement and planning purposes. The Item Velocity can be configured via Fulfillment Optimization. Days of Supply Multiplier The Days of Supply Multiplier is calculated using weighted sales across the last 7 days, with fixed weightages assigned as follows: Day Weightage Most recent day (Day 1) 79% Day 2 6% Day 3 5% Day 4 4% Day 5 3% Day 6 2% Day 7 1% The system multiplies each day’s sales by the corresponding weightage and sums the results to generate a weighted sales score. This score determines the velocity tier for the item, which maps to a predefined multiplier. For example: Weighted Sales Score = (Sales_Day1 × 0.79) + (Sales_Day2 × 0.06) + ... + (Sales_Day7 × 0.01) Based on the score, the system selects a multiplier from a configured mapping (example, 2×, 5×, 10×), with higher multipliers applied to fast-moving items. Days of Supply Calculation The adjusted Days of Supply are calculated using the formula: Days of Supply = Base DOS × Velocity Multiplier Base DOS is a constant (e.g., 1 or 2 days) defined by system configuration or business rules. Velocity Multiplier is derived from the item’s weighted sales over the past 7 days. This ensures that faster-moving items are replenished with a higher DOS to prevent stockouts, while slower-moving items are stocked more conservatively. Rejection Rate Retailers may prefer promising orders from locations with higher performance levels in order to decrease the likelihood of an order being delayed due to order rejection. Rejection rate captures the number of orders rejected by a location in the past. A retailer may prefer to allocate an order against a location with a low rejection rate to decrease the chance of the order being delayed. The rejection rate is calculated as the percentage of orders rejected in the last 30 days. For example, if the number of orders placed at a location during the time range is 500, and the number of orders rejected from that location is 80, then the reject rate is calculated as 80/500 = 16%. Even if a single unit from an order is rejected, the location is considered to have rejected the order. Location(s) with less rejection rate will be given preference. Finding the rejection rate: Rejection rate is calculated by the number of shorts that happened for the last 30 days average. Scheduler (Location Performance Job) computes this data based on the Order Event - Short. Rejection rate is computed irrespective of the short reason code (customer cancellation, Inventory short etc.). Rejection rate calculation (Short reason code and Number of days average) is currently not configurable. The promising component makes a call to the inventory component to get the rejection rate percentages. Refer to Evaluate soft cost section for details on how cost is computed. Sample Scheduler set up - locationPerformanceJob { "JobScheduleId": "locationPerformanceJob", "JobTypeId": "locationPerformanceJob", "CronExpression": "0 0 0 1/1 * ? *", "StartDelay": 1000, "RepeatInterval": 20000, "TriggerKey": "locationPerformanceJobTrigger", "IsDisabled": true } Location Proximity Retailers may prefer fulfilling an order from a location which is closer to the destination. This preference usually results in a less expensive fulfillment and faster delivery. This can be modeled by increasing the location proximity cost as the shipping distance increases. Location closer to the destination will be given preference. The distance is calculated as the difference in latitude/longitude between the location and the destination. Distance is always calculated in terms of Miles and cannot be configured as km, Yard, feet, and so on. Finding the shipping proximity: The Promising Component makes a call to the Geo Component to get the latitude longitude value of a location and the destination. It uses a simple standard formula to calculate the distance between the location and the destination. In Geo component, postal codes can be loaded using the API "/api/geo/loaddata". US Postal code is provided as part of seed data. Refer to the below section on how to load postal codes How to Load Postal codes?When using Manhattan’s Active Omni application for either Geo-proximity based sourcing and allocation (based on lat/long of sources and destinations) Radius based store look up the application requires city/state/zip code/lat & long data to be pre-loaded and maintained. If a customer order has a particular city/state/zip as its destination, that city/state/zip must exist in the application’s base data in order for store look up and/or geo-location based sourcing to work properly. Although Manhattan provides pre-loaded sample data (source: Geonames https://www.geonames.org/) for use during initial system installation, pilots, and so on, it is strongly recommended to establish a reliable external source for this data and to build a plan to refresh this data on a periodic basis, for example, yearly. Upon receipt of this data, it can be formatted and loaded into the Active database using an exposed upload API. Check the postal code GPS coordinates: API: GET : {{url}}/geo/api/geo/zipdetails/{{country code in 2 letters}}/{{postal code}} Token: System admin Upload the postal code data in the Geo Component To upload data in the Geo component, an API is exposed to load csv data from a file. POST: {{url}}/geo/api/geo/loaddata Postman Collection: Select the POST request, in the "body" section, select "form-data". in "KEY", type in 'zipCodeData' and value, Browse to the postal data file. Postal code samples can be downaloded from http://download.geonames.org/export/zip/ Refer to Evaluate soft cost section for details on how cost is computed. Location proximity does not support distances of more than 5000 miles. Selling Price Differential The selling price differential is only applied to stores since they can offer a different price to in-person customers. Selling price differential case can either be positive or negative. For example, assume that the e-commerce price of an item is $10, but in a particular store the same item sells for $12. In this case, fulfilling the e-commerce order from the store may result in a $2 loss for the retailer, since the item could have been sold in store for $12. This adds a 2$ cost impact to the overall cost of fulfillment. However, in cases of distressed inventory in the store, the e-commerce price may be greater than the price at a particular location. In this case, there is a negative cost impact to fulfilling from the store since it is desirable to use this inventory. Say for example, e-Com price of an item is 10$ and in a store that item is selling at 8$, then fulfilling the e-Com order from the store may result in a 2$ profit for the retailer, because had that item been sold in the store, the retailer could have potentially made just 8$. This adds a 2$ negative cost impact to the overall cost of fulfillment. This will apply only when Selling price differential is selected as part of Fulfillment Optimization Config - Optimization. Refer How to set up Optimization for more details. Finding the Selling Price Differential: Selling price margin (Attribute name - priceMargin) is maintained in the Item Location Config (API - {{url}}/inventory/api/inventory/itemLocationConfig). Price margin (if not set) would be considered as zero for the corresponding Item and Location combination. Scheduler (priceMarginJob) updates the price margin cache for the Price Margin present in Item Location Config. Promising component makes call to the Inventory component from within the optimization engine to get the Selling price margin for the items for the location considered in the top group. If multiple items of the order are being considered from the location, the total selling price differential is the sum of all item differentials being considered at the location. If Store1 is considered for Item A and Item B, and Store 2 is considered for Item B and Item C, then the total selling price differentials for each location are Selling Price Differential of Store1 = Selling Price Differential of Item A + Selling Price Differential of Item B Selling Price Differential of Store2 = Selling Price Differential of Item B + Selling Price Differential of Item C This is the price margin which a retailer may gain or lose if an item is shipped from a store instead of a distribution center. Selling price differential is the difference of selling price of an item at a location compared to the e-commerce price: Selling Price Differential = Store Price - E-commerce Price Sample Scheduler set up - priceMarginJob Recommendation: Can be run once a day post Item price updates { "JobScheduleId": "priceMarginJob", "JobTypeId": "priceMarginJob", "CronExpression": "0 0 0 1/1 * ? *", "StartDelay": 1000, "RepeatInterval": 20000, "TriggerKey": "priceMarginJobTrigger", "IsDisabled": true } Optimization - Cost Evaluation Factor Groups A user can configure a factor group with only a few factors to be evaluated to compare locations and find the best among them.  Say for example, if few costs and preferences are deemed as the most important factors to be used, user can configure only those factors. Factor group cost is calculated as (only applicable for the configured costs, preference and price differential). Factor group cost = Total Hard Cost * Total Preference Score + Selling price differential Multiple Optimization Levels The objective of using the factor group is to find the best location using the factors configured. But it is quite possible that there can be a few other locations which are very close to the best in terms of the overall cost and cannot be simply ignored. Tolerance level is a threshold limit to find the top locations which fall within the tolerance limit of the best location. If the best location found using a factor group has a total fulfillment cost as 10$ and the tolerance level is configured as 20%, then all the locations with a factor group cost of 12$ (10 + 20% *10) or less are considered as the top locations found from a factor. When multiple optimization levels are used, a tolerance level is defined between each optimization level. All locations that fall within the defined tolerance range from the best location that is found are forwarded to the next level for further evaluation. Depending upon the tolerance level configured, an optimization level evaluation can result in finding one top location or a list of top locations. If a single top location is found, then the optimization process completes. However, if a list of locations is found as a result of optimization level evaluation, they are evaluated using the next optimization level. The process completes only when the algorithm finds one top location as the output of optimization level evaluation. The output of the last optimization level is also the single best location. If there are multiple location(s) with the same cost post the evaluation, then a random location is picked up (not in any specific order) from the final optimized list of location(s). Refer to the below section for more details. Tolerance level - Location EvaluationConsider the following Optimization factors (Multi level) Optimization Level 1 TOLERANCE LEVEL=10% Optimization Level 2 Shipping Cost Shipping Cost Fulfillment Capacity Utilization Fulfillment Capacity Utilization Inventory Level Inventory Level Handling Cost Handling Cost Rejection Rate Rejection Rate Location Proximity Location Proximity Selling Price Differential Selling Price Differential Whenever there are more than one level of optimization, evaluation is done for first level and all location costs are compared based on the tolerance % defined to decide if the next level should be evaluated or not. Example 1 - Consider the cost of the location(s) as below post Level 1 evaluation Location 1 - $7.5, Location 2 - $8.3, Location 3 - $8.3 Tolerance will be 10% of the least cost which is 7.5$= 0.75$ Check if any other location(s) whose cost that falls within Lowest cost+ tolerance=7.5+0.75=> 8.25. In this example, since there are no other location in the Tolerance zone, Location 1 is selected and Optimization level 2 is not evaluated. Example 2 - Consider the cost of the location(s) as below post Level 1 evaluation Location 1 - $7.5, Location 2 - $8, Location 3 - $8.1 Tolerance will be 10% of the least cost which is 7.5$= 0.75$ Check if any other location(s) whose cost that falls within Lowest cost+ tolerance=7.5+0.75=> 8.25. In this example, all three location(s) fall within the Tolerance zone, so all three location(s) are again evaluated based on Optimization level 2 settings. This process is repeated for all Optimization levels. At any stage, if system finds an optimal location then it is selected for Promising. If there are multiple location(s) with the same cost post the evaluation then a random location is picked up from the final optimized list of location(s). Evaluate Soft Cost Soft costs must be related to a hard cost (shipping cost, handling cost) in order to define their influence on the optimization decision. In case, hard cost is not available in the same or preceding optimization level then a default cost is used for evaluating the soft cost. The default cost can be configured in the Fulfillment Optimization configuration. By default, cost is $6 and this can be changed in the Fulfillment Optimization configuration. Updated Default cost is used for soft cost evaluation if there are no hard cost in the same or preceding optimization level. Note: Though the Default cost can be changed to any value for cost calculation but the default value representing the visual graph (for illustration of soft cost) will always be based on default cost of $6. Refer How to set up Optimization for more details. If an optimization factor group has both hard and soft cost factors defined, the soft cost impact is evaluated based on the hard costs configured at the same level (group). If hard cost is present in the same level, then any cost from previous level(s) is not used. If only soft costs are defined for the level with at least one of the previous optimization levels having a hard cost configured, the soft cost impact is evaluated based on the hard cost of the optimization level that is immediately preceding the current level. If only soft costs are defined for the level and none of the previous optimization levels have a hard cost configured, a default cost will be used for evaluating the soft cost impact. The default cost can be configured for an optimization level. If hard cost is configured as zero, then the soft cost will also be calculated as zero If hard cost is configured as null, then the soft cost will be calculated based on the default cost "$6" Consider the following Fulfillment Optimization configuration: Optimization Level 1 - Shipping Cost, Optimization Level 2 - Handling Cost, Location Proximity While calculating Level 2, Hard cost (Handling cost) alone is used to calculate the Location proximity cost Consider the following Fulfillment Optimization configuration: Optimization Level 1 - Shipping Cost, Handling Cost, Optimization Level 2 - Location Proximity While calculating Level 2, Hard cost (Both Shipping & Handling cost) is used to calculate the Location proximity cost Example: Optimization level 1 has Shipping Proximity factors configured. In this case, a default cost is required to do the calculation for cost impact for each of the factors, as no hard cost was configured in this optimization level. Optimization level 2 has Capacity Utilization factors configured. In this case, a default cost is required to do the calculation for cost impact for each of the factors, as no hard cost was configured in this optimization level. Optimization level 3 has Handling cost configured. In this case, a default cost is not required to do the calculation for cost impact for the capacity utilization factor as a hard cost was configured in this optimization level. Optimization level 4 has Inventory Level factors configured. In this case, a default cost is not required to do the calculation for cost impact for the Inventory Level as the Handling cost which is a hard cost from the preceding level is used. Optimization level 5 has Rejection Rate & Shipping cost factor configured. In this case, a default cost is not required to do the calculation for cost impact for the Rejection Rate as a hard cost is configured in the current level. Even if the Hard cost (Shipping cost) is not configured in this level, still default cost will not used as one of the preceding optimization level has hard cost configured (Handling cost at Level 3). Optimization Level Cost Factors Soft Cost Impact Level 1 Shipping Proximity Default Cost - As there are no hard costs in same level Level 2 Capacity Utilization Default Cost - As there are no hard cost in the same level and preceding levels Level 3 Handling Cost Hard Cost Level 5 Inventory Level Hard Cost - The Handling cost which is a hard cost from the preceding level is used. Level 4 Rejection Rate & Shipping Cost Hard Cost - As Shipping Cost is a hard cost available on the same level Note: Since soft cost is dependent on the hard cost configured at the same level or preceding level, there is a possibility of the soft cost to be different for Locations even though the factors (Distance, Inventory level, Capacity utilization, and so on) are same. Example - If Store 1 & 2 have identical address and have the same Shipping cost but different handling cost then the location proximity cost will be different for both stores as it is dependent on the hard cost (Shipping and Handling cost) Cost Carry forward between factors: One factor can be configured in only one group. This means that the Factor group cost from each factor group is different. But the cost from all the previous factor groups are carry forwarded to the current group to find the total cost of fulfillment. Refer to the below section for more examples on Optimization cost evaluation Optimization - Cost Evaluation (Examples)Consider the following Location details to Ship to a specific postal code Location Shipping cost Handling cost Proximity Capacity Utilization Inventory Levels Rejection Rate Selling price diff. Location 1 $5 $3 100 miles 60% High 70% $0 Location 2 $6 $1 800 miles 70% Medium 70% $0 ANF Default cost = $6 Example 1 - ANF is configured with only Hard cost - "Shipping cost" (One Level) Level Factors Weight Level 1 Shipping cost na Total cost of fulfillment for a Location is computed using the actual cost. Factor cost: Location 1: $5 Location 2: $6 Location 1 is considered as the total cost of fulfillment is less than Location 2 Example 2 - ANF is configured with only Hard cost - "Shipping cost" & "Handling Cost" (One Level) Level Factors Weight Level 1 Shipping cost na Level 1 Handling cost na Total cost of fulfillment for a Location is computed using the actual cost (Shipping cost + Handling cost) Factor cost: Location 1: $5  + $3  = $8 Location 2: $6 + $1  = $7 Location 2 is considered as the total cost of fulfillment is less than Location 1 Example 3 - ANF is configured with only Soft cost - "Location Proximity" (One Level) Level Factors Weight Level 1 Location Proximity 100% Since no hard cost is available for evaluation, Total cost of fulfillment is computed using default cost which is $6 Cost impact for 100 miles would be around -$5.8 and 800 miles would be around -$4 Location 1 is considered as the total cost of fulfillment is less than Location 2 Example 4 - ANF is configured with Hard cost - "Shipping cost & Handling cost" (Level 1) and Soft cost - "Location Proximity" (Level 2). Location with 25% Tolerance alone is evaluated using Level 2 factors Level Factors Weight Level 1 Shipping cost na Level 1 Handling cost na Tolerance 25% Level 2 Location Proximity 100% For Level 1 - Total cost of fulfillment for a Location is computed using the actual cost. Factor cost (Level 1) Location 1: $5  + $3  = $8 Location 2: $6 + $1  = $7 Post Level 1, Location 2 is cheaper than Location 1 but since both Location 1 and Location 2 cost falls within 25% tolerance, both the location(s) are again evaluated using Level 2 Factors (Location proximity) Factor cost (Level 2) - Since a hard cost is available at Level 1, Hard cost from Level 1 is used for evaluating the soft cost instead of Default cost "$6" Location 1: It is around 100 miles. So for default cost "$6", proximity cost was calculated as -$5.8. For Hard cost (from Level 1) $8, proximity cost would be around -$7.73 Location 2: It is around 800 miles. So for default cost "$6", proximity cost was calculated as -$4. For Hard cost (from Level 1) $7, proximity cost would be around -$4.67 Overall Cost of Fulfillment post Level 1 and Level 2 evaluation Location 1: $8 (Level 1) + -$7.73 (Level 2) = $0.27 Location 2: $7 (Level 1) + -$4.67 (Level 2) = $2.33 Location 1 is considered as the total cost of fulfillment is less than Location 2. Example 5 - ANF is configured with Soft cost - "Capacity Utilization" (Level 1) and Soft cost - "Location Proximity" (Level 2). Location with 25% Tolerance alone is evaluated using Level 2 factors Level Factors Weight Level 1 Capacity Utilization 100% Tolerance 25% Level 2 Location Proximity 100% For Level 1 - Since no hard cost is available for evaluation, Total cost of fulfillment is computed using default cost which is $6 Factor cost (Level 1) Location 1: approx $3 Location 2: approx $4 Post Level 1, Location 1 is cheaper than Location 2 but since both Location 1 and Location 2 cost falls within 25% tolerance, both the location(s) are again evaluated using Level 2 Factors (Location proximity) Factor cost (Level 2) - Since there is no hard cost is available at Level 1, Default cost $6 is again used for evaluating the soft cost Location 1: It is around 100 miles. For default cost "$6", proximity cost was calculated as -$5.8. Location 2: It is around 800 miles. For default cost "$6", proximity cost was calculated as -$4. Overall Cost of Fulfillment post Level 1 and Level 2 evaluation Location 1: $3 (Level 1) + -$5.8 (Level 2) = -$2.8 Location 2: $4 (Level 1) + -$4 (Level 2) = $0 Location 1 is considered as the total cost of fulfillment is less than Location 2. At the end of the optimization, location with the least total cost of fulfillment is selected for Promising. In case, there are multiple location(s) with the same cost of fulfillment at the end of this process then location is picked up in a random manner from the short listed location(s). No Optimization Configuration - Optimization is an optional step. If a retailer does not configure any optimization rules, a basic optimization is still performed which attempts to reserve inventory from the location that can fulfill the highest number of lines. The first location found that can fulfill the most lines is selected, and further optimization analysis is not performed. Merge Shipment - Optimization Merge shipment is a concept where the order is merged or consolidated at a location before the final shipment to the customer. In a merge scenario, the order is merged at the merge location, also called as merge node. It can be a regular distribution center or a specialized consolidation location. Order hopping is another concept where the order shipment hops from one location to another before being shipped out to the customer. This need not necessarily be an order consolidation scenario. The entire order can be shipped from the origin location and then hops through the nodes before being finally shipped. Reasons for order consolidation: There are few reasons for consolidation of an order. One of them is saving the shipping cost by optimizing the consolidation route. The other benefit is improving the customer service by delivering the order in one go. Also, there are certain products which logically needs consolidation before being shipped out, say for example a laptop and the laptop carrying case. Reasons for order hopping: It may not be necessary, but in certain cases, order hopping may result in an optimized shipment. For example, if the order is shipped from the origin to the destination using an external carrier service, it might incur a high shipping cost. Instead, if the order is hopped internally to a location which is geographically closer to the destination using the internal carrier, and the final leg shipment being done using the external carrier, the shipping cost incurred might be very cheap. In certain cases, order hopping is required as the origin location does not have an external carrier shipping facility. Say for example, a satellite Distribution center may always ship to the main Distribution center thus making the main DC as the hopping node for the satellite DC. For all purpose, the order management concept for both order consolidation and order hopping is called merge shipment. A typical merge shipment scenario involves Origin location – The location where the inventory is present Merge Location (or locations) - The consolidation node or the hop node Destination – The destination where the order needs to be shipped Note: when merge leg is shipped, by default, system always creates ASN with supply type as InTransit. Currently, we do not support mapping of ASN to any other supply type. The delivery path between each node is called a leg. The leg where the order is shipped to a merge location is a merge leg. This means that all the legs except the final leg are merge legs. The final leg is called delivery leg, where the final delivery happens. Is Site to store scenario a merge scenario? In true sense, a site to store scenario is not a merge scenario as there are no intermediary merge location. But a site to store scenario involves two legs of fulfillment. The first leg is where the order is shipped from the origin location to the store. The second leg is the one where the customer picks the order from the store. Since it involves multiple legs of fulfillment, a parallel can be drawn between a merge shipment and a site to store scenario. Hence, the first leg in the site to store scenario becomes a merge leg, and the second leg becomes a pick-up leg (not a delivery leg) Note: • It is important to note that in merge shipment scenario, both the merge and the delivery leg will use the same shipping method provided in the order line. The only exception to this rule is Ship to store scenario for which the pick-up leg does not need a shipping method as no carrier is involved in picking up the order. • If a Site to Store(STS) order is created and there is inventory for the item at Pickup store, the merge leg is not created, and a Pickup Release leg is created directly for the pickup store to process. Supported merge flows - The following flavors of merge shipment are supported. Merge location and origin location provided on the order lines: This is a scenario where both merge location and origin location are provided on the order line. Merge Shipment - Use case 1 Consolidation Location Ship From Location When the merge location, also known as the consolidation location, is provided on the order line, promising treats this merge location as the last merge node from where the final shipment needs to happen. When the origin location is provided on the order line, promising allocates the order from this location. When both consolidation center and the ship from location are provided on the order line, the shipment route is as follows Merge location provided on the order and promising decides the origin location by using optimization algorithm: This is the scenario where only the merge location is provided on the order line. The promising logic determines the ship from location. Since the origin location is not provided on the order line, the optimization algorithm is called to determine the best location. Note: The algorithm logic works as per the matching Promising Strategy found. If no configuration found, then the reservation can happen from any available location which can fulfill the maximum number of lines. Refer to the below section on how the best location is determined Merge Shipment - Use case 2To determine the best location, system finds the most optimized route of fulfillment. Let’s consider a scenario where there are three location from where the reservation of an order can potentially happen. Hence the following fulfillment routes are possible. Fulfillment Option 1 Fulfillment Option 2 Fulfillment Option 3 The objective of the algorithm is to find the most optimized fulfillment route among these routes. The cost of fulfillment for any of these routes, i.e., Cost of Fulfillment = Cost of Merge Leg + Cost of Delivery Leg Since the second leg is common for all the options, the cost of this leg can be ignored from all the options to find the most optimized route. Hence, only the cost of the merge leg is used to compare the three options. The cost calculation for factors are done as follows Shipping Cost:  The cost of shipping from the origin to the consolidation center Shipping Proximity: Cost of location proximity from the consolidation center Handling Cost: The cost of handling at the origin location Fulfillment Utilization Cost:  Cost of utilization at the origin location Location Performance Cost: Cost of location performance at the origin location Inventory Level Cost: Cost of inventory level at the origin location Price Margin Differential: Price margin differential at the origin location Depending upon what is configured in the promising configuration, the cost of fulfillment is calculated and the most optimized location is determined. Merge Shipment - Use case 3The best location is the one which has the lowest (or most optimized) cost of fulfillment. Let’s consider a scenario where there are three locations (L1, L2, L3) from where the reservation of an order can potentially happen. The merge routes for the location are defined as follows. This means that no matter what, if the location L1 is considered for reservation, it always invariably ships the item to MC1 from where the item is always shipped to MC2 before being shipped out to the customer. Similarly, L2 always ships the item to the MC3. L3 on the other hand, ships the item directly to the customer. These kind of merge routes are possible for an external vendor, where the vendor ships it to the distribution center first instead of drop shipping it. This is also possible in the case of a satellite DC, where the satellite DC always ships it to the main DC. The objective of the algorithm is to find the most optimized fulfillment route among these routes. The cost of fulfillment for any of these routes are as follows For L1, the cost of fulfillment = Cost of Merge Leg (L1 – MC1) + Cost of Merge Leg (MC1 – MC2) + Cost of Delivery leg (MC2 – Destination) For L2, the cost of fulfillment = Cost of Merge Leg (L2 – MC3) + Cost of Delivery leg (MC3 – Destination) For L3, the cost of fulfillment = Cost of Delivery leg (L3 – Destination) The cost calculation for factors are done as follows Shipping Cost: The sum of cost of shipping for all the legs. Handling Cost: The cost of handling at the origin location. System does not consider the handling cost at merge locations. Location Capacity: The cost of capacity at the origin location. System does not consider the utilization levels at the merge locations in determining the cost. Location performance: The cost of location performance at the origin location. System does not consider the location performance at the merge location in determining this cost. Shipping Proximity: The sum of cost of location proximity of all the legs. Inventory Level: The cost of inventory level at the origin location. Price Margin Differential: The price margin differential at the origin location. Depending upon the promising configuration, the cost of fulfillment is calculated and the most optimized location is determined. Merge Shipment - Multiple Merge RouteFor all such cases, Locations can be created with multiple merge routes along with 'ExternalRouteId'. It will act as matching criteria during allocation, for selecting merge route. During order creation, integration layer or host system needs to provide 'ExternalRouteId' for line/s or order as a part of promising details. During allocation, if merge route for a location exists with matching 'ExternalRouteId', merge legs will be created per merge route details. In case, there is no matching merge route for a location, origin location itself will directly ship order to destination like a regular fulfillment. Note: There is no ability to differentiate between internal carrier for Merge Legs & External Carrier for Delivery Leg. Hence, system uses the Carrier and Service level defined in the Request (order/orderline) for all the legs. Note: There will not be any default value or configuration for ExternalRouteId for Call Center Orders. Merge nodes (route) defined for location and promising decides the origin location by using optimization algorithm: This is the scenario where neither the merge location, nor the origin location is provided on the order. The locations in consideration have merge routes defined, based on which the optimization cost is determined. Since the origin location is not provided on the order line, the optimization algorithm is called to determine the best location. Refer How to set up Merge route for a Location for more details. When merge route is defined for a location and if promising finalizes this location then order line gets merged into the merge location(s) defined as part of merge route detail. Refer to the below section on how the best location is determined Multiple merge routes for a Location -  In certain cases, retailer may want to follow different merge route for different types of order or may need to have a direct fulfillment from origin location even if location has merge route defined. For instance: retailers may want to follow a merge route for all international orders when shipped from Atlanta DC, but direct shipment in case of Domestic Order. Consolidation location and Origin location are provided on the order line and the origin location has a merge route defined: Refer to the below section for details. Merge Shipment - Use case 4 The origin location (OL) has a merge route defined And the consolidation location (CL) is provided on the order line. Hence the fulfillment path for this order is Merge Shipment - Use case 5Let’s consider a scenario where there are three locations (L1, L2, L3) from where the reservation of an order can potentially happen. The consolidation location provided on the order line is CL.  Hence the fulfillment paths for the three options considered are: The fulfillment path with the optimized cost of fulfillment is selected for reservation. Configuration Configuring Optimization Refer to the below section on how to set up the optimization details in a Fulfillment Optimization configuration. How to set up OptimizationOptimization configuration settings are important since they can have a major impact on allocation decisions. The following is configured in the optimize section. Optimization Levels An optimization level represents a group of selected factors that are used for allocation optimization. Multiple optimization levels can be configured. If multiple levels are configured and if a certain factor is configured in a level, it cannot be configured in any subsequent level. For example, if shipping cost is configured in optimization level 1, it cannot be configured in any other level. An example of a three-level optimization is shown below. In this diagram, factors that are highlighted are considered by that optimization level, while factors that are not in bold are not considered. Optimization Level 1 TOLERANCE LEVEL=10% Optimization Level 2 TOLERANCE LEVEL = 5% Optimization Level 3 Shipping Cost Shipping Cost Shipping Cost Fulfillment Capacity Utilization Fulfillment Capacity Utilization Fulfillment Capacity Utilization Inventory Level Inventory Level Inventory Level Handling Cost Handling Cost Handling Cost Rejection Rate Rejection Rate Rejection Rate Location Proximity Location Proximity Location Proximity Selling Price Differential Selling Price Differential Selling Price Differential In this example, The primary factors evaluated in the first level are Shipping cost, Fulfillment utilization, and Inventory level. If more than one location is found within the level one tolerance of 10%, the second optimization level is considered. In the second level - Handling cost, Location proximity and Rejection rate performance are applied. If there are still multiple locations within the second tolerance level, Selling price margin becomes the tie breaker in level three to identify the best location. There are certain other configurations within the optimization configuration which provides additional flexibility to guide the optimization algorithm to the desired result. If not configured, the system uses default values. Note: It is recommended that the default values be retained due to the degree of effect the each of these configurations have on the optimization output. Tolerance Level If multiple optimization levels are used, the tolerance level determines how many locations are eligible for evaluation by the next level. Tolerance levels must be greater than 0. The tolerance level of the last optimization level is always 0 and is not configurable. Weights Retailers can configure the relative weights of the preference factors (soft costs) within an optimization level. Relative weights doesn't apply to Hard cost (Shipping cost, Handling cost) and Selling price differential. In case these handling costs are added along with the soft costs then the weights can be defined only for the soft cost, Hard cost value is taken as-is. Fulfillment Capacity Utilization Inventory Level Rejection Rate Shipping Proximity Location Proximity For example, Optimization Level 1 TOLERANCE LEVEL=10% Optimization Level 2 TOLERANCE LEVEL = 5% Optimization Level 3 Shipping Cost Shipping Cost Shipping Cost Fulfillment Capacity Utilization Fulfillment Capacity Utilization Fulfillment Capacity Utilization Inventory Level Inventory Level Inventory Level Handling Cost Handling Cost Handling Cost Rejection Rate Rejection Rate Rejection Rate Location Proximity Location Proximity Location Proximity Selling Price Differential Selling Price Differential Selling Price Differential For the above configuration, In optimization Level 1, since there are two preference factors present, the default weight of the fulfillment utilization and inventory level is 50% each. If the user deems the fulfillment utilization is more important, the corresponding weight could be increased to 70% (and thus a decrease in weight of the inventory level to 30%.) In optimization level 2, the weight of rejection rate is always 100% since this is the only preference factor configured in the level. In optimization level 3, since there is only Selling price differential - there is no relative weight. Default Cost For each optimization level, the preference cost calculation is based on the hard cost factors configured in that level. At least one hard cost factor such as shipping cost or handling cost must exist as a base cost, using which the preference cost can be calculated. If no hard cost factors are configured in an optimization level, then the hard cost from the immediately preceding optimization level, if present, is used for soft cost calculations. If no hard cost factors are configured in an optimization level and none of the preceding optimization levels maintain a hard cost, default cost is used for that level for soft cost calculations. Default cost can be configured in the Fulfillment Optimization configuration. By default, cost is $6 and this can be changed in the Fulfillment Optimization configuration. Updated Default cost is used for soft cost evaluation if there are no hard cost in the same or preceding optimization level. Note: Though the Default cost can be changed to any value for cost calculation but the default value representing the visual graph (for illustration of soft cost) will always be based on default cost of $6. Refer to Soft cost evaluation for more details. Configuring the Score Calculation Graph This allows the retailer to adjust the value relationship of a certain factor to the overall score. For example, one can choose to define the cost impact of each of the preferences for each value of the preference. For example: Optimization Level 1 TOLERANCE LEVEL=10% Optimization Level 2 TOLERANCE LEVEL = 5% Optimization Level 3 Shipping Cost Shipping Cost Shipping Cost Fulfillment Capacity Utilization Fulfillment Capacity Utilization Fulfillment Capacity Utilization Inventory Level Inventory Level Inventory Level Handling Cost Handling Cost Handling Cost Rejection Rate Rejection Rate Rejection Rate Location Proximity Location Proximity Location Proximity Selling Price Differential Selling Price Differential Selling Price Differential Using the same example, For the first optimization level, only shipping cost is configured as the hard cost. Assume that the shipping cost calculated for location Store A is $6. The default weights of each of the preferences is 50% each. Thus, the cost impact which each of the preference can create to the overall cost is in the range of [-$3, +$3]. Cost Impact Analysis of Fulfillment Utilization Preference The system assumes by default that at a fulfillment utilization of 0% the preference has a maximum negative cost impact (-$3) and reduces the overall cost of fulfillment. At a capacity utilization of 100%, the preference has a maximum positive cost impact (+$3) and increased the overall cost of fulfillment. The cost impact is linearly scaled from -$3 to +$3 for a capacity utilization percentage of 0% to 100%. The following graph shows the default cost impact analysis. If the weight of the preference is changed from 50% to 75%, the cost impact of capacity preference comes to the range of [-$4.5, +$4.5]. The cost impact of the other preference comes to the range of [-$1.5, +$1.5]. The following graphs shows the cost impact because of each of the preferences. Users can change the cost impact of a preference at each value. For example, one can configure the cost impact of capacity at 0% utilization level as -$2 (instead of -$3) and at 10% utilization level as -$1.5 as a continuous linear scale.  The following image shows a sample capacity cost impact configuration. As seen in the above graph, the cost impact of the capacity is from a range of -$3 to +$3. The graph is linear between each of the inflection points. At a capacity utilization of 80%, the cost impact is 0 (equivalent to a preference score of 1). This means that the location is preferred and does not have a positive cost impact till the utilization percentage reaches 80%. Beyond 80%, the preference starts to impact negatively on the chances of selection of the store for reservation. The system internally calculates the score at each of the utilization percentage value based on the graph configuration. Location Proximity: Default distance for cost evaluation is 500 miles. If there are location(s) that are in a similar distance (few miles apart) then there is a possibility of system picking up a random location within this as the cost evaluation might be same. If this sceanrio happens then it is recommnded to change the Max Distance (Promising config parameters) from 500 miles to 100 miles to get a better location (API - {{url}}/promising/api/promising/promisingConfigParameters) Configuring Merge Route for a Location Refer to the below section on how to set up the merge route for a location. How to configure Merge routeMerge location(s) can be defined as part of Inventory Location - Merge Route (API - GET {{url}}/inventory/api/inventory/location/locationId/<locationID>). Within a Merge route - merge route detail can be defined for every merge location. Location can have multiple merge routes along with 'ExternalRouteId'. If 'ExternalRouteId' is present on the routes, then location will select matching merge route during allocation. In case, there is no matching 'ExternalRouteId', order will be directly shipped from Origin Location. Sample set up - { "LocationId": "DC1", "DisplayId": "DC1", "LocationStatusId": 1, "LocationTypeId": "DistributionCenters", "LocationName": "Atlanta DC1", "LaborCost": 1, "CapacityUtilizationLevel": "order", "MergeRoute": [ { "RouteId": "100", "ServiceLevel": "Ground", "Carrier": "UPS", "ExternalRouteId": "A", "MergeRouteDetail": [ { "LocationId": "DC2", "Sequence": "1" }, { "LocationId": "DC3", "Sequence": "2" } ] }, { "RouteId": "101", "ServiceLevel": "Ground", "Carrier": "UPS", "ExternalRouteId": "B", "MergeRouteDetail": [ { "LocationId": "DC2", "Sequence": "1" } ] } ] } Example: If for location - DC1, Order needs to be routed always to Merge location 1 and then to Merge location 2 and then finally to destination location then two merge route detail needs to be defined for Merge location 1 and Merge 2 location 2 respectively. It can be configured while creating/updating Inventory Location through API call. Note: Merge locations needs to be defined at Location -> Merge Routes Location -> Location Merge Route is deprecated. Configuring Shipping Rates Refer to the section below on how to set up shipping rates/cost. How to set up Shipping CostBelow are the attributes which plays a role in Shipping cost Attributes Description Region set up Regions - Region can be of type Country, State, Location, 3 digit zip code or 5 digit zip code Region schema definitions Region schema lookup When there are overlapping regions with different Region Types (9 digit zip code, 5 digit zip code, 3 digit zip code, Country, and so on) then preference is given to the most granular details. Region is selected based on the more granular data available. Following is the order of the preference - Location, Zip Code (9 digit, 5 digit and 3 digit), City, State and finally Country. When there are overlapping regions for the same Region Type - Zip code then Region is selected based on the Sequence defined in the Region. Consider an example - Region 1 - Seq 1 - Postal code range (30000 - 30099) Region 2 - Seq 2 - Postal code range (30010 - 30080) When a request is placed for postal code 30020, there are two Regions (Region 1 and Region 2) for the postal code. In this case, preference is given to Region 1 as the sequence is 1. System check if the Zone/Lane exists for the selected Region (Region 1). Refer to Master Data guide for more details Carrier set up Carrier zones - Create zones for Origin and Destination Region Carrier zone shipping rate Refer to Master Data guide for more details Implementation Flavors How to prioritize the Locations where prices have been Markdown for an Item? Consolidation location is provided on the order line. The locations determined from the optimization algorithm has merge route defined: Refer to the below section for details. Use Selling Price Differential to capture the Markdown price. Use this factor in the Optimization rule (along with other factors if needed) so that locations are prioritized based on this. Do we perform address validation in Manhattan Active® Omni during Location Proximity ? If you don't want to allocate inventory for order with invalid address or postal code, please perform address validation prior to the allocation process. Since AVS will take care of postal code validation, there will be no validation in the Active Omni or Geo component to check if the postal code is valid or not. If the zipcode is not present in Geo, it will always return Latitude and Longitude as 0 for the destination address. Logic to calculate distance for finding the nearest location for the allocation process Distance = Longitude and Lattitude of Origin Location - Longitude and Lattitude of Destination Address. If the calculated value of Distance is within5000 miles, then allocation logic will find the nearest location and allocate the inventory. Related Articles Force AllocateForecast ReservationAdvanced Shipping RestrictionsCustomer Engagement ConfigurationsTroubleshootingSubstitution During AllocationREST APIs and User ExitsProcure To SellOverviewHow Promising Works