# How Reservation Works

**Permalink:** how-reservation-works
**Path:** Manhattan Active® Omni/Order Management/Process & Configuration Guides/Enterprise Inventory/Reservation/How Reservation Works
**Content Length:** 105,384 characters
**Scraped:** 2025-08-09T21:54:23.259488

---

Home ››Manhattan Active® Omni››Order Management››Process & Configuration Guides››Enterprise Inventory››Reservation ››How Reservation Works How Reservation Works Previous | Next In this section let's understand how the reservation works OverviewProcess FlowGenerate Reservation RequestRead Reservation RequestFind Matching SuppliesOther Constraints CheckCreate Reservation MatchesUpdate Allocation DetailsUpdate Capacity UtilizationCreate Reservation responseReservation UpdateReservation Delete Reservation Updates (Release)Reservation Updates (Fulfillment and Short)Fulfillment (Shipped or Picked up)ShortConfigurations How is Reservation Request CreatedHow to Define Sort Order for Future SupplyHow to Define Sort Order for On-Hand Supply How to Find What Supply Type, Order/Reservation is Allocated AgainstHow to Send Reservation Event - Ship and Short to Update Reservations DirectlyImplementation FlavorsHow to Bridge a Reservation Supply Event (Ship) without OrderTroubleshootingInventory Attributes like InvAttribute1-5 from Inventory supply are not copied to reservation request detailInventory Reservation update with new demand typeOrder delivery leg is not released even after inventory is received for the merge legPO and PO details (ASN and ASN details) are not included in the Reservation Request Details when allocated.Related Articles Overview Before going into how a reservation works, it is necessary to understand a few critical objects related to the reservation order and how it is used. The details of the reservation are uniquely identified by the Reservation Detail Id and Location ID Process Flow Regardless of whether a reservation occurs independently or as part of promising, it consists of the following steps: Generate Reservation Request To reserve the inventory for an order, a request must be sent with a request type of optimization or reservation. Refer to How Reservation request is created and the API documentation (Promising Request) in the Promising service for more details. Note: In a multi-org set-up, a reservation request is set up at the same level as the promising request Read Reservation Request From the Reservation request - Reservation and Reservation details are read. Refer to the information persisted in Reservation and Reservation details. Find Matching Supplies The reservation process finds the matching supply for the given request and reserves the inventory. For promising requests, the supply information can be found from an ATC view or from the perpetual inventory (if either perpetual inventory or a list of DCs is defined as the source.) Reservations considers the source (ATC vs Perpetual inventory) while evaluating the supply. All ATC view constraints and exclusion defined at the Item-Location level or Rule set are considered while computing the available quantity. Refer to Inventory Supply UI for details on how the available quantity is computed. Source Type - If the promising system has sourced an order line from an ATC view, the view ID should be sent in the reservation request for the order line. This ensures that only the quantity visible in a view is used for allocation. If the promising system has sourced an order line from perpetual inventory, the view ID should not be sent on the request detail. If the view ID is not sent, the perpetual inventory quantities are used to determine the availability. Demand Supply Match - Demand type is a mandatory field on the reservation request. The demand type sent in the request detail is used to find matching supplies. If not sent in the detail, the request level demand type is used to find matching supplies. Refer to find matching supply section for more information. Latest Release Date Match - If future inventories are considered for allocation, the release date match ensures that only future inventories that have an ETA on or before the latest release date of the order line are used for allocation. Other Constraints Check Complete Single Source - Provides an ability for the retailer to completely source all or a group of order lines from a single location. If the Strategy Type is Complete Single Source, then "allorNone" attribute is sent as true in the Reservation Request. Reservation will try to reserve all line(s) with "allorNone" as true from a single source (for same Fulfillment group ID). If at least one line is not completely allocated, then all related line(s) are not allocated. Refer to Promising Guide for more details. Force Allocate/Reservation - Refer to Promising Guide for more details Overrides (Capacity) - It’s typical for retailers to override capacity considerations in order to meet specific business requirements. Refer to Promising Guide for more details Note : In Reservation Requests, the 'AllorNone' flag is supported at the line level but not at the header level. Create Reservation Matches Once the reservation process finds the matching supplies, the next step is to create records for the reservation matches. Supply records are prioritized based on the following: Supply Type Rank - The supply type ranks configured for the demand types are used to find the priority supplies to match the request. Example: ReservationMatch-SupplyTypeRank Consider the following reservation request and the matching supplies: Request Id Request Detail Id Item Quantity Location Demand Type Order 1 1 Item A 3 DC 1 All 1 Item A 2 DC 2 All 2 Item B 1 Store A On Hand 2 item B 5 Store B On Hand The following table shows the demand supply match along with rankings: Demand type Supply Type Rank On Hand On Hand Available 1 On Hand Available Soon 2 All On Hand Available 1 On Hand Available Soon 2 In Transit 3 On Order 4 The following table shows the matching supplies: Location Item Quantity Supply Type DC 1 Item A 5 On Hand Available DC 1 Item A 2 On Hand Available Soon DC 2 Item A 40 In Transit DC 2 Item A 1 On Hand Available Store A Item B 1 On Hand Available Store A Item B 2 On Hand Available Soon Store B Item B 3 On Hand Available Soon Store B Item B 10 In Transit Output - System creates the following Reservation match records Request Id Request Detail Id Item Location Supply Type Quantity Order 1 1 Item A DC 1 On Hand Available 3 Order 1 1 Item A DC 2 On Hand Available 1 Order 1 1 Item A DC 2 In Transit 1 Order 1 2 Item B Store A On Hand Available 1 Order 1 2 Item B Store B On Hand Available Soon 3 The reservation matches are created using the demand supply rank. For example, even though 40 units are available for an ‘In Transit’ supply, only 1 unit is allocated from that record because it is a lower-ranked supply type. Sorting of Future Supply - Reservations can be allocated against on-hand or future supply based on the supply types associated with the demand type. When allocated against future supplies such as “In Transit” or “On Order”, there could be multiple supply records for the same supply type with different ETA. In such case, supply records are further sorted based on default “sort order” i.e. by ETA ascending. The system can be configured to sort the future supply record(s) by ETA descending order. Use case - If there are orders created with a “Requested Delivery Date”, then a retailer may want to allocate the orders against future inventory with an ETA closest to the requested date. This will ensure that the future inventory with earlier estimated arrival dates is available for immediate orders. Refer How to define sort order for future supply for more details. Sorting of On-Hand Supply - Reservations can be allocated against on-hand supply associated with the demand type. There can be multiple on-hand supplies associated with the same items having different inventory attributes. In such a case, supply records can be sorted based on Inventory Attributes [1-5]  either in Ascending or Descending order. Use case can be if the supplies that have the nearest expiration date should be consumed first. Refer "How to define sort order for on-hand supply" for more details. De-prioritize Past Due Inventory Supply - If a retailer wants to ensure that all future inventory which has ETA in past date should be considered as a last option for allocation, "Deprioritize Past Due Inventory Supply" can be enabled for all future supply types for a Demand Type. "Deprioritize Past Due Inventory Supply" can be configured in Inventory Configuration. If "Deprioritize Past Due Inventory Supply" is enabled, then future supply records with ETA in past date will be de-prioritized during allocation for that supply type. For instance, In-Transit inventory with ETA less than the current date will be considered last if there is other In-Transit inventory with ETA as a future date. The de-prioritized past due inventory supply is applicable for a supply type. Hence, supply types with higher rank will always be prioritized compared to lower ranked supply types irrespective of their ETA. In case there are multiple supply records with Past ETA for a supply type, they will be sorted in descending order irrespective of the "Sort Order" configured for the supply type. Deprioritize Past Due - ExamplesExample #1: If an order is created for 35 quantities with “Latest Release Date" calculated as 15 days from current date Inventory Demand Types: Demand Supply Match for "Allocation and Future" Supply Type Rank Sort Attribute Sort Order On Hand Available 1 On Hand Available Soon 2 In Transit 3 ETA Descending On Order 4 ETA Descending Sorted List of Eligible supply records with Allocated Qty Supply Type ETA Quantity Allocated Quantity Rank On Hand Available ~ 10 10 1 In Transit Current Date + 5 10 5 3 In Transit Current Date + 10 20 20 2 In Transit Current Date + 20 20 0 NA On Order Current Date + 12 30 0 4 Example #2: If "Deprioritize past due Inventory Supply" is enabled and current date is Jan 10, the priority for In Transit Supply as per the configured "Sort Order" are listed below In Transit (ETA desc) In Transit (ETA asc) ASN – Jan 15 ASN – Jan 13 ASN – Jan 13 ASN – Jan 15 ASN – Jan 7 ASN – Jan 7 ASN – Jan 6 ASN – Jan 6 Demand Segment Match - The supply segment ranks can be configured for the demand types and are used to find the priority supplies and segment combination to match the request. Refer here for the configuration. Remaining Attributes such as (Sort Attribute, Sort Order, De-prioritize Past Due Inventory Supply) will work as they used to work in Demand Supply Match. Examples - How supply segment combination would be evaluated? Scenario 1 Supply Table Demand Segment Match Evaluation Item Supply Segment Rank Supply Type Segment Item Supply Segment Rank Item A OHA S1 1 OHA S1 Item A OHA S1 1 Item A OHA S2 2 OHA S2 Item A OHA S2 2 Item A OHAS S1 3 OHAS S1 Item A OHAS S1 3 Item A OHAS S2 4 OHAS S2 Item A OHAS S2 4 Item A PO S1 5 PO S1 Item A PO S1 5 Item A PO S2 6 PO S2 Item A PO S2 6 Scenario 2 - If Location does not maintains a segment Supply Table Demand Segment Match Evaluation Item Supply Rank Supply Type Segment Item Supply Rank Item A OHA 1 OHA S1 Item A OHA 1 Item A OHAS 2 OHA S2 Item A OHAS 2 Item A PO 3 OHA null Item A PO 3 4 OHAS S1 5 OHAS S2 6 OHAS null 7 PO S1 8 PO S2 9 PO null Scenario 3 Supply Table Demand Segment Match Evaluation Item Supply Segment Rank Supply Type Segment Item Supply Segment Rank Item A OHA S1 1 OHA S1 Item A OHA S1 1 Item A OHA S2 2 OHA S2 Item A OHA S2 2 Item A OHAS S1 3 OHAS S1 Item A OHAS S1 3 Item A OHAS S2 4 PO S1 Item A PO S1 4 Item A PO S1 Item A OHAS/PO S2 Picked randomly Item A PO S2 Item A OHAS/PO S2 Picked randomly Scenario 4 Supply Table Demand Segment Match Evaluation Item Supply Segment Rank Supply Type Segment Item Supply Segment Rank Item A OHA S1 1 OHA S1 Item A OHA S1 1 Item A OHA S2 2 OHAS S1 Item A OHAS S1 2 Item A OHAS S1 Item A OHA/OHAS S2 Picked randomly Item A OHAS S2 Item A OHA/OHAS S2 Picked randomly Item A PO S1 Item A PO S2 Note : Demand Segment Match will be used for supply type and segment combination ranking. If "Demand segment match" is set up, any configurations made in "Demand Supply Match" will be ignored. Update Allocation Details Based on the requested units on the reservation request and available units of the matching supply records, allocation details are updated on the Reservation Details and Supply allocation. Reservation Detail Updates - Following scenarios are possible: If the supply quantity (of all the matches together) is greater than or equal to the available quantity, then the allocated quantity is the same as the requested quantity. If the supply quantity is less than the requested quantity, then the reservation is made only for the available quantity. If the supply quantity is zero, then the reservation does not occur. Consider the example below: Reservation request details with requested quantity Request Id Request Detail Id Item Quantity Location Order 1 1 Item A 3 DC 1 1 Item A 2 DC 2 2 Item B 1 Store A 2 item B 5 Store B Reservation match records are as below: Request Id Request Detail Id Item Location Supply Type Quantity Order 1 1 Item A DC 1 On Hand Available 3 Order 1 1 Item A DC 2 On Hand Available 1 Order 1 1 Item A DC 2 In Transit 1 Order 1 2 Item B Store B On Hand Available Soon 3 Reservation Detail - Allocation qty updates Request Id Request Detail Id Item Quantity Allocated Quantity Location Order 1 1 Item A 3 3 DC 1 1 Item A 2 2 DC 2 2 Item B 1 0 Store A 2 item B 5 3 Store B Reservation Detail Id "1" against Location "DC 1" is completely allocated. So the allocated quantity is the same as the requested quantity "3". Reservation Detail Id "1" against Location "DC 2" is completely allocated. So the allocated quantity is the same as the requested quantity "2". Reservation Detail Id "2" against Location "Store A" is not allocated. So the allocated quantity is zero against the requested quantity "1". Reservation Detail Id "2" against Location "Store B" is partially allocated. So the allocated quantity "3" is less than the requested quantity "5". Supply Allocation Updates - Once the reservation matches are created, the allocated quantity for the supply is updated so that the ATC view or the perpetual inventory remains up to date. Refer to the Available to Commerce guide for additional information regarding availability. The supply allocation is an incremental quantity. If the existing allocated units are 5 and 1 more unit is allocated, the Supply Allocation Quantity is updated to 6 units. The following updates are performed to supply allocation based on the above scenario: Location Item Quantity Supply Type Supply Allocation DC1 Item A 5 On Hand Available 3 DC1 Item A 2 On Hand Available Soon 0 DC2 Item A 40 In Transit 1 DC2 Item A 1 On Hand Available 1 Store A Item B 1 On Hand Available 0 Store A Item B 2 On Hand Available Soon 0 Store B Item B 3 On Hand Available Soon 1 Update Capacity Utilization The reservation process updates the capacity utilization of the location where the reservation occurred (if the location maintains capacity.) Refer to the Capacity Management guide for additional information. Create Reservation response Once the reservation process is complete and reservation matches are created, the same information is sent back to the caller. Refer to the API documentation for the Promising service for more information on the response attributes. Currently, reservation matches are not sent in the reservation response. Refer how to determine what Supply Type the Order is allocated against for more details. Reservation Update Reservations are always reset and the system de-allocates and re-allocates the inventory. If any reservation detail is not sent, then the reservation detail and its corresponding matches are deleted from the system. Consider the example below - a reservation is sent with the following details. Reservation request details with requested quantity Request Id Request Detail Id Item Quantity Location Order 1 1 Item A 3 DC 1 1 Item A 2 DC 2 2 Item B 1 Store A 2 item B 5 Store B Reservation match records are as below: Request Id Request Detail Id Item Location Supply Type Quantity Order 1 1 Item A DC 1 On Hand Available 3 Order 1 1 Item A DC 2 On Hand Available 1 Order 1 1 Item A DC 2 In Transit 1 Order 1 2 Item B Store B On Hand Available Soon 3 Now, a reservation request is sent only with Request Detail ID - 1 (Detail ID is not sent in the request). In this case, reservation matches related to Detail 2 are deleted and reservations are de-allocated and re-allocated to Detail 1. If the system finds a better supply for Detail 1, then it allocates to the better supply for the requested location. Request Id Request Detail Id Item Quantity Location Order 1 1 Item A 3 DC 1 1 Item A 2 DC 2 Updated Reservation Match records are as below. Request Id Request Detail Id Item Location Supply Type Quantity Order 1 1 Item A DC 1 On Hand Available 3 Order 1 1 Item A DC 2 On Hand Available 1 Order 1 1 Item A DC 2 On Hand Available Soon (better supply) 1 Note: The system does not de-allocate and reallocate always during reservation updates. During order quantity update, the system can be configured based on Order MOD configuration to pass the existing reservation/allocation details as-is. In this case, the system internally uses the reservations as-is and doesn't de-allocate and reallocate the matches. The Item ID update is not supported as part of a reservation update against the same reservation detail ID. Consider a reservation request created for Item A. Reservation Match is created for Item A. In case, Item ID is updated from Item A to Item B for the same Reservation Detail ID, then the item Id in reservation request detail will get updated to Item B but there will be no de-allocation and reallocation of inventory from Item A to Item B. Workaround - new Reservation detail ID should be sent for Item B. Reservation Delete There are business scenarios like adding items to the cart where temporary reservations are created to block the supply. Reservation expiration is the process of freeing up reserved inventory for other orders in case the reservation becomes invalid. These Reservations are created with "Is Confirmed" flag set to false and the reservation expiry date is passed from promising request in order to signify that the reservation has an expiration date. "Reservation Expiry Date" indicates the expiration date and time for the reservation record if the order is not confirmed. This can be achieved using the "ReservationExpiryDate" field in the promising request. This field can take the time after which the unconfirmed reservation is eligible to be deleted. The reservation expiry date can also be configured in "Promising Config Parameters" on the promising side as the number of hours for reservation expiry. The priority is given to the expiry date passed in the promising request. If the expiry date is not passed, then the value mentioned in the Promising config parameters is used to compute the expiry date. If the promising config parameters are also not configured in the system, then a default time of 4 hours is added to the current time. Note that the reservation expiry date is stamped only for the "unconfirmed" order. If "Is Confirmed" is true, then the system assumes that the order is confirmed and the reservations are not subject to expiration. The system deletes the unconfirmed reservation post the reservation expiry date. This is done by a scheduled job, "Reservation Delete Job", which can be run multiple times in a day to remove unconfirmed reservations. Once the eservations are deleted then a message is communicated to Order to sync up Order allocations and Reservations. "ReservationDeleteJob" needs to be configured in Inventory (available as part of seed data) to take care of deleting the expired Reservations. Based on the scheduled date/time, expired reservations are deleted. This job needs to be configured at the same level where the reservation is created. Reservations can be reused after they expire. An active reservation can be updated before it is released to the Fulfillment system. Sample Reservation delete job As part of seed data, a reservation delete job is provided to run every 30 mins. This can be changed by changing the cron expression in the API - {{url}}/inventory/api/batch/jobSchedule/save                         { "JobScheduleId": "ReservationDeleteJob", "JobTypeId": "reservationDeleteJob", "CronExpression": "0 0/30 * 1/1 * ? *", "StartDelay": 1000, "TriggerKey": "ReservationDeleteJobTrigger", "JobParameters": [ { "InputKey": "ChunkSize", "InputValue": "10" } ] } Note: Reservation Delete Job doesn't accept any Job parameters other than frequency and chunk size Reservation Updates (Release) When the order is ready to get released based on the pipeline configured, a message is sent to inventory to compute and update the release quantity based on the release demand type stamped on the reservation detail. Reservation details are updated with the release quantity if there are any eligible units to be released. For Example, consider the Release demand type is "Allocation" for the Order based on the Release configuration. Demand type "Allocation" corresponds to the supply type "On Hand Available" and "On Hand Available Soon". So, this means the only eligible units for release for these orders are the quantity allocated to "On Hand Available" and "On Hand Available Soon" bucket and not any other supply type like "In Transit" or "On Order". Consider Reservation Detail ID "1" with Requested Quantity and Allocated quantity as 5. Out of these 5 units, 4 are allocated to on-hand supply and 1 unit is allocated to "In Transit". Hence, for release demand type "Allocation", eligible release units are only 4. Reservation details are updated with release quantity as 4. Reservation Match Request Id Request Detail Id Item Location Supply Type Quantity Order 1 1 Item A DC 1 On Hand Available 3 Order 1 1 Item A DC 1 On Hand Available Soon 1 Order 1 1 Item A DC 1 In Transit 1 Reservation Detail Request Id Request Detail Id Item Location Quantity Allocated Released Order 1 1 Item A DC 1 5 5 4 When the "In Transit" inventory is received, reservations are transferred to on-hand triggering the computation of releasable quantity. Now, since all the units are on-hand, the release quantity in the reservation detail is updated as 5. Request Id Request Detail Id Item Location Quantity Allocated Released Order 1 1 Item A DC 1 5 5 5 Reservation Updates (Fulfillment and Short) Fulfillment (Shipped or Picked up) Whenever an order is shipped or picked up, fulfillment locations (DC or Store) send a ship or pickup event to update the order status. Once the order status is updated, the Active Order management system communicates a message to the Inventory (via Reservation Supply Event - Transaction "Ship") to update the supply details. This message updates the allocation of the supply record and also decreases the supply quantity. Host system do not provide any information on the "Supply Type" which is shipped, hence these updates might not always be on the same supply record. Also, the relay is supported for the Reservation Ship event to relay the details to the external system. Refer to Publish Inventory - Relay for more details. Reservation Detail & Reservation Match - Shipped quantity is updated as per top ranked "Release Demand Type". Supply Allocation Update - Allocated quantity is always reduced from the originally allocated Supply Type. Supply Quantity Update Quantity is reduced from on-hand supply eligible as per "Release Demand Type". The system will update the highest ranked on-hand supply type. If there is not enough quantity, then the second highest on-hand supply type is reduced for the remaining quantity. If no record exists, then a negative record is created against the highest ranked On Hand supply type. If reservations are allocated against future supply, then the ship message will reduce the inventory always from on-hand bucket only and not against the allocated future supply (top ranked supply type based on the release demand type) If over shipment or force allocated, then the ship message will always reduce the inventory from the on-hand bucket (top ranked supply type based on the release demand type). Whenever an order is shipped, the supply quantity is always reduced for the highest-ranked on-hand supply type as per Release Demand Type configuration. Retailers that have multiple on-hand supply types may prefer to always reduce the quantity from allocated supply types during shipment. This can be achieved by the enabling "HonorAllocationsOnShip" in Inventory Location attribute for individual Location. If enabled, Supply qty will be updated for the original allocated supply/s in the ranked manner as per Release Demand Type (highest first) for Ship Event. Refer to the process flow for more details Ship - Update Allocated records Ship - Update allocated records (Examples)For all below scenarios supply Type Ranks are in this order ( OH1 > OH2 > OH3 > ASN > PO ) as per Release Demand Type S.N Scenario Allocated Released Ship Event Supply Update Short Event ( Mark Error ) 1 Allocated/Released against single OH supply Type OH1 = 10 OH1 =10 Reduce from OH1 Mark OH1 as Errored 2 Allocated/Released against multiple OH supply Type OH1 = 5 OH2 = 5 OH1 = 5 OH2 = 5 Reduce from OH1 followed by OH2 Short 1 qty - Mark OH2 with Error Short 6 qty- Mark OH1 & OH2 with Error Short 10 qty - Mark OH1 & OH2 with Error 3 Allocated against OH + Future but released against OH OH1 = 2 OH2 = 3 PO = 5 OH1 = 2 OH2 = 3 Reduce from OH1 followed by OH2 Short 1 qty - Mark OH2 with Error Short 3 qty - Mark OH1 & OH2 with Error 4 Allocated/Released against Future inventory PO = 10 PO =10 Reduce from OH1 No record will be marked as Error 5 Allocated/Released against Onhand + Future inventory OH1 = 2 OH2 = 3 PO = 5 OH1 = 2 OH2 = 3 PO = 5 Reduce from OH1 followed by OH2 ( till 5 qty). Further 5 qty reduce from OH1 Short 1 qty - Mark OH2 with Error Short 5 qty - Mark OH1 & OH2 with Error Short 6 qty - Mark OH1 & OH2 with Error 6 Allocated/Released against Onhand and over shipped by 3 qty. OH1 = 5 OH2 = 5 OH1 = 5 OH2 = 5 Reduce from OH1 followed by OH2 ( till 10 qty ). Over shipped 3 qty reduce from OH1 Short 1 qty - Mark OH2 with Error Short 10 qty - Mark OH1 & OH2 with Error 7 Allocated/released against OHA - Retail & OHA - Ecom OHA - Retail = 5 OHA - Ecom = 5 OHA - Retail = 5 OHA - Ecom = 5 Reduce from OHA - Retail followed by OHA - Ecom or vice-versa  ( Randomly ). Randomly 8 (Force Allocated ) Allocated/Released against single OH SupplyType OH1 = 8 OH1 = 8 Reduce 8 qty from OH2 then create -2 qty for OH1. ~ Note: If an order is allocated to multiple segments of the same supply type, the system will randomly assume one as the highest ranked. There will be no logic of prioritizing segments during ship/short processing. When HonorAllocationsOnShip is disabled, then there can be scenarios where the ship message can reduce the quantity from a different supply rather than the original reserved supply. Enabling the "HonorAllocationsOnShip" feature in the feature rollout will activate this attribute globally across all locations. Alternatively, you can enable it for a specific location by configuring it within the inventory locations Ship - ExamplesExample - At T0 - Consider an Order is reserved against the following supply (On Hand Available Soon). Consider the Release demand type as Allocation (On Hand Available, On Hand Available Soon) Request Id Request Detail Id Item Location Supply Type Quantity Order 1 1 Item A DC 1 On Hand Available Soon 3 At T1 - On Hand Available supply is created for 10 units Location Item Quantity Supply Type Supply Allocation DC1 Item A 10 On Hand Available 0 DC1 Item A 3 On Hand Available Soon 3 At T2 - Ship message is sent for 3 units. As per Release demand type, On Hand available is ranked higher than Available Soon. Hence, supply quantity is reduced against On Hand Available instead of Original allocated supply (On Hand Available Soon) Location Item Quantity Supply Type Supply Allocation DC1 Item A 7 On Hand Available 0 DC1 Item A 3 On Hand Available Soon 0 Capacity utilization - current backlog is reduced to take any additional Orders against this location, if the location is not full. # If orders from different organizations are allocated to different on-hand supplies. To ensure shipped quantity is reduced from allocated supply, their respective "Release Demand Type" should only have the allocated supply type as the eligible supply type. For Org A - "On Hand Available" is used for allocation, whereas for Org B - "On Hand Available Soon" is used. "Release Demand Type" for Org A should have "On Hand Available" as the eligible supply type. "Release Demand Type" for Org B should have "On Hand Available Soon" as the eligible supply type. Refer to How to send Reservation Event - Ship and Short to update Reservations directly for standalone implementation. Short Whenever an order is short, fulfillment locations (DC or Store) send a short event to update the Order Status. Once the Order status is updated, the Active Order management system communicates a short message to the Inventory (via Reservation Supply Event - Transaction "Short") to update the supply details. The relay is not supported for the reservation short event. Refer to Publish Inventory - Relay for more details. Following updates happen as part of this message Reservation Detail & Reservation Match - Allocated quantity is reduced based on the lowest rank of the originally allocated supply type. Supply Allocation Update - Allocated quantity is always reduced from the originally allocated supply type. Supply Error Update - Fulfillment locations can send the reason code for shorting the order (example, Inventory not available, customer cancelation etc.). Error codes can be set up for a reason code. Based on the reason code, all matching on-hand supply (based on the inventory attributes sent in the request) can be marked as error. This error can be reset based on the incoming supply events or supply sync events. System errors out all on-hand supply record(s) though the supply may not be reserved against the order. Consider an example - There are two on-hand supply records (On Hand Available and On Hand Available Soon). Order 1 is allocated against on-hand available only. If order 1 is short with the reason "Inaccurate Inventory", then the system errors out both supply records (On Hand Available and On Hand Available Soon) to prevent orders getting allocated against this location. System errors out the corresponding Item Location as also errored out. Enterprise Inventory tracks if the supply is errored out or not. It doesn't track the reason code which marked the supply as errored. Error code ID is a base profile entity part of inv::SupplyConfiguration profile purpose. As many error codes as needed can be configured for each implementation. When shorting, all On Hand supply Type(s) for the item at the fulfillment location are flagged as being in error. Retailers that have multiple on-hand supply type may prefer to always mark in error only the allocated on-hand supply type during order short. This can be achieved by enabling "HonorAllocationsOnShort" in the Inventory Location attribute for an individual location. If enabled, error will be set only for Allocated On Hand supply/s in the ranked manner as per Release Demand Type ( lowest first ) for Short Event. Short - Update Allocated records Supply is marked for errors only for the on-hand supply and not future supply. This is because inventory error is encountered only for on-hand supply during store/WM processing time. In case when Enterprise Inventory and Fulfillment Locations are not in sync for on-hand inventory (i.e. Enterprise Inventory has some inventory and orders are allocated and released. However, if the fulfillment location (DC/Store) doesn't have adequate inventory), an inventory error is applied and short the fulfillment with a proper reason code. This will error out the inventory in DOM to restrict further allocation from Order Management side. This is not applicable for future inventory as it has not yet reached the store/WM and there is no point in applying inventory Error. Capacity utilization - current back log is reduced to take any additional Orders against this location, if the location is not full. Configurations How is Reservation Request Created A Reservation request is created (internally) for every Order/Reservation (aka Promising request). On a bare minimum, for every line (request detail) and allocated location, one reservation request detail is created. There can be scenarios when multiple reservation details are created for this combination which will be discussed later in this guide. Example: Consider the following scenario Order/Pre-reservation (promising request) is sent as below Order ID/ Request Id Order Line Id/ Request Detail Id Item Quantity Order 1 Line 1 Item A 2 Line 2 Item B 1 Line 3 Item C 3 Below are the locations the line/request details are allocated against Order ID/ Request Id Order Line Id/ Request Detail Id Item Quantity Promising output - Location(s) and units to be allocated Order 1 Line1 Item A 2 DC 1 (1 unit) DC 2 (1 unit) Line2 Item B 1 DC 1 (1 unit) Line3 Item C 3 DC 1(2 unit) DC 3 (1 unit) The following is the reservation request formed in the above scenario. The request detail ID, location, and item are all unique identifiers of the reservation request detail. In this, the Reservation Request Id is the same as the Promising Request Id and the Reservation Request Detail Id is the same as the Promising Request Detail Id. Sample Reservation Request Reservation Request - Sample{ "IsConfirmed": true, "RequestId": "Order 1" "ReservationRequestDetail": [ { "ItemId": "Item A", "LocationId": "DC 1", "ReservationRequestDetailId": "Line 1", "Quantity": 1 }, { "ItemId": "Item A", "LocationId": "DC 2", "ReservationRequestDetailId": "Line 1", "Quantity": 1 }, { "ItemId": "Item B", "LocationId": "DC 1", "ReservationRequestDetailId": "Line 2", "Quantity": 1 }, { "ItemId": "Item C", "LocationId": "DC 1", "ReservationRequestDetailId": "Line 3", "Quantity": 2 }, { "ItemId": "Item C", "LocationId": "DC 3", "ReservationRequestDetailId": "Line 3", "Quantity": 1 } ] } Reservation Request Id Reservation Request Detail Id Location Item Quantity Order 1 Line1 DC1 Item A 1 Line2 DC1 Item B 1 Line3 DC1 Item C 2 Line1 DC2 Item A 1 Line3 DC3 Item C 1 Note: The ReservationRequestDetailId and OrderLineId attribute values should be the same. How to Define Sort Order for Future Supply By default, reservations pick up future supply in the ascending order of ETA. This is configurable in the Demand Supply Match tab in the Demand Type Definitions UI. For each supply type in the demand type, a user can configure if the reservation should pick the future supply in ascending or descending order. Users can configure sorting orders by ETA, either in ascending or descending order for all future supply types mapped to an individual demand type. This can be defined on the Demand Type UI. "Sort order" is defined at a supply type level and will be applied during allocation, transfer allocation, batch reallocation, reallocation on order modification and reallocation on inventory drop. The future supply records that have ETA greater than the “Latest Release Date” (LRD) will always be ineligible for allocation irrespective of a defined sort order. Sorting order by ETA, either in ascending/descending order, is applied at an individual supply type level. Hence, supply types with higher rank will always be prioritized compared to lower ranked supply types irrespective of their defined "Sort Order". “Sort Order” is defined for a supply type mapped to a demand type. Hence, different demand types can have different “Sort Order” for their future supply types. Different future supply types could have different “Sort Order”. For instance: The sord order for “In Transit” can be by ETA descending, whereas “On Order” by ETA ascending. If the requested delivery date is not present for a line, the system will still sort future inventory in a defined “sort order” of ETA. For example: Supply Type ETA Available Qty PO1 10/30/2019 10 PO2 11/15/2019 9 PO3 11/30/2019 7 PO4 12/01/2019 0 PO5 12/30/2019 10 PO6 01/15/2019 10 If the sort order is ascending and order O1 has an RDD of 01/01/2020 and transit time = 15 days, the system still always pick up the first PO (PO1) for allocation. Though the system could have used PO3 with an ETA (11/30). If the sort order is descending, then the system will use PO3 with an ETA (11/30) for allocation. How to Define Sort Order for On-Hand Supply We can configure the on-hand supply allocation based on inventory attributes. This is configurable in the Demand Supply Match tab in the Demand Type Definitions UI. For each supply type in the demand type, a user can configure if the reservation should pick an on-hand supply in ascending or descending order. Users can configure “Sort Order” by Inventory Attributes 1-5, either in ascending or descending order for all on-hand supply types mapped to an individual demand type. This can be defined by the Demand Type UI. "Sort Order" is defined at a supply type level and will be applied during allocation, transfer allocation, batch reallocation, reallocation on order modification and reallocation on inventory drop. "Sort Order" by Inventory Attributes 1-5, either by ascending/descending order is applied at an individual supply type level. Hence, supply types with higher rank will always be prioritized compared to lower ranked supply types irrespective of their defined "Sort Order". “Sort Order” is defined by a supply type mapped to a demand type. Hence, different demand types can have different “Sort Order” for their on-hand supply types. "Sort Order" can be different for each on-hand supply type. For instance: The sord order for “On Hand Available” supply type can be by “Inventory Attribute 1” descending, whereas “On Hand Available Soon” can be by “Inventory Attribute 2” ascending. For example: Supply Type Inventory Attribute 1 - 5 Available Qty OHA1 Inventory Attribute 1 : A 10 OHAS1 Inventory Attribute 2 : D 9 OHA2 Inventory Attribute 1 : B 7 OHAS2 Inventory Attribute 2 : E 4 OHA3 Inventory Attribute 1 : C 10 OHAS3 Inventory Attribute 2 : F 10 Configuration : Supply Type Sort Attribute Sort Order Rank 1: OHA (OnHand Available) Inventory Attribute 1 ASC Rank 2: OHAS (OnHand Available Soon) Inventory Attribute 2 DSC If the order comes for 30 units, the supply allocation will be followed in the order : OHA1, OHA2, OHA3, OHAS3 If an order is allocated for 30 units, the supply allocation will follow this sequence: OHA1, OHA2, OHA3, OHAS3 If the Order comes for 50 units, the supply allocation will be followed in the order : OHA1, OHA2, OHA3, OHAS3, OHAS2, OHAS1 . If an order is allocated for 50 units, the supply allocation will follow this sequence: OHA1, OHA2, OHA3, OHAS3, OHAS2, OHAS1 How to Find What Supply Type, Order/Reservation is Allocated Against There is no supply type information sent in the Reservation response or stored on the order. To determine this, you need to: Get the reservation request for your order using the API /inventory/api/inventory/reservationRequest/requestId/{orderId} Find the reservation request match you are interested in and get the Hash Id, Item Id, and Location Id Retrieve the item location for this Item Id and Location Id and find the supply record with a matching Hash Id The Supply Type Id is visible on the supply record This works for Reservation and Optimization mode. But for query mode, since no reservation is made, you can't get the details. Workaround - Once the location details are available as part of query mode, get Supply call should be done and based on the ordered quantity - custom logic can be added to find the supply type How to Send Reservation Event - Ship and Short to Update Reservations Directly Rest end point "POST /api/inventory/reservation/supplyEvent" is used to post the Ship/Short message directly to update the Reservation in Enterprise Inventory. This API will take care of performing the updates as mentioned under Reservation Updates - Ship and Short. Sample message Reservation Ship Event - Sample { "ReservationSupplyEvent": [ { "LastTransDate": "2017-10-31T14:00:18.523Z", "RequestId": "CO_17092018_01", "ReservationDetail": [ { "ItemId": "Ann:Item1", "LocationId": "Ann:LouisvilleDC", "Quantity": 6, "ReasonCodeId": "", "ReservationRequestDetailId": "CO_17092018_01", "SupplyAttributes": { "BatchNumber": "Batch1", "CountryofOrigin": "US", "InvAttribute1": "Attr1", "InvAttribute2": "Attr2", "InvAttribute3": "Attr3", "InvAttribute4": "Attr4", "InvAttribute5": "Attr5", "InventoryType": "F", "ProductStatus": "Finished Goods" } , "Uom": "U" } ], "TransactionTypeId": "Ship" } ] } Implementation Flavors How to Bridge a Reservation Supply Event (Ship) without Order For the Reservation supply event (Ship) to work without Order, Reservation should be available in Inventory with the Release information (Release quantity and Release Demand Type). Follow the steps below Reservation supply event (Ship) without OrderStep # 1 - Once the inventory is received to On Hand, release need to be simulated on the Reservation. Sample Reservation Request POST /api/inventory/reservationRequest/save { "AllOrNone": false, "RequestId": "RES_PO_BG20210318_04_01", "IsConfirmed": true, "DemandType": "Allocation and Future", "ReservationExpiryDate": null, "ReservationRequestDetail": [ { "ItemId": "40306", "LocationId": "6400", "Quantity": 1, "ReservationRequestDetailId": "1", "PoId": "PO_BG20210318_04", "PoDetailId": "1", "ReleasedQuantity": 1, "ReleaseDemandType": "Allocation and Future" } ] } Step # 2 - Sample Reservation supply event (ship) POST /api/inventory/reservation/supplyEvent { "ReservationSupplyEvent": [ { "reservationComplete": true, "TransactionTypeId": "Ship", "LastTransDate": "2021-03-18T17:30:00", "RequestId": "RES_PO_BG20210318_03_01", "ReservationDetail": [ { "ReservationRequestDetailId": "1", "LocationId": "6400", "ItemId": "40306", "Quantity": 1, "Uom": "EA", "IsReleaseCapacity": true, "SupplyAttributes": { "CountryofOrigin": null, "BatchNumber": null, "ProductStatus": null, "InventoryType": null, "InvAttribute1": null, "InvAttribute2": null, "InvAttribute3": null, "InvAttribute4": null, "InvAttribute5": null } } ], "InventoryTransactionType": "Retail Demand Shipment", "InventoryTransactionId": "RES_PO_BG20210318_03_01" } ] } Note : For the ship reservation mapping: "reservationComplete"= true should be passed only on the last ship reservation and not required to pass in short reservation. Based on "reservationComplete" value, the base will decide whether to populate PurgeDate or not. Troubleshooting Inventory Attributes like InvAttribute1-5 from Inventory supply are not copied to reservation request detail The inventory attributes will be populated in the reservation request details only if they are passed in OrderLinePromisingInfo. Otherwise, the basic supply details will be populated in the reservation request details. Inventory Reservation update with new demand type When updating a reservation save request with a new demand type, kindly include the attribute 'TriggerReservation' with a value of 'true.' This will facilitate the transfer of quantities from the old demand type to the new demand type. Order delivery leg is not released even after inventory is received for the merge leg Enable "enableReservationMovement" attribute under inventory parameters. PO and PO details (ASN and ASN details) are not included in the Reservation Request Details when allocated. When an order is allocated to a PO or ASN, the Reservation Request details do not include POId or PODetailsId. This behavior is intentional and works as designed. Related Articles Rest APIs & User ExitsTransfer ReservationOverview