# Late Order Cancellation

**Permalink:** lateordercancellation
**Path:** Manhattan Active® Omni/Order Management/Process & Configuration Guides/Order Processing/Order Fulfillment/Late Order Modifications/Late Order Cancellation
**Content Length:** 150,375 characters
**Scraped:** 2025-08-09T21:57:46.056427

---

Home ››Manhattan Active® Omni››Order Management››Process & Configuration Guides››Order Processing››Order Fulfillment››Late Order Modifications ››Late Order Cancellation Late Order Cancellation OverviewFunctional FlowLate Order Cancellation: Order ProcessingCancellation Request TrackingCancellation Request IntegrationCancellation AcceptedCancellation Temporarily RejectedCancellation RejectedLate Order Cancellation Integration with MAWM, External Store and External WMEligibility for Line CancellationLate Order Cancellation for STS and STH MergeLate Order Cancellation in the Contact CenterLate Order Cancellation in Digital Self-ServiceLate Order Cancellation in Store FulfillmentCancellation after Contacting CustomerProcessing of Cancellation RequestsPrepare PickupsStagingContact Customer, Confirm Pickup, and Curbside PickupsReturn To Shelf Prepare Shipments Packing ShipmentsConfigurationOrder ConfigurationEnabling mod type config overrides for an order config using rest APIsModifying default configuration for delayed message serviceOrder Reason CodesEnabling the Customer Initiated Cancel Line Mod TypeOrder and XBoundAuth Service Definition for MAWM IntegrationResources for Cancel Option in Contact CustomerAllow Late Order CancellationFulfillment Reason CodesPullbacks Pipeline ChangesFulfillment Outbound ChangesContact Center ConfigurationResources for Order Line List & Order Details UIsImplementation FlavorsLate Order Cancellation Initiated from External SystemsLate Order Cancellation Integration with External Store and External WMLate Order Cancellation in the Call Center at the Order LevelLate order cancellation with vendor locationFeature ScopeUIs and EntitiesServicesTroubleshootingWhy is released order line not eligible for cancellation?Why is released order not eligible for cancellation?Why is the released order line not canceled after requesting for cancellation?Is it possible to cancel the merge legs of pickup orders that are in released status using the late order cancellation job?Related Articles Overview With Manhattan Active® Omni late order cancellations, customers can cancel buy online pick up in store (BOPIS), ship to store(STS), and ship to home (STH) items which have already been released to the store or DC for fulfillment. For example, a customer places a BOPIS order and the store has already picked the items and staged them for pickup. If the customer wishes to cancel the items, the customer can cancel these items using either Digital Self-Service (DSS) or Contact Center in conjunction with Manhattan Active® Omni Store Inventory & Fulfillment (MAO SIF)  or Manhattan Active® Warehouse Management(MAWM). In some instances, third party store or warehouse management applications can be used as fulfillment or warehouse systems respectively. Late order cancellation integration is supported with these applications through extension point. Currently, late order cancellation is supported for BOPIS, ship to store, and ship to home items. Ship from Store items can be canceled until packing begins and BOPIS or Ship To Store can be canceled until picked up. Ship from MAWM can be canceled till the loading or manifesting process begins. Here's how it works: A customer places a ‘Pick Up At Store’ order. The items are released to a store for processing. The store may have started picking or picked the items. The customer cancels the item in Digital Self-Service, by calling Contact Center, or via E-Commerce, which is leveraging Active® Omni APIs. If the store has picked the items, then the items appear on the Return to Shelf list. If the store has not started picking the items, then the items no longer appear on the pick list. If the customer has canceled some items but comes to pick up the remaining items, then the store associate is alerted that some items have been canceled and should be removed from the bag. Functional Flow Late Order Cancellation: Order Processing A pick-up-at-store or ship to store item can be requested for cancellation up until it is picked up, ship to home up until it is packed. The phrase "requested for cancellation" is used because the order component is requesting cancellation from the downstream fulfillment component, and there is some possibility that cancellation could fail. For BOPIS items, the likelihood of cancellation failure is essentially zero, as the customer picking up the items is the only factor that should cause cancellation to fail. Refer here on how to enable late order cancellation for BOPIS, STS and Ship to home items. Note: Partial quantity cancellation request on a released line is not supported. For example, if an order line is released for 5 units, the customer cannot cancel 2 units. Cancellation Request Tracking To track the cancellation request, the order line attribute "cancellationRequestStatus" is set to "Requested". When this occurs, a release update request is generated based on the fulfillment configuration and sent to the Manhattan Active® Omni Store or any other third party store or warehouse system. In case of full line cancellation, release line quantity on the request is set to zero. Cancellation Request Integration The request to Manhattan Active® Omni Store will be through rest call if the location is "Manhattan Active® Location" for location type Store, refer here for location configuration details. For anything else (MAWM or External Store or Warehouse applications), extension point Order:Release:UserExit:ProcessExternalReleaseUpdate should be configured. Manhattan Active® Omni Store or other fulfillment or warehouse management applications can respond back with one of the three responses: Cancellation Accepted Fulfillment or warehouse management application immediately cancels the line and also order immediately cancels the order line and the customer is notified via email. The order line  cancellationRequestStatus is set to "Success". Cancellation Temporarily Rejected If the Manhattan Active® Omni Store is actively picking an item, then the cancellation request cannot be immediately processed. However, the cancellation can be processed after picking is complete when the picker returns to the work station. In this case, a cancellation is temporarily rejected. The order line cancellationRequestStatus will remain in "Requested". The order component reattempts cancellation after 30 minutes. Read here to change the nextEvalTimeDuration time limit. If the order component has not received a definitive rejected decision after 24 hours, then the order line "cancellationRequestedStatus" is updated to "Failure". Read here to change the ThresholdLimitDuration time limit. Cancellation Rejected If the lines are already canceled in the fulfillment or warehouse management, the order line "cancellationRequestedStatus" is updated to "Failure". One release update request is generated per release-location combination. For example, a customer placed an order to pickup one item at store A and one item at store B. If a customer cancels both items, then two separate release update requests are generated: one for store A and one for store B. Sample Release Update Request{ "ServiceLevelCode": "UPS_GROUND", "Email": "pSmith@manh.com", "MaxFulfillmentStatusId": "3000", "IsOnHold": false, "IsConfirmed": true, "OrderSubtotal": 0, "ModeId": null, "SellingLocationId": null, "CurrencyCode": "USD", "CustomerPhone": "(678) 597-7070", "CustomerFirstName": "John", "ReleaseTotal": 0, "ExtendedFields": { "ServiceLevelCode": "UPS_GROUND", "Email": "pSmith@manh.com", "MaxFulfillmentStatusId": "3000", "IsOnHold": false, "IsConfirmed": true, "OrderSubtotal": 0, "ModeId": null, "SellingLocationId": null, "CurrencyCode": "USD", "CustomerPhone": "(678) 597-7070", "CustomerFirstName": "John", "ReleaseTotal": 0, "ExtendedFields": {}, "TotalCharges": 0, "ExternalShipFromLocationId": null, "TaxExemptId": null, "AddressId": "21aad2d26f36476ad7505da778ae61f4", "DocTypeId": "CustomerOrder", "CreatedBy": "admin@ecomorg.com", "OrderTotalDiscounts": 0, "Priority": null, "IsCancelled": false, "IsPublished": null, "HasNotes": false, "ReleaseId": "TEST_ML_92", "CustomerId": "customer113", "City": "Charlotte", "OrderId": "TEST_ML_9", "AVSReasonId": null, "CustomerType": "", "IsTaxExempt": false, "AddressName": null, "State": "NC", "DestinationAction": "Delivery", "Note": [], "IsAddressVerified": false, "Country": "US", "PaymentMethod": null, "OrderTotalTaxes": 0, "HasAlerts": null, "LastName": "Smith", "ReleaseExtendedFields": {}, "IsReadyForTender": false, "ConfirmedDate": "2021-06-22T09:52:12.195", "OverageAllowed": false, "DeliveryMethodSubType": null, "CreateReleaseTimeStamp": "2021-06-22T09:54:54.585", "TaxExemptReasonId": null, "ShipFromLocationId": "ecomorg:T1479", "NoOfStoreSaleLines": 0, "PostalCode": "28211", "OrganizationId": "ecomorg", "InvoiceId": null, "County": null, "IsPostVoided": null, "AlternateOrderId": null, "CustomerEmail": "pSmithmanh-dev.com", "Phone": "9945586015", "OrderTypeId": "CallCenter Order", "PaymentStatusId": "1000.000", "CustomerCommPref": null, "SellingChannelId": "CallCenter", "MinFulfillmentStatusId": "3000", "ReleaseType": null, "CreateOrderTimeStamp": "2021-06-22T09:52:11.937", "ExternalOrganizationId": null, "ShipToLocationId": null, "EffectiveRank": "Not Applicable", "DeliveryMethod": "ShipToAddress", "NoOfDeliveryLines": 1, "FirstName": "John", "ReleaseLine": [ { "CancelledQuantity": 0, "ServiceLevelCode": null, "LineTypeId": null, "OrderLineTotalCharges": 0, "FulfilledQuantity": 0, "IsReturnable": true, "IsTaxIncluded": false, "IsHazmat": false, "RefundPrice": null, "TaxOverrideValue": null, "MaxFulfillmentStatusId": "3000", "IsOnHold": false, "ItemWebURL": "", "ItemId": "Tops-12238-Blue-L", "ShippingMethodId": "Standard", "SellingLocationId": null, "IsGift": false, "ParentOrderLineId": null, "TotalCharges": 0, "ParentOrderId": null, "ItemStyle": "12238", "TaxExemptId": null, "Priority": null, "SmallImageURI": "http://res.cloudinary.com/com-manh-cp/image/upload/12238_poolsidebluebeachwalk_a1.jpg", "DeliveryMethodId": "ShipToAddress", "IsDiscountable": true, "IsCancelled": false, "TaxOverrideTypeId": null, "ItemBrand": "U.S. Polo", "IsPreOrder": false, "OrderLineTotalDiscounts": 0, "ParentOrderLineTypeId": null, "IsTaxExempt": null, "PromisedDeliveryDate": null, "IsPerishable": false, "LatestDeliveryDate": null, "Note": [], "StreetDate": null, "GiftCardValue": null, "HazmatCode": null, "IsPreSale": false, "AlternateOrderLineId": null, "IsGiftWithPurchase": null, "DoNotShipBeforeDate": null, "IsExchangeable": true, "LastPossibleDeliveryDate": null, "OrderLineTotal": 0, "ItemSeason": null, "PickupDetail": [], "ItemColorDescription": "Blue", "ItemBarCode": null, "ItemDescription": "The Duval printed linen cap sleeve top is a summer essential. Wear this with your favorite printed", "IsReturn": false, "IsTaxOverridden": false, "ReleaseLineTotal": 0, "OrderLineVASInstructions": [], "IsPriceOverrIdden": false, "AllocationInfo": { "InventorySegmentId": null, "AllocationId": "183002187119657667983", "SubstitutionTypeId": null, "EarliestDeliveryDate": "2021-06-22T09:54:00", "CountryOfOrigin": null, "EarliestShipDate": "2021-06-22T09:54:00", "SubstitutionRatio": null, "InventoryTypeId": null, "SupplyTypeId": null, "ASNDetailId": null, "ExtendedFields": {}, "CommittedDeliveryDate": null, "InventoryAttribute1": null, "PODetailId": null, "InventoryAttribute2": null, "InventoryAttribute3": null, "InventoryAttribute4": null, "InventoryAttribute5": null, "POId": null, "CommittedShipDate": null, "BatchNumber": null, "LatestShipDate": null, "ASNId": null, "GroupId": null, "ProductStatusId": null, "LatestReleaseDate": null }, "ProductClass": "Tops", "MinFulfillmentStatusId": "3000", "ItemSize": "L", "AsnId": null, "PaymentGroupId": null, "ShipToLocationId": null, "EffectiveRank": "Not Applicable", "ExtendedLineFields": {}, "LineShortCount": 0, "Mode": null, "ReleaseLineExtendedFields": {}, "Quantity": 0, "ShipViaId": null, "IsItemNotOnFile": false, "IsGiftCard": false, "IsPackAndHold": false, "ProcessInfo": { "IsSerialNumberRequired": null, "PickLocAssignmentType": null, "CubeMultipleQty": null, "LPNBreakAttribute": null, "OrganizationId": null, "ItemBreakAttribute": null, "SingleUnit": null, "UnitWeight": null, "ExtendedFields": null, "ParentOrderLine": null, "UnitVolume": null, "ExportInfoCode": null, "WaveProcessType": null, "ItemPrice": null, "CriticalDimension3": null, "PickTicketControlNumber": null, "CriticalDimension2": null, "PickUpReferenceNumber": null, "CriticalDimension1": null, "PriceTicketType": null, "Price": null, "BatchRequirementType": null, "DeliveryReferenceNumber": null, "PK": null, "VASProcessType": null }, "CancelReasonId": "Misc", "ReleaseLineId": "1", "ParentItemId": null, "IsReturnableAtStore": true, "FulfillmentGroupId": "2fe8f1e559ac8999fe7fe15cb9cbcf1", "UOM": "EA", "OrderLineSubtotal": 0, "UnitPrice": 39.99, "OrderLineId": "1", "TotalTaxes": 0, "OrderLineTotalTaxes": 0, "RequestedDeliveryDate": null, "CarrierCode": null, "OriginalUnitPrice": 39.99, "TotalDiscounts": 0 } ], "Address2": null, "ShipViaId": "UPSGR", "Address3": null, "Address1": "4400 SharonRoad", "ProcessInfo": { "InternalGoodsDescription": null, "AccountReceivableCode": null, "IsAutoCreateBlocked": null, "ShipLocationControl": null, "ScheduleDeliveryDate": null, "GlobalLocationNumber": null, "AdvertisingCode": null, "MovementOption": null, "ShipmentPlanningScheduleDay": null, "IsCartonMinWeight": null, "IsBackOrdered": null, "ExtendedFields": null, "WaveId": null, "RoutingAttributes": null, "PlanningOriginFacilityId": null, "IsAutoConsolidationBlocked": null, "DesignatedShipVia": null, "DeclaredValueCurrencyCode": null, "BillOfLadingBreakAttribute": null, "Priority": null, "ShipmmentPlanningScheduleDay": null, "AccountReceivableAccountNumber": null, "LPNCubingIndicator": null, "ParentOrder": null, "RouteType1": null, "RouteType2": null, "SecondryMaxicodeAddressNumber": null, "InternationalGoodsDescription": null, "AdvertisingDate": null, "OrganizationId": null, "RouteTo": null, "FedexDutyTaxAccountID": null, "FTSRNumber": null, "Language": null, "DsgStaticRouteId": null, "CashOnDeliveryFund": null, "PalletCubingIndicator": null, "DestinationShipThroughLocation": null, "DeclaredValue": null, "CustomerBrokerAccountNumber": null, "RouteWaveNumber": null, "FedexDutyTaxPaymentType": null, "ImporterDefinition": null, "MoveType": null, "FreightForwardAccountNumber": null, "IsWarehouseTransfer": null, "IsShipmentDocumentsOnly": null, "CustomerDepartment": null, "TransportationWaveOptionId": null, "PlanningDestinationFacilityId": null, "PK": null, "PrimaryMaxicodeAddressNumber": null, "DesignatedEquipmentId": null }, "CancelReasonId": null, "PostVoIdReasonId": null, "OrderLocale": null, "OrderTotalCharges": 0, "TotalTaxes": 0, "CustomerLastName": "Smith", "CapturedDate": "2021-06-22T08:11:40.927", "CarrierCode": "UPS", "OrderTotal": 0, "TotalDiscounts": 0 }, "TotalCharges": 0, "ExternalShipFromLocationId": null, "TaxExemptId": null, "AddressId": "21aad2d26f36476ad7505da778ae61f4", "DocTypeId": "CustomerOrder", "CreatedBy": "admin@ecomorg.com", "OrderTotalDiscounts": 0, "Priority": null, "IsCancelled": false, "IsPublished": null, "HasNotes": false, "ReleaseId": "TEST_ML_92", "CustomerId": "customer113", "City": "Charlotte", "OrderId": "TEST_ML_9", "AVSReasonId": null, "CustomerType": "", "IsTaxExempt": false, "AddressName": null, "State": "NC", "DestinationAction": "Delivery", "Note": [], "IsAddressVerified": false, "Country": "US", "PaymentMethod": null, "OrderTotalTaxes": 0, "HasAlerts": null, "LastName": "Smith", "ReleaseExtendedFields": {}, "IsReadyForTender": false, "ConfirmedDate": "2021-06-22T09:52:12.195", "OverageAllowed": false, "DeliveryMethodSubType": null, "CreateReleaseTimeStamp": "2021-06-22T09:54:54.585", "TaxExemptReasonId": null, "ShipFromLocationId": "ecomorg:T1479", "NoOfStoreSaleLines": 0, "PostalCode": "28211", "OrganizationId": "ecomorg", "InvoiceId": null, "County": null, "IsPostVoided": null, "AlternateOrderId": null, "CustomerEmail": "pSmithmanh-dev.com", "Phone": "9945586015", "OrderTypeId": "CallCenter Order", "PaymentStatusId": "1000.000", "CustomerCommPref": null, "SellingChannelId": "CallCenter", "MinFulfillmentStatusId": "3000", "ReleaseType": null, "CreateOrderTimeStamp": "2021-06-22T09:52:11.937", "ExternalOrganizationId": null, "ShipToLocationId": null, "EffectiveRank": "Not Applicable", "DeliveryMethod": "ShipToAddress", "NoOfDeliveryLines": 1, "FirstName": "John", "ReleaseLine": [ { "CancelledQuantity": 0, "ServiceLevelCode": null, "LineTypeId": null, "OrderLineTotalCharges": 0, "FulfilledQuantity": 0, "IsReturnable": true, "IsTaxIncluded": false, "IsHazmat": false, "RefundPrice": null, "TaxOverrideValue": null, "MaxFulfillmentStatusId": "3000", "IsOnHold": false, "ItemWebURL": "", "ItemId": "Tops-12238-Blue-L", "ShippingMethodId": "Standard", "SellingLocationId": null, "IsGift": false, "ParentOrderLineId": null, "TotalCharges": 0, "ParentOrderId": null, "ItemStyle": "12238", "TaxExemptId": null, "Priority": null, "SmallImageURI": "http://res.cloudinary.com/com-manh-cp/image/upload/12238_poolsidebluebeachwalk_a1.jpg", "DeliveryMethodId": "ShipToAddress", "IsDiscountable": true, "IsCancelled": false, "TaxOverrideTypeId": null, "ItemBrand": "U.S. Polo", "IsPreOrder": false, "OrderLineTotalDiscounts": 0, "ParentOrderLineTypeId": null, "IsTaxExempt": null, "PromisedDeliveryDate": null, "IsPerishable": false, "LatestDeliveryDate": null, "Note": [], "StreetDate": null, "GiftCardValue": null, "HazmatCode": null, "IsPreSale": false, "AlternateOrderLineId": null, "IsGiftWithPurchase": null, "DoNotShipBeforeDate": null, "IsExchangeable": true, "LastPossibleDeliveryDate": null, "OrderLineTotal": 0, "ItemSeason": null, "PickupDetail": [], "ItemColorDescription": "Blue", "ItemBarCode": null, "ItemDescription": "The Duval printed linen cap sleeve top is a summer essential. Wear this with your favorite printed", "IsReturn": false, "IsTaxOverridden": false, "ReleaseLineTotal": 0, "OrderLineVASInstructions": [], "IsPriceOverrIdden": false, "AllocationInfo": { "InventorySegmentId": null, "AllocationId": "183002187119657667983", "SubstitutionTypeId": null, "EarliestDeliveryDate": "2021-06-22T09:54:00", "CountryOfOrigin": null, "EarliestShipDate": "2021-06-22T09:54:00", "SubstitutionRatio": null, "InventoryTypeId": null, "SupplyTypeId": null, "ASNDetailId": null, "ExtendedFields": {}, "CommittedDeliveryDate": null, "InventoryAttribute1": null, "PODetailId": null, "InventoryAttribute2": null, "InventoryAttribute3": null, "InventoryAttribute4": null, "InventoryAttribute5": null, "POId": null, "CommittedShipDate": null, "BatchNumber": null, "LatestShipDate": null, "ASNId": null, "GroupId": null, "ProductStatusId": null, "LatestReleaseDate": null }, "ProductClass": "Tops", "MinFulfillmentStatusId": "3000", "ItemSize": "L", "AsnId": null, "PaymentGroupId": null, "ShipToLocationId": null, "EffectiveRank": "Not Applicable", "ExtendedLineFields": {}, "LineShortCount": 0, "Mode": null, "ReleaseLineExtendedFields": {}, "Quantity": 0, "ShipViaId": null, "IsItemNotOnFile": false, "IsGiftCard": false, "IsPackAndHold": false, "ProcessInfo": { "IsSerialNumberRequired": null, "PickLocAssignmentType": null, "CubeMultipleQty": null, "LPNBreakAttribute": null, "OrganizationId": null, "ItemBreakAttribute": null, "SingleUnit": null, "UnitWeight": null, "ExtendedFields": null, "ParentOrderLine": null, "UnitVolume": null, "ExportInfoCode": null, "WaveProcessType": null, "ItemPrice": null, "CriticalDimension3": null, "PickTicketControlNumber": null, "CriticalDimension2": null, "PickUpReferenceNumber": null, "CriticalDimension1": null, "PriceTicketType": null, "Price": null, "BatchRequirementType": null, "DeliveryReferenceNumber": null, "PK": null, "VASProcessType": null }, "CancelReasonId": "Misc", "ReleaseLineId": "1", "ParentItemId": null, "IsReturnableAtStore": true, "FulfillmentGroupId": "2fe8f1e559ac8999fe7fe15cb9cbcf1", "UOM": "EA", "OrderLineSubtotal": 0, "UnitPrice": 39.99, "OrderLineId": "1", "TotalTaxes": 0, "OrderLineTotalTaxes": 0, "RequestedDeliveryDate": null, "CarrierCode": null, "OriginalUnitPrice": 39.99, "TotalDiscounts": 0 } ], "Address2": null, "ShipViaId": "UPSGR", "Address3": null, "Address1": "4400 SharonRoad", "ProcessInfo": { "InternalGoodsDescription": null, "AccountReceivableCode": null, "IsAutoCreateBlocked": null, "ShipLocationControl": null, "ScheduleDeliveryDate": null, "GlobalLocationNumber": null, "AdvertisingCode": null, "MovementOption": null, "ShipmentPlanningScheduleDay": null, "IsCartonMinWeight": null, "IsBackOrdered": null, "ExtendedFields": null, "WaveId": null, "RoutingAttributes": null, "PlanningOriginFacilityId": null, "IsAutoConsolidationBlocked": null, "DesignatedShipVia": null, "DeclaredValueCurrencyCode": null, "BillOfLadingBreakAttribute": null, "Priority": null, "ShipmmentPlanningScheduleDay": null, "AccountReceivableAccountNumber": null, "LPNCubingIndicator": null, "ParentOrder": null, "RouteType1": null, "RouteType2": null, "SecondryMaxicodeAddressNumber": null, "InternationalGoodsDescription": null, "AdvertisingDate": null, "OrganizationId": null, "RouteTo": null, "FedexDutyTaxAccountID": null, "FTSRNumber": null, "Language": null, "DsgStaticRouteId": null, "CashOnDeliveryFund": null, "PalletCubingIndicator": null, "DestinationShipThroughLocation": null, "DeclaredValue": null, "CustomerBrokerAccountNumber": null, "RouteWaveNumber": null, "FedexDutyTaxPaymentType": null, "ImporterDefinition": null, "MoveType": null, "FreightForwardAccountNumber": null, "IsWarehouseTransfer": null, "IsShipmentDocumentsOnly": null, "CustomerDepartment": null, "TransportationWaveOptionId": null, "PlanningDestinationFacilityId": null, "PK": null, "PrimaryMaxicodeAddressNumber": null, "DesignatedEquipmentId": null }, "CancelReasonId": null, "PostVoIdReasonId": null, "OrderLocale": null, "OrderTotalCharges": 0, "TotalTaxes": 0, "CustomerLastName": "Smith", "CapturedDate": "2021-06-22T08:11:40.927", "CarrierCode": "UPS", "OrderTotal": 0, "TotalDiscounts": 0 } Release Update Request to Fulfillment Mapping Release Update Request Manhattan Active® Omni Store ReleaseId FulfillmentId ReleaseLineId FulfillmentLineId order line.cancelReason FulfillmentReasonId ReleaseLine.Quantity as 0 for full line cancellation NA Release Update Response from Manhattan Active® Omni Store to Order Mapping Https Status Release Update Response Order Post Release Tracker Status Order Line CancellationRequestStatus Comments 200 "Type": "INFO",  "Code": "200",  "Description": "Success" Completed Success The line will be canceled. 409 "Type": "ERROR",  "Code": "250",  "Description": "TemporarilyRejected" Rejected Requested The line is temporarily rejected and can be retried later. 409 "Type": "ERROR",  "Code": "300",  "Description": "Failure" Failure Failure Cancellation is forever rejected for this line. 404 NA Failure Failure Business key not found (for example, fulfillment Id is not found) 500 NA Open Requested Technical error Sample Release Update Response{ "success": true, "header": null, "data": { "ServiceLevelCode": "UPS_GROUND", "IsVASRequired": false, "CreatedTimestamp": "2021-05-18T09:47:39.641", "IsCustomerOnTheWay": false, "OrderDeliveryMethodSubType": null, "Process": null, "CurrencyCode": null, "FulfillmentAddress": [], "CustomerPhone": null, "UpdatedBy": "dummyUser", "IsGift": false, "CustomerFirstName": "Sreeni", "OrderOrgId": null, "Packages": [], "IsVerified": false, "IsSameDayDelivery": false, "DocTypeId": "Customer Order", "ReturnToLocationId": null, "IsNonParcel": false, "CreatedBy": "dummyUser", "IsReturnLabelRequired": false, "Priority": "NA", "DeliveryMethodId": "PickUpAtStore", "DestinationActionId": null, "CustomerId": null, "FulfillmentCustCommPref": [], "FulfillmentPaymentMethod": [], "MaxStatusId": "1000.000", "FulfillmentInstruction": [], "DeliveryDueDate": null, "ContextId": "9b06f49e-5a5f-4240-992a-babb0492f332", "MinStatusId": "1000.000", "FulfillmentPickupConfirmation": null, "OverageAllowed": false, "DeliveryMethodSubType": null, "PickupExpiryDate": null, "AdditionalPurchasedValue": null, "OrderPriority": null, "ContainsAlert": false, "ShippedDate": null, "OrderCaptureDate": null, "ShipFromLocationId": "STR-Nellore", "ContainsInstruction": false, "IsClosed": false, "FulfillmentId": "FUL_PICKUP_8", "Source": "Order Component", "IsPickupConvertToShipment": false, "CustomerEmail": null, "FulfillmentLine": [], "OrderTypeId": "Ecom Order", "IsPickToSlot": false, "AdditionalPurchasedUnits": null, "PickedupValue": null, "FulfillmentStagingLocation": [], "UpdatedTimestamp": "2021-05-18T09:47:39.641", "ShipToLocationId": "STR-Nlr1", "ShipViaId": null, "CancelReasonId": null, "OrgId": "dummyOrg", "OrderLocale": null, "FulfillmentPickupContact": [], "ShippingDueDate": null, "PickupETADateTime": null, "CustomerLastName": "A", "PickupArrivalDateTime": null, "CarrierCode": "UPS", "PK": "6213312596357225832", "ExpectedDeliveryDate": null, "OrderTotal": null, "SlotDetail": null }, "messageKey": null, "message": null, "errors": [], "exceptions": [], "messages": { "Message": [ { "Type": "INFO", "Code": "200", "Description": "Success", "ShortDescription": null, "ErrorCode": null, "ErrorField": null, "ResourceId": null, "QuickInfo": false, "BusinessKeys": { "ReleaseId": "FUL_PICKUP_8", "ReleaseLineId": "2" } }, { "Type": "INFO", "Code": "200", "Description": "Success", "ShortDescription": null, "ErrorCode": null, "ErrorField": null, "ResourceId": null, "QuickInfo": false, "BusinessKeys": { "ReleaseId": "FUL_PICKUP_8", "ReleaseLineId": "1" } } ], "Size": 2 }, "rootCause": null, "requestUri": null, "statusCode": "OK" } Late Order Cancellation Integration with MAWM, External Store and External WM Eligibility for Line Cancellation This section explains the criteria that should be met for cancelling lines which are released from MAWM or external fulfillment systems. This also covers the eligibility criteria for items to cancel a release line. Validation Configuration Comments Line cancellation is restricted if non-Active Store or WM is not systematically handled to process late order modification Extension point should be defined for external fulfillment systems to process late order modifications. Refer here for extension point definition in case external fulfillment is designed to handle late order modification. OL1 - Release 1 - Active Store OL2 - Release 2 - Non-Active DC CSR or end customer cannot request for OL2 cancellation update in spite of all the above eligibility validation passes. Extension point: Order:Release:User Exit:ProcessExternalReleaseUpdate to send cancellation request to other Non Manhattan Active® Omni Store locations. The above user exit is invoked for post release line cancellation processing when the order line allocation source is non Manhattan Active® Omni Store location.  A non-MAO Store is identified as isManhattanActiveLocation is false and LocationType is Store. The input to the above user exit is release update request and location details. Refer here to configure extension point. Sample Release Update Request Sample Location Request for UE Implementation{ "LocationId":"StoreAtlanta", "DisplayId":"StoreAtlanta", "ParentOrgId":"ecomorg", "ShipToAddress":true, "ShipToStore":true, "LocationName":"Atlanta Store1", "LocationType":{ "LocationTypeId":"Store" }, "LocationStatus":{ "LocationStatusId":"Operational" }, "LocationSubType":{ "LocationSubTypeId":"HighVolumeStore" }, "Address":{ "FirstName":"STR-001", "LastName":"Store", "Address1":"2300, windy ridge", "City":"Atlanta", "State":"GA", "PostalCode":"30336", "Country":"US", "Phone":"2815551212", "Email":"yammy@rooster.net" } } User Exit:Order:Release:User Exit:ProcessExternalReleaseUpdate response to Order Mapping Https Status Release Update Response Order Post Release Tracker Status Order Line CancellationRequestStatus Comments 200 "Type": "INFO",  "Code": "200",  "Description": "Success" Completed Success The line will be canceled. 200 "Type": "ERROR",  "Code": "250",  "Description": "TemporarilyRejected" Rejected Requested The line is temporarily rejected and can be retried later. 200 "Type": "ERROR",  "Code": "300",  "Description": "Failure" Failure Failure Cancellation is forever rejected for this line. 404 NA Failure Failure Business key not found. 500/503 NA Open Requested Technical error. If user exit is implemented and the response is 500 / 503 error, then the tracker will remain in open status. These open records are not re-attempted automatically. The recommendation is to ignore these https status through configuration in the extension handler definition. Refer here for configuration details. Additionally, for an order line with a success tracker, If there is at least one failed tracker for the line, then the orderline.cancellationRequestStatus will be set to Partial Cancellation. If there is at least one rejected tracker then the orderline.cancellationRequestStatus will remain in Requested. For a given order line with a failure tracker, if there is at least one rejected tracker then the orderline.cancellationRequestStatus will remain in Requested. Refer below for an example, Cancellation Request Status calculation when Release Update request to multiple locations and their response Location DC Store OrderLine.CancellationRequestStatus Units 1 1 Release Update Response Success Success Success Success Failure Partial Cancellation Success Temporarily Rejected Requested Success TimeOut / Open Requested Failure Success Partial Cancellation Failure Failure Failure Failure Temporarily Rejected Requested Failure Time Out / Open Requested Time Out / Open Success Requested Time Out / Open Failure Requested Time Out / Open Temporarily Rejected Requested Time Out / Open Time Out / Open Requested Sample Release Update UE Response{ "success": true, "header": null, "data": null, "messageKey": null, "message": null, "errors": [], "exceptions": [], "messages": { "Message": [ { "Type": "WARNING", "Code": "250", "Description": "TemporarilyRejected", "ShortDescription": null, "ErrorCode": null, "ErrorField": null, "ResourceId": null, "QuickInfo": false, "BusinessKeys": { "ReleaseId": "CC100151", "ReleaseLineId": "1" } }, { "Type": "WARNING", "Code": "300", "Description": "Failure", "ShortDescription": null, "ErrorCode": null, "ErrorField": null, "ResourceId": null, "QuickInfo": false, "BusinessKeys": { "ReleaseId": "CC100151", "ReleaseLineId": "2" } } ], "Size": 2 }, "rootCause": null, "cloudComponentHostName": "C02WL3Q8G8WN", "cloudComponent": "com-manh-cp-fulfillment:10041", "requestUri": null, "statusCode": "OK" } Late Order Cancellation for STS and STH Merge Late order cancellation support STS and STH merge cancellation are dependent on the merge leg status, If the order line is released and the merge leg is not yet shipped, then the request is sent to the merge leg source. The order line is cancelled or not cancelled based on the response from the fulfillment or warehouse system. If the order line is shipped from merge source, but the pick-up/delivery leg is not yet released, Order Management will cancel the line without any communication to the fulfillment / warehouse system. If the order line is shipped from merge source and the pickup/delivery leg is released. The order line is cancelled or not cancelled based on the response from the fulfillment or warehouse system. For example, Fulfillment Location 1 In Transit Fulfillment Location 2 Steps Allocated Released In Picking Picked In Packing Packed Manifested Shipped (In Transit) Received Packed (Final Status for HD) Manifested Fulfilled (or Picked up) STS - MAO SIF MAO Store 1 - MAO Store 2 Eligible Accepted Temporarily Rejected Accepted Permanent Rejection Permanent Rejection NA Permanent Rejection from the store if there is a Release against Intransit inventory to the store else the line will be canceled in OM without any communication to the fulfillment system (there is no release against an Intransit inventory) Picked NA NA Not Eligible STS - MA WM & MAO SIF MA WM DC - MAO Store 1 Not Supported out of the box (Creation of MAWM ASN is not the same as merge leg MAO ASN) however creation and receiving of MAO ASN through custom extension can allow the retailers to leverage the STS cancellation. Also, the merge leg MAO ASN is not the same as the merge leg MAWM ASN. This means that when the merge leg is received, we cannot match it to the delivery leg allocation. STS - External WM & MAO SIF Not Supported out of the box (Receiving ASN in MAO SIF is not supported however receiving through custom extension can allow the retailers to leverage the STS cancellation. STH (Merge) - External Store or WM & Customer Address DC - DC1 - Customer Store - DC1 - Customer Eligible Depends on Warehouse Management System (WMS) / Fulfillment system capability Depends on WMS / Fulfillment system capability if there is a Release against Intransit inventory to the store else the line will be canceled in OM without any communication to the fulfillment system (there is no release against an Intransit inventory) Depends on WMS / Fulfillment system capability STH (Merge) - MAO SIF & Customer MAO Store 1 - DC 1 - Customer Not Supported (MAO store being merge source is not supported, hence cancellation of these is not applicable) STH (Merge) - MA WM & Customer MA WM DC - DC2 - Customer Not Supported (STH merge fulfillment from MAWM is not supported, hence cancellation of these is not applicable). When merge leg is shipped, MAO ASN record is not created. Also, the merge leg MAO ASN is not the same as the merge leg MAWM ASN. This means that when the merge leg is received, we cannot match it to the delivery leg allocation. Late Order Cancellation in the Contact Center The cancellation of a post-released line can be done in the following places in the application: The cancel option in the edit customer order and order status UI The Edit Order UI by clicking the 'X' cancel icon on the order line. This cancel icon is enabled based on the permitted mod type API. See the diagram below for details. The Cancel Line button on the Order Line List page The Cancel Line button on the Order Details page Once the user provides a reason for cancellation and confirms cancellation, the cancellation request is submitted to store fulfillment. If cancellation succeeds, then the page will automatically refresh and the line will appear canceled. If the line itself or some quantities on the line have failed cancellation or have been requested for cancellation, the user will see a pop-up with the real-time status of the line as a synchronous process. The Order Line List and Order Details pages currently do not have an indicator that cancellation has been requested. The cancel eligible quantities pop-up or the cancel backordered quantities pop-up is shown based on the Call Center configuration “Cancel Eligible Quantities” flag. See below for configuration details with few examples. Note: Late order cancellations in contact center are supported only at the order line level. Order-level cancellations are not supported by the contact center for orders in post-released status. Click here to view Post release cancellation flow for Contact center Late Order Cancellation in Digital Self-Service Customers can directly cancel items without the assistance of customer service using Digital Self-Service. See here for details. Late Order Cancellation in Store Fulfillment Late order cancellation in store fulfillment occurs when the order management system triggers the cancellation request to fulfillment component. Successful, temporary or permanent failures are rendered back to the order management system depending upon the status of the fulfillment. In case of BOPIS orders, if the fulfillment is associated with only the pickup leg, then the customer can successfully cancel the order at any stage up until the order is "picked-up". But in certain scenarios where the order needs to be fulfilled from another store or DC due to unavailability of inventory at the origin (aka STS) involving both merge and pickup leg, the customer can cancel the order successfully up until the order is in "picked" status at the merge leg. Once the order is in-packing, packed or  shipped, the customer cannot cancel the order unless the package arrives at the destination location and is yet to be received. If the cancellation request is triggered post package receiving process, successful cancellation is achieved. For ship to home orders, the cancellation is possible up until the order is in "in-packing" status. Manhattan Active® Omni Store application takes care of the return to shelf process post successful late order cancellation. Cancellation after Contacting Customer Refer here for more details Processing of Cancellation Requests When the cancellation request is made by the order management systems or contact customer function within SIF, below process is followed. Fulfillment parameter for late order cancellation is not enabled Not allowed to cancel. Fulfillment Id doesn't exist Not allowed to cancel. It's a permanent failure and cannot be retried later with the same request data. Fulfillment is not in picking Cancellation succeeds if other validations pass. Cancellation quantity is increased by the requested canceled units on the fulfillment line. Fulfillment line status and fulfillment status are updated as canceled if every ordered unit is canceled on the fulfillment line or fulfillment respectively. Late order cancellation request is recorded at the affected fulfillment line. Some of the notable information is Requested canceled quantity Cancel reason code provided Fulfillment line status at the time of cancellation Required to restock for selling again is false as no units were picked Fulfillment is in picking Not allowed to cancel until picking is completed. It indicates that the cancellation can be retried later with the same request data. Fulfillment is picked Cancellation succeeds if other validations pass. Cancellation quantity is increased by the requested canceled units on the fulfillment line. Picked quantity is reduced by the requested canceled units on the fulfillment line. Original picked quantity that was submitted during picking process is persisted and is unchanged throughout. Fulfillment line status and fulfillment status are updated as canceled if every ordered unit is canceled on the fulfillment line or fulfillment respectively. Late order cancellation request is recorded at the affected fulfillment line. Some of the notable information is Requested canceled quantity Cancel reason code provided Fulfillment line status at the time of cancellation Required to restock for selling again is true since there would be picked units that need to be returned Fulfillment is picked up or canceled or in packing or packed or shipped Not allowed to cancel. It's a permanent failure and cannot be retried later. The Late Order Cancellation service is used to modify the fulfillment. Note: Store Fulfillment supports cross-org Late Order Cancellation requests (for example, if the order's organization is A and the fulfillment's organization is B - details here: Cross-Organization Fulfillment Guide). Prepare Pickups Canceled units are excluded from the expected units to be picked in the pick list and list of fulfillments. Staging When staging fulfillments by a pick list that were canceled after picking are also listed, the store associates can use the order details to know the items to be returned to sell again. The store associate is alerted about the modification of the order post the picking process completion. This helps to stage only latest ordered units and return the canceled units. Canceled units are excluded from the staged units shown on the pickup slip. Contact Customer, Confirm Pickup, and Curbside Pickups When the store associate navigates to order details, modification of the order is alerted. This helps to handover only non-canceled units to the customer and return the canceled units back to shelf as sellable stock. Return To Shelf Return To Shelf (RTS) function lists fulfillment lines canceled after picking was completed. However, when few units are canceled on a fulfillment line, they are not listed in RTS. These are alerted during confirm pickup or staging or while contacting the customer so that they can be returned for selling. Prepare Shipments Canceled units are excluded from the expected units to be picked in the pick list and list of fulfillments. Packing Shipments When fulfillment or fulfillment lines are canceled after picking is completed, then in the pick list summary screen store associate can see the details of the canceled line items. If the fulfillment line is partially canceled, then the pick list summary screen shows the remaining quantity to be packed in red color. If the fulfillment line is fully canceled then the pick list summary screen shows the quantity to be packed as 0. In the packing screen, based on the modification alert, the store associate is required to acknowledge all the cancelled line items, remove them from the order, and place them back on the shelf or in the back room. This process helps the store associates to pack and ship only the non-canceled lines. Fully canceled fulfillments are also listed on the packing screen and once they are acknowledged by store associates then they aren't displayed again in the packing UI. Store associates can also be alerted to order modifications when they scan an item for packing using the pack by item functionality or when they scan the order for packing using the pack by order functionality. Note: If the team-based picking (Split and sort) is configured, then fulfillments can only be canceled when they are in the "Created" status. Configuration Below is a checklist of all configuration and interface mapping changes required to enable late order cancellation. *Indicates that help is required by Manhattan services to complete this configuration. Otherwise, configuration can be done within the application or in external, customer-owned systems. Order Enable Allow Post Release Cancellation in the Order Configuration UI. Enable the preview mode. See Cart and preview mode for more details. Enable cancellationInitiatedBy for order Reasons Cancel to generate cancellation emails through order config. Refer here for more details. Define Extension Handler for non Manhattan Active Omni® Store location post release cancellation. Refer here for more details. Define Service Definition for non Manhattan Active Omni® Store location post release cancellation. Refer here for more details. Organization/Location Enable "isManhattanActiveLocation" flag to true for a seamless integration with Manhattan Active® Omni Store. Email Enable cancellation confirmation emails if required by referring to the Transactional Emails guide. Digital Self-Service No specific configuration is required for late order cancellation in Digital Self-Service. More details here on enabling the general DSS cancel feature. Store Fulfillment Enable late order cancellation in the Store Fulfillment Parameters UI. Add resources to utilize the late order cancellation API. Add resources to cancel during Contact Customer. Update pullbacks pipeline data if required. Update fulfillment outbound configuration if required. Contact Center Enable "Cancel All Eligible Quantities" flag on the call center config. Add resources to cancel line in the order line list, order details page in Contact Center. Order Configuration To use late order cancellation, enable the 'Allow post-release cancellation' configuration in the Order Configuration UI or click here to enable this using APIs. Note: "Allow post release cancellation" flag is not an attribute in the order config entity but when enabled from the UI creates Mod Type Config Overrides for "ModTypeId": "OrderLine::Cancel", "OrderLine::Cancel::Customer", "OrderLine::Cancel::System" and "OrderLine::Quantity::Decrease" for all the delivery methods like STS, STH and BOPIS. If retailers want to enable post release cancellation only for a praticular delivery method then create mod type config overrides using rest API. Enabling mod type config overrides for an order config using rest APIs Mod type config overrides are supported only for mod type "order line::Cancel" and order line::Quantity::Decrease for Delivery method "Pick Up At Store" or "Ship To Store" and restrict from status "7000" (Picked Up) or "3500" (InProcess) Delivery method "Ship To Home" and restrict from status "3600 Packed. Refer to the examples below to save mod type config overrides for the delivery method "Pick Up At Store" using API {{url}}/order/api/order/orderConfig/save Save mod type config override for mod type OrderLine::Cancel { "OrderConfigId": "defaultConfig", "ModTypeConfig": [ { "ModTypeConfigOverrides": [ { "DeliveryMethod": { "DeliveryMethodId": "PickUpAtStore" }, "RestrictFromStatus": "7000" } ], "ModType": { "ModTypeId": "OrderLine::Cancel" } }, { "ModTypeConfigOverrides": [ { "DeliveryMethod": { "DeliveryMethodId": "PickUpAtStore" }, "RestrictFromStatus": "7000" } ], "ModType": { "ModTypeId": "OrderLine::Cancel::System" } }, { "ModTypeConfigOverrides": [ { "DeliveryMethod": { "DeliveryMethodId": "PickUpAtStore" }, "RestrictFromStatus": "7000" } ], "ModType": { "ModTypeId": "OrderLine::Cancel::Customer" } } ] } Save mod type config override for mod type OrderLine::Quantity::Decrease{ "OrderConfigId": "defaultConfig", "ModTypeConfig": { "ModTypeConfigOverrides": [ { "DeliveryMethod": { "DeliveryMethodId": "PickUpAtStore" }, "RestrictFromStatus": "7000" } ], "ModType": { "ModTypeId": "OrderLine::Quantity::Decrease" } } } Validations are in place if any other mod type is provided or any other delivery method or restrict from status for mod type "order line::Cancel" and order line::Quantity::Decrease is provided. Once the configuration is done, verify if "ModTypeConfigOverrides" is available for both the mod types mentioned above by calling {{url}}/order/api/order/orderConfig/DefaultConfig, use GET method. To disable mod type config overrides post enabling, then refer below samples to reset mod type config overrides using API {{url}} /order/api/order/orderConfig/save Reset mod type config overrides for post release cancellation{ "OrderConfigId": "DefaultConfig", "ModTypeConfig": { "Actions": { "ModTypeConfigOverrides": "RESET" }, "ModType": { "ModTypeId": "OrderLine::Cancel" } }, "ModTypeConfig": { "Actions": { "ModTypeConfigOverrides": "RESET" }, "ModType": { "ModTypeId": "OrderLine::Quantity::Decrease" } } } Modifying default configuration for delayed message service NextEvaluationTimeDuration for rejected line Default duration for rejected lines retries is 30 mins from the previous attempt, order.postReleaseCancel.rejectedDelayedMessageMinutes=30 ThresholdLimitDuration for reattempt of rejected line Default duration for rejected lines is 24 hrs post which the line is marked as failure, order.postReleaseCancel.thresholdDurationHours=24 All the above two values can be manually modified in Consul > Config > com-man-cp-order. Restart order depending on the implementation requirement Order Reason Codes Reason codes with reason type 'Cancel' must be defined in the Order Reasons UI. Reason codes defined for reason type cancel should be marked as "cancellationInitiatedBy" as customer for email notification to the end customer on successful line cancellation. Enabling the Customer Initiated Cancel Line Mod Type To deliver cancellation confirmation emails to customers, the "Customer Initiated Cancel Line" modification type is used so that only customer-initiated cancellations trigger the email. This ensures that system-initiated cancellations do not trigger this same email. If you do not see this mod type in your Order Configuration UI, sync the mod types by calling the API: {{url}}/order/api/order/orderConfig/sync. To trigger the outbound email message when customer-initiated cancellations occur, select "Cancellation confirmation for items cancelled" in the Email Message drop-down for this mod type. Order and XBoundAuth Service Definition for MAWM Integration The Service Definition in order that has the xbound URL to route to dcorder API for Cancellation along with the oAuth Service Id should be persisted. We should use the below body for saving to the order Service Definition (using system admin credentials) {{url}}/order/api/ServiceDefinition/serviceDefinition/save Order Service Definition{ "ComponentId": "COMPONENT-ORDER", "Url": "com-manh-cp-xbound:8080/dcorder/api/ServiceDefinition/invoke/ReleaseUpdateService", "ServiceId": "MAWMPostReleaseUpdatesService", "ServiceDefinitonParams": [ { "ParameterName": "PROTOCOL", "ParameterValue": "HTTP" }, { "ParameterName": "HTTPMETHOD", "ParameterValue": "POST" }, { "ParameterName": "ISEXTERNAL", "ParameterValue": false } ], "ServiceAuthParams": [ { "ParameterName": "oAuth.serviceId", "ParameterValue": "{:MAWMAuthServiceId}" }, { "ParameterName": "location", "ParameterValue": "$.ExternalShipFromLocationId" }, { "ParameterName": "organization", "ParameterValue": "$.ExternalOrganizationId" } ] } The MAWMPostReleaseUpdatesService functions only when MAO and MAWM share the same organization name. If the organization names do not match, use the request format outlined below to create the service. { "ComponentId": "COMPONENT-ORDER", "Url": "com-manh-cp-xbound:8080/dcorder/api/ServiceDefinition/invoke/ReleaseUpdateService", "ServiceId": "MAWMPostReleaseUpdatesService", "ServiceDefinitonParams": [ { "ParameterName": "PROTOCOL", "ParameterValue": "HTTP" }, { "ParameterName": "HTTPMETHOD", "ParameterValue": "POST" }, { "ParameterName": "ISEXTERNAL", "ParameterValue": false } ], "ServiceAuthParams": [ { "ParameterName": "oAuth.serviceId", "ParameterValue": "{:MAWMAuthServiceId}" }, { "ParameterName": "xbound-location", "ParameterValue": "$.ExternalShipFromLocationId" }, { "ParameterName": "xbound-organization", "ParameterValue": "$.ExternalOrganizationId" } ] } The Service Definition in xboundauth also has to be saved. We should use the below body for saving to the xboundauth Service Definition (using system credentials): {{url}}/xboundauth/api/ServiceDefinition/serviceDefinition/save XBoundAuthServiceDefintion{ "ComponentId": "Xboundauth", "Url": "com-manh-cp-xbound:8080/dcorderAuthorization/oauth/token", "ServiceId": "MAWMAuthService", "ServiceDefinitonParams": [ { "ParameterName": "ISEXTERNAL", "ParameterValue": false } ], "ServiceAuthParams": [ { "ParameterName": "xbound-basic.username", "ParameterValue": "{:XBoundBasicUsernameForMAWMService}" }, { "ParameterName": "xbound-basic.password", "ParameterValue": "{:XBoundBasicPasswordForMAWMService}" } ], "ServiceFormDataParams": [ { "ParameterName": "Content-Type", "ParameterValue": "application/x-www-form-urlencoded" }, { "ParameterName": "grant_type", "ParameterValue": "{:GrantTypeForMAWMService}" }, { "ParameterName": "username", "ParameterValue": "{:UsernameForMAWMService}" }, { "ParameterName": "password", "ParameterValue": "{:PasswordForMAWMService}" } ] } Note: Any value starting with “{:” in the above Service Definitions indicate they are picked up from consul properties. Next step points mention how to configure them. The "oAuth.serviceId" in the Service Definition of order is the xboundauth Service Id which is MAWMAuthService in the above body. And this value is picked up in the Service Definition of order from consul by the key: MAWMAuthServiceId. Thus, the following entry should be made in the consul of order: MAWMAuthServiceId=MAWMAuthService. If you use any other value as the xboundauth Service Definition Id, use that value as the consul property value. But keep the key name same, i.e., MAWMAuthServiceId - since that key name is persisted in the order Service Definition whose value will be picked up from consul. The following entry should be made in the consul of xboundauth: GrantTypeForMAWMService=password PasswordForMAWMService=Password@1234 UsernameForMAWMService=inadmin XBoundBasicPasswordForMAWMService=b4s8rgTyg55XYNun XBoundBasicUsernameForMAWMService=omnicomponent.1.0.0 The values above are corresponding to the environments that were used for the MAO MAWM integration testing, like the passwords and the usernames. Use the correct values for those fields according to your environment and retain the same key names that you use in your xboundauth Service Definition. The following entry should be made in the consul of xbound: zuul.routes.dcorder.path=/dcorder/** zuul.routes.dcorder.url=https://qasc.cp.manh.cloud/dcorder zuul.routes.dcorderAuthorization.path=/dcorderAuthorization/** zuul.routes.dcorderAuthorization.url=https://qasc-auth.cp.manh.cloud custom.free.pass=/dcorder/**,/dcorderAuthorization/** The hostname values above are corresponding to the environments that were used for the MAO MAWM integration testing. Use the correct values for those fields according to your environment. The following entry should be made in the consul of zuulserver: zuul.routes.xbound.url=http://com-manh-cp-xbound:8080 Do note that if the release location is an external store or external WM, same configurations as above need to be done according to the environment, so that the Service Definition in order can be saved with the ServiceId name as “ProcessExternalReleaseUpdate”. Note: The above order and XBoundAuth Service Definitions are samples of MAWM integration. If there is a requirement to integrate with external WM or external store, then create separate order and XBoundAuth service definitions with specific custom URL and environment consul properties. The entry condition to invoke the respective service definition can be defined. For example, if it's MAWM, then the entry condition is Location.IsManhattanActiveLocation==true && Location.LocationType.LocationTypeId=='DC'. For External WM,  Location.IsManhattanActiveLocation==false && Location.LocationType.LocationTypeId=='DC'. For External Store, Location.IsManhattanActiveLocation==False && Location.LocationType.LocationTypeId=='Store'. Note: In case there are multiple DC users then individual Xbound and Xbound Auth Service Definitions have to be created. Also, create encrypted values by calling /core/encrypt/{String} and use these encrypted values in consul properties. Note: If passwords are configured to expire after a certain time for human users, then it is recommended to create a Robo user with access to all the locations and use this. Store Fulfillment Configuration Resources for the Late Order Cancellation API An API is called to request cancellation on the fulfillment, and it performs the updates described. This API is invoked by order and contact customer within SIF but can also be invoked by an external order system. This API is protected by the resource below. API Name: URL: “/fulfillment/api/fulfillment/fulfillment/update” Resource Name: api::fulfillment::transaction::admin Resources for Cancel Option in Contact Customer Assign grants (resources) of the cancel option to the required user groups. Resource Name: ui-fulfillment::fulfillment::menu-cancelpickuporder Resource Name: ui-fulfillment::fulfillment::pickup-cancel-partial-quantity Allow Late Order Cancellation Configuration in Store Fulfillment Parameters defines whether the later order cancellation is allowed or not. The default value for these configurations is set to false. Set it true to enable late order cancellations within SIF for pickup and shipment orders. Configuration Name: Allow late order cancellations Fulfillment Reason Codes Reason codes with reason type 'Cancel' must be defined in Store Fulfillment Reasons UI and should match with the ones defined for order. Refer to Confirm Pickup Configurations for additional information on how to set up reason codes within SIF. Pullbacks Pipeline Changes This configuration is required when late order cancellation API is used to cancel pullbacks and transfers. Get the pipeline data using below API GET API Name: URL/fulfillment/api/ServiceDefinition/pipeline Verify that the PickupService and DropStatusDetermination exists with below data in pullback section "PickupService": { "FromStatus": "1000.000", "ComponentId": "Fulfillment", "ServiceId": "cancelFulfillment" } "DropStatusDetermination": { "FromStatus": "1000.000", "ComponentId": "Fulfillment", "ServiceId": "cancelFulfillment", "IntendedDropStatus": "9000.000", "Sequence": 1, "ConditionText": null, "DropStatus": "9000.000" } If the above data doesn't exist, add them to pullback section of the pipeline data and post it by using below API. POST API Name: URL/fulfillment/api/ServiceDefinition/pipeline/save Fulfillment Outbound Changes Get the outbound configuration data using below API GET API Name: URL/fulfillment/api/ServiceDefinition/outBoundMessageType Verify that FulfillmentPartialCancelMSGType exists with below data { "MessageType": "FulfillmentPartialCancelMSGType", "IsUserOverride": false, "Transactional": true, "PersistMessageToMsgStore": false, "OutBoundQueues": { "QueueName": "FulfillmentOutbound" } } If the above data doesn't exist, add them to the existing data and post it by using the below API. POST API Name: URL/fulfillment/api/ServiceDefinition/outBoundMessageType/save Contact Center Configuration The two main configurations to allow cancellation of post released order lines in the contact center are: The "Allow post-release cancellation" flag on the order config The "Cancel All Eligible Quantities" flag on the call center config "Cancel All Eligible Quantities" configuration supports the cancellation of all eligible quantities on a line. If "Allow post-release cancellation" is enabled in order configuration and "Cancel All Eligible Quantities" is enabled in call center, the user can cancel all eligible quantities that have already been released to stores or DC, even when complete line cancellation is not possible. If Allow post-release cancellation parameter is enabled in order configuration, the Cancel All Eligible Quantities parameter will only play a role when the order line has few quantities that are already picked up if the line is a pickup in store line or packed if it is a ship to home line. If all the quantities on the order line are less than picked up status (for a pickup in-store line) or packed status (for a ship to home line), then the entire line will be allowed for cancellation irrespective of the Cancel All Eligible Quantities flag being enabled or disabled. For example, If an order line has 11 quantities of an item, out of which all 11 are in released or ready to pick status, the entire line will be eligible for cancellation as long as the 'Allow post release cancellation' flag is enabled in the order config, irrespective of the Cancel All Eligible Quantities flag in call center config being enabled or disabled. When the Cancel All Eligible Quantities flag attribute is enabled, then all eligible quantities of an item in a partially picked up order line can get canceled. For example, If an order line has 11 quantities of an item, out of which 6 are in picked up status (for a pickup in-store line) or packed (for a ship to home line), 2 are released or ready to pick and 3 are back ordered, then on cancellation all the 5 units that are not yet picked up will get canceled. When the Cancel All Eligible Quantities flag attribute is disabled, then only the backordered quantities of an item in a partially picked up (for a pickup in-store line) or partially packed (for a ship to home line) order line can get canceled. For example, If an order line has 11 quantities of an item, out of which 6 are in picked up status, 2 in released or ready to pick and 3 backordered, then on cancellation, only the 3 units in backordered status get canceled. Resources for Order Line List & Order Details UIs The cancellation buttons on these pages are protected by grants: UI Action Resource details Order Line List Click the CANCEL button Click here for resource details Order Line List Click the CANCEL ELIGIBLE QUANTITY button Click here for resource details Order Details Click the CANCEL ORDER button Click here for resource details Order Details Click the CANCEL button Click here for resource details Order Details Click the CANCEL ELIGIBLE QUANTITY button Click here for resource details Implementation Flavors Late Order Cancellation Initiated from External Systems Late order cancellation requests can be initiated from external systems such as E-Commerce or External Contact Center integrating via order APIs. Refer here for more API details. Late Order Cancellation Integration with External Store and External WM If integrating with non Manhattan Active® Store applications, for example WMi or Pre Active WMOS and if these systems cannot process the request and cancel the line immediately, in such case, fulfillment system can send "Failure" response synchronously. Later, process the cancellation on fulfillment system and send Order Event "Short" in case of cancellation or Order Event "Ship" in case the line was not canceled but shipped. Alternatively, the cancellation request tracker can be updated directly by setting the status to 'Completed' with the appropriate cancelled quantities populated. Refer below to understand non-Active Store Fulfillment Asynchronous Cancellation implementation. External Call Center or Order API integration with non Active Store Fulfillment Late Order Cancellation in the Call Center at the Order Level Late Order Cancellation in the Call Center at the Order Level can be enabled by implementing the command router, interpreting the permitted modtype API response, and checking the minfulfillmentstatus value. If minfulfillmentstatus is equal to 3000 and less than 3700, then enable the cancel button. Once the order is canceled, interpret the save order request and set the isCancelled flag from true to false at the header and set the isCancelled flag from false to true for all the lines. This behavior is also impacted by Order::Cancel Mod type. To interpret the permitted mod type, use the below API. PermittedModTypes API : {{url}} /order/api/order/order/orderId/{orderId}/permittedModTypes Late order cancellation with vendor location Use the ProcessExternalReleaseUpdate user exit. This exit is triggered when the location type is set to Supplier (both in the organization and inventory location), with isMaActive set to false. This setup enables post-release cancellations without requiring any additional custom work. Feature Scope Currently, only full line cancellation is supported; Unit-level cancellations of released units are not supported. Full order cancellation is not supported. For example, if all the lines in the order are Pick Up At Store or Ship To Home and the lines are eligible for late order cancellation, the system does not support order level cancellation either through contact center, Omni Facade or through order APIs. The lines have to be canceled individually, which will result in order cancellation. Emails are generated on successful line cancellation or when the cancellation request results in failure for various scenarios. Post Release cancellation is certified only for customer order. Retail order post release line cancellation flow is not certified. UIs and Entities The configuration UIs mentioned in this document are listed in the following table, along with information to navigate to the API documentation. UI Name Component Group Seed Data Present? Seed Data Profile Store Fulfillment Parameters Fulfillment FulfillmentParameter services Yes Base Store Fulfillment Reasons Fulfillment FulfillmentReasons services Yes Base Services The APIs listed in the following table are referenced in this document. Refer to the API documentation for additional details on each service. Service Component Group Service Endpoint Save Order Order Order Services /order/api/order/order/save Cancel order Line Order Order Services /order/api/order/order/orderId/{{orderId}/order line/cancel Cancel multiple order lines Order Order Services /order/api/order/order/order line/cancel Return all the valid mod types for input order Order Order Services /order/api/order/order/orderId/{orderId}/permittedModTypes Late Order Cancellation Fulfillment Fulfillment Process Controller /fulfillment/api/fulfillment/fulfillment/lateOrderCancellation Fulfillment Update Fulfillment Fulfillment Translate and Update Controller /fulfillment/api/fulfillment/fulfillment/update Troubleshooting Why is released order line not eligible for cancellation? Verify if Line delivery method is PickUpAtStore and line is in Released status and above but less than Fulfilled status or verify if Line Delivery method is ShipToHome and line is in Released status and above but less than Packed status. If yes, then proceed to step 2. Check if in the Order Configuration page for your order type, the "Allow post release cancellation" flag is turned on. Also, verify "Get order config" using {{url}}/order/api/order/orderConfig/orderConfigId/ecommConfig, verify "ModTypeConfigOverrides" defined for delivery method PickUpAtStore and ShipToHome for both OrderLine::Cancel and OrderLine::Quantity::Decrease. If yes, then proceed to step 3. Verify if the BOPIS or STH released line is eligible for cancellation by calling eligible mod type API for your order - {{url}}/order/api/order/order/orderId/{orderId}/permittedModTypes, verify for "OrderLine::Cancel" mod type for the line. If yes, then line is eligible for cancellation. Why is released order not eligible for cancellation? Verify if the order is eligible for cancellation by calling eligible mod type API for your order - {{url}}/order/api/order/order/orderId/{orderId}/permittedModTypes, verify for "Order::Cancel" mod type for the order. If yes, then order is eligible for cancellation. Why is the released order line not canceled after requesting for cancellation? Verify OrderLine.CancellationRequestStatus, if the status is in Requested or Failure. If Requested then the order has already been requested for Cancellation. Please wait for further updates. - Fetch the Tracker details by using the below API POST {{url}}/order/api/order/postReleaseCancellationTracker/search { "Page": 0, "Query": "OrderId=MS_PAS_11", "Size": 10, "Sort": [ {} ], "Template": {} } Possible reasons for line being stuck in Requested are: If Tracker Line status is Open → The initial message posted is a delayed message, so please wait for a few seconds and check again. If it is still stuck in Open, ask services to verify the Fulfillment component is up. Verify if the response is 500/503 error. In either of the above two cases, use postReleaseCancel api to manually retry the open records for cancellation. If it still remains open, then manually mark the tracker to Failure using postReleaseCancellationTracker api. Work with RnD team for API details. If Tracker Line status is Rejected → Check if any of the line in the tracker is in the active pick list in Fulfillment. It will not accept the cancellation until the lines are removed from the active pick list. If Tracker Line status is stuck in Rejected state → Check if delayed message is posted to the Post Release cancel service from rabbitMQ/logs. Enable DEBUG logs for the file com.manh.cp.order.order.impl.handler.OrderPostReleaseHandler Search for keyword : onTrackerStatusChange() If Failure then the order line has failed the cancellation. Possible reasons can be: Check if “IsManhattanActiveLocation” for the location is set to true for Active Store integration. For all non-active store integration, verify if the flag is set to false. If the value is false and the User Exit “Order:Release:UserExit:ProcessExternalReleaseUpdate” is not implemented, then the tracker is marked as failure. Check if the Late Order Cancellation flag is set to true under Store Fulfillment Params. (This is a location specific flag) Ensure the ThresholdLimitDuration for reattempt of rejected line is greater than a minute at least. This is to give some time to Fulfillment Systems to process the cancellation. If the line has crossed the eligible cancel state in the meantime, example fulfilled, then the tracker is also marked as failure. Note : If a direct Fulfillment cancel event comes without the request originating from order, there will be no tracker created for this and CancellationRequestStatus will also be null. Is it possible to cancel the merge legs of pickup orders that are in released status using the late order cancellation job? Out-of-the-box functionality supports the cancellation of released lines that have been sent to the distribution center or store for fulfillment. However, cancelling released merge leg is not supported. Related Articles Extend Pickup WindowPrevent Shipment on Payment FailurePull Back Released OrdersChange Shipping Address