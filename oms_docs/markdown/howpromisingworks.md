# How Promising Works

**Permalink:** howpromisingworks
**Path:** Manhattan Active® Omni/Order Management/Process & Configuration Guides/Order Promising/How Promising Works
**Content Length:** 314,499 characters
**Scraped:** 2025-08-09T21:55:59.537982

---

Home ››Manhattan Active® Omni››Order Management››Process & Configuration Guides››Order Promising ››How Promising Works How Promising Works Previous I Next OverviewProcess FlowRead Promising RequestPrioritizeSelect the Prioritization tier based on number of unitsInventory AvailabilityMaintain Inventory status cacheHow Promising gets availability from inventory status cacheValidate Service LevelValidate LanesValidate VASFind Eligible Location(s)OptimizeApply ConstraintsCapacity ConstraintsScheduling ConstraintsInventory ConstraintsScope for further Allocation and OptimizationReserve InventoryForm Promising ResponsePromising TraceOrder AnalysisOrder Analysis - Map ConfigurationOther ConceptsOrder Modification and Re-PromisingPromising without Postal CodesSupport for Cross DockReturn Routing OptimizationHonor Fulfillment Optimization when Ship From Location Id is PassedAbility to Promise against Out-of-stock Inventory ConfigurationsHow to Set up Prioritization RuleHow Matching Supply is ComputedDifferent Types of Substitution - Impact on AllocationDifferent Ways of Allocation Overrides (capacity) - Impact on AllocationAllocation Overrides - How Does it Work at Different LevelsAllocation Overrides - Ignore ProtectionHow to Enable Shipping Restrictions evaluation for promising Enable Promising and ATP (Delivery Dates calculation in Product and Cart ATP) for Out-of-stock ItemsImplementation FlavorsHow to restrict a location from "Ship from stores" orders while fulfilling BOPIS ordersHow to prioritize On Hand supply before future supply for promisingWhy does force allocate on last priority tier cause my entire order line to be allocated against the force allocate tier?How to configure capacity override for BOPIS order linesHow to configure return routing optimizationHow can we restrict inventory or allocation so that some stores support both Merge and Pickup allocations, while other stores are limited to Pickup legs only in the STS flow (Without using RDD)?TroubleshootingReturn Routing OptimzationWhy are orders released with a non-existent shipping methodRelated Articles Overview This section describes the actions executed when a promising request is sent to the Promising component to reserve the order. Promising request can be sent as part of web reservation flow or as part of Order capture (API - POST {{url}}/promising/api/promising/promise/). Refer to the different type of promising request for more details. The input variables to each of the steps of this process are determined by the promising strategy or configuration. Process Flow The following set of actions is executed as part of promising Read Promising Request The input for promising is the Promising request which is either created by the Order component or sent by an external order capture system. Promising request consists of the list of line Item(s), quantity to be allocated, promising config details with other promising related attributes. Refer to the API documentation for the Promising service for more information on the request attributes. Promising request - Sample{ "Address": {}, "CarrierCode": "string", "ConsolidationLocationId": "string", "DeliveryMethodId": "string", "DemandType": "string", "ExistingReservations": [], "Extended": {}, "ExternalRouteId": "string", "IsConfirmed": false, "IsPartialRequest": false, "LastPossibleDeliveryDate": "2020-10-20T04:18:52.894Z", "OrganizationId": "string", "PromisingRequestDetail": [ { "ASNDetailId": "string", "ASNId": "string", "Address": {}, "CarrierCode": "string", "ConsolidationLocationId": "string", "DeliveryMethodId": "string", "DemandType": "string", "EffectiveRank": "string", "Extended": {}, "ExternalRouteId": "string", "FulfillmentGroupId": "string", "InventoryTypeId": "string", "IsForceAllocate": false, "ItemId": "string", "LastPossibleDeliveryDate": "2020-10-20T04:18:52.894Z", "PODetailId": "string", "POId": "string", "ParentItemId": "string", "ProductStatusId": "string", "PromisingRequestDetailId": "string", "Quantity": 0, "ReqCapacityPerUnit": 0, "RequestedDeliveryDate": "2020-10-20T04:18:52.894Z", "ServiceLevelCode": "string", "ShipFromLocationId": "string", "ShipToLocationId": "string", "ShippingMethodId": "string", "ShippingMethodIds": [ "string" ], "SourceId": "string", "StrategyType": "string", "Weight": 0 } ], "PromisingRequestId": "string", "RequestType": "string", "RequestedDeliveryDate": "2020-10-20T04:18:52.894Z", "ReservationExpiryDate": "2020-10-20T04:18:52.894Z", (Indicates the date on which the Reservation expires if the Order is not confirmed) "ServiceLevelCode": "string", "ShipFrom": { "Radius": 0, "RadiusUOM": "string", "Segments": [ "string" ], "ShipFromLocationIds": [ "string" ] }, "ShipToLocationId": "string", "ShippingMethodId": "string", "ShippingMethodIds": [ "string" ], "StrategyName": "string", (takes PromisingConfigName) "StrategyType": "string", "confirmed": true, "expiryDate": "2020-10-20T04:18:52.894Z" (Indicates the date on which the promising config expires) } Note : Demand Type is mandatory in the promising request. Once a promising request is received, the first step is to source the request. Sourcing defines the set of locations (inventories) from where orders can be reserved. As part of sourcing, the sourcing type defines whether to source from an Available to Commerce (ATC) view, a specific list of DCs, or all perpetual inventory. The source type is determined based on the promising configuration sent in the promising request. The parent header-level source is used for all lines unless a line-level override exists. This is based on the sourcing level defined in the promising configuration. Refer to Fulfillment Optimization Config UI for additional information. Section Description Sourcing Type ATC view - Uses an active ATC view to source for promising. The locations configured in the view become eligible source locations. The item and availability rules defined by the view defines the availability for allocation. Since these views are also used for publishing availability, the same controls used for defining availability are available to promising. Views defined for specific purposes should be used as sources for allocation for that specific purpose order. For example, a pickup at store view should be used for pickup at store order allocations, and a ship to home view should be used for ship to home order allocations. ATC views can also ensure that locations which are not available for various reasons are not considered for allocation. Any ATC view may be used for promising. Refer to the Available to Commerce guide for additional information on ATC views. Using an ATC view for allocation reduces the chances of over-allocation or under-allocation due to shortages or availability data issues. If an ATC view is selected as the source of inventory for promising, but the order line is created with instructions to allocate against a specific PO or in a specific location (in the Order Line promising info) that is not in the view, the order line will still allocate as specified by the host system. List of distribution centers - Retailers may choose to fulfill orders only from certain DCs. This may be the preferred setup for certain product classes that should only be fulfilled from DCs. This is also typically used for ship to store orders.  Note: Only list of DCs are available for selection in this option. For Location Type of Supplier/Store, use the ATC View option. Using a list of DCs as the source may not yield the most optimized solution, but given the fact that DCs are the main source for online order fulfillment, the results may be satisfactory. The promising configuration also runs the optimization engine across the DCs to give a better result. Perpetual Inventory - If a promising configuration ID is not sent in the Promising request, all perpetual inventory is used as the source. This considers all locations being fed into the optimization engine to select the best location for allocation. There is, however, a cost, as looking at so many potential sources is a performance intensive task. In addition, since perpetual inventory does not reflect what is actually available for allocation, this may lead to over-allocations or allocation cancellations due to shortages. Note: Different sourcing type can be defined for order and lines. Sourcing Level - Header (Order) Sourcing rules are defined at the order level. Unless overridden (see below) all lines on the order are sourced using the same rule. By default, sourcing is performed at the order header level, but line level overrides can also be defined. Configure order level rules to find the matching configuration for each order. The user can choose the order level fields such as order type or RDD to find the matching configuration. When a Return Order is evaluated for matching the return optimization template, the orders can be filtered based on the below Ship from Address attributes. Return Orders are filtered based on exact match criteria. Only the following filter attributes are available on the Return Optimization Template out of the box. Ship From Address Country Ship From Address State Ship From Address City Ship From Address Zip Code Note: • Any new ship from address attribute added through available attributes will not work. • The above attribute evaluation will only work for Return Orders when config Return Routing Optimization is enabled in Order Parameters. Header - Allocation Overrides Allocation overrides - Capacity and Protection can be defined at Line Overrides level. Refer to the Different ways of overriding Capacity and its Impact on Allocation for more details. Refer to the Protection Overrides and Its impact on Allocation for more details. Sourcing Level - Line (Line  overrides) It is common for certain order line attributes to drive sourcing decisions rather than header attributes. For example, a particular item class may only be available in a specific set of locations. This can be handled via order line overrides. The process for defining an override is the same as the initial source selection definition. The retailer defines the order line attributes as a filter criteria to select the lines which requires an overridden source. Multiple line level source overrides can be defined. If more than one rule matches the order line criteria, the rule with the highest sequence is chosen. If none of the line rules match the line attributes, then the parent source is used for line sourcing. Each source definition has a unique identifier referred to as Source ID. The source details consist of either the ATC View, or the list of DCs depending upon what the source type is. If an override condition is found for a line, the matching source ID is sent on the Promising request detail. If the source ID is not passed on the line, then the header-level source is used for promising. Refer to below section on how Sourcing level is identified. Note: While calling the promise API ({{url}}/promising/api/promising/promise) directly, the promising config name and SourceId should be passed. Refer to Promising Request Sample for more details Promising - Identify Sourcing Level Note: Line level overrides are not supported in the Return Optimization Template Line overrides - Source selection The line level overridden sources can be selected similar to parent source selection and can be the same or different from the parent source type. For example, parent source can be ATC View, whereas line level overridden source can be ATC View or distribution centers. For example, all ship to home orders can to be allocated using an ATC view with a number of DCs and stores configured. But, if a certain order line (i.e.heavy item) can only be fulfilled from DCs, the heavy item line-level criteria can override the source rules for the order. When a reservation occurs using this configuration, the entire order is allocated from the ATC view except for the overridden line which is allocated from one of the DCs configured with the override source. Line override rule conditions are configured for each overridden sourcing rule. These conditions are used to find the matching lines. Line overrides - Allocation overrides Allocation overrides - Capacity and Protection can be defined at the Line Overrides level. Refer to the Different ways of overriding Capacity and its Impact on Allocation for more details. Refer to the Protection Overrides and Its impact on Allocation for more details. Providing Sources on the Request If the reservation is attempted without a promising configuration, then optionally the Source Information (Location, Future supply information, Segment) can be provided for each request detail as the sources in the promising request. If sources are provided on the request detail, then the optimization algorithm is not run. Only basic inventory and scheduling check is performed. Source Location: One can provide a list of locations on the promising request to be used as source. The list of locations acts as the source for the entire request and overrides the source which is found in the promising configuration, if the promising configuration is also sent in the request. For example, if Store A and Store B are provided as sources on the request, and the sources found on the promising configuration to be used is ATC View1, the reservation happens only against Store A and/or Store B and the view is not considered for reservation. The order line in this scenario is only reserved against the location(s) provided. Future supply details: An ASN ID or a PO ID can be provided as a source on the promising request detail. To be more specific, ASN Detail ID or the PO detail ID can also be provided. The order line is reserved against the ASN or the PO mentioned in the request detail. Segment: Segments typically represent a set of inventories used for a particular channel. For example, an E-Commerce order is typically allocated against e-commerce segmented inventory. One can provide a list of segments on the promising request to ensure that reservation happens only against inventory belonging to those segments.  If, however, a location does not maintain segmentation, then the entire unsegmented inventory is eligible for reservation for such a request. In this case, the location sources can be considered from the sources provided on the request, or from the sources configured in the promising configuration. Evaluate Substitution Rules Substitution gives the ability for the system to allocate an alternative item from the originally ordered item if a rule is configured to do so. If this parameter is set to true, the system evaluates all the configured substitution rules to determine is substitution should occur. If false, the strategy does not evaluate substitution rules even if substitution rules are configured and promising occurs for the originally ordered item. Substitution is not supported with fulfillment optimization strategies that have reapportionment enabled. If this parameter is enabled, Get Substitution Rule API is invoked to fetch the applicable Substitution rules for the Item. A User Exit (GetSubstituteItems) is exposed to invoke Substitution rules from external system. If the Substitution Type is Immediate, original Item is replaced with the substituted Item in the promising request. If the Substitution Type is "On Back Order" then the substituted Item is appended to the promising request. Promising tries allocation for the original Item. On back order - Promising tries allocation for the substituted Item(s) based on the "On Back Order" rule. Refer to the below section on how Substitution rule is evaluated as part of sourcing process. Promising - Evaluate Substitution Rule Refer to the Substitution Guide for more details. Default BOPIS View The promising request for BOPIS (Buy Online Pick Up In Store) lines automatically considers the default view set in the promising configuration, eliminating the need for a line-specific override for BOPIS transactions. Refer here for Configuration Evaluate Shipping Restrictions If "Evaluate Shipping Restrictions" is set to "true", the promising request can evaluate the shipping restrictions in the background and will apply restrictions based on the matching configuration to exclude specific supply type, location type or all. Refer here for Configuration Prioritize Prioritization is the optional process of further filtering the locations identified during sourcing by determining the priority location(s) for allocation. The input to this process is the list of sources, and the output is the subset of those locations which are identified as priority locations for allocation. When prioritize is used, promising will attempt to fulfill all units from the 1st priority Tier before evaluating the 2nd Tier. Only units that cannot be fulfilled from the locations included in the 1st priority tier will be evaluated when proceeding to the 2nd tier. In addition to the location(s) priority - Segment and Demand Type priority can be defined in the prioritization rule. Refer how to define Prioritization rules for more details. Prioritization rules are configured within the promising configuration. If prioritization rules are configured for the strategy, then prioritization is used and rule(s) are applied to all the lines on the promising request. Prioritization logic occurs at the line level since the sources for each line can differ. Refer to below section to understand how Prioritize - Demand Type works Prioritze Demand Type - How it works? In Prioritization Tier, specific demand Type can also be selected. If a Demand Type is selected for a Tier, then it will override header or line level demand type sent in promising request. Once a demand type is selected for a Tier, promising will only consider mapped supply types as eligible inventory for allocation for that Tier. If it is selected as null, then header level Demand Type will be considered. For instance: if a retailer wants to prioritize physical on hand inventory across fulfillment network followed by future inventory, two tiers can be created with same location group but with different Demand Type as "Allocation" and "Allocation and Future" respectively. Promising will try to allocate order first from on hand inventory across locations followed by future inventory.Example 1 - Consider there are two Location groups (group 1 and group 2) and no demand type priority set up in the Prioritization. Location Group Location(s) Demand type Group 1 DC1, DC2 none Group 2 DC3, DC4 none Location Supply Type Available Qty DC1 On Order 100 DC2 In Transit 100 DC3 On Hand Available 50 Prioritization would allocation lines() at location group 1 before location group 2. However, because of the base Order Config having "Allocation and Future" as a demand type sent in the promising request, the system would allocate lines against "on-order supply" at location group 1 (assuming no on hand supply for the locations in group 1) , instead of against "on-hand available" supply at location group 2. This is not always the preferred behavior though, as allocating against future supply when on-hand supply exists in the network might create unnecessary delays in completely fulfilling an order. Example 2 - Consider there are two Location groups (group 1 and group 2) and demand type priority set up in the Prioritization. Location Group Location(s) Demand type Group 1 DC1, DC2 Allocation (On Hand) Group 2 DC3, DC4 Allocation (On Hand) Group 3 DC1, DC2 Future Group 4 DC3, DC4 Future Location Supply Type Available Qty DC1 On Order 100 DC2 In Transit 100 DC3 On Hand Available 50 Priority rules can be set up to allocate against "Allocation" supply at location group 1, before attempting to allocate "Allocation" supply at location group 2, before attempting to allocate against "Future" supply at location group 1, before attempting to allocate against "Future" supply at location group 2. This is done by setting a demand type field in each priority rule, which will override the demand type that is set in Order Config, for the purpose of evaluating a given line that is being evaluated by that rule. This ensures that we are completely fulfilling orders as soon as possible with "Allocation" supply throughout the network as much as possible, before resorting to allocating supply which isn't physically in a location yet. If an order is allocated from Future inventory such as PO or ASN then during receiving, quantities will move between different supplies and allocations will also move with those supplies accordingly. During transfer allocation, demand type used during allocation will not be referred but the demand type from the configured parameter “TransferAllocationDemandType” in Inventory Configuration will be used, default value is “Allocation and Future”. To enable this feature, “ForwardTransferFeature” in inventory Configuration should be set as True. Once this feature is enabled, Transfer allocation will only consider supply type sent in the event during receiving, even if there is any other available inventory with higher supply Type rank. During Movement of inventory between supply Types, allocation will always be transferred. For example: Fulfillment Configuration for DC's Tiers Location Group Demand Type Tier1 East DC's Allocation Tier2 East DC's Allocation and Future Tier3 West DC's Allocation Tier4 West DC's Allocation and Future Supply Picture Location On Hand ASN PO East DC1 10 0 0 East DC2 20 50 10 West DC1 10 0 0 West DC1 20 50 10 NOTE* ASN is ranked higher than PO Following Table shows the supply information of a location which is considered for allocation: Requested Quantity East DC1 East DC2 West DC1 West DC2 If Requested quantity is 20 On Hand - 10 On Hand - 10 If Requested quantity is 50 On Hand - 10 On Hand - 20 ASN - 20 If Requested quantity is 120 On Hand - 10 On Hand - 20 ASN - 50 PO - 10 On Hand - 10 On Hand - 20 Note: If the entire request detail cannot be fulfilled by the priority locations, the allocation is reverted. Prioritization identifies priority locations differently depending on the source type: ATC view - The priority locations are the common locations between those configured in the ATC view and the prioritization rules are considered as the priority locations. Perpetual inventory - All the locations configured in the prioritization rules are the priority locations. List of DCs - The common locations between those defined in sourcing and the priority rule are considered as the priority locations. When Source Location(s) is defined in the Promising request for a Line, then Prioritization Tier is not evaluated for the line. It considers the source location sent in the request. Refer to the below section to find how Prioritization rules are evaluated. Promising - Prioritization Below processes are performed for all the eligible location(s) from a priority tier. These steps are repeated for the subsequent tier location(s) if there are any unfulfilled units from the previous tier location(s). Also, promising request details are logically grouped based on the Fulfillment Group ID and Strategy Type (Complete Single Source) and every group is tried for promising separately. Once the promising is completed for all the logical groups then Reservation process takes place. Note: If there are no prioritization tiers defined, then promising can pickup a Location (based on the optimization) and allocate against On Hand or Future Supply based on the Inventory available for the location. Refer How to prioritize, promising to allocate against On-hand before future supply for more details. Select the Prioritization tier based on number of units Prioritization tiers allow filtering of fulfillment groups based on their total unit count. During prioritization, a tier is applied only if the total number of units in the fulfillment group falls within the specified minimum and/or maximum thresholds. If no thresholds are defined, the tier is evaluated without unit-based constraints. For tiers with minimum and maximum unit constraints, fulfillment is considered as a single-source allocation strategy. To ensure flexibility, it is recommended to configure at least one lower-priority tier without unit constraints to act as a fallback for orders that do not meet specific unit thresholds. Implementation examples: Use a tier with a max unit as 1 to prioritize a given location group for single-unit orders. Use a tier with min units as 5 to prioritize a location group for large orders. Inventory Availability Inventory Status Cache is used to maintain status at qualitative level such as "Low"/"Medium"/"High". Whenever an order is allocated or standalone promising request is sent, availability for an item across locations is evaluated based on cache status. This is done to avoid multiple calls to the database supply table while running promising logic for finding optimized location for allocation. Status Quantity Low 1-10 Medium 11-20 High 21+ Note: The inventory status cache is not to be confused with the availability caches part of interactive inventory. The inventory status cache stays active even if interactive inventory is deactivated and serves as a fall back in case the interactive inventory caches are not available. See Interactive inventory documentation for more information. Maintain Inventory status cache What is commonly referred as Inventory status cache contains three information accessed using different types of keys. The information retrieved depends on the key used to call the cache. The item supply specific data is accessed using: Key = <itemId>:supply (replace <itemId> by the actual item Id) Content: By supply type the list of location with availability, the availability status ("Low"/"Medium"/"High"), a "isFutureSupplyAvailable" boolean flag to indicate if the supply is a PO or ASN, a "skipSupplyCache" flag indicating if the location supports inventory status cache. See Skip supply cache section below for more information. It is updated synchronously every time a supply record is updated. It is updated asynchronously when a view is rebuilt or when an item is created. The view specific data is accessed using: Key = <itemId>:view (replace <itemId> by the actual item Id) Content: By view, the list of location and if the item is available in this location It is updated synchronously every time a supply event is processed, or a view is updated and every time an item or location is created/updated The "All_Items" information is accessed using: Key = "ALL_ITEMS" Content: A single record with an array of all the location and if they are currently at full capacity or victim of a fulfillment outage It is updated synchronously every time an outage is enabled or a location "IsCapacityFull" flag is updated. If this cache not have any status for a location /item, it will synchronously call the database to retrieve the information and will generate a message to rebuild that cache record asynchronously. Skip supply cache: Item Supply cache maintains the availability status at Item, Location, Supply Type level (against a view). Cache doesn't maintain the information at Attributes or Segments level. So, when a location maintains supply by attributes then Supply cache status may not be accurate (if different inventory attribute comes in the system then last one will override the status). For example, if current status is Low based on the quantity, then if same supply event comes with different attribute with negative quantity then this supply will override the status and makes it to NONE. This is because currently cache status is not maintained based on attributes and segment Id. Skip Supply cacheWhen location maintains any inventory attributes then internally system will update "Skip Cache" = true instead of updating the cache status for all items with respect to that location id only. For the locations which maintains attributes, cache response will have Skip Cache as true for the location. Example - Consider AtlantaDC maintains supply by attributes then Cache response will be [ { "ItemId": "OnePlus6T", "LocationId": "AtlantaDC", "Status": "NONE", (If Skip cache is true for a location then Status will be none) "SupplyTypeId": null, "IsFutureSupplyAvailable": false, "IsFallback": false, "SkipSupplyCache": true (Indicates if location attributes are maintained. So cache is skipped) } ] For these locations (SkipSupplyCache = True), a get supply call is made to get the exact Supply details and based on the response, it will calculate the total available quantity and set the status dynamically to proceed. How Promising gets availability from inventory status cache The supply check performed at this stage is a preliminary check. This initial supply check is done against cached inventory information (for approximate inventory information) in order to make the elimination process faster. The Inventory status cache is used to identify locations that will for sure have enough inventory to serve the promising request. The Inventory status cache provides bracketed information (low, medium, high) of how much supply is available for each location. During the inventory status cache check, the demand supply match is not performed. Since the process is meant to perform a quick evaluation of locations, only the quantities are compared during this check. Refer to the below section on how promising uses the Inventory status cache. Promising - Check Supply Cache Input to this process are the list of Items, View name in case the source type is ATC, Requested quantity and List of location(s) when there is a priority tier (API - {{url}}/promising/api/promising/getInventoryStatus). Warning: If protection levels are configured in the views, they will not be taken into account at this stage of the promising checks. Protections levels are applied after this step during the promising process. This means that a location identified in a certain bracket may not have enough inventory available to allocate the full quantity of a line because of protection levels. This situation is solved in Interactive Inventory reservation. Sample Request { "ItemId" : "OnePlus6T", "DemandType" : "Allocation and Future", (If want to check the status for based on specific demand type ) "Locations" : [] (Optional : - if you want to check availability for some specific locations only) } Sample Response { "ItemId": "OnePlus6T", "LocationId": "AtlantaDC", "Status": LOW, "SupplyTypeId": "On Hand Available", "IsFutureSupplyAvailable": false, (Indicates if future supply is available or not) "IsFallback": false (Indicates whether status is from cache or from DB, false means from cache) } The requested quantity is compared to the brackets (low/medium/high) to decide for which location the system will need a call to the supply table to get accurate quantity and which location has for sure enough supply to serve the request. For example, if the requested quantity falls in the medium bracket, then for all locations in the low bracket or medium bracket, the supply table is called to get accurate quantities. High bracket locations are considered without accurate quantities as it is assumed the location has enough inventory available to serve the request. Output of this process is the list of Location(s) and their quantity status and actual quantities when needed for every Item. There is a user exit exposed to exclude additional location(s) that do have inventory based on custom logic (UE -> GetExcludedLocations). Validate Service Level The list of service levels supported by each location that have availability is fetched from the Location Service Level entity. Only the locations that support the incoming service level(s) are considered eligible for promising and will participate in the optimization process. If the incoming request contains shipping method and not a service level, the shipping method is first resolved to a service level based on the Ship Via Selection Logic and the locations are evaluated against this service level. Refer to Inventory Location - Service Level for details on how to configure the eligible service levels for a location. This validation is applicable for all Promising Modes. This service level validation is controlled using "Validate Service Level" configuration in promising configuration parameters entity. When this configuration is turned on, the promising process will filter only the eligible locations that support the incoming service level. If a particular location is not configured with any supported service levels, it will not be considered for the promising process. As a result, turning this parameter on mandates the user to configure all supported service levels at the location level. When the configuration is turned off, the promising process will skip the location filtering process. All locations will be considered eligible for the promising process irrespective of whether they support the incoming service level or not. Validate Lanes The functionality to validate the transit lane presence during the forward scheduling part of the promising process can be turned on and off using the "Validate Lanes for EDD" configuration in promising config parameters. When this configuration is turned on, the promising process will only consider locations that are connected to the destination by a valid transit lane for that carrier/service level. If no transit lane is found for that combination of origin, destination, carrier and service level, the location will not be considered for allocation. When the configuration is turned off, if the promising process does not find a transit lane for that combination of origin, destination, carrier and service level, the location will still be considered for allocation even if no transit lane and transit time can be found. This behavior is also controlled by the "Validate Lanes For Greedy" parameter, which should be set to true in the promising config parameters using the following API. {{url}}/promising/api/promising/promisingConfigParameters { "ValidateLanesForGreedy": true, "PromisingConfigParameterId": "1" } Note: As soon as RDD is passed on the request, transit lanes are validated independantly of this parameter. Validate VAS The list of value added service supported by each location that have availability is fetched from the inventory location Value added service list. Only the location that support the incoming VAS are considered eligible for promising and will participate in the optimization process. The VAS validation is controlled using "Validate VAS" configuration in promising config parameter entity. When this configuration is turned on, the promising process will filter only the eligible locations that support the incoming VAS. When the configuration is turned off, the promising process will skip the location filtering process for VAS. All locations will be considered eligible for the promising process, irrespective of whether they support the incoming VAS or not. For BOPIS orders, it is possible to ignore the VAS validation in the store. This is assuming that the order capture process already perform some type of validation that the VAS is available in the store the customer selects for pick up at store. This behavior is controled by "Ignore VAS validation for BOPIS" parameter in promising config parameters. Find Eligible Location(s) From the list of location(s) from cache that support the incoming service level, find the location(s) which can fulfill the maximum number of order lines. This is done to potentially bring down the number of shipments, and hence the shipping cost and the total fulfillment cost. Thus, the locations which can fulfill most number of lines are considered first for promising. No cost optimization is performed at this stage. There is a possibility of more than one location which can fulfill max number of Order Line(s). If the Promising request is of type "Reservation" or if there is no Optimization defined or No promising config provided then system randomly pick up a location for reservation from this list provided the hard constraints - capacity and scheduling is successful. If the Promising request is of type "Query/Optimization" and Optimization factors defined for the promising config then system sends the list of eligible location(s) and Item combination to the next step (Optimize) to find the lowest cost of fulfillment. If there are no location(s) which can fulfill maximum number of line(s) then system evaluates the location(s) which can fulfill the next max number of line(s). For example, if there are three line(s) and no location(s) can fulfill all three lines then system evaluates the location(s) which can at least fulfill two line(s) together. If still no location(s) then system evaluates if any location which can fulfill at least one line. User Exit "GetLocationOverride" is exposed to override Carrier related data (Carrier pickup time) for a location. Find Eligible Location(s) Promising - Find Eligible locations (Examples)Example 1: Basic scenario (1 order line, 1 quantity) This is a basic scenario to demonstrate that allocation happens from the cheapest location. It involves an order with just one order line and 1 requested quantity. Setup: Order O with 1 order line OL1 with 1 quantity requested for ItemA Locations L1, L2, L3, L4 and L5 The following shows the grid map of whether the item is available or not at the given location. Green indicates availability. L1 L2 L3 L4 L5 ItemA Steps: Find the locations which can fulfill the order: L1, L4 and L5 Find the cost of fulfillment for each of the location: F1, F4 and F5 Reserve inventory against the cheapest location: Location where cost = Min (F1, F4, F5) Example 2: Basic scenario (3 order lines, 1 quantity each line) This is a basic scenario to demonstrate that allocation happens from a location which can fulfill all the lines. If there are more than one such location, then the algorithm tries to find the cheapest location among this list and allocates the order from there. Setup: Order O with 3 order lines OL1, OL2, OL3 with 1 quantity requested per order line for ItemA, ItemB, and ItemC respectively Locations L1, L2, L3, L4 and L5 The following shows the grid map of whether the item is available or not at the given location. Green indicates availability L1 L2 L3 L4 L5 ItemA ItemB ItemC Steps: The algorithm assumes that the location which can fulfill the maximum number of lines is among the potential locations from where the allocation can happen. Find locations which can fulfill maximum order lines: L1 and L4 Find the cost of fulfillment for each of the location:  F1 and F4 Reserve inventory against the cheapest location:  Location where cost = Min (F1, F4) Example 3: Basic Scenario (3 order line, 1 quantity each line, no locations can fulfill all order lines) This is a scenario to demonstrate that allocation happens from a location which can fulfill maximum number of lines. In this scenario, none of the locations can fulfill all the order lines. So the algorithm tries to find the location from which the maximum lines can be filled. The algorithm is repeated to find the locations which can fulfill the remaining lines. Setup: Order O with 3 order lines OL1, OL2, OL3 with 1 quantity requested per order line for ItemA, ItemB, and ItemC respectively Locations L1, L2, L3, L4 and L5 The following shows the grid map of whether the item is available or not at the given location. Green indicates availability L1 L2 L3 L4 L5 ItemA ItemB ItemC Steps: The algorithm assumes that the location which can fulfill the maximum number of lines is among the potential locations from where the allocation can happen. None of the location can fulfill all the three lines. Find locations which can fulfill maximum order lines:   L1, L4 and L5 Find the cost of fulfillment for each of the location:   F11, F14, and F15** Find location with the cheapest cost of fulfillment:  Location where cost = Min(F11, F14, F15) Let’s assume that Location L5 was the cheapest location. Hence ItemA and ItemC are reserved against Location L5. The item which is pending and yet to be allocated is ItemB. The following shows the grid map of item availability for ItemB. L1 L2 L3 L4 L5 ItemA Allocated ItemB ItemC Allocated The algorithm steps are repeated for ItemB Find locations which can fulfill maximum order lines:  L1, L2 and L4 Find the cost of fulfillment for each of the location: F21, F22 and F24 Find location with the cheapest cost of fulfillment: Location where cost = Min (F21, F22, F24) Let’s assume that Location L2 was the cheapest location among the three considered. Hence ItemB is reserved against Location L2. The cost of fulfillment of Location L1 in the first iteration F11 is different from second iteration F21, as the items that are getting fulfilled in the two iterations are different. In the first iteration ItemA and ItemB together were considered, but in second iteration, only itemB was considered for fulfillment. Refer to How Optimization works for more details on the Fulfillment cost evaluation If Strategy is "Complete Single Source" then system evaluates if there are any location(s) which can fulfill all Item(s) together. If yes, then the location(s) are sent to the next step. If not, then next tier is evaluated. Refer to Complete single source for more details. Optimize Optimization determines the best of the available locations and is the most important process of promising. The objective of optimization is to select the location/location combination with the lowest overall cost of fulfillment. Various factors are available for consideration in this decision, including shipping cost, capacity and store performance. The input to the optimization process is a list of locations which can fulfill each line item. The output is the location or location combination for each line in a sorted manner based on the lowest cost of fulfillment. This is an optional step, and it is performed for Promising request with type "Query/Optimization" and Optimization factors defined for the promising config. Refer to the optimization detail section for detailed fulfillment optimization information. At the end of the optimization, location with the least total cost of fulfillment is selected for Promising. In case, there are multiple location(s) with the same cost of fulfillment at the end of this process then location is picked up randomly from the shortlisted location(s). Note: Optimization happens for the Location(s) defined in a particular prioritization tier and not across all Tier(s). Tiers work independently. Any unallocated units from one Tier goes to the next Tier Apply Constraints Promising constraints are applied to eliminate locations which do not meet basic criteria for allocation. For example, if a location does not have inventory for a certain item, the location is no longer considered for that line. This step is performed for all promising request of type "Query, Reservation and Optimization" and is performed for one location at a time. In case of Optimization mode - the lowest ranked location is picked up. In case of Reservation mode - random location is picked up. The following constraints are applied during this process: Capacity constraints Scheduling constraints Inventory constraints Capacity Constraints If a location does not have enough capacity or the time when the allocation is being performed outside the location fulfillment hours, the location is excluded from the process. Refer to the Capacity Management guide for additional information. Location fulfillment hours - The time of day when a location can fulfill e-commerce orders can be defined for each location (Capacity Definition). The fulfillment hours are defined along with the capacity availability for that location. In the below example, the store has dedicated capacity to fulfill e-commerce orders only in the period of 10:00 to 5:00 and 18:00 to 22:00. If an order is processed for allocation at 17:30, this location is excluded since it is not available at that time. Location Day Start Time End Time Capacity Store A Monday 10:00 17:00 10 Store A Monday 18:00 22:00 5 If capacity is not defined for a shift/day or Order is created outside capacity shift hours, the order will not get allocated against the location. If capacity is defined under capacity overrides but capacity not set under Capacity Definition then store is considered as closed and Order will not get allocated against the location. If capacity is defined as zero for a shift/day (under Capacity definition or Capacity definition overrides) then the order will not get allocated against the location. But there can be few instances where Retailers may still want to fulfill orders which do not require capacity, such as Pickup In Store or Curbside pickup on such days whereas restricts "Ship from store" orders from allocation. This can be achieved by enabling "ConsiderZeroCapacityLocation" flag in the Promising Config Parameters (Default false). Note* Orders with source as DCs in Fulfillment Optimization Config will get allocated even if capacity defined is '0'. Below are the three configuration variations which will consider Location with "Zero" capacity for allocation provided "ConsiderZeroCapacityLocation" is True S.N Source View: Exclude Location with Capacity Full ANF Config: Allocation Override ** 1 View False None 2 View False Ignore Capacity 3 View True Ignore Capacity ** - Refer to different ways of Allocation override - capacity for more details. Capacity full - If a location has consumed all available capacity for the day/shift (meaning that the number of orders/order lines/units allocated has reached the threshold defined for the location/day/shift), the location is not considered for further allocations for the day/shift. ATC view can publish a location as out-of-stock once the location has reached its capacity. When an ATC view is used as the source for allocation, a location at full capacity is excluded as part of the capacity constraint check (when ATC view is configured to exclude location(s) running at full capacity). Override Capacity - Override capacity flag can be set as part of source and prioritize. Refer to the Different ways of overriding Capacity and its Impact on Allocation for more details. None - This is the default behavior and  indicates no capacity override is performed. Locations running at full capacity will be considered for allocation based on the above ATC configuration. Location(s) running at full capacity are considered for allocation if ATC view is configured to publish availability for these location (Attribute - Exclude inventory from facilities at full capacity is set to False) Location(s) running at full capacity are not considered for allocation if ATC view is not configured to publish availability for these location (Attribute - Exclude inventory from facilities at full capacity is set to True) Ignore capacity - Helps to consider the location(s) for further allocations for the day/shift even though the location running at full capacity and ATC is configured to exclude these location(s) from publishing availability. Consider capacity - Helps to publish the Availability for location(s) running at full capacity but Ignores these locations for allocation. When source is perpetual inventory, location is not excluded even though the capacity is full Tip: To exclude locations at full capacity from allocation, use an ATC view as the source. Scheduling Constraints If a location cannot deliver an order on or before the requested delivery date (RDD) or Last possible deliver date (LPDD - used when location cannot deliver by RDD) or a transit lane does not exist between the location and the destination address, the location is excluded from promising process. Promising requests may be sent with a RDD that is specified at the header and/or line level. Promising attempts to find the potential locations which can deliver the order (or lines) on or before the RDD. Promising checks that: A transit lane exists between the location and the destination A zone is a group of transit lanes sharing the same transit time The location can deliver the order on or before the RDD The location can deliver the order on or before the LPDD (If location doesn't meet RDD) Transit Lane - Transit lanes (and Zone) information should exist in the Parcel component. Zone data defines the path and transit time that exists between the location address and the destination address. User Exit (GetCarrierSchedulingData) is exposed to fetch the zone related data from external system. Promising validates scheduling lanes and transit time only when order has Requested delivery date (RDD) or Last possible deliver date (LPDD) populated. So if RDD/LPDD is not populated then the check for transit lane would not happen. Example: Zone Lane Ship Via Origin Region (Postal Code) Destination Region (Postal Code) Transit Time (in hours) Zone 1 Lane 11 UPS-Ground 202 (postal codes from 20200 to 20299) 303 (postal codes from 30200 to 30299) 48 Lane 12 UPS-Ground 202 (postal codes from 20200 to 20299) 304 (postal codes from 30400 to 30499) 48 Lane 13 UPS-Ground 202 (postal codes from 20200 to 20299) 305 (postal codes from 30500 to 30599) 48 Zone 2 Lane 21 UPS-Ground DC1 303 (postal codes from 30200 to 30299) 24 Lane 22 UPS-Ground DC1 304 (postal codes from 30400 to 30499) 24 Zone 3 Lane 31 UPS-Ground DC1 Store 1 36 In the above example - Assume a location address in postal code 20233, destination address in 30339, and ship via on the Promising request of UPS Ground. Using the table above, a transit lane is found for that combination. The total time it may take to deliver the item once shipped from location is 48 hours. Consider Location 2 address in postal code 10001, since the lane doesn't exist for the origin, destination and ship via, scheduling would not pass for Location 2. Note: Even if a location does not pass the transit lane check, the location can still be considered for allocation for other lines because it is possible that the destination addresses for other lines is different. Refer to the Fulfillment Grouping section for additional information on how requests for order lines with different address are handled. Also, refer to How Scheduling works for more information on how transit lane calculations are done. Scheduling Dates - A check is performed to see if the location can deliver the order (or lines) before the RDD. This check (API - /api/promising/getLatestDatesList) is performed only if the RDD is sent on the promising request either at the header level or at each line level. If it is not provided, any location with a transit lane available to the destination passes the scheduling constraint. Latest Ship Date (LSD) and Latest Release Date (LRD) is computed for the location using RDD.  The concept of calculating the dates is referred to as scheduling. Latest Ship Date (LSD) = RDD - Carrier Zone Transit Time Latest Release Date (LRD) = Latest Ship Date - Location Processing Time If LRD is greater than the current timestamp then Scheduling is considered as success. If not, Latest Release Date (LRD) is recomputed for the location using Last Possible Delivery Date (LPDD). This check is performed only if the LPDD is sent on the promising request. If the new LRD is greater than the current timestamp then Scheduling is considered as success. If not, Scheduling is considered as failed for the location. Refer to How Scheduling works for additional information. Note: A location that is excluded because of scheduling reasons will still be a part of the locations evaluated for promising. This will result in these locations being a part of the promising trace and eventually the order analysis UI. Refer to Order Analysis for more details. Inventory Constraints If the requested quantity and the quantity status (from cache) is of the same level then a real-time supply check for the demand type is performed to make sure location can still fulfill the requested quantity. Get Supply call (POST url/inventory/api/inventory/supply/search) to the Inventory component is performed to fetch the real-time supply details. For example, consider the requested quantity is 10 and quantity status is High (> 20 units) then it is less likely the reservation would fail. So in this case, real-time supply check is not performed. But if the requested quantity is 10 and quantity status is Medium (10-20 units) then there is more probability for reservation to fail. In this case, real-time supply check is performed. Refer How matching supply is computed as part of Get Supply call. If location does not have sufficient inventory for an item, it is eliminated from the promising process for that order line. Promising obtains the inventory information from the Inventory component. Depending upon the source, it either retrieves the perpetual inventory supply (if either perpetual inventory or a list of DCs is selected as the source) or the ATC view availability. Based on order split rules in the promising configuration, the algorithm decides whether to consider the available quantity or eliminate the location from the process. Grant: "api::inventory::transaction::read" can be used to search the Supply via this API (POST url/inventory/api/inventory/supply/search) Note: In case of force Allocation scenario, the inventory constraint check is skipped. Scope for further Allocation and Optimization If there are any unfulfilled line(s) or quantity, then Promising looks for other locations within the prioritization tier to fulfill the remaining quantities. If there are no location(s) in the current fulfillment tier then Promising looks for additional prioritization tiers to be evaluated. If available, then the above processes such as Check supply cache, Find eligible locations, and Apply constraints are performed to allocate the remaining units. If there are more units to be allocated and if Substitution is enabled, then the promising processes such as Check supply cache, Find eligible locations, and Apply constraints is tried for the substituted Items based on the On Back Order rule. Refer to the Substitution Guide for more details. If all units are allocated or there are no more locations or prioritization tiers to be evaluated then proceed to the next step - Reserve Inventory Further Optimization (Happens post Optimization process) - If the lines are allocated against multiple locations then promising internally tries to find if there is any scope for combining the shipments. In scenarios, when the number of order lines in a request are 3 or more, it is quite possible that the order may get split allocated from multiple locations using the algorithm. Or even if it doesn’t, the location may not be the most optimal location because it may be one of those few locations tried which had inventory for all the items.  It did not consider many locations which with a combination could have given a better result. In such scenarios, there is a possibility of another split location combination which can be better than the result obtained otherwise. Say for example, fulfilling all order lines from one far location may be costlier than fulfilling them from two locations nearby. Reserve Inventory Reservation is the last step of the promising process when the reservation request is formed based on the output of optimization. One Promising detail can be allocated to multiple locations. So, for a Promising detail, one Reservation request detail is created for every location allocated.  Location, Latest Scheduling dates, Quantity, Item, Other promising information is passed to the Reservation Request (API - /api/inventory/reservationRequest). Inventory reserves the inventory based on the Reservation request and a Reservation response is sent back with the allocated quantity, ETA (future supply) for every Reservation detail. Refer to How Reservation works section for more details. Reservation Request - Sample{ "Actions": {}, "AllOrNone": false, "CreatedBy": "string", "CreatedTimestamp": "2015-10-28T10:15:30 (ISO Date Time Format)", "DemandType": "string", "Extended": {}, "IsConfirmed": false, "IsPartialRequest": false, "LocalizedTo": "string", "OrgId": "string", "PK": "string", "PurgeDate": "2015-10-28T10:15:30 (ISO Date Time Format)", "RVersion": 0, "RequestId": "string", "ReservationExpiryDate": "2015-10-28T10:15:30 (ISO Date Time Format)", "ReservationRequestDetail": [ { "Actions": {}, "AllOrNone": false, "AllocatedQuantity": 0, "AsnDetailId": "string", "AsnId": "string", "BatchNumber": "string", "CapacityReleaseQuantity": 0, "ConsiderCapacity": false, "CountryOfOrigin": "string", "CreatedBy": "string", "CreatedTimestamp": "2015-10-28T10:15:30 (ISO Date Time Format)", "DemandType": "string", "EarliestShipByDate": "2015-10-28T10:15:30 (ISO Date Time Format)", "EffectiveRank": "string", "Eta": "2015-10-28T10:15:30 (ISO Date Time Format)", "Extended": {}, "FulfillmentGroupId": "string", "InvAttribute1": "string", "InvAttribute2": "string", "InvAttribute3": "string", "InvAttribute4": "string", "InvAttribute5": "string", "InventoryType": "string", "IsForceAllocated": false, "IsOpen": false, "ItemId": "string", "LatestReleaseDate": "2015-10-28T10:15:30 (ISO Date Time Format)", "LocalizedTo": "string", "LocationId": "string", "OrgId": "string", "OverrideCapacity": false, "OverrideInventoryProtection": false, "PK": "string", "ParentReferenceTypeId": "string", "PoDetailId": "string", "PoId": "string", "ProductStatus": "string", "PurgeDate": "2015-10-28T10:15:30 (ISO Date Time Format)", "Quantity": 0, "ReleaseDemandType": "string", "ReleaseGroupId": "string", "ReleasedQuantity": 0, "ReqCapacityPerUnit": 0, "ReservationRequestDetailId": "string", "Segment": "string", "ShippedQuantity": 0, "SupplyQuantity": {}, "TriggerRelease": false, "TriggerReservation": false, "Uom": "string", "UpdatedBy": "string", "UpdatedTimestamp": "2015-10-28T10:15:30 (ISO Date Time Format)", "ViewId": "string", "entityName": "string", "localize": true } ], "ReservationVersion": 0, "UpdatedBy": "string", "UpdatedTimestamp": "2015-10-28T10:15:30 (ISO Date Time Format)", "entityName": "string", "localize": true } Reservation Response - Sample{ "Actions": {}, "AllOrNone": false, "CreatedBy": "string", "CreatedTimestamp": "2015-10-28T10:15:30 (ISO Date Time Format)", "DemandType": "string", "Extended": {}, "IsConfirmed": false, "IsPartialRequest": false, "LocalizedTo": "string", "OrgId": "string", "PK": "string", "PurgeDate": "2015-10-28T10:15:30 (ISO Date Time Format)", "RVersion": 0, "RequestId": "string", "ReservationExpiryDate": "2015-10-28T10:15:30 (ISO Date Time Format)", "ReservationRequestDetail": [ { "Actions": {}, "AllOrNone": false, "AllocatedQuantity": 0, "AsnDetailId": "string", "AsnId": "string", "BatchNumber": "string", "CapacityReleaseQuantity": 0, "ConsiderCapacity": false, "CountryOfOrigin": "string", "CreatedBy": "string", "CreatedTimestamp": "2015-10-28T10:15:30 (ISO Date Time Format)", "DemandType": "string", "EarliestShipByDate": "2015-10-28T10:15:30 (ISO Date Time Format)", "EffectiveRank": "string", "Eta": "2015-10-28T10:15:30 (ISO Date Time Format)", "Extended": {}, "FulfillmentGroupId": "string", "InvAttribute1": "string", "InvAttribute2": "string", "InvAttribute3": "string", "InvAttribute4": "string", "InvAttribute5": "string", "InventoryType": "string", "IsForceAllocated": false, "IsOpen": false, "ItemId": "string", "LatestReleaseDate": "2015-10-28T10:15:30 (ISO Date Time Format)", "LocalizedTo": "string", "LocationId": "string", "OrgId": "string", "OverrideCapacity": false, "OverrideInventoryProtection": false, "PK": "string", "ParentReferenceTypeId": "string", "PoDetailId": "string", "PoId": "string", "ProductStatus": "string", "PurgeDate": "2015-10-28T10:15:30 (ISO Date Time Format)", "Quantity": 0, "ReleaseDemandType": "string", "ReleaseGroupId": "string", "ReleasedQuantity": 0, "ReqCapacityPerUnit": 0, "ReservationDetailSegment": [], "ReservationRequestDetailId": "string", "ReservationRequestMatch": [ { "Actions": {}, "CreatedBy": "string", "CreatedTimestamp": "2015-10-28T10:15:30 (ISO Date Time Format)", "Extended": {}, "HashId": "string", "ItemId": "string", "LocalizedTo": "string", "LocationId": "string", "OrgId": "string", "PK": "string", "PurgeDate": "2015-10-28T10:15:30 (ISO Date Time Format)", "Quantity": 0, "ReservationRequest": "string", "SegmentId": "string", "ShippedQuantity": 0, "SupplyTypeId": "string", "UpdatedBy": "string", "UpdatedTimestamp": "2015-10-28T10:15:30 (ISO Date Time Format)", "entityName": "string", "localize": true } ] } } Form Promising Response From the Reservation response, Promising response is formed with the following details Promising Response - Sample{ "ExistingReservationsDetailList": [], "OrganizationId": "string", "PromisingRequestDetailList": [ { "Allocation": [ { "ASNDetailId": "string", "ASNId": "string", "AllocatedOn": "2020-10-20T04:18:52.877Z", "EarliestDeliveryDate": "2020-10-20T04:18:52.877Z", "EarliestShipDate": "2020-10-20T04:18:52.877Z", "IsVirtualAllocation": false, "ItemId": "string", "LatestReleaseDate": "2020-10-20T04:18:52.877Z", "LatestShipDate": "2020-10-20T04:18:52.877Z", "PODetailId": "string", "POId": "string", "Quantity": 0, "ReservationRequestDetailId": "string", "ReservationRequestId": "string", "SchedulingInfo": [ { "DeliveryMethodId": "string", "DestinationLocationId": "string", "EarliestDeliveryDate": "2020-10-20T04:18:52.877Z", "EarliestShipDate": "2020-10-20T04:18:52.877Z", "LatestReleaseDate": "2020-10-20T04:18:52.877Z", "LatestShipbydate": "2020-10-20T04:18:52.877Z", "OriginLocationId": "string", "Sequence": 0, "SupplyDetailsInfo": [ { "EarliestDeliveryDate": "2020-10-20T04:18:52.877Z", "EarliestShipDate": "2020-10-20T04:18:52.877Z", "Eta": "2020-10-20T04:18:52.877Z", "IsForceAllocate": false, "IsOnHandSupply": false, "Quantity": 0, "SupplyTypeId": "string" } ] } ], "ServiceLevelCode": "string", "ShipFromLocationId": "string", "ShipToLocationId": "string", "ShipViaId": "string", "SubstitutionTypeId": "string", "SupplyDetailsInfo": [ { "EarliestDeliveryDate": "2020-10-20T04:18:52.877Z", "EarliestShipDate": "2020-10-20T04:18:52.877Z", "Eta": "2020-10-20T04:18:52.877Z", "IsForceAllocate": false, "IsOnHandSupply": false, "Quantity": 0, "SupplyTypeId": "string" } ], "UOM": "string" } ], "ItemId": "string", "ParentRequestDetailId": "string", "PromisingRequestDetailId": "string" } ], "PromisingRequestId": "string", "RequestType": "string" } The promising response returns the allocation information for each request detail. Each request detail can be reserved against multiple locations. A list of allocation information is sent as a response under each detail. The response contains the information of the item (either the original or substituted Item) and the quantity reserved against each location. It also contains the scheduling information (Latest dates and Earliest dates) for every allocation. If the reservation did not occur for a request detail, the allocation response will be empty. Sample response with empty allocation { "PromisingRequestId": "137c8e6148b5ac5fc5f8183294", "RequestType": "Reservation", "MessageDTO": null, "OrganizationId": null, "PromisingRequestDetailList": [ { "PromisingRequestDetailId": "1", "ItemId": "Item1", "ParentRequestDetailId": null, "Allocation": [] } ], "ExistingReservationsDetailList": [] } Earliest dates (Earliest Ship Date and Earliest Delivery Dates) are computed (API - /api/promising/getEarliestDatesList) based on the supply allocated. If the Reservation detail is allocated to a future supply, then based on the ETA stamped on the reservation detail, earliest dates are computed. If no ETA, then it means it is allocated only to on hand supply, and then the earliest dates are computed accordingly. Refer to How Scheduling works for additional information. Note: Earliest Ship Date = Allocation Date or Latest ETA + Location Processing Time Earliest Delivery Date = Earliest Ship Date + Carrier Zone Transit Time In case of inventory transfer (PO -> ASN) or PO/ASN ETA Update,  System does not recalculate Latest Dates and Committed Delivery Date. Only Earliest dates such as Earliest Ship Date and  Earliest Delivery Date gets recalculated. Future supply details (PO, ASN) is populated only when the PO ID/ASN ID is stamped as part of Order Import (Promising Info section). Refer to Cross dock scenario for more details. Currently, for Promising Response (Reservation and Optimization mode) - the supply details like Supply Type, Future supply details are not communicated from Inventory to Order on the Promising Response. For Promising Response in Query mode, there is a flexibility to send additional information like the Supply Type, ETA, and Earliest dates based on the Supply Type. Supply details in the response can help retailer to display quantity break-up as per Estimated Delivery Date (EDD) or can potentially create multiple lines with different RDD as per Estimated Delivery Date (EDD). This is enabled by Promising configuration parameter "IncludeSupplyDetails" (API - {{url}}/promising/api/promising/promisingConfigParameters/save). { "PromisingConfigParameterId" : "defaultPromisingParameters", "IncludeSupplyDetails" : true } When enabled, response will provide quantity details of allocated supply along with key details such as ETA, Earliest Ship Date, Earliest Delivery Date, and so on in the Supply Details info for every allocation. Earliest Dates will be calculated based on Current Date for On Hand supply and ETA for future supply. Since the Earliest dates will be same for all the On Hand records, only one record is sent for all allocated On Hand supply (On Hand Available, On Hand Available Soon) whereas individual record is sent for every future supply with their respective earliest dates. Supply details are captured under "Supply Details Info" section in the promising response. Supply details info section is available at both Allocation and at Scheduling info level. Allocation section is populated for Non Merge flows and Scheduling section is populated for Merge flow. Refer to Promising Response - Sample for more details Promising Response - Sample{ "ExistingReservationsDetailList": [], "OrganizationId": "string", "PromisingRequestDetailList": [ { "Allocation": [ { "ASNDetailId": "string", "ASNId": "string", "AllocatedOn": "2020-10-20T04:18:52.877Z", "EarliestDeliveryDate": "2020-10-20T04:18:52.877Z", "EarliestShipDate": "2020-10-20T04:18:52.877Z", "IsVirtualAllocation": false, "ItemId": "string", "LatestReleaseDate": "2020-10-20T04:18:52.877Z", "LatestShipDate": "2020-10-20T04:18:52.877Z", "PODetailId": "string", "POId": "string", "Quantity": 0, "ReservationRequestDetailId": "string", "ReservationRequestId": "string", "SchedulingInfo": [ { "DeliveryMethodId": "string", "DestinationLocationId": "string", "EarliestDeliveryDate": "2020-10-20T04:18:52.877Z", "EarliestShipDate": "2020-10-20T04:18:52.877Z", "LatestReleaseDate": "2020-10-20T04:18:52.877Z", "LatestShipbydate": "2020-10-20T04:18:52.877Z", "OriginLocationId": "string", "Sequence": 0, "SupplyDetailsInfo": [ { "EarliestDeliveryDate": "2020-10-20T04:18:52.877Z", "EarliestShipDate": "2020-10-20T04:18:52.877Z", "Eta": "2020-10-20T04:18:52.877Z", "IsForceAllocate": false, "IsOnHandSupply": false, "Quantity": 0, "SupplyTypeId": "string" } ] } ], "ServiceLevelCode": "string", "ShipFromLocationId": "string", "ShipToLocationId": "string", "ShipViaId": "string", "SubstitutionTypeId": "string", "SupplyDetailsInfo": [ { "EarliestDeliveryDate": "2020-10-20T04:18:52.877Z", "EarliestShipDate": "2020-10-20T04:18:52.877Z", "Eta": "2020-10-20T04:18:52.877Z", "IsForceAllocate": false, "IsOnHandSupply": false, "Quantity": 0, "SupplyTypeId": "string" } ], "UOM": "string" } ], "ItemId": "string", "ParentRequestDetailId": "string", "PromisingRequestDetailId": "string" } ], "PromisingRequestId": "string", "RequestType": "string" } Note: In case of the same supply type but different segment or inventory attributes, supply details info will have a single record with total quantity. In case there are multiple supply records with the same supply type and same ETA, the system will aggregate all the records into a single record as it will have the same earliest dates. For instance: Two POs with exact same ETA If Allocation Demand Type has "Sort Order"/"Deprioritize Past Due Inventory" configured for future supply types, the system will consider it during allocation. "Supply Details Info" will not be sorted as per any attribute such as Delivery Date or Quantity. If Force Allocate=True and "Ship from Location Id" is present in the request, then Supply Details Info will have a single record with Force Allocate=true and earliest dates calculated as per Current Date If Prioritization Tier is enabled with Force Allocation, then Supply Details for all the allocations from that Tier will have a single record with Force Allocate=true and earliest dates calculated as per the Current Date. Examples Example 1 - Order can be allocated to On Hand and Future Supply (ASN, PO) Promising Response (Supply Details) - Example 1 Example 2 - In case of Merge shipment, supply details will be populated in "Scheduling Info". Details will be populated only for the final leg (Delivery Leg) whereas it will be empty for all intermediate legs (Merge Leg). Order can be allocated to On Hand and Future Supply (ASN, PO). Also, supply details section will not be populated at Allocation level for Merge flows. Promising Response (Supply Details) - Example 2Consider the following Merge route and Location processing time Location Route Id Merge Route DC1 101 DC1 - HUB - Customer Location Location Processing Time Carrier Transit Time DC1 24 hours or 1 Day 48 hours or 2 Day HUB 24 hours or 1 Day 48 hours or 2 Day Promising Request is made for Item A with 10 quantity in "Query" mode on Jan 1 (Dates are taken without timestamp for simple illustration) Supply details Location Item Supply Type ETA Quantity DC1 Item A On Hand ~ 5 DC1 Item A On Order (PO1) Jan 5 5 Earliest Dates calculation EarliestShipDate (ESD) = CurrentDate or ETA + Location Processing Time EarliestDeliveryDate (EDD) = EarliestShipDate + Carrier Transit Time Supply Type Earliest Ship Date (Merge) Earliest Delivery Date (Merge) Earliest Ship Date (Delivery) Earliest Delivery Date (Delivery) On Hand Jan 1 + 1 day = Jan 2 Jan 2 + 2 day = Jan 4 Jan 4 + 1 day = Jan 5 Jan 5 + 2 day = Jan 7 On Order (PO1) Jan 5 + 1 day = Jan 6 Jan 6 + 2 day = Jan 8 Jan 8 + 1 day = Jan 9 Jan 9 + 2 day = Jan 11 *Merge Leg (Leg 1) earliest dates will not be populated in Promising Response Allocation: { "RequestType": "Query", "PromisingRequestId": "Order1", "PromisingRequestDetailList": [ { "PromisingRequestDetailId": "1", "ItemId": "ITEM1", "Allocation": [ { "ReservationRequestId": "Order1", "ReservationRequestDetailId": "1", "ItemId": "ITEM1", "Quantity": 10, "ShipFromLocationId": "DC1", "EarliestShipDate": "2020-01-06T00:00:00", "EarliestDeliveryDate": "2020-01-08T00:00:00", "SchedulingInfo": [ { "DestinationLocationId": "HUB", "OriginLocationId": "DC1", "SupplyDetailsInfo": [] -- Empty for Merge legs }, { "DestinationLocationId": "STORE1", "OriginLocationId": "HUB", "SupplyDetailsInfo": [ { "SupplyTypeId": "null", "isOnHandSupply": "True", "ETA": "null", "Quantity": 5, "IsForceAllocate": false, "EarliestShipDate": "2020-01-05T00:00:00", "EarliestDeliveryDate": "2020-01-07T00:00:00" }, { "SupplyTypeId": "On Order", "isOnHandSupply": "False", "ETA": "2020-01-05T00:00:00", "Quantity": 5, "IsForceAllocate": false, "EarliestShipDate": "2020-01-09T00:00:00", "EarliestDeliveryDate": "2020-01-11T00:00:00" } ] } ], "SupplyDetailsInfo": [] -- Empty for Merge flow } ] } ] } Location Id ItemId Allocated Qty Earliest Ship Date Earliest Delivery Date Scheduling Info (Delivery) : Supply Details Info (Onhand) Scheduling Info (Delivery) : Supply Details Info (On Order - PO1) DC1 Item A 10 Jan 5 + 1 day = Jan 6 Jan 6 + 2 day = Jan 8 SupplyTypeId: Null isOnHandSupply: True isForceAllocate: False ETA: Null Quantity: 5 EarliestShipDate: Jan 5 EarliestDeliveryDate: Jan 7 SupplyTypeId: On Order isOnHandSupply: False isForceAllocate: False ETA: Jan 5 Quantity: 5 EarliestShipDate: Jan 9 EarliestDeliveryDate: Jan 11 Promising Trace The promising trace provides visibility into how the optimization engine determined the optimal location(s.) Promising trace is not supported for promising type Query and Reservation, it is applicable only for the type optimization. Promising Trace gets generated as part of the Promising call and is persisted in the Elastic. Promising trace can be invoked by API - GET "{{url}}/promising/api/promising/trace/?promisingRequestId=<RequestID>".  The following information is available as part of the trace: Promising configuration: Name of the promising configuration which was used to execute the promising process for the order Promising source ID: Name of the source configuration which was used to find the source (ATC view or DCs) used for allocation for each line Fulfillment Group details Cost breakup analysis: This is the cost breakup information of each location/combination that was considered for allocation. The breakup information is available by the optimization level used for allocation. For example, if the location was selected using the second optimization level, the cost breakup information is available for the location for both the first and second levels. Cost breakup information for all the locations which were compared against the best location in the second optimization level is also provided in the trace. Location Exclusion Reason: Reason for exclusion of a location "Lane not available for Transit time calculation". Note: Location could still be considered for promising even though the lane does not exist. This can happen when RDD or LPDD is not provided in the promising request. Other Location exclusion reason can be "Stored closed (capacity reason), Scheduling failed". Location will not get considered if it fails with these two reasons. Item Exclusion Reason: Reason for exclusion of Item for that location "Supply not available" Whether Location is considered or not for Promising Refer to a sample promising trace generated post evaluating different locations. Promising Trace - SampleIn the below example, Order with two lines (Tops-19691-Blue-XS, Tops-19691-Blue-M) are tried for allocation from the following DCS AustinDC (Shipping cost $1 and Handling cost $1) OrlandoDC (Shipping cost $2 and Handling cost $1) PlanoDC (Shipping cost $1 and Handling cost $1) AtlantaDC (Shipping cost $1 and Handling cost $1) Optimization is set with one Level (Two factors - Shipping cost and Handling cost). Other Constraints are as below - Supply available for both the lines at AustinDC, OrlandoDC and PlanoDC Lane not available between PlanoDC and Destination Supply not available at Atlanta DC (Supply not available is possible if Supply cache status is Low and as part of Inventory constraint check - Supply quantity is not available to allocate the line completely. This can happen as Protection quantity is checked as part of the Inventory constraint evaluation and not during supply cache evaluation) Since the Fulfillment cost from AustinDC to Dest is $2 and is the cheapest compared to other locations, So AustinDC is given preference over other locations  and it is considered as Supply and Lanes are available (IsLocationConsidered = True for AustinDC). Trace also provides information on the Scheduling dates, Location exclusion reasons (for PlanoDC), Item exclusion reason (for AtlantaDC) Note: Attribute "IsLocationConsidered" signifies whether the location is evaluated in an optimization level or not for promising. If the value is True, then the location is considered for allocation. Location might have not considered for promising for several reasons like Location Outage, capacity full etc. { "PromisingRequestId": "Ord141117_5", "TraceList": [ { "FulfillmentGroupId": "34736cf8edda53a74b1fbc29805e96ae", "ShippingMethod": "Ground", "ConfigName": "Config1", "Selection": [ { "Item": "Tops-19691-Blue-XS", "Quantity": 2, "Location": "AustinDC" }, { "Item": "Tops-19691-Blue-M", "Quantity": 8, "Location": "AustinDC" } ], "shippingMethod": "Ground", "PriorityRuleName": null, "ConfigId": "PCN1510566245159", "MultiStartTrace": [ { "MultiStartTraceDetail": [ { "RunIteration": 1, "NumberOfItems": 2, "LocationTraces": [ { "PreferenceBreakUp": [], "LineList": [], "IgnoredPostProcessing": false, "LocationId": "AustinDC", "LocationExclusionReason": [], "Latitude": "30.4417", "SchedulingResult": [ { "PromisingRequestDetailId": "1", "EarliestDeliveryDate": "2020-11-14T18:04:00", "LatestReleaseDate": "2020-11-15T18:04:00", "EarliestShipDate": "2020-11-14T10:04:00", "LatestShipbydate": "2020-11-15T20:04:00" }, { "PromisingRequestDetailId": "2", "EarliestDeliveryDate": "2020-11-14T18:04:00", "LatestReleaseDate": "2020-11-15T18:04:00", "EarliestShipDate": "2020-11-14T10:04:00", "LatestShipbydate": "2020-11-15T20:04:00" } ], "Longitude": "-97.6811", "PreferenceData": null, "CostBreakUp": [ { "FactorGroupName": "Optimization Level 1", "FactorGroupCosts": [ { "FactorName": "ShippingCost", "Cost": 1 }, { "FactorName": "LaborCost", "Cost": 1 } ] } ], "CostData": [ { "FactorGroupName": "Optimization Level 1", "Cost": 2 } ], "ItemExclusionDetail": [], "LineDetails": [ { "itemId": "Tops-19691-Blue-XS", "units": 2, "ItemId": "Tops-19691-Blue-XS", "Units": 2 }, { "itemId": "Tops-19691-Blue-M", "units": 8, "ItemId": "Tops-19691-Blue-M", "Units": 8 } ], "IsLocationConsidered": true, "LocationType": "DistributionCenters" }, { "PreferenceBreakUp": [], "LineList": [], "IgnoredPostProcessing": false, "LocationId": "OrlandoDC", "LocationExclusionReason": [], "Latitude": "30.4417", "SchedulingResult": [ { "PromisingRequestDetailId": "1", "EarliestDeliveryDate": "2020-11-14T18:04:00", "LatestReleaseDate": "2020-11-15T18:04:00", "EarliestShipDate": "2020-11-14T10:04:00", "LatestShipbydate": "2020-11-15T20:04:00" }, { "PromisingRequestDetailId": "2", "EarliestDeliveryDate": "2020-11-14T18:04:00", "LatestReleaseDate": "2020-11-15T18:04:00", "EarliestShipDate": "2020-11-14T10:04:00", "LatestShipbydate": "2020-11-15T20:04:00" } ], "Longitude": "-97.6811", "PreferenceData": null, "CostBreakUp": [ { "FactorGroupName": "Optimization Level 1", "FactorGroupCosts": [ { "FactorName": "ShippingCost", "Cost": 2 }, { "FactorName": "LaborCost", "Cost": 1 } ] } ], "CostData": [ { "FactorGroupName": "Optimization Level 1", "Cost": 3 } ], "ItemExclusionDetail": [], "LineDetails": [ { "itemId": "Tops-19691-Blue-XS", "units": 0, "ItemId": "Tops-19691-Blue-XS", "Units": 0 }, { "itemId": "Tops-19691-Blue-M", "units": 0, "ItemId": "Tops-19691-Blue-M", "Units": 0 } ], "IsLocationConsidered": false, "LocationType": "DistributionCenters" }, { "PreferenceBreakUp": [], "LineList": [], "IgnoredPostProcessing": false, "LocationId": "PlanoDC", "LocationExclusionReason": [], "Latitude": "30.4417", "SchedulingResult": [], "Longitude": "-97.6811", "PreferenceData": null, "CostBreakUp": [ { "FactorGroupName": "Optimization Level 1", "FactorGroupCosts": [ { "FactorName": "ShippingCost", "Cost": 2 }, { "FactorName": "LaborCost", "Cost": 1 } ] } ], "CostData": [ { "FactorGroupName": "Optimization Level 1", "Cost": 3 } ] "ItemExclusionDetail": [ { "ExclusionReason": "Supply Not Available", "Items": [ "Tops-19691-Blue-XS", "Tops-19691-Blue-M" ] } ], "LineDetails": [ { "itemId": "Tops-19691-Blue-XS", "units": 0, "ItemId": "Tops-19691-Blue-XS", "Units": 0 }, { "itemId": "Tops-19691-Blue-M", "units": 0, "ItemId": "Tops-19691-Blue-M", "Units": 0 } ], "IsLocationConsidered": false, "LocationType": "DistributionCenters" }, { "PreferenceBreakUp": [], "LineList": [], "IgnoredPostProcessing": false, "LocationId": "AtlantaDC", "LocationExclusionReason": [ "Lane Not Available", "Transit Time Not Available" ], "Latitude": "30.4417", "SchedulingResult": [], "Longitude": "-97.6811", "PreferenceData": null, "CostBreakUp": [ { "FactorGroupName": "Optimization Level 1", "FactorGroupCosts": [ { "FactorName": "ShippingCost", "Cost": 1 }, { "FactorName": "LaborCost", "Cost": 1 } ] } ], "CostData": [ { "FactorGroupName": "Optimization Level 1", "Cost": 2 } ], "ItemExclusionDetail": [], "LineDetails": [ { "itemId": "Tops-19691-Blue-XS", "units": 0, "ItemId": "Tops-19691-Blue-XS", "Units": 0 }, { "itemId": "Tops-19691-Blue-M", "units": 0, "ItemId": "Tops-19691-Blue-M", "Units": 0 } ], "IsLocationConsidered": false, "LocationType": "DistributionCenters" } ] } ], "Selection": [ { "Item": "Tops-19691-Blue-XS", "Quantity": 2, "Location": "AustinDC" }, { "Item": "Tops-19691-Blue-M", "Quantity": 8, "Location": "AustinDC" } ], "Considered": true, "Run": 0, "ReservationSuccess": true } ], "RunDate": "2020-11-14T10:04:21.869+0000" } ] } Flows where Promising Trace is not generated or has out-dated information: Promising trace is generated only when Optimization is enabled in the Fulfillment Optimization config and Promising type is Optimization. It is not generated for type - Query and Reservation. Promising trace is not generated if Optimization is not triggered (when Ship from location ID populated for all the lines). If at least one line doesn't have Ship from location ID then Promising trace is generated. See Force Allocation for more information on the ship from location flow. If promising is invoked for the Order multiple times then promising trace is generated for the new run and persisted in the Elastic. But when a Get call is made to fetch the promising trace, it always fetches the first Promising trace generated by the system and not the latest one. Example - If an Order is back ordered for the first time, promising trace would have generated for this run. On subsequent runs, though new promising trace gets generated, above API always fetches the first promising trace (which got generated as part of the first run - Back order), so there may be a possibility of the promising trace not showing the latest information. Note: Promising trace is not updated upon re-allocation. In case order is partially allocated and remaining backorder qty is allocated again, user won't be able to see details of second promising call in the promising trace. Order Analysis Once an order is created, the allocation engine determines the most optimal location for fulfilling an order. During the optimization process, multiple locations are evaluated and the most cost effective location is selected as the location to fulfill the order from. Users can view the details of the source and evaluated locations along with their costs by selecting "Order Analysis" from the drop-down in the Order Details UI. All location(s) evaluated by Promising is displayed in the Order Analysis UI (Except failed due to reasons "Supply not available", "Store closed" and "Scheduling Failed") and selected Location is highlighted. Order analysis UI displays the Considered/Evaluated Location with their Cost details (Multiple Levels) for every Fulfillment Group. Note: Order Analysis details will be available only when a Promising Trace is generated for the Order. In case, promising trace is not generated then Order Analysis UI will display message as "Order analysis not available!". Since Promising trace is not updated upon re-allocation, the order analysis that gets populated for the first time will be displayed and does not show the latest promising run details. So there may be a possibility of the Order analysis UI not showing the latest information. The order analysis UI details is available for as long as the Promising trace index has that information. Promising trace should remain until the order gets archived, but there can be instances where the index was dropped on purpose before the archiving of the order. Locations which failed due to Reasons "Supply not available", "Store closed" and "Scheduling Failed" will not be displayed in the Order analysis UI. Location(s) which were not considered due to Lane issues will still show up in the Order analysis UI (as it can be considered when RDD and LPDD is not available). An order with multiple lines might be available across whole network. System will not evaluate every possible location combination for availability, hence order analysis will not plot all location which were not selected. Order Analysis - Map Configuration Fulfillment location, Evaluated locations & the Ship to destination are plotted on the Map. Maps are supported only for US, North America, Europe and Australia. "Map Scope" needs to be configured in promising config parameter (API - {{url}}/promising/api/promising/promisingConfigParameters/save) for an organization. In case it is not configured then, system dynamically calculates which map to be displayed based on the source, destination and evaluated location addresses. Below is how system determines which map to display when it is not configured by the user. { "MapScope": "NorthAmerica", "PromisingConfigParameterId": "Default" } If Map Scope is configured in the Promising Config Parameter then Valid Values are NorthAmerica, US, EU, and AU. For any other value - World map is displayed Note: If Map Scope is configured and Postal Codes of source/destination addresses are part of a country different from the configured country in promising parameter then Map may not get displayed. If scope is set to NorthAmerica then Source Location and Destination is plotted clearly in the North America map for the following flows Order is a Ship To Address order for Canada address. Both Canada_DC & US_DC have inventory, but it got shipped from Canada DC(less cost) and evaluated location is US DC. All location(s) are plotted in the North America map Order is a Ship To Address order for US address. Both Canada_DC & US_DC have inventory, but it got shipped from US DC(Location proximity) and evaluated location is Canada DC. If Map Scope is not configured in the Promising Config Parameter then If an order is source and shipped from US and evaluated locations also have US address then US map is displayed If an order is source and shipped from either US or Canada and evaluated locations also have US or Canada address then North America map is displayed. For instance: Customer placed an order for Canada address, but it got shipped from "US" DC because it was more optimal fulfillment location than "Canada" DC then North America map is displayed. Countries for which map is not supported, message will be displayed on UI - "Map is not available". Note : Order analysis data is purged after 45 days in elastic search. Other Concepts Order Modification and Re-Promising Once an order or group of line(s) in an order are allocated from a single source, there could be various modifications on order/order line - Increase or Decrease Line Quantity, Add Line, Update RDD for line/order, Update shipping address, Update Strategy type etc. Refer to Order Orchestration configuration for more details. If certain critical fields of an order that has already been reserved are updated, the order is sent to the Promising for re-promising(re-reservation). If a change occurs to an order or line that triggers reallocation, the order capture system sends a Promising request again to promising for reallocation. The following scenarios are potential candidates for critical change: Change to order line quantity Add a new order line Delete an order line Change shipping address, shipping method or RDD of order or line Change delivery method of order or line Change fulfillment group ID of an order Confirm an unconfirmed order In all such cases, the order capture system re-reserves the order to update the reservation with the latest information. Some of these scenarios are described below in further detail: Change, add or delete order line quantity - If the ordered quantity is changed for one of the order lines or an order line is added or deleted, a promising request must be sent to the Promising component with the new information. To get the most out of the promising optimization process, all unaffected order lines should also be sent in the request. This allows the optimization engine to find the best location for the entire order, rather than optimizing only the affected order lines. Change shipping address, shipping method, or RDD - The shipping address, shipping method and RDD fields are used to schedule the order. If any of these fields are changed, the order must be rescheduled. The optimization engine also considers the shipping method and shipping address fields to find the shipping cost for a location. If any of these fields changed for the order or for order line(s), the optimization must be triggered again. Change delivery method - If the delivery method for an order line changes, the allocations tied to the order line must be reassessed. For example, if a ship to home order line that was allocated against a DC changes to a pickup in-store order line, the order line now must be allocated against the store. The existing reservation must be removed. Change fulfillment group ID - Order lines belonging to one fulfillment group are optimized together. If the group ID of one of the order lines changed, both the old and new group must be reallocated to find an optimized solution. Update Strategy Type - This is configured as order line mod type which can be enabled only for Open/backorder status. If an order line with strategy type="Null" is updated with "Complete Single Source"  then all the lines within FG will be sent again for Promising & reservation. For all such modification on a line with strategy type="Complete Single Source , all lines within same Fulfillment Group & strategy type="Complete Single Source" will be sent again for Promising & Reservation except lines which are already released. The re-reservation process is similar to the first-time reservation process except that during the supply check, the process loads the existing reservations (from the Inventory component) to reconsider the existing allocated quantity for allocation. It is the same for Allocation and Reallocation. The optimization logic remains the same. Existing Reservation - If an order capture system (or any e-commerce system) wants to re-reserve part of an order without affecting other existing reservations, those existing reservations can be sent with the Existing Reservations Detail attribute. Common reasons that an existing reservation should not be affected include: The existing reservation is already released to the fulfillment system for processing. The existing reservation (or part of it) is already shipped. During peak season, a re-optimization of allocations is not needed, and whatever has been reserved should be kept undisturbed due to peak volume. Only the changes are sent for re-reservation. In all such cases, the reservations that should not be updated are sent in the existing reservation section, and only those that should be reserved are sent in the promising request detail. Promising without Postal Codes For some countries, postal code is not a part of the address whereas for a few other countries, postal code is present only for a subset of addresses. Promising and allocation will be supported for Ship To Addresses without postal codes for countries where postal code is not mandatory. A country can be configured to indicate whether postal code is mandatory or not. Please refer to the country configuration under Master Data Guide for more information on the configuration (countryConfiguration - IsPostalCodeMandatory). This is a profile based entity under profile purpose org::countryConfig. This entity will have 1 entry for each country with this flag set to a true or a false. If this is null, it is considered true. For countries that are configured to have postal codes as mandatory, the promising request will not allocate if it does not have a postal code. There will be a validation error sent back to the calling system (internal or external) indicating that one of the mandatory fields “Postal Code” is not present on the incoming request. This will ensure that order management does not send any bad addresses to the down stream fulfillment systems. State being mandatory or not will not impact allocation as there is no validation for state within promising. If this flag is set to a true, then the promising request/allocation expects the postal code to be present as part of the input request. It doesn’t check to see if geo proximity is enabled or not. If this flag is a false: If postal code is coming in the input request, the request will process successfully irrespective of whether Geo Proximity is enabled or not. If postal code is not coming in the input request, the request will process successfully only if geo proximity is not enabled. Order Fulfillment Optimization parameter "Location Proximity" is not supported when the order address does not have a postal code. When a promising request that does not have a postal code is processed by a fulfillment optimization template with "Location Proximity" as one of the optimization factors, it will be backordered with an appropriate error message in the promising trace. If geo proximity is enabled, the order/promising request will not allocate and there will be an error in the promising trace indicating “Location Proximity is not supported for requests without postal code”. Order Analysis map will not be rendered for addresses without postal codes. Note: System only honors mandatory settings for Postal Codes alone, and it does not consider the settings for State attribute configuration for Promising. For example - "Is State Mandatory": true - or - False. For example - "Is State Mandatory": false configuration will not have any bearing on Promising except for Order Scheduling or Shipping Cost calculations. Support for Cross Dock In Cross dock flow - Retailer would be aware of the Future supply details (PO/ASN) against which the order should be allocated against. In this scenario, future supply details can be directly passed as part of the Order/Promising request. Under Order, these details are captured under Order Line Promising info section - Requested PO and Requested ASN details. This information is sent in the promising request under Promising Request Detail section - PO ID, PO Detail ID, ASN ID, ASN Detail ID "PromisingRequestDetail": [ { "ASNDetailId": "string", "ASNId": "string", "PODetailId": "string", "POId": "string" } ] When PO/ASN details are provided in the Promising requested, Promising ensures the Orders are allocated only against the specific future supply. If the requested future supply is not available or enough units are not available then the Order is back ordered. When the future supply is received to On hand then the reservation is transferred to the On Hand supply (similar to transfer reservation flow). Note: • If an order is bridged in with future supply details (PO and ASN) and if the PO/ASN is already received to an On Hand, then upon reallocation the order is back ordered as promising checks against the specific future supply. • Order is backordered if bridged in with PO and PO supply is already converted to ASN before order is bridged in. • If ASN is converted back to PO (because of ASN cancellation) then these orders can now get allocated as the supply is pointing to the PO specified in the order. • To avoid backorder during reallocation, these orders (with future supply) can be configured for immediate release or should be ignored as part of reallocation process Return Routing Optimization Return Routing Optimization enables retailers to configure multiple return centers instead of having a single default return center. These return centers will be filtered to find the best available location based on the various optimization factors during return creation with the aid of the promising engine. This allows returns to be received and processed in a timely manner to avoid increased shipping costs, increased delays in receipts, and to improve the overall customer experience. Refer here on how to configure Return Routing Optimization. Use the following API to determine the return center Return Center Request - Sample {{url}}/promising/api/promising/optimizeReturns/ { "RequestId": "CC10035", "ReturnConfigId": "EcomOrdersConfig", "DeliveryMethodId": "ShipToReturnCenter", "ShipFromAddress": { "FirstName": "Megada", "LastName": "Sujatha", "Address1": "1400 Holcomb Bridge Rd", "Address2": null, "Address3": null, "City": "Roswell", "State": "GA", "PostalCode": "30076-2190", "County": null, "Country": "US", "Phone": "(994) 558-6015", "Email": "sujathay756@gmail.com", "Latitude": null, "Longitude": null }, "OptimizedReturnRequestDetail": [ { "ItemId": "Tops-20216-Pink-XL", "RequestDetailId": "1", "Quantity": 2, "VolumetricWeight": null, "VolumetricWeightUOM": null, "ShippingMethodId": "OneDay" }, { "ItemId": "Tops-20216-Pink-XS", "RequestDetailId": "2", "Quantity": 2, "ShippingMethodId": "OneDay" } ] } Return Center Response - Sample{ "RequestId": "CC10035", "ReturnConfigId": "EcomOrdersConfig", "DeliveryMethodId": "ShipToReturnCenter", "ShipToLocationId": "ecomorg:AtlantaDC" } Accepts Returns The Accept Return feature in Inventory Location enables the location to participate in return center determination. This flag is also available in ATC view to allow the locations to be eligible even when the sourcing is view based. This is configured on the Inventory Location UI. High Level Flow Determine Return Center Honor Fulfillment Optimization when Ship From Location Id is Passed When an order is designated as “Ship From Location”, this feature allows retailers to honor the Availability to Commerce View configured as part of the fulfillment optimization template. Refer here for configuration details. Ability to Promise against Out-of-stock Inventory When an item is out of stock, it is typically backordered. However, with this configurable feature, the item can still be promised based on its vendor lead time, even without available inventory. The vendor lead time represents the time (in hours) required for a vendor to deliver the item to a specific location. In the promising process, delivery dates are calculated based on the vendor lead time. Until a purchase order is received or inventory is replenished, the item remains in the 'Awaiting Procurement' (1600) status provided configuration is enabled, if the configuration is not enabled or item does not have vendor lead time configured then order moves to backordered status (1500). Refer here to enable the  'Awaiting Procurement' (1600) status in order pipeline. Additionally, a configurable buffer time (in hours) allows for consideration of purchase orders within the range of 'LatestReleaseDate - BufferTime' and LatestShipDate when the request includes a RequestedDeliveryDate. Refer here for delivery dates calculation with VendorLeadTime. Refer here to enable necessary configurations. NOTE: Ensure that Continuous Allocation is enabled for the ability to promise against out-of-stock inventory feature to function. NOTE: Procurement of out-of-stock inventory will only occur from distribution centers (DCs). If source destinations are configured in the view but items cannot be procured to any DCs or if scheduling fails, the item will still be marked as back-ordered. Configurations How to Set up Prioritization Rule Refer to the below section on how to set up the prioritization details in a Promising configuration. Promising - Set up Prioritization rulePrioritization rule can be defined under Fulfillment Optimization Config - Prioritization tab.  When creating and enabling a prioritization rule, the new ranking criteria will apply only to the future allocations. The previous orders which have been already allocated(fully) will not be affected. Note: Ensure that the list of priority rules covers all location groups and demand types because once a single priority rule is configured, promising will only return supply that matches with an existing priority rule. Section Description Location Group In order to use prioritization,a retailer must first define location groups which are configured on the Inventory Location Group UI. Each location group is then assigned a priority. The same location can be part of multiple location groups. Consider that the following location groups are configured: Location Group DCs Stores Location Group 1 DC 1 Store A, Store B Location Group 2 DC 1, DC 2 Store C, Store D Location Group 3 DC 3 Store E, Store F Location Group 4 N/a Store G Location Group 5 N/a Store H, Store I, Store J Once defined, the priorities of the location groups must be configured in the Fulfillment Optimization UI. Priority 1 Location Group 1, Location Group 2 Priority 2 Location Group 3, Location Group 4 Priority 3 Location Group 5 Based on the above example, the locations corresponding to location group 1 (DC 1, Store A, Store B) and location group 2 (DC 2, Store C, and Store D) are considered as the highest priority locations for allocation. Each location has an equal priority, and the optimization logic selects the best out of these locations for allocation by considering all the promising factors configured. Prioritize when used, promising will attempt to fulfill all units from the 1st priority Tier before evaluating the 2nd Tier. Only units that cannot be fulfilled from the locations included in the 1st priority tier will be evaluated when proceeding to the 2nd tier. Demand Type Priority Overrides the demand type that would be sent from order configuration in the header. So, for the execution of this priority tier, it will only consider inventory supply which maps to this demand type. This is optional. If not selected, the demand type sent from order configuration will be used. In Prioritization Tier, specific demand Type can also be selected. If a demand Type is selected for a Tier, then it will override header or line level demand type sent in the promising request. Once a demand type is selected for a Tier, promising will only consider mapped supply types as eligible inventory for allocation for that Tier. If it is selected as null, then header level demand type will be considered. For instance: if a retailer wants to prioritize physical on hand supply across fulfillment network followed by future supply, two tiers can be created with same location group but with different demand type as "Allocation" and "Allocation and Future" respectively. Promising will try to allocate order first from on hand supply across locations followed by future supply. Segment Priority Defines the priority of the segment against every Tier. This is optional. If not selected, all segments are considered for allocation. If any specific segment(s) are selected, then only the selected segment is used in that allocation run. For example, if Location group 1 and Segment E-Com and Retail are configured as priority 1, the first reservation attempt is made against the E-Com and Retail segmented inventory belonging to the locations configured in Location group 1. If any location in the location group does not maintain segments, then the entire inventory is eligible for allocation. So, in the previous scenario, for location which maintains segments, only ECom and Retail segmented inventory is eligible for reservation, and for other locations, the inventory for that item is eligible. Force Allocate Force allocation or reservation provides an opportunity for the Retailer to allocate the Order(s) irrespective of the inventory levels at a location. If atleast one line doesn't have the Ship from location ID or atleast one line has Delivery method "Pick up at store" in the promising request then the Force allocate flag sent on the promising request is ignored. Force allocate flag set on the prioritization tiers (Fulfillment Optimization config) will take precedence. If there are no prioritization tiers defined or Force allocate flag not set on the prioritization tier then Force allocate will not be triggered even if the force allocate flag is sent on the Promising request. This is used as a last resort option when the configuration is not able to allocate orders because of inventory constraints. Tier 1 (Rank 1) - Location Group 1 - Force Allocate (false) Tier 2 (Rank 2) - Location Group 2 - Force Allocate (true) Allocation Overrides Allocation overrides - Capacity and Protection can be defined at Prioritization Tier level. In addition to this, overrides can be set at Source (Header and Line overrides level). Refer how overrides works when set up at different levels. Refer to the Different ways of overriding Capacity and its Impact on Allocation for more details. Refer to the Protection Overrides and Its impact on Allocation for more details. Min and Max units Min and Max units act as a filter for the prioritization tier. If these units thresholds are configured, only fulfillment group with matching quantity will be evaluated for this fulfillment group. In a prioritization tier that has min and/or max unit, the fuflillment will automatically be complete single source. Configure a catch all tier to make sure the order would still get allocated using split shipments if no location can fulfill it completely. How Matching Supply is Computed Refer to the below section on how matching supply is computed as part of Get Supply call. Promising - Find matching supplyFinding Matching Supply - Following are the key attributes which determines which supply record(s) to be evaluated. Demand type - Specifies what kind of supply is required to reserve an order. This is sent in the promising request as a contract to reserve the order (or line) only against the matching inventories. The demand type is specified at the header level and can be overridden at the line level. Refer to the Order Fulfillment guide for additional information. Note: If a custom supply (On Hand or Future)  is created, make sure to include the custom supply in the inventory demand type. Supply type - The type of supply at a location. For example, on-hand available, on-hand available soon, etc. Demand supply match: A relationship must be defined for mapping the demand types to the matching supply types. Each demand type can be associated with multiple supply types, and each supply type can be associated with multiple demand types. Sample data is shown below. Demand and supply type relationships are configurable. Demand Type Supply Type On Hand On Hand Available On Hand Available Soon On Hand and Future On Order In Transit On Hand Available On Hand Available Soon Get supply call (to Inventory) is performed with the following attributes to get the real-time supply information ATC View: The supply check is done using the ATC view passed in the supply check request. If the view name is not provided, the supply check is done from the perpetual inventory. Demand Type: The supply types mapped to the demand type are eligible for allocation. Supplies which match the demand type are provided in the response. Latest Release Date: The order will fail to meet the RDD after this release date. Only on-hand or future supplies with an ETA (in case of future inventory) less than the latest release date are considered as the matching supplies. Any other future inventory is not considered. Example 1 - Consider a request to reserve 5 units of Item A in an order line with an "on hand" demand type (Matching supply types are On Hand Available and On Hand Available Soon). Latest Release Date is 11/20 The following table shows the supply information of a location which is considered for reservation: Location Item Supply Type Available Quantity DC Item A On Hand Available 2 DC Item A On Hand Available Soon 4 DC Item A On Order (ETA - 10/25) 50 Get Supply call will fetch quantity as 6. Future supply is not considered though the ETA is less than the Latest release date as demand type doesn't consider future supply. Example 2 - Consider a request to reserve 5 units of Item A in an order line with an "On hand and Future) demand type (Matching supply types are On Hand Available and On Hand Available Soon, On Order, In Transit). Latest Release Date is 11/20 The following table shows the supply information of a location which is considered for reservation: Location Item Supply Type Available Quantity DC Item A On Hand Available 2 DC Item A On Hand Available Soon 4 DC Item A On Order (ETA - 10/25) 50 Get Supply call will fetch quantity as 56 as On Order record ETA (10/25) is less than LRD (11/20) and demand type considers future supply. Different Types of Substitution - Impact on Allocation Refer to the below section on the different types of substitution and its impact on Allocation Substitution Types - Impact on AllocationSubstitution allows retailers to configure rules when an alternate item can be used to fulfill an order.  Substitution rules can be configured to immediately substitute the ordered item with an alternate item or substitute the ordered item only when the original item is out of stock.  Additionally, retailers may add a condition which must be satisfied in order for the substitution to be applied. For example, when the order is shipped to Canada or the order line is a rental, then apply substitution. Substitutions are enabled for 1:1 quantity ratios and 1:1 items. There are three types of substitution: Immediate Substitution - With immediate substitution, the inventory of the originally ordered item is not considered and the configured items are substituted as long as it has inventory. If the substitute item does not have inventory, backordered item record is created using the originally ordered item. For immediate substitution rules, only a single substitute item may be configured. A sequence of substitute items cannot be configured for immediate substitution rules. This type of substitution is useful when the actual Item ID is different or has changed from the time the original order was placed. Example Substitution Rule Configuration: Ordered Item (parent) Substitution Type Substitute Item(s) Item A Preorder Immediate Item A Inventory Availability: Item Available Inventory Item A Preorder 99999 Item A 6 An order is placed for 10 units of Item A preorder. Allocation Result is: Item Quantity Status Item A 6 Allocated Item A Preorder 4 Backordered OnBackorder Substitution -  With OnBackorder substitution, the substitute item will only be allocated if the original item is out of stock. If inventory does not exist for either the original item or the substitute item, then a backordered item record is created for the originally ordered item. For On Backorder substitution rules, retailers may configure a sequence of substitute items to replace the ordered item. OnBackorder substitution is useful when retailers have an equivalent item which they would like to continue selling if the original item becomes unavailable. Example Substitution Rule Configuration: Ordered Item (parent) Substitution Type Substitute Item(s) Item A Used Condition OnBackorder 1- Item A Like New Condition 2- Item A New Condition Inventory Availability: Item Available Inventory Item A Used Condition 3 Item A Like New Condition 4 Item A New Condition 2 An order is placed for 10 units of Item A Used Condition. Allocation Result is: Item Quantity Status Item A Used Condition 3 Allocated Item A Like New Condition 4 Allocated Item A New Condition 2 Allocated Item A Used Condition 1 Backordered Conditional Substitution -  Conditions may be added to substitution rules to perform substitution only when certain conditions are met. If there are multiple substitution rules for a single item, then each rule is evaluated in the order of rank. Each condition is evaluated before moving to the next substitution rule and if a condition is met, then that substitution rule is used for promising. This type of substitution is useful when retailers need to control when substitution happens or does not happen based on attributes from the order or promising request. Example Substitution Rule Configuration: Ordered Item (parent) Rank Substitution Type Condition Substitute Item(s) Item A 1 Immediate Destination Country = US Item A - US version Item A 2 Immediate Destination Country = CA Item A - Canada version Inventory Availability: Item Available Inventory Item A 100 Item A  - US version 6 Item A - Canada version 4 An order is placed for 10 units of Item A. Destination Country is US. Allocation Result is: Item Quantity Status Item A - US version 6 Allocated Item A 4 Backordered An order is placed for 10 units of Item A. Destination Country is UK. Allocation Result is: Item Quantity Status Item A 10 Allocated Immediate and OnBackorder substitution together - Substitution rules may be combined together only in one scenario. A single Immediate substitution rule may be combined with a single OnBackorder substitution rule for the same item to fulfill the originally ordered item only if the immediate substitute item is unavailable. This is most useful for seasonal products for which retailers are trying to exhaust inventory for a particular seasonal item before resuming sale of the standard item. Example Substitution Rule Configuration: Ordered Item (parent) Substitution Type Substitute Item(s) Coca Cola Immediate Coca Cola Christmas Coca Cola Christmas On Backorder Coca Cola Inventory Availability: Item Available Inventory Coca Cola 100 Coca Cola Christmas 2 An order is placed for 10 units of Coca Cola. Allocation Result is: Item Allocated Quantity Coca Cola Christmas 2 Coca Cola 8 Different Ways of Allocation Overrides (capacity) - Impact on Allocation Refer to the below section on the different ways to override capacity and how it impacts allocation Allocation Overrides - CapacityCapacity Overrides - Following capacity overrides are available: None - This is the default value which indicates that no override has been set. Ignore Capacity - When selected, locations running at full capacity are also considered for allocation (even though these locations have been excluded from publishing availability) Consider Capacity - When selected, locations which are running at full capacity are not considered for allocation (Availability can be still published) Use case # 1: When a location is running at its full capacity, business might not want to publish availability and further allocation to happen from that location. This is controlled by ATC configuration “Exclude inventory from facilities at full capacity”. "Override capacity : None" is the default behavior and  indicates no capacity override is performed. Locations running at full capacity will be considered for allocation based on the above ATC configuration. Location(s) running at full capacity are considered for allocation if ATC view is configured to publish availability for these location (Attribute - Exclude inventory from facilities at full capacity is set to False). Example - In ATC view – attribute "Exclude inventory from facilities at full capacity” is not set. So, availability will be published even for locations at full capacity. Location “NY Store” is running at full capacity. Order is created with Line 1 “ITEM1” for 10 quantity. This Item is available only at location “NY Store” (which is running at its full capacity) Item ID Location Capacity Full Inventory Position Item 1 NY Store Yes 10 units Allocation Result: Item ID Location Allocated Quantity Comments Item 1 NY Store 10 Order gets allocated, since location which is running at full capacity is not excluded Location(s) running at full capacity are not considered for allocation if ATC view is not configured to publish availability for these location (Attribute - Exclude inventory from facilities at full capacity is set to True). Example - In ATC view – attribute "Exclude inventory from facilities at full capacity” is set. So, availability will not be published for locations at full capacity. Location “NY Store” is running at full capacity. Order is created with Line 1 “ITEM1” for 10 quantity. This Item is available only at location “NY Store” (which is running at its full capacity). Item ID Location Capacity Full Inventory Position Item 1 NY Store Yes 10 units Allocation Result: Item ID Location Allocated Quantity Comments Item 1 NY Store 0 Order doesn't get allocated, since location which is running at full capacity is excluded Use case # 2: Retailers can override to not Publish the Availability but still allocate from the location(s) which are running at full capacity. This can be done by setting the "Override capacity : Ignore Capacity". This option works when the ATC configuration "Exclude inventory from facilities at full capacity" is set. Example: In ATC view – attribute "Exclude inventory from facilities at full capacity” is set. So availability will not be published for locations at full capacity. Location “NY Store” is running at full capacity. Override - Ignore Capacity is set Order is created with Line 1 “ITEM1” for 10 quantity. This Item is available only at location “NY Store” (which is running at its full capacity) Item ID Location Capacity Full Inventory Position Item 1 NY Store Yes 10 units Allocation Result: Item ID Location Allocated Quantity Comments Item 1 NY Store 10 Since Ignore capacity is set - Order gets allocated, though the location which is running at full capacity is excluded Use case # 3: Some E-Commerce sites displays products on their websites based on the Inventory availability picture. So, if the location is excluded from publishing availability (when at full capacity) then the product will not get displayed in the catalog.  To achieve this “Exclude inventory from facilities at full capacity” is not set thereby availability is published and location is also considered for allocation. Retailers may want to still publish the availability (and show the products in the catalog) but prevent any further allocation from the location(s) running at full capacity. Allocation from locations which are running at full capacity is prevented by setting up the Consider Capacity override. Example: In ATC view – attribute "Exclude inventory from facilities at full capacity” is not set. So, availability will be published even for locations at full capacity. Consider Location “NY Store” is running at full capacity. Override - Consider Capacity is set Order is created with Line 1 “ITEM1” for 10 quantity. This Item is available only at location “NY Store” (which is running at its full capacity) Item ID Location Capacity Full Inventory Position Item 1 NY Store Yes 10 units Allocation Result: Item ID Location Allocated Quantity Comments Item 1 NY Store 0 The Order gets backordered, since the location which has inventory is running at its full capacity and "Consider Capacity" has been selected in the overrides section Allocation Overrides - How Does it Work at Different Levels Refer to the below section on how overrides work when set up at different levels (Source, Line overrides and Prioritization Tier) Allocation Overrides - LevelOverride setting level - Allocation overrides can be set up at Source (header and line overrides) and Prioritization Tier level. Refer to the Fulfillment Optimization UI for more details. Example 1 - Allocation override is set only at Prioritization Tier level View and Location configuration Location Part of View Capacity full? Protection Quantity Atlanta DC Yes No n/a NY Store Yes Yes 3 LA Store Yes No 2 Inventory position Items Atlanta DC NY Store LA Store Item 1 5 5 Item 2 3 3 5 Fulfillment Optimization configuration - Allocation override settings Tier 1 is not set with any Overrides Tier 2 is set with Capacity override (Ignore capacity) and Protection overrides Level Ignore Capacity Ignore protection quantity Sourcing (Header) No No Sourcing (Line) No No Prioritization Tier 1 (all locations) No No Prioritization Tier 2 (all locations) Yes Yes Allocation result: (Order is bridged in with two lines. Each 10 units) Since there are no overrides as part of Tier 1 evaluation - Location (NY Store) which are capacity full are ignored and Protection quantity is considered while evaluating the Available quantity As part of Tier 2 evaluation - Locations (NY Store) which are full capacity are considered for allocation and Protection quantity is ignored. Tier considered Iteration Location(s) considered Allocation location Allocated quantity Remaining quantity Comments Tier 1 Iteration 1 LA Store LA Store Line 1: 3 Line 2: 3 Line 1: 7 Line 2: 7 Only 3 units are allocated from LA store as two units are protected Tier 1 Iteration 2 Atlanta DC Atlanta DC Line 2: 3 Line 1: 7 Line 2: 4 NY store is not considered as its capacity is full Tier 2 Iteration 1 LA Store, NY Store LA Store Line 1: 2 Line 2: 2 Line 1: 5 Line 2: 2 In Tier 2 run - Protected quantity is considered for allocation Tier 2 Iteration 2 NY Store NY Store Line 1: 5 Line 2: 2 Line 1: 0 Line 2: 0 NY store is also considered as the override capacity is set to true there by saving the sale. Example 2 - Allocation override is set at both Souring and Prioritization level View and Location configuration Location Part of View Capacity full? Protection Quantity Atlanta DC Yes No n/a NY Store Yes Yes 3 LA Store Yes No 2 Inventory position Items Atlanta DC NY Store LA Store Item 1 5 5 Item 2 3 5 5 Fulfillment Optimization configuration - Allocation override settings: Sourcing (Header) is not set with any overrides Sourcing (Line) is set with Capacity override (Ignore capacity) and Protection overrides Tier 1 is not set with any Overrides Tier 2 is set with Capacity override (Ignore capacity) and Protection overrides Level Ignore Capacity Ignore protection quantity Sourcing (Header) No No Sourcing (Line) - BOPIS line Yes Yes Prioritization Tier 1 (all locations) No No Prioritization Tier 2 (all locations) Yes Yes Allocation result: (Order is bridged in with two lines. Line 2 is BOPIS. Each 10 units) Tier considered Iteration Location(s) considered Allocation location Allocated quantity Remaining quantity Comments Tier 1 Iteration 1 LA Store LA Store Line 1: 3 Line 2: 5 Line 1: 7 Line 2: 5 For Line 1 - Only 3 units are allocated from LA store as two units are protected But for Line 2 - all 5 units are allocated as override protection quantity is true for BOPIS line. Tier 1 Iteration 2 Atlanta DC, NY Store NY Store Line 2: 5 Line 1: 7 Line 2: 0 NY store is considered only for Line 2 (BOPIS line) even though its capacity is full Line 1 is not considered as the capacity is full Tier 2 Iteration 1 LA Store, NY Store LA Store Line 1: 2 Line 1: 5 In Tier 2 run - Protected quantity is considered for allocation for Line 1 also. Tier 2 Iteration 2 NY Store NY Store Line 1: 5 Line 1: 0 NY store is also considered for Line 1 as the override capacity is set to true there by saving the sale. Allocation Overrides - Ignore Protection Refer to the below section on How Allocation override - Ignore protection works. Protection quantity is not considered as part of Supply cache evaluation and it is considered only during the Inventory constraint evaluation. If Allocation Override - Ignore protection quantity is set to True then protection quantity is not considered as part of Inventory constraint evaluation. Allocation Overrides - Protection QuantityIgnore Protection Quantity - The protected quantity at a location is ignored while considering the inventory value at the location for allocation. Example - Order is created for 5 units. Inventory position Items NY Store Item 1 5 Protection quantity configuration: Location Protection Quantity NY Store 3 When Override -  Ignore protection quantity is not set then only 2 units are available for allocation. Order Line Order quantity Available quantity Allocated quantity Line 1 5 2 (5-3 "protected quantity") 2 When Override -  Ignore protection quantity is set then all 5 units are available for allocation. Order Line Order quantity Available quantity Allocated quantity Line 1 5 5 5 Only protection quantity defined at Item - Location (rule set) is used. Protection quantity defined at Network level is not used during promising (it is used only during publishing availability). How to Enable Shipping Restrictions evaluation for promising The shipping restriction evaluation for promising can be enabled from the UI or by using the following API: {{url}}/promising/api/promising/promisingConfig/save { "PromisingConfigId": "PCN1723195803705", "PromisingConfigName": "Ecom", "EvaluateShippingRestrictions": true } Enable Promising and ATP (Delivery Dates calculation in Product and Cart ATP) for Out-of-stock Items This feature enables to automatically promise and procure items based on the vendor's lead time when inventory is unavailable. Refer here for more information. To add VendorLeadTime to an item, follow the steps below: Navigate to Items UI Select the item of choice and click on edit at the bottom right. In the Planning Attributes section, enter the Vendor Lead Time (in hours) To enable the promising and ATP for out-of-stock inventory, follow the steps: Navigate to Fulfillment Optimization. Select the Fulfillment Optimization for which the feature needs to be evaluated and click edit. Select "Promise And Procure Based On Vendor Lead Time" to enable delivery dates calculation during promising and ATP calls. This allows the system to calculate delivery dates based on the vendor-specific lead time for each item, ensuring timely fulfillment even without current stock. Enter time in hours to configure buffer time in "Prioritize inventory procurement if LRD exceeds ____ hours beyond the latest available supply". To enable availability configurations refer here NOTE: Ensure that Continuous Allocation is enabled for the Calculation of Delivery Dates for Out-of-Stock Items in Product and Cart ATP Calls Implementation Flavors How to restrict a location from "Ship from stores" orders while fulfilling BOPIS orders Restrict a Location from "Ship from stores" orders while fulfilling BOPIS ordersUse Case - Retailer wants to restrict the days a store processes ship from store orders, while continuing to fulfill pick up orders. #1: Monday to Friday → For a store, I should have a way to take limited orders for Ship To Home but infinite orders for BOPIS. #2: Saturday & Sunday → For a store, I should have a way to take no orders for Ship To Home but infinite orders for BOPIS. Below are the configuration required to achieve this Configuration Details Promising Config parameter "ConsiderZeroCapacityLocation" True Capacity Configuration Stores should have the capacity defined in Single shift as below Monday to Friday (00:00 to 23:59) - Max Capacity is 10 Saturday & Sunday (00:00 to 23:59) - Max Capacity is 0 View Configuration - "Exclude Location with Capacity Full" False for Ship To Home & BOPIS Views Fulfillment Optimization Configuration Order Level Filter for Ship To Home lines Source: Ship To Home view → "Consider Capacity” as Override Order Line Filter for BOPIS lines Source: BOPIS View → “Ignore Capacity” as Override How to prioritize On Hand supply before future supply for promising Option 1: Demand-Supply match. Under Demand-Supply match, set On Hand supply types to have better rank than the future supply. This provides preference to On hand supply before trying future supply. In case, Location groups are used in Prioritization then use Option 2 Option 2: Fulfillment Optimization config (Prioritization setup) Active® Omni allows users to configure a ranked set of rules in fulfillment optimization (Prioritization), which prioritizes the allocation of supply at certain location groups before others. This allows an additional layer of prioritization at the demand type level. Demand type set at the prioritization level overrides the Order config demand type sent in the promising request. Refer to below section on How prioritize demand type works with some examples. Prioritize Demand Type - How it works In Prioritization Tier, specific demand Type can also be selected. If a Demand Type is selected for a Tier, then it will override header or line level demand type sent in promising request. Once a demand type is selected for a Tier, promising will only consider mapped supply types as eligible inventory for allocation for that Tier. If it is selected as null, then header level Demand Type will be considered. For instance: if a retailer wants to prioritize physical on hand inventory across fulfillment network followed by future inventory, two tiers can be created with same location group but with different Demand Type as "Allocation" and "Allocation and Future" respectively. Promising will try to allocate order first from on hand inventory across locations followed by future inventory. Example 1 - Consider there are two Location groups (group 1 and group 2) and no demand type priority set up in the Prioritization. Location Group Location(s) Demand type Group 1 DC1, DC2 none Group 2 DC3, DC4 none Location Supply Type Available Qty DC1 On Order 100 DC2 In Transit 100 DC3 On Hand Available 50 Prioritization would allocation lines() at location group 1 before location group 2. However, because of the base Order Config having "Allocation and Future" as a demand type sent in the promising request, the system would allocate lines against "on-order supply" at location group 1 (assuming no on hand supply for the locations in group 1) , instead of against "on-hand available" supply at location group 2. This is not always the preferred behavior though, as allocating against future supply when on-hand supply exists in the network might create unnecessary delays in completely fulfilling an order. Example 2 - Consider there are two Location groups (group 1 and group 2) and demand type priority set up in the Prioritization. Location Group Location(s) Demand type Group 1 DC1, DC2 Allocation (On Hand) Group 2 DC3, DC4 Allocation (On Hand) Group 3 DC1, DC2 Future Group 4 DC3, DC4 Future Location Supply Type Available Qty DC1 On Order 100 DC2 In Transit 100 DC3 On Hand Available 50 Priority rules can be set up to allocate against "Allocation" supply at location group 1, before attempting to allocate "Allocation" supply at location group 2, before attempting to allocate against "Future" supply at location group 1, before attempting to allocate against "Future" supply at location group 2. This is done by setting a demand type field in each priority rule, which will override the demand type that is set in Order Config, for the purpose of evaluating a given line that is being evaluated by that rule. This ensures that we are completely fulfilling orders as soon as possible with "Allocation" supply throughout the network as much as possible, before resorting to allocating supply which isn't physically in a location yet. If an order is allocated from Future inventory such as PO or ASN then during receiving, quantities will move between different supplies and allocations will also move with those supplies accordingly. During transfer allocation, demand type used during allocation will not be referred but the demand type from the configured parameter “TransferAllocationDemandType” in Inventory Configuration will be used, default value is “Allocation and Future”. To enable this feature, “ForwardTransferFeature” in inventory Configuration should be set as True. Once this feature is enabled, Transfer allocation will only consider supply type sent in the event during receiving, even if there is any other available inventory with higher supply Type rank. During Movement of inventory between supply Types, allocation will always be transferred. For example: Fulfillment Configuration for DC's Tiers Location Group Demand Type Tier1 East DC's Allocation Tier2 East DC's Allocation and Future Tier3 West DC's Allocation Tier4 West DC's Allocation and Future Supply Picture Location On Hand ASN PO East DC1 10 0 0 East DC2 20 50 10 West DC1 10 0 0 West DC1 20 50 10 NOTE* ASN is ranked higher than PO Following Table shows the supply information of a location which is considered for allocation: Requested Quantity East DC1 East DC2 West DC1 West DC2 If Requested quantity is 20 On Hand - 10 On Hand - 10 If Requested quantity is 50 On Hand - 10 On Hand - 20 ASN - 20 If Requested quantity is 120 On Hand - 10 On Hand - 20 ASN - 50 PO - 10 On Hand - 10 On Hand - 20 Why does force allocate on last priority tier cause my entire order line to be allocated against the force allocate tier? Scenario: The prioritization tiers on the allocation configuration are set as On Hand, On Order, and Force Allocation. If two locations have 30 units of the same item as shown below: Location 1 with 30 units of On-hand available inventory Location 2, which is a more optimal location has 30 units of On-order inventory When an order is placed for 70 units: Expected: Order allocates 30 units to On Hand, 30 units to On Order and the remaining 10 units force allocated to On Hand. Actual: Order force allocates all 70 units to On Hand. The reason for deviation in Expected vs Actual is: The Force Allocate flag is at the line level and the moment a particular line is processed by the force allocate tier, the entire line is force allocated, and NOT just the remaining unallocated quantity. This can be achieved through a custom implementation outlined below: Implement promise user exit Order:Order:UserExit:Promise in order. Remove the force allocate tier from your promising config (PromisingConfig1) Create a new config with lower rank with just the force allocate tier. (PromisingConfig2) As part of this user exit, make the base optimization call for incoming promising config - PromisingConfig1 As per your requirement, you will get the following response: Allocation object1 - TR~DC~P103/OH/30 units Allocation object2 - TR~DC~E1/PO/30 units 10 units backordered (Will be requested quantity -Total Allocated quantity) For the backordered units, bridge in another promising request with a new promising request detail ID and new configuration (PromisingConfig2) and force allocate flag = true. This will allocate the remaining 10 units to the most optimal location, even if it doesn’t have actual inventory. Now, bridge in promising request detail again with quantity = 10 units, Request Detail Id = 1:1, ForceAllocate=true, PromisingConfigName=PromisingConfig2 Response will be Allocation object 1 - TR~DC~E1/OH/10 units Combine all 3 allocation objects and send back as response to order. How to configure capacity override for BOPIS order lines For store pick up order, source is already identified during order creation. Promising request will have Ship From Location ID populated for BOPIS orders. Any request with Ship From Location ID populated does not refer to the Location(s) defined in the Prioritization Tier. So, any capacity overrides should be defined only at Source (Header or Line level) for BOPIS orders. Line Level Source Overrides Criteria: Delivery Method Id = Pick Up At Store Overrides: Ignore Capacity = true How to configure return routing optimization Return Routing Optimization is used to determine the optimal location for returns and can be configured in the Fulfillment Optimization UI. How can we restrict inventory or allocation so that some stores support both Merge and Pickup allocations, while other stores are limited to Pickup legs only in the STS flow (Without using RDD)? STS Flow, restrict inventory or allocation so that some stores support both Merge and Pickup allocations, while other stores are limited to Pickup legs onlyCreate Location-to-Country lanes, but ensure the ATC view includes all locations with ShipToStore=true. These lanes should only include locations that can ship, preventing allocation to non-shipping locations, as they will not be part of the lanes. Pickup allocations do not require lanes . Non-shipping locations excluded from the lanes will fail scheduling for Merge allocations but will still be eligible for Pickup allocations. In this case, user can enable "ValidateLanesForEDD" in Promising Config Parameters. Note: • While creating a config in Fulfillment Optimization, if “Return Routing Optimization” is enabled, substitution or reapportionment cannot be selected. • The Return Routing Optimization is disabled on the UI for an existing forward promising config to prevent users from accidentally changing an existing configuration to a return configuration. Troubleshooting Return Routing Optimzation Promising Configuration checks: Check if the Return Routing Optimization option is enabled. Check if locations are marked to accept returns. Check if any optimization factors are enabled and if so, check if they fall under tolerance limits. In the API, check if the request is using the correct promising config. Selecting Locations: While selecting DC sourcing, only the DCs that are marked to accept returns will be visible in the return config. However, from the backend, any store can be marked to accept returns. There is currently no validation even in forward fulfillment configurations. In case ATC view is selected as the sourcing criteria, check if the view is marked with Accepts Returns. If Assortment optimization is selected, locations with existing supply records will be prioritized. Null Response when promising is called for determining a return center: If a forward config is used, promising will send a null response since the used config is invalid to determine a return center. If an invalid config is used, promising will send a null response since the used config is invalid to determine a return center. In case of a user mistake, if unique details such as request detail Id are passed with the same line Id, promising will send a null response. This behavior is also observed during forward promising If the address is invalid, promising will send a null response. Information related to null response can be checked using functional logs and debug logs. Why are orders released with a non-existent shipping method It is required to have the shipping method populated for the orders to be allocated/released, but the system does not validate the value of the shipping method. However, if the shipping method Id is empty or null, the order will not be released but will be backordered. Note: If the order has a carrier/service level, it does not need a shipping method. The shipping method is used to get to the carrier service level. Related Articles Advanced Shipping RestrictionsProcure To SellREST APIs and User ExitsCustomer Engagement ConfigurationsTroubleshootingOverviewForce AllocateSubstitution During AllocationForecast ReservationHow Optimization Works