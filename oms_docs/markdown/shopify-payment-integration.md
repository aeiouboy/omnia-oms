# Payment Integration with Shopify

**Permalink:** shopify-payment-integration
**Path:** Manhattan Active® Omni/Order Management/Process & Configuration Guides/Order Processing/Shopify Integration/Payment Integration with Shopify
**Content Length:** 38,898 characters
**Scraped:** 2025-08-09T21:58:17.228709

---

Home ››Manhattan Active® Omni››Order Management››Process & Configuration Guides››Order Processing››Shopify Integration ››Payment Integration with Shopify How to Integrate with Shopify Payments Previous I Next OverviewFollow-on SettlementFollow-on RefundShop Pay Commerce ComponentShopify Webhooks and APIsTransaction Create WebhookRefund Create WebhookShopify APIs CalledorderCapture MutationrefundCreate MutationConfigurationShopify Configuration - Manual Payment CapturePayment Gateway Configuration Shopify Connectivity ConfigurationError Handling and TroubleshootingTroubleshoot Out of the Box TranslationFailed MessagesRelated Articles Overview For orders authorized in Shopify, the follow-on settlements and refunds are also sent to Shopify for processing. For the purpose of this payments integration, Shopify is considered as a payment gateway such from the standpoint of Manhattan Active® Omni. From there, Shopify may integrate to the merchant's payment gateway for transaction processing. When orders are captured or modified in channels outside of Shopify, the associated new payment methods are not sent to Shopify. These payments are processed using another payment gateway. See Payment Gateway integration page for more information. Out of the box, the payment gateway "ShopifyPayments" is used for all orders that are created in Shopify. Follow-on Settlement Once an order is created in Shopify, the corresponding authorization transaction is sent to Manhattan Active® Omni, and a payment header, payment method and payment transactions are created. See create payment page for more information. Once the payment method is authorized, when the order is shipped, an invoice is created that leads to a follow-on settlement transaction being added to the payment method. This process is described in more detail in the settlement page. Regarding the Shopify integration, once the settlement transaction is created for a payment method that has "ShopifyPayments" as a payment gateway, it is sent to Shopify using the orderCapture mutation in Shopify GraphQL Admin API. Once the transaction is processed, a transaction create webhook is returned with the result of the settlement (success or failure). Follow-on Refund Once an order is settled, it can be refunded. See the refund page for more information on refund transactions. An order created in Shopify and settled in Shopify can also be refunded using ShopifyPayments as a payment gateway. In the case of a refund on the parent order or a return order, when a refund payment transaction is created, the refundCreate mutation in Shopify GrapQL Admin API is called to trigger the refund process. Once the refund process is complete, a refund create webhook is returned with the result of the refund (success or failure). Shop Pay Commerce Component Shop Pay Commerce Component (aka Shop Pay only stores) enables merchants to use Shop Pay as a payment method on e-commerce websites hosted by a provider other than Shopify. See Payment integration with Shop Pay only stores for more information. Shopify Webhooks and APIs Transaction Create Webhook The transaction create webhook is received both for authorization and settlement transaction creation. The content of this webhook is translated by the out of the box integration into a payment response to the payment component. Refund Create Webhook The refund create webhook is received when a refund transaction is processed in Shopify. The content of the webhook is translated by the out of the box integration into a payment response for the payment component. Shopify APIs Called orderCapture Mutation When a settlement payment transaction is processed, the orderCapture mutation is called to trigger the capture of funds for the merchant. Graph QL mutation Inputs mutation orderCapture($input: OrderCaptureInput!) { orderCapture(input: $input) { transaction { id kind status errorCode gateway createdAt paymentId accountNumber paymentDetails { ... on CardPaymentDetails { company cvvResultCode expirationMonth expirationYear name number paymentMethodName } } amountSet { presentmentMoney { amount } } } userErrors { field message } } } { "id":"<transactionId>", "amount":"<amount to capture>", "parentTransactionId":"gid://shopify/OrderTransaction/<auth transaction id>" } If there are no errors, the transaction status is updated to in progress while waiting for the corresponding webhook. refundCreate Mutation When a refund payment transaction is processed, the refundCreate mutation is called to trigger the refund of funds to the customer. Graph QL mutation Inputs mutation refundCreate($input: RefundInput!) { refundCreate(input: $input) { order { id } refund { id transactions(first: 100) { nodes { id kind status } } createdAt totalRefundedSet { presentmentMoney { amount } } } userErrors { field message } } } { "kind": "REFUND", "orderId": "<parent order id>", "amount": "<amount to refund>", "parentId": "gid://shopify/OrderTransaction/<settlement transaction ID>" } If there are no errors, the transaction status is updated to in progress while waiting for the corresponding webhook. Configuration Shopify Configuration - Manual Payment Capture Shopify has the ability to decide what amount needs to be captured based on the order status. However, in the out-of-the-box integration, Manhattan Active® Omni is the payment orchestration system that decides how much to settle and refund for each payment method. To support this, Shopify payment capture must be configured to "Manual Capture". In Settings > Payments> Payment capture method: Payment Gateway Configuration If you installed the Manhattan Active® Omni App on the Shopify store, the payment gateway 'ShopifyPayments" should already be configured. The attributes below are the mandatory attributes. They are listed here for information purposes. Account Attributes APIVersion - "2024-07" ShopifyDomain - the shopify store domain. Example: "my-store.myshopify.com" Account encrypted attributes: Access Token given by the app ShopifyPayment payment gatewayPOST {{url}}/payment/api/payment/gateway/save { "PerformsStandaloneRefunds": true, "Account": [ { "AccountAttribute": [ { "Value": "2024-07", "Name": "ApiVersion" }, { "Value": "https://<yourstore>.myshopify.com/", "Name": "ShopifyDomain" } ], "UpdatedTimestamp": "2024-05-16T16:31:04.831", "AccountId": "Shopify", "AccountEncryptedAttribute": [ { "Name": "AccessToken", "Value": "your app access token" } ] } ], "GatewayId": "ShopifyPayments", "IsBase": true, "ProcessStuckTransaction": true } Shopify Connectivity Configuration See the configuration page for more information on connecting a Shopify store to a Manhattan Active® Omni organization. Error Handling and Troubleshooting Troubleshoot Out of the Box Translation An API is available to invoke the out-of-the-box translation logic using the content of a Shopify webhook as an input. POST {{url}}/marketplace/api/shopify/fieldMapping It has two inputs: The webhookFunction - can be "Order" or "Payment" The webhookDocument - the actual content of the webhook coming from Shopify The response of the API will contain the translated order or payment. Example of input for translation API - Payment{ "webhookFunction": "Payment", "webhookDocument": { "id": 7049124577592, "order_id": 5767690486072, "kind": "capture", "gateway": "shopify_payments", "status": "success", "message": "Transaction approved", "created_at": "2024-03-04T21:47:02-05:00", "test": true, "authorization": "pi_3Oqo1vR5TdXGiMG90EDxPHxL", "location_id": null, "user_id": null, "parent_id": 7049124446520, "processed_at": "2024-03-04T21:47:03-05:00", "device_id": null, "error_code": null, "source_name": "web", "payment_details": { "credit_card_bin": "424242", "avs_result_code": "Y", "cvv_result_code": "M", "credit_card_number": "•••• •••• •••• 4242", "credit_card_company": "Visa", "buyer_action_info": null, "credit_card_name": "FirstName lastName", "credit_card_wallet": null, "credit_card_expiration_month": 12, "credit_card_expiration_year": 2024, "payment_method_name": "visa" }, "receipt": { "id": "pi_3Oqo1vR5TdXGiMG90EDxPHxL", "object": "payment_intent", "amount": 262995, "amount_capturable": 0, "amount_received": 262995, "canceled_at": null, "cancellation_reason": null, "capture_method": "manual", "charges": { "object": "list", "data": [ { "id": "ch_3Oqo1vR5TdXGiMG90Gdy8kri", "object": "charge", "amount": 262995, "application_fee": "fee_1Oqo1zR5TdXGiMG90EQcIG4r", "balance_transaction": { "id": "txn_3Oqo1vR5TdXGiMG900267c4V", "object": "balance_transaction", "exchange_rate": null }, "captured": true, "created": 1709606819, "currency": "usd", "failure_code": null, "failure_message": null, "fraud_details": {}, "livemode": false, "metadata": { "email": "lastName@manh.com", "manual_entry": "false", "order_id": "rG2Btrmx0RRiLtO6MzEwaPvSp", "order_transaction_id": "7049124446520", "payments_charge_id": "2677898019128", "shop_id": "85567275320", "shop_name": "Test_manh_test" }, "outcome": { "network_status": "approved_by_network", "reason": null, "risk_level": "normal", "risk_score": 48, "seller_message": "Payment complete.", "type": "authorized" }, "paid": true, "payment_intent": "pi_3Oqo1vR5TdXGiMG90EDxPHxL", "payment_method": "pm_1Oqo1vR5TdXGiMG9idmzviPZ", "payment_method_details": { "card": { "amount_authorized": 262995, "brand": "visa", "capture_before": 1712026019, "checks": { "address_line1_check": "pass", "address_postal_code_check": "pass", "cvc_check": "pass" }, "country": "US", "description": "Visa Classic", "ds_transaction_id": null, "exp_month": 12, "exp_year": 2024, "extended_authorization": { "status": "enabled" }, "fingerprint": "2M23dVRniScqT7K2", "funding": "credit", "iin": "424242", "incremental_authorization": { "status": "unavailable" }, "installments": null, "issuer": "Stripe Payments UK Limited", "last4": "4242", "mandate": null, "moto": null, "multicapture": { "status": "unavailable" }, "network": "visa", "network_token": { "used": false }, "network_transaction_id": "987489114841006", "overcapture": { "maximum_amount_capturable": 302444, "status": "available" }, "overcapture_supported": true, "payment_account_reference": "xR4eIL3CZCjH9hMkhqeysHPkE5Zxs", "three_d_secure": null, "wallet": null }, "type": "card" }, "refunded": false, "source": null, "status": "succeeded", "mit_params": { "network_transaction_id": "987489114841006" } } ], "has_more": false, "total_count": 1, "url": "\/v1\/charges?payment_intent=pi_3Oqo1vR5TdXGiMG90EDxPHxL" }, "confirmation_method": "manual", "created": 1709606819, "currency": "usd", "last_payment_error": null, "livemode": false, "metadata": { "email": "clastName@manh.com", "manual_entry": "false", "order_id": "rG2Btrmx0RRiLtO6MzEwaPvSp", "order_transaction_id": "7049124446520", "payments_charge_id": "2677898019128", "shop_id": "85567275320", "shop_name": "Test_manh_test" }, "next_action": null, "payment_method": "pm_1Oqo1vR5TdXGiMG9idmzviPZ", "payment_method_types": [ "card" ], "source": null, "status": "succeeded" }, "amount": "2629.95", "currency": "USD", "payment_id": "#1008.2", "total_unsettled_set": { "presentment_money": { "amount": "0.0", "currency": "USD" }, "shop_money": { "amount": "0.0", "currency": "USD" } }, "manual_payment_gateway": false, "admin_graphql_api_id": "gid:\/\/shopify\/OrderTransaction\/7049124577592" } } Failed Messages If an order or a payment fails to be created for any reason, it will be posted to failed messages for future re-processing. Related Articles Order Integration with ShopifyShop Pay IntegrationShopify Technical IntegrationInventory Integration with Shopify